var Yd=Object.create,Cn=Object.defineProperty,Zd=Object.defineProperties,eu=Object.getOwnPropertyDescriptor,tu=Object.getOwnPropertyDescriptors,Ms=Object.getOwnPropertyNames,vn=Object.getOwnPropertySymbols,iu=Object.getPrototypeOf,Ns=Object.prototype.hasOwnProperty,so=Object.prototype.propertyIsEnumerable,Or=(e,i)=>{if(i=Symbol[e])return i;throw Error("Symbol."+e+" is not defined")},Hi=Math.pow,ba=(e,i,r)=>i in e?Cn(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,ue=(e,i)=>{for(var r in i||(i={}))Ns.call(i,r)&&ba(e,r,i[r]);if(vn)for(var r of vn(i))so.call(i,r)&&ba(e,r,i[r]);return e},ge=(e,i)=>Zd(e,tu(i)),as=(e,i)=>{var r={};for(var s in e)Ns.call(e,s)&&i.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&vn)for(var s of vn(e))i.indexOf(s)<0&&so.call(e,s)&&(r[s]=e[s]);return r},ru=(e,i)=>function(){return e&&(i=(0,e[Ms(e)[0]])(e=0)),i},fe=(e,i)=>function(){return i||(0,e[Ms(e)[0]])((i={exports:{}}).exports,i),i.exports},nu=(e,i)=>{for(var r in i)Cn(e,r,{get:i[r],enumerable:!0})},su=(e,i,r,s)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of Ms(i))!Ns.call(e,o)&&o!==r&&Cn(e,o,{get:()=>i[o],enumerable:!(s=eu(i,o))||s.enumerable});return e},$t=(e,i,r)=>(r=e!=null?Yd(iu(e)):{},su(!e||!e.__esModule?Cn(r,"default",{value:e,enumerable:!0}):r,e)),M=(e,i,r)=>new Promise((s,o)=>{var l=C=>{try{m(r.next(C))}catch(h){o(h)}},d=C=>{try{m(r.throw(C))}catch(h){o(h)}},m=C=>C.done?s(C.value):Promise.resolve(C.value).then(l,d);m((r=r.apply(e,i)).next())}),pr=function(e,i){this[0]=e,this[1]=i},ao=(e,i,r)=>{var s=(d,m,C,h)=>{try{var v=r[d](m),D=(m=v.value)instanceof pr,E=v.done;Promise.resolve(D?m[0]:m).then(R=>D?s(d==="return"?d:"next",m[1]?{done:R.done,value:R.value}:R,C,h):C({value:R,done:E})).catch(R=>s("throw",R,C,h))}catch(R){h(R)}},o=d=>l[d]=m=>new Promise((C,h)=>s(d,m,C,h)),l={};return r=r.apply(e,i),l[Symbol.asyncIterator]=()=>l,o("next"),o("throw"),o("return"),l},oo=e=>{var i=e[Or("asyncIterator")],r=!1,s,o={};return i==null?(i=e[Or("iterator")](),s=l=>o[l]=d=>i[l](d)):(i=i.call(e),s=l=>o[l]=d=>{if(r){if(r=!1,l==="throw")throw d;return d}return r=!0,{done:!1,value:new pr(new Promise(m=>{var C=i[l](d);if(!(C instanceof Object))throw TypeError("Object expected");m(C)}),1)}}),o[Or("iterator")]=()=>o,s("next"),"throw"in i?s("throw"):o.throw=l=>{throw l},"return"in i&&s("return"),o},au=(e,i,r)=>(i=e[Or("asyncIterator")])?i.call(e):(e=e[Or("iterator")](),i={},r=(s,o)=>(o=e[s])&&(i[s]=l=>new Promise((d,m,C)=>(l=o.call(e,l),C=l.done,Promise.resolve(l.value).then(h=>d({value:h,done:C}),m)))),r("next"),r("return"),i),hr,Z=ru({"shims/process.js"(){hr=void 0}}),co=fe({"../../node_modules/bowser/es5.js"(e,i){Z(),function(r,s){typeof e=="object"&&typeof i=="object"?i.exports=s():typeof define=="function"&&define.amd?define([],s):typeof e=="object"?e.bowser=s():r.bowser=s()}(e,function(){return function(r){var s={};function o(l){if(s[l])return s[l].exports;var d=s[l]={i:l,l:!1,exports:{}};return r[l].call(d.exports,d,d.exports,o),d.l=!0,d.exports}return o.m=r,o.c=s,o.d=function(l,d,m){o.o(l,d)||Object.defineProperty(l,d,{enumerable:!0,get:m})},o.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},o.t=function(l,d){if(1&d&&(l=o(l)),8&d||4&d&&typeof l=="object"&&l&&l.__esModule)return l;var m=Object.create(null);if(o.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:l}),2&d&&typeof l!="string")for(var C in l)o.d(m,C,(function(h){return l[h]}).bind(null,C));return m},o.n=function(l){var d=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(d,"a",d),d},o.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},o.p="",o(o.s=90)}({17:function(r,s,o){s.__esModule=!0,s.default=void 0;var l=o(18),d=function(){function m(){}return m.getFirstMatch=function(C,h){var v=h.match(C);return v&&v.length>0&&v[1]||""},m.getSecondMatch=function(C,h){var v=h.match(C);return v&&v.length>1&&v[2]||""},m.matchAndReturnConst=function(C,h,v){if(C.test(h))return v},m.getWindowsVersionName=function(C){switch(C){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},m.getMacOSVersionName=function(C){var h=C.split(".").splice(0,2).map(function(v){return parseInt(v,10)||0});if(h.push(0),h[0]===10)switch(h[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},m.getAndroidVersionName=function(C){var h=C.split(".").splice(0,2).map(function(v){return parseInt(v,10)||0});if(h.push(0),!(h[0]===1&&h[1]<5))return h[0]===1&&h[1]<6?"Cupcake":h[0]===1&&h[1]>=6?"Donut":h[0]===2&&h[1]<2?"Eclair":h[0]===2&&h[1]===2?"Froyo":h[0]===2&&h[1]>2?"Gingerbread":h[0]===3?"Honeycomb":h[0]===4&&h[1]<1?"Ice Cream Sandwich":h[0]===4&&h[1]<4?"Jelly Bean":h[0]===4&&h[1]>=4?"KitKat":h[0]===5?"Lollipop":h[0]===6?"Marshmallow":h[0]===7?"Nougat":h[0]===8?"Oreo":h[0]===9?"Pie":void 0},m.getVersionPrecision=function(C){return C.split(".").length},m.compareVersions=function(C,h,v){v===void 0&&(v=!1);var D=m.getVersionPrecision(C),E=m.getVersionPrecision(h),R=Math.max(D,E),b=0,H=m.map([C,h],function(j){var k=R-m.getVersionPrecision(j),y=j+new Array(k+1).join(".0");return m.map(y.split("."),function(f){return new Array(20-f.length).join("0")+f}).reverse()});for(v&&(b=R-Math.min(D,E)),R-=1;R>=b;){if(H[0][R]>H[1][R])return 1;if(H[0][R]===H[1][R]){if(R===b)return 0;R-=1}else if(H[0][R]<H[1][R])return-1}},m.map=function(C,h){var v,D=[];if(Array.prototype.map)return Array.prototype.map.call(C,h);for(v=0;v<C.length;v+=1)D.push(h(C[v]));return D},m.find=function(C,h){var v,D;if(Array.prototype.find)return Array.prototype.find.call(C,h);for(v=0,D=C.length;v<D;v+=1){var E=C[v];if(h(E,v))return E}},m.assign=function(C){for(var h,v,D=C,E=arguments.length,R=new Array(E>1?E-1:0),b=1;b<E;b++)R[b-1]=arguments[b];if(Object.assign)return Object.assign.apply(Object,[C].concat(R));var H=function(){var j=R[h];typeof j=="object"&&j!==null&&Object.keys(j).forEach(function(k){D[k]=j[k]})};for(h=0,v=R.length;h<v;h+=1)H();return C},m.getBrowserAlias=function(C){return l.BROWSER_ALIASES_MAP[C]},m.getBrowserTypeByAlias=function(C){return l.BROWSER_MAP[C]||""},m}();s.default=d,r.exports=s.default},18:function(r,s,o){s.__esModule=!0,s.ENGINE_MAP=s.OS_MAP=s.PLATFORMS_MAP=s.BROWSER_MAP=s.BROWSER_ALIASES_MAP=void 0,s.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},s.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},s.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},s.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},s.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(r,s,o){s.__esModule=!0,s.default=void 0;var l,d=(l=o(91))&&l.__esModule?l:{default:l},m=o(18);function C(v,D){for(var E=0;E<D.length;E++){var R=D[E];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(v,R.key,R)}}var h=function(){function v(){}var D,E,R;return v.getParser=function(b,H){if(H===void 0&&(H=!1),typeof b!="string")throw new Error("UserAgent should be a string");return new d.default(b,H)},v.parse=function(b){return new d.default(b).getResult()},D=v,R=[{key:"BROWSER_MAP",get:function(){return m.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return m.ENGINE_MAP}},{key:"OS_MAP",get:function(){return m.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return m.PLATFORMS_MAP}}],(E=null)&&C(D.prototype,E),R&&C(D,R),v}();s.default=h,r.exports=s.default},91:function(r,s,o){s.__esModule=!0,s.default=void 0;var l=v(o(92)),d=v(o(93)),m=v(o(94)),C=v(o(95)),h=v(o(17));function v(E){return E&&E.__esModule?E:{default:E}}var D=function(){function E(b,H){if(H===void 0&&(H=!1),b==null||b==="")throw new Error("UserAgent parameter can't be empty");this._ua=b,this.parsedResult={},H!==!0&&this.parse()}var R=E.prototype;return R.getUA=function(){return this._ua},R.test=function(b){return b.test(this._ua)},R.parseBrowser=function(){var b=this;this.parsedResult.browser={};var H=h.default.find(l.default,function(j){if(typeof j.test=="function")return j.test(b);if(j.test instanceof Array)return j.test.some(function(k){return b.test(k)});throw new Error("Browser's test function is not valid")});return H&&(this.parsedResult.browser=H.describe(this.getUA())),this.parsedResult.browser},R.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},R.getBrowserName=function(b){return b?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},R.getBrowserVersion=function(){return this.getBrowser().version},R.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},R.parseOS=function(){var b=this;this.parsedResult.os={};var H=h.default.find(d.default,function(j){if(typeof j.test=="function")return j.test(b);if(j.test instanceof Array)return j.test.some(function(k){return b.test(k)});throw new Error("Browser's test function is not valid")});return H&&(this.parsedResult.os=H.describe(this.getUA())),this.parsedResult.os},R.getOSName=function(b){var H=this.getOS().name;return b?String(H).toLowerCase()||"":H||""},R.getOSVersion=function(){return this.getOS().version},R.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},R.getPlatformType=function(b){b===void 0&&(b=!1);var H=this.getPlatform().type;return b?String(H).toLowerCase()||"":H||""},R.parsePlatform=function(){var b=this;this.parsedResult.platform={};var H=h.default.find(m.default,function(j){if(typeof j.test=="function")return j.test(b);if(j.test instanceof Array)return j.test.some(function(k){return b.test(k)});throw new Error("Browser's test function is not valid")});return H&&(this.parsedResult.platform=H.describe(this.getUA())),this.parsedResult.platform},R.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},R.getEngineName=function(b){return b?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},R.parseEngine=function(){var b=this;this.parsedResult.engine={};var H=h.default.find(C.default,function(j){if(typeof j.test=="function")return j.test(b);if(j.test instanceof Array)return j.test.some(function(k){return b.test(k)});throw new Error("Browser's test function is not valid")});return H&&(this.parsedResult.engine=H.describe(this.getUA())),this.parsedResult.engine},R.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},R.getResult=function(){return h.default.assign({},this.parsedResult)},R.satisfies=function(b){var H=this,j={},k=0,y={},f=0;if(Object.keys(b).forEach(function(X){var ee=b[X];typeof ee=="string"?(y[X]=ee,f+=1):typeof ee=="object"&&(j[X]=ee,k+=1)}),k>0){var w=Object.keys(j),F=h.default.find(w,function(X){return H.isOS(X)});if(F){var U=this.satisfies(j[F]);if(U!==void 0)return U}var q=h.default.find(w,function(X){return H.isPlatform(X)});if(q){var V=this.satisfies(j[q]);if(V!==void 0)return V}}if(f>0){var $=Object.keys(y),J=h.default.find($,function(X){return H.isBrowser(X,!0)});if(J!==void 0)return this.compareVersion(y[J])}},R.isBrowser=function(b,H){H===void 0&&(H=!1);var j=this.getBrowserName().toLowerCase(),k=b.toLowerCase(),y=h.default.getBrowserTypeByAlias(k);return H&&y&&(k=y.toLowerCase()),k===j},R.compareVersion=function(b){var H=[0],j=b,k=!1,y=this.getBrowserVersion();if(typeof y=="string")return b[0]===">"||b[0]==="<"?(j=b.substr(1),b[1]==="="?(k=!0,j=b.substr(2)):H=[],b[0]===">"?H.push(1):H.push(-1)):b[0]==="="?j=b.substr(1):b[0]==="~"&&(k=!0,j=b.substr(1)),H.indexOf(h.default.compareVersions(y,j,k))>-1},R.isOS=function(b){return this.getOSName(!0)===String(b).toLowerCase()},R.isPlatform=function(b){return this.getPlatformType(!0)===String(b).toLowerCase()},R.isEngine=function(b){return this.getEngineName(!0)===String(b).toLowerCase()},R.is=function(b,H){return H===void 0&&(H=!1),this.isBrowser(b,H)||this.isOS(b)||this.isPlatform(b)},R.some=function(b){var H=this;return b===void 0&&(b=[]),b.some(function(j){return H.is(j)})},E}();s.default=D,r.exports=s.default},92:function(r,s,o){s.__esModule=!0,s.default=void 0;var l,d=(l=o(17))&&l.__esModule?l:{default:l},m=/version\/(\d+(\.?_?\d+)+)/i,C=[{test:[/googlebot/i],describe:function(h){var v={name:"Googlebot"},D=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/opera/i],describe:function(h){var v={name:"Opera"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/opr\/|opios/i],describe:function(h){var v={name:"Opera"},D=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/SamsungBrowser/i],describe:function(h){var v={name:"Samsung Internet for Android"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/Whale/i],describe:function(h){var v={name:"NAVER Whale Browser"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/MZBrowser/i],describe:function(h){var v={name:"MZ Browser"},D=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/focus/i],describe:function(h){var v={name:"Focus"},D=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/swing/i],describe:function(h){var v={name:"Swing"},D=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/coast/i],describe:function(h){var v={name:"Opera Coast"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(h){var v={name:"Opera Touch"},D=d.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/yabrowser/i],describe:function(h){var v={name:"Yandex Browser"},D=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/ucbrowser/i],describe:function(h){var v={name:"UC Browser"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/Maxthon|mxios/i],describe:function(h){var v={name:"Maxthon"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/epiphany/i],describe:function(h){var v={name:"Epiphany"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/puffin/i],describe:function(h){var v={name:"Puffin"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/sleipnir/i],describe:function(h){var v={name:"Sleipnir"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/k-meleon/i],describe:function(h){var v={name:"K-Meleon"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/micromessenger/i],describe:function(h){var v={name:"WeChat"},D=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/qqbrowser/i],describe:function(h){var v={name:/qqbrowserlite/i.test(h)?"QQ Browser Lite":"QQ Browser"},D=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/msie|trident/i],describe:function(h){var v={name:"Internet Explorer"},D=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/\sedg\//i],describe:function(h){var v={name:"Microsoft Edge"},D=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/edg([ea]|ios)/i],describe:function(h){var v={name:"Microsoft Edge"},D=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/vivaldi/i],describe:function(h){var v={name:"Vivaldi"},D=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/seamonkey/i],describe:function(h){var v={name:"SeaMonkey"},D=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/sailfish/i],describe:function(h){var v={name:"Sailfish"},D=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,h);return D&&(v.version=D),v}},{test:[/silk/i],describe:function(h){var v={name:"Amazon Silk"},D=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/phantom/i],describe:function(h){var v={name:"PhantomJS"},D=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/slimerjs/i],describe:function(h){var v={name:"SlimerJS"},D=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(h){var v={name:"BlackBerry"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/(web|hpw)[o0]s/i],describe:function(h){var v={name:"WebOS Browser"},D=d.default.getFirstMatch(m,h)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/bada/i],describe:function(h){var v={name:"Bada"},D=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/tizen/i],describe:function(h){var v={name:"Tizen"},D=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/qupzilla/i],describe:function(h){var v={name:"QupZilla"},D=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/firefox|iceweasel|fxios/i],describe:function(h){var v={name:"Firefox"},D=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/electron/i],describe:function(h){var v={name:"Electron"},D=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/MiuiBrowser/i],describe:function(h){var v={name:"Miui"},D=d.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/chromium/i],describe:function(h){var v={name:"Chromium"},D=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,h)||d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/chrome|crios|crmo/i],describe:function(h){var v={name:"Chrome"},D=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/GSA/i],describe:function(h){var v={name:"Google Search"},D=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:function(h){var v=!h.test(/like android/i),D=h.test(/android/i);return v&&D},describe:function(h){var v={name:"Android Browser"},D=d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/playstation 4/i],describe:function(h){var v={name:"PlayStation 4"},D=d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/safari|applewebkit/i],describe:function(h){var v={name:"Safari"},D=d.default.getFirstMatch(m,h);return D&&(v.version=D),v}},{test:[/.*/i],describe:function(h){var v=h.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:d.default.getFirstMatch(v,h),version:d.default.getSecondMatch(v,h)}}}];s.default=C,r.exports=s.default},93:function(r,s,o){s.__esModule=!0,s.default=void 0;var l,d=(l=o(17))&&l.__esModule?l:{default:l},m=o(18),C=[{test:[/Roku\/DVP/],describe:function(h){var v=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,h);return{name:m.OS_MAP.Roku,version:v}}},{test:[/windows phone/i],describe:function(h){var v=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,h);return{name:m.OS_MAP.WindowsPhone,version:v}}},{test:[/windows /i],describe:function(h){var v=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,h),D=d.default.getWindowsVersionName(v);return{name:m.OS_MAP.Windows,version:v,versionName:D}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(h){var v={name:m.OS_MAP.iOS},D=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,h);return D&&(v.version=D),v}},{test:[/macintosh/i],describe:function(h){var v=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,h).replace(/[_\s]/g,"."),D=d.default.getMacOSVersionName(v),E={name:m.OS_MAP.MacOS,version:v};return D&&(E.versionName=D),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(h){var v=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,h).replace(/[_\s]/g,".");return{name:m.OS_MAP.iOS,version:v}}},{test:function(h){var v=!h.test(/like android/i),D=h.test(/android/i);return v&&D},describe:function(h){var v=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,h),D=d.default.getAndroidVersionName(v),E={name:m.OS_MAP.Android,version:v};return D&&(E.versionName=D),E}},{test:[/(web|hpw)[o0]s/i],describe:function(h){var v=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,h),D={name:m.OS_MAP.WebOS};return v&&v.length&&(D.version=v),D}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(h){var v=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,h)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,h)||d.default.getFirstMatch(/\bbb(\d+)/i,h);return{name:m.OS_MAP.BlackBerry,version:v}}},{test:[/bada/i],describe:function(h){var v=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,h);return{name:m.OS_MAP.Bada,version:v}}},{test:[/tizen/i],describe:function(h){var v=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,h);return{name:m.OS_MAP.Tizen,version:v}}},{test:[/linux/i],describe:function(){return{name:m.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:m.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(h){var v=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,h);return{name:m.OS_MAP.PlayStation4,version:v}}}];s.default=C,r.exports=s.default},94:function(r,s,o){s.__esModule=!0,s.default=void 0;var l,d=(l=o(17))&&l.__esModule?l:{default:l},m=o(18),C=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(h){var v=d.default.getFirstMatch(/(can-l01)/i,h)&&"Nova",D={type:m.PLATFORMS_MAP.mobile,vendor:"Huawei"};return v&&(D.model=v),D}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(h){var v=h.test(/ipod|iphone/i),D=h.test(/like (ipod|iphone)/i);return v&&!D},describe:function(h){var v=d.default.getFirstMatch(/(ipod|iphone)/i,h);return{type:m.PLATFORMS_MAP.mobile,vendor:"Apple",model:v}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getBrowserName(!0)==="blackberry"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(h){return h.getBrowserName(!0)==="bada"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getBrowserName()==="windows phone"},describe:function(){return{type:m.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(h){var v=Number(String(h.getOSVersion()).split(".")[0]);return h.getOSName(!0)==="android"&&v>=3},describe:function(){return{type:m.PLATFORMS_MAP.tablet}}},{test:function(h){return h.getOSName(!0)==="android"},describe:function(){return{type:m.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getOSName(!0)==="macos"},describe:function(){return{type:m.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(h){return h.getOSName(!0)==="windows"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(h){return h.getOSName(!0)==="linux"},describe:function(){return{type:m.PLATFORMS_MAP.desktop}}},{test:function(h){return h.getOSName(!0)==="playstation 4"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}},{test:function(h){return h.getOSName(!0)==="roku"},describe:function(){return{type:m.PLATFORMS_MAP.tv}}}];s.default=C,r.exports=s.default},95:function(r,s,o){s.__esModule=!0,s.default=void 0;var l,d=(l=o(17))&&l.__esModule?l:{default:l},m=o(18),C=[{test:function(h){return h.getBrowserName(!0)==="microsoft edge"},describe:function(h){if(/\sedg\//i.test(h))return{name:m.ENGINE_MAP.Blink};var v=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,h);return{name:m.ENGINE_MAP.EdgeHTML,version:v}}},{test:[/trident/i],describe:function(h){var v={name:m.ENGINE_MAP.Trident},D=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:function(h){return h.test(/presto/i)},describe:function(h){var v={name:m.ENGINE_MAP.Presto},D=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:function(h){var v=h.test(/gecko/i),D=h.test(/like gecko/i);return v&&!D},describe:function(h){var v={name:m.ENGINE_MAP.Gecko},D=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:m.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(h){var v={name:m.ENGINE_MAP.WebKit},D=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,h);return D&&(v.version=D),v}}];s.default=C,r.exports=s.default}})})}}),lo=fe({"../../node_modules/sdp-transform/lib/grammar.js"(e,i){Z();var r=i.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(s){return s.encoding?"rtpmap:%d %s/%s/%s":s.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(s){return s.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(s){return s.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(s){return"extmap:%d"+(s.direction?"/%s":"%v")+(s["encrypt-uri"]?" %s":"%v")+" %s"+(s.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(s){return s.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(s){var o="candidate:%s %d %s %d %s %d typ %s";return o+=s.raddr!=null?" raddr %s rport %d":"%v%v",o+=s.tcptype!=null?" tcptype %s":"%v",s.generation!=null&&(o+=" generation %d"),o+=s["network-id"]!=null?" network-id %d":"%v",o+=s["network-cost"]!=null?" network-cost %d":"%v",o}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(s){var o="ssrc:%d";return s.attribute!=null&&(o+=" %s",s.value!=null&&(o+=":%s")),o}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(s){return s.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(s){return s.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(s){return"imageattr:%s %s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(s){return"simulcast:%s %s"+(s.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(s){return"ts-refclk:%s"+(s.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(s){var o="mediaclk:";return o+=s.id!=null?"id=%s %s":"%v%s",o+=s.mediaClockValue!=null?"=%s":"",o+=s.rateNumerator!=null?" rate=%s":"",o+=s.rateDenominator!=null?"/%s":"",o}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(s){var o=r[s];o.forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})}}),ou=fe({"../../node_modules/sdp-transform/lib/parser.js"(e){Z();var i=function(m){return String(Number(m))===m?Number(m):m},r=function(m,C,h,v){if(v&&!h)C[v]=i(m[1]);else for(var D=0;D<h.length;D+=1)m[D+1]!=null&&(C[h[D]]=i(m[D+1]))},s=function(m,C,h){var v=m.name&&m.names;m.push&&!C[m.push]?C[m.push]=[]:v&&!C[m.name]&&(C[m.name]={});var D=m.push?{}:v?C[m.name]:C;r(h.match(m.reg),D,m.names,m.name),m.push&&C[m.push].push(D)},o=lo(),l=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(m){var C={},h=[],v=C;return m.split(/(\r\n|\r|\n)/).filter(l).forEach(function(D){var E=D[0],R=D.slice(2);E==="m"&&(h.push({rtp:[],fmtp:[]}),v=h[h.length-1]);for(var b=0;b<(o[E]||[]).length;b+=1){var H=o[E][b];if(H.reg.test(R))return s(H,v,R)}}),C.media=h,C};var d=function(m,C){var h=C.split(/=(.+)/,2);return h.length===2?m[h[0]]=i(h[1]):h.length===1&&C.length>1&&(m[h[0]]=void 0),m};e.parseParams=function(m){return m.split(/;\s?/).reduce(d,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(m){return m.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(m){for(var C=[],h=m.split(" ").map(i),v=0;v<h.length;v+=3)C.push({component:h[v],ip:h[v+1],port:h[v+2]});return C},e.parseImageAttributes=function(m){return m.split(" ").map(function(C){return C.substring(1,C.length-1).split(",").reduce(d,{})})},e.parseSimulcastStreamList=function(m){return m.split(";").map(function(C){return C.split(",").map(function(h){var v,D=!1;return h[0]!=="~"?v=i(h):(v=i(h.substring(1,h.length)),D=!0),{scid:v,paused:D}})})}}}),cu=fe({"../../node_modules/sdp-transform/lib/writer.js"(e,i){Z();var r=lo(),s=/%[sdv%]/g,o=function(C){var h=1,v=arguments,D=v.length;return C.replace(s,function(E){if(h>=D)return E;var R=v[h];switch(h+=1,E){case"%%":return"%";case"%s":return String(R);case"%d":return Number(R);case"%v":return""}})},l=function(C,h,v){var D=h.format instanceof Function?h.format(h.push?v:v[h.name]):h.format,E=[C+"="+D];if(h.names)for(var R=0;R<h.names.length;R+=1){var b=h.names[R];h.name?E.push(v[h.name][b]):E.push(v[h.names[R]])}else E.push(v[h.name]);return o.apply(null,E)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],m=["i","c","b","a"];i.exports=function(C,h){h=h||{},C.version==null&&(C.version=0),C.name==null&&(C.name=" "),C.media.forEach(function(R){R.payloads==null&&(R.payloads="")});var v=h.outerOrder||d,D=h.innerOrder||m,E=[];return v.forEach(function(R){r[R].forEach(function(b){b.name in C&&C[b.name]!=null?E.push(l(R,b,C)):b.push in C&&C[b.push]!=null&&C[b.push].forEach(function(H){E.push(l(R,b,H))})})}),C.media.forEach(function(R){E.push(l("m",r.m[0],R)),D.forEach(function(b){r[b].forEach(function(H){H.name in R&&R[H.name]!=null?E.push(l(b,H,R)):H.push in R&&R[H.push]!=null&&R[H.push].forEach(function(j){E.push(l(b,H,j))})})})}),E.join(`\r
`)+`\r
`}}}),Ft=fe({"../../node_modules/sdp-transform/lib/index.js"(e){Z();var i=ou(),r=cu();e.write=r,e.parse=i.parse,e.parseParams=i.parseParams,e.parseFmtpConfig=i.parseFmtpConfig,e.parsePayloads=i.parsePayloads,e.parseRemoteCandidates=i.parseRemoteCandidates,e.parseImageAttributes=i.parseImageAttributes,e.parseSimulcastStreamList=i.parseSimulcastStreamList}}),lu=fe({"../../node_modules/ua-parser-js/src/ua-parser.js"(e,i){Z(),function(r,s){var o="0.7.33",l="",d="?",m="function",C="undefined",h="object",v="string",D="major",E="model",R="name",b="type",H="vendor",j="version",k="architecture",y="console",f="mobile",w="tablet",F="smarttv",U="wearable",q="embedded",V=350,$="Amazon",J="Apple",X="ASUS",ee="BlackBerry",re="Browser",ne="Chrome",Ce="Edge",Re="Firefox",ke="Google",Y="Huawei",he="LG",be="Microsoft",me="Motorola",Te="Opera",Be="Samsung",st="Sharp",ti="Sony",Gt="Xiaomi",nr="Zebra",_i="Facebook",Un=function(He,$e){var Ue={};for(var at in He)$e[at]&&$e[at].length%2===0?Ue[at]=$e[at].concat(He[at]):Ue[at]=He[at];return Ue},sr=function(He){for(var $e={},Ue=0;Ue<He.length;Ue++)$e[He[Ue].toUpperCase()]=He[Ue];return $e},qr=function(He,$e){return typeof He===v?qi($e).indexOf(qi(He))!==-1:!1},qi=function(He){return He.toLowerCase()},qn=function(He){return typeof He===v?He.replace(/[^\d\.]/g,l).split(".")[0]:s},yr=function(He,$e){if(typeof He===v)return He=He.replace(/^\s\s*/,l),typeof $e===C?He:He.substring(0,V)},Jt=function(He,$e){for(var Ue=0,at,Ke,or,et,Vi,ii;Ue<$e.length&&!Vi;){var zr=$e[Ue],Wr=$e[Ue+1];for(at=Ke=0;at<zr.length&&!Vi;)if(Vi=zr[at++].exec(He),Vi)for(or=0;or<Wr.length;or++)ii=Vi[++Ke],et=Wr[or],typeof et===h&&et.length>0?et.length===2?typeof et[1]==m?this[et[0]]=et[1].call(this,ii):this[et[0]]=et[1]:et.length===3?typeof et[1]===m&&!(et[1].exec&&et[1].test)?this[et[0]]=ii?et[1].call(this,ii,et[2]):s:this[et[0]]=ii?ii.replace(et[1],et[2]):s:et.length===4&&(this[et[0]]=ii?et[3].call(this,ii.replace(et[1],et[2])):s):this[et]=ii||s;Ue+=2}},_r=function(He,$e){for(var Ue in $e)if(typeof $e[Ue]===h&&$e[Ue].length>0){for(var at=0;at<$e[Ue].length;at++)if(qr($e[Ue][at],He))return Ue===d?s:Ue}else if(qr($e[Ue],He))return Ue===d?s:Ue;return He},Vn={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Vr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Kr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[j,[R,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[j,[R,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[R,j],[/opios[\/ ]+([\w\.]+)/i],[j,[R,Te+" Mini"]],[/\bopr\/([\w\.]+)/i],[j,[R,Te]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[R,j],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[j,[R,"UC"+re]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[j,[R,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[j,[R,"WeChat"]],[/konqueror\/([\w\.]+)/i],[j,[R,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[j,[R,"IE"]],[/yabrowser\/([\w\.]+)/i],[j,[R,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[R,/(.+)/,"$1 Secure "+re],j],[/\bfocus\/([\w\.]+)/i],[j,[R,Re+" Focus"]],[/\bopt\/([\w\.]+)/i],[j,[R,Te+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[j,[R,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[j,[R,"Dolphin"]],[/coast\/([\w\.]+)/i],[j,[R,Te+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[j,[R,"MIUI "+re]],[/fxios\/([-\w\.]+)/i],[j,[R,Re]],[/\bqihu|(qi?ho?o?|360)browser/i],[[R,"360 "+re]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[R,/(.+)/,"$1 "+re],j],[/(comodo_dragon)\/([\w\.]+)/i],[[R,/_/g," "],j],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[R,j],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[R],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[R,_i],j],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[R,j],[/\bgsa\/([\w\.]+) .*safari\//i],[j,[R,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[j,[R,ne+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[R,ne+" WebView"],j],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[j,[R,"Android "+re]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[R,j],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[j,[R,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[j,R],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[R,[j,_r,Vn]],[/(webkit|khtml)\/([\w\.]+)/i],[R,j],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[R,"Netscape"],j],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[j,[R,Re+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[R,j],[/(cobalt)\/([\w\.]+)/i],[R,[j,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,qi]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,l,qi]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,qi]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[H,Be],[b,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[H,Be],[b,f]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[H,J],[b,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[H,J],[b,w]],[/(macintosh);/i],[E,[H,J]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[H,Y],[b,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[H,Y],[b,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[H,Gt],[b,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[H,Gt],[b,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[H,"OPPO"],[b,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[H,"Vivo"],[b,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[H,"Realme"],[b,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[H,me],[b,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[H,me],[b,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[H,he],[b,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[H,he],[b,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[H,"Lenovo"],[b,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[H,"Nokia"],[b,f]],[/(pixel c)\b/i],[E,[H,ke],[b,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[H,ke],[b,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[H,ti],[b,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[H,ti],[b,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[H,"OnePlus"],[b,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[H,$],[b,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[H,$],[b,f]],[/(playbook);[-\w\),; ]+(rim)/i],[E,H,[b,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[H,ee],[b,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[H,X],[b,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[H,X],[b,f]],[/(nexus 9)/i],[E,[H,"HTC"],[b,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[H,[E,/_/g," "],[b,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[H,"Acer"],[b,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[H,"Meizu"],[b,f]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[H,st],[b,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[H,E,[b,f]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[H,E,[b,w]],[/(surface duo)/i],[E,[H,be],[b,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[H,"Fairphone"],[b,f]],[/(u304aa)/i],[E,[H,"AT&T"],[b,f]],[/\bsie-(\w*)/i],[E,[H,"Siemens"],[b,f]],[/\b(rct\w+) b/i],[E,[H,"RCA"],[b,w]],[/\b(venue[\d ]{2,7}) b/i],[E,[H,"Dell"],[b,w]],[/\b(q(?:mv|ta)\w+) b/i],[E,[H,"Verizon"],[b,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[H,"Barnes & Noble"],[b,w]],[/\b(tm\d{3}\w+) b/i],[E,[H,"NuVision"],[b,w]],[/\b(k88) b/i],[E,[H,"ZTE"],[b,w]],[/\b(nx\d{3}j) b/i],[E,[H,"ZTE"],[b,f]],[/\b(gen\d{3}) b.+49h/i],[E,[H,"Swiss"],[b,f]],[/\b(zur\d{3}) b/i],[E,[H,"Swiss"],[b,w]],[/\b((zeki)?tb.*\b) b/i],[E,[H,"Zeki"],[b,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[H,"Dragon Touch"],E,[b,w]],[/\b(ns-?\w{0,9}) b/i],[E,[H,"Insignia"],[b,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[H,"NextBook"],[b,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[H,"Voice"],E,[b,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[H,"LvTel"],E,[b,f]],[/\b(ph-1) /i],[E,[H,"Essential"],[b,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[H,"Envizen"],[b,w]],[/\b(trio[-\w\. ]+) b/i],[E,[H,"MachSpeed"],[b,w]],[/\btu_(1491) b/i],[E,[H,"Rotor"],[b,w]],[/(shield[\w ]+) b/i],[E,[H,"Nvidia"],[b,w]],[/(sprint) (\w+)/i],[H,E,[b,f]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[H,be],[b,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[H,nr],[b,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[H,nr],[b,f]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[H,E,[b,y]],[/droid.+; (shield) bui/i],[E,[H,"Nvidia"],[b,y]],[/(playstation [345portablevi]+)/i],[E,[H,ti],[b,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[H,be],[b,y]],[/smart-tv.+(samsung)/i],[H,[b,F]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[H,Be],[b,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[H,he],[b,F]],[/(apple) ?tv/i],[H,[E,J+" TV"],[b,F]],[/crkey/i],[[E,ne+"cast"],[H,ke],[b,F]],[/droid.+aft(\w)( bui|\))/i],[E,[H,$],[b,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[H,st],[b,F]],[/(bravia[\w ]+)( bui|\))/i],[E,[H,ti],[b,F]],[/(mitv-\w{5}) bui/i],[E,[H,Gt],[b,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[H,yr],[E,yr],[b,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,F]],[/((pebble))app/i],[H,E,[b,U]],[/droid.+; (glass) \d/i],[E,[H,ke],[b,U]],[/droid.+; (wt63?0{2,3})\)/i],[E,[H,nr],[b,U]],[/(quest( 2)?)/i],[E,[H,_i],[b,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[H,[b,q]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[b,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[b,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,f]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[H,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[j,[R,Ce+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[j,[R,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[R,j],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[j,R]],os:[[/microsoft (windows) (vista|xp)/i],[R,j],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[R,[j,_r,Vr]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,"Windows"],[j,_r,Vr]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[j,/_/g,"."],[R,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[R,"Mac OS"],[j,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[j,R],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[R,j],[/\(bb(10);/i],[j,[R,ee]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[j,[R,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[j,[R,Re+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[j,[R,"webOS"]],[/crkey\/([\d\.]+)/i],[j,[R,ne+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[R,"Chromium OS"],j],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[R,j],[/(sunos) ?([\w\.\d]*)/i],[[R,"Solaris"],j],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[R,j]]},Ot=function(He,$e){if(typeof He===h&&($e=He,He=s),!(this instanceof Ot))return new Ot(He,$e).getResult();var Ue=He||(typeof r!==C&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:l),at=$e?Un(Kr,$e):Kr;return this.getBrowser=function(){var Ke={};return Ke[R]=s,Ke[j]=s,Jt.call(Ke,Ue,at.browser),Ke.major=qn(Ke.version),Ke},this.getCPU=function(){var Ke={};return Ke[k]=s,Jt.call(Ke,Ue,at.cpu),Ke},this.getDevice=function(){var Ke={};return Ke[H]=s,Ke[E]=s,Ke[b]=s,Jt.call(Ke,Ue,at.device),Ke},this.getEngine=function(){var Ke={};return Ke[R]=s,Ke[j]=s,Jt.call(Ke,Ue,at.engine),Ke},this.getOS=function(){var Ke={};return Ke[R]=s,Ke[j]=s,Jt.call(Ke,Ue,at.os),Ke},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ue},this.setUA=function(Ke){return Ue=typeof Ke===v&&Ke.length>V?yr(Ke,V):Ke,this},this.setUA(Ue),this};Ot.VERSION=o,Ot.BROWSER=sr([R,j,D]),Ot.CPU=sr([k]),Ot.DEVICE=sr([E,H,b,y,f,F,w,U,q]),Ot.ENGINE=Ot.OS=sr([R,j]),typeof e!==C?(typeof i!==C&&i.exports&&(e=i.exports=Ot),e.UAParser=Ot):typeof define===m&&define.amd?define(function(){return Ot}):typeof r!==C&&(r.UAParser=Ot);var ki=typeof r!==C&&(r.jQuery||r.Zepto);if(ki&&!ki.ua){var ar=new Ot;ki.ua=ar.getResult(),ki.ua.get=function(){return ar.getUA()},ki.ua.set=function(He){ar.setUA(He);var $e=ar.getResult();for(var Ue in $e)ki.ua[Ue]=$e[Ue]}}}(typeof window=="object"?window:e)}}),du=fe({"../../node_modules/jsrsasign/lib/jsrsasign.js"(e){Z();var i={};i.userAgent=!1;var r={},s="11.0.0",o="jsrsasign(all) 11.0.0 (2024-01-16) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license",l=l||function(t,n){var a={},c=a.lib={},p=c.Base=function(){function _(){}return{extend:function(I){_.prototype=this;var P=new _;return I&&P.mixIn(I),P.hasOwnProperty("init")||(P.init=function(){P.$super.init.apply(this,arguments)}),P.init.prototype=P,P.$super=this,P},create:function(){var I=this.extend();return I.init.apply(I,arguments),I},init:function(){},mixIn:function(I){for(var P in I)I.hasOwnProperty(P)&&(this[P]=I[P]);I.hasOwnProperty("toString")&&(this.toString=I.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=c.WordArray=p.extend({init:function(_,I){_=this.words=_||[],I!=n?this.sigBytes=I:this.sigBytes=_.length*4},toString:function(_){return(_||S).stringify(this)},concat:function(_){var I=this.words,P=_.words,A=this.sigBytes,L=_.sigBytes;if(this.clamp(),A%4)for(var K=0;K<L;K++){var ie=P[K>>>2]>>>24-K%4*8&255;I[A+K>>>2]|=ie<<24-(A+K)%4*8}else for(var K=0;K<L;K+=4)I[A+K>>>2]=P[K>>>2];return this.sigBytes+=L,this},clamp:function(){var _=this.words,I=this.sigBytes;_[I>>>2]&=4294967295<<32-I%4*8,_.length=t.ceil(I/4)},clone:function(){var _=p.clone.call(this);return _.words=this.words.slice(0),_},random:function(_){for(var I=[],P=0;P<_;P+=4)I.push(t.random()*4294967296|0);return new u.init(I,_)}}),x=a.enc={},S=x.Hex={stringify:function(_){for(var I=_.words,P=_.sigBytes,A=[],L=0;L<P;L++){var K=I[L>>>2]>>>24-L%4*8&255;A.push((K>>>4).toString(16)),A.push((K&15).toString(16))}return A.join("")},parse:function(_){for(var I=_.length,P=[],A=0;A<I;A+=2)P[A>>>3]|=parseInt(_.substr(A,2),16)<<24-A%8*4;return new u.init(P,I/2)}},O=x.Latin1={stringify:function(_){for(var I=_.words,P=_.sigBytes,A=[],L=0;L<P;L++){var K=I[L>>>2]>>>24-L%4*8&255;A.push(String.fromCharCode(K))}return A.join("")},parse:function(_){for(var I=_.length,P=[],A=0;A<I;A++)P[A>>>2]|=(_.charCodeAt(A)&255)<<24-A%4*8;return new u.init(P,I)}},T=x.Utf8={stringify:function(_){try{return decodeURIComponent(escape(O.stringify(_)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(_){return O.parse(unescape(encodeURIComponent(_)))}},B=c.BufferedBlockAlgorithm=p.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(_){typeof _=="string"&&(_=T.parse(_)),this._data.concat(_),this._nDataBytes+=_.sigBytes},_process:function(_){var I=this._data,P=I.words,A=I.sigBytes,L=this.blockSize,K=L*4,ie=A/K;_?ie=t.ceil(ie):ie=t.max((ie|0)-this._minBufferSize,0);var ae=ie*L,se=t.min(ae*4,A);if(ae){for(var ce=0;ce<ae;ce+=L)this._doProcessBlock(P,ce);var z=P.splice(0,ae);I.sigBytes-=se}return new u.init(z,se)},clone:function(){var _=p.clone.call(this);return _._data=this._data.clone(),_},_minBufferSize:0});c.Hasher=B.extend({cfg:p.extend(),init:function(_){this.cfg=this.cfg.extend(_),this.reset()},reset:function(){B.reset.call(this),this._doReset()},update:function(_){return this._append(_),this._process(),this},finalize:function(_){_&&this._append(_);var I=this._doFinalize();return I},blockSize:512/32,_createHelper:function(_){return function(I,P){return new _.init(P).finalize(I)}},_createHmacHelper:function(_){return function(I,P){return new N.HMAC.init(_,P).finalize(I)}}});var N=a.algo={};return a}(Math);(function(t){var p=l,n=p.lib,a=n.Base,c=n.WordArray,p=p.x64={};p.Word=a.extend({init:function(u,x){this.high=u,this.low=x}}),p.WordArray=a.extend({init:function(u,x){u=this.words=u||[],this.sigBytes=x!=t?x:8*u.length},toX32:function(){for(var u=this.words,x=u.length,S=[],O=0;O<x;O++){var T=u[O];S.push(T.high),S.push(T.low)}return c.create(S,this.sigBytes)},clone:function(){for(var u=a.clone.call(this),x=u.words=this.words.slice(0),S=x.length,O=0;O<S;O++)x[O]=x[O].clone();return u}})})(),l.lib.Cipher||function(t){var I=l,n=I.lib,a=n.Base,c=n.WordArray,p=n.BufferedBlockAlgorithm,u=I.enc.Base64,x=I.algo.EvpKDF,S=n.Cipher=p.extend({cfg:a.extend(),createEncryptor:function(A,L){return this.create(this._ENC_XFORM_MODE,A,L)},createDecryptor:function(A,L){return this.create(this._DEC_XFORM_MODE,A,L)},init:function(A,L,K){this.cfg=this.cfg.extend(K),this._xformMode=A,this._key=L,this.reset()},reset:function(){p.reset.call(this),this._doReset()},process:function(A){return this._append(A),this._process()},finalize:function(A){return A&&this._append(A),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(A){return{encrypt:function(L,K,ie){return(typeof K=="string"?P:_).encrypt(A,L,K,ie)},decrypt:function(L,K,ie){return(typeof K=="string"?P:_).decrypt(A,L,K,ie)}}}});n.StreamCipher=S.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var N=I.mode={},O=function(A,L,K){var ie=this._iv;ie?this._iv=t:ie=this._prevBlock;for(var ae=0;ae<K;ae++)A[L+ae]^=ie[ae]},T=(n.BlockCipherMode=a.extend({createEncryptor:function(A,L){return this.Encryptor.create(A,L)},createDecryptor:function(A,L){return this.Decryptor.create(A,L)},init:function(A,L){this._cipher=A,this._iv=L}})).extend();T.Encryptor=T.extend({processBlock:function(A,L){var K=this._cipher,ie=K.blockSize;O.call(this,A,L,ie),K.encryptBlock(A,L),this._prevBlock=A.slice(L,L+ie)}}),T.Decryptor=T.extend({processBlock:function(A,L){var K=this._cipher,ie=K.blockSize,ae=A.slice(L,L+ie);K.decryptBlock(A,L),O.call(this,A,L,ie),this._prevBlock=ae}}),N=N.CBC=T,T=(I.pad={}).Pkcs7={pad:function(A,L){for(var K=4*L,K=K-A.sigBytes%K,ie=K<<24|K<<16|K<<8|K,ae=[],se=0;se<K;se+=4)ae.push(ie);K=c.create(ae,K),A.concat(K)},unpad:function(A){A.sigBytes-=A.words[A.sigBytes-1>>>2]&255}},n.BlockCipher=S.extend({cfg:S.cfg.extend({mode:N,padding:T}),reset:function(){S.reset.call(this);var L=this.cfg,A=L.iv,L=L.mode;if(this._xformMode==this._ENC_XFORM_MODE)var K=L.createEncryptor;else K=L.createDecryptor,this._minBufferSize=1;this._mode=K.call(L,this,A&&A.words)},_doProcessBlock:function(A,L){this._mode.processBlock(A,L)},_doFinalize:function(){var A=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){A.pad(this._data,this.blockSize);var L=this._process(!0)}else L=this._process(!0),A.unpad(L);return L},blockSize:4});var B=n.CipherParams=a.extend({init:function(A){this.mixIn(A)},toString:function(A){return(A||this.formatter).stringify(this)}}),N=(I.format={}).OpenSSL={stringify:function(A){var L=A.ciphertext;return A=A.salt,(A?c.create([1398893684,1701076831]).concat(A).concat(L):L).toString(u)},parse:function(A){A=u.parse(A);var L=A.words;if(L[0]==1398893684&&L[1]==1701076831){var K=c.create(L.slice(2,4));L.splice(0,4),A.sigBytes-=16}return B.create({ciphertext:A,salt:K})}},_=n.SerializableCipher=a.extend({cfg:a.extend({format:N}),encrypt:function(A,L,K,ie){ie=this.cfg.extend(ie);var ae=A.createEncryptor(K,ie);return L=ae.finalize(L),ae=ae.cfg,B.create({ciphertext:L,key:K,iv:ae.iv,algorithm:A,mode:ae.mode,padding:ae.padding,blockSize:A.blockSize,formatter:ie.format})},decrypt:function(A,L,K,ie){return ie=this.cfg.extend(ie),L=this._parse(L,ie.format),A.createDecryptor(K,ie).finalize(L.ciphertext)},_parse:function(A,L){return typeof A=="string"?L.parse(A,this):A}}),I=(I.kdf={}).OpenSSL={execute:function(A,L,K,ie){return ie||(ie=c.random(8)),A=x.create({keySize:L+K}).compute(A,ie),K=c.create(A.words.slice(L),4*K),A.sigBytes=4*L,B.create({key:A,iv:K,salt:ie})}},P=n.PasswordBasedCipher=_.extend({cfg:_.cfg.extend({kdf:I}),encrypt:function(A,L,K,ie){return ie=this.cfg.extend(ie),K=ie.kdf.execute(K,A.keySize,A.ivSize),ie.iv=K.iv,A=_.encrypt.call(this,A,L,K.key,ie),A.mixIn(K),A},decrypt:function(A,L,K,ie){return ie=this.cfg.extend(ie),L=this._parse(L,ie.format),K=ie.kdf.execute(K,A.keySize,A.ivSize,L.salt),ie.iv=K.iv,_.decrypt.call(this,A,L,K.key,ie)}})}(),function(){for(var t=l,n=t.lib.BlockCipher,z=t.algo,a=[],c=[],p=[],u=[],x=[],S=[],O=[],T=[],B=[],N=[],_=[],I=0;256>I;I++)_[I]=128>I?I<<1:I<<1^283;for(var P=0,A=0,I=0;256>I;I++){var L=A^A<<1^A<<2^A<<3^A<<4,L=L>>>8^L&255^99;a[P]=L,c[L]=P;var K=_[P],ie=_[K],ae=_[ie],se=257*_[L]^16843008*L;p[P]=se<<24|se>>>8,u[P]=se<<16|se>>>16,x[P]=se<<8|se>>>24,S[P]=se,se=16843009*ae^65537*ie^257*K^16843008*P,O[L]=se<<24|se>>>8,T[L]=se<<16|se>>>16,B[L]=se<<8|se>>>24,N[L]=se,P?(P=K^_[_[_[ae^K]]],A^=_[_[A]]):P=A=1}var ce=[0,1,2,4,8,16,32,64,128,27,54],z=z.AES=n.extend({_doReset:function(){for(var W=this._key,G=W.words,Q=W.sigBytes/4,W=4*((this._nRounds=Q+6)+1),te=this._keySchedule=[],oe=0;oe<W;oe++)if(oe<Q)te[oe]=G[oe];else{var de=te[oe-1];oe%Q?6<Q&&oe%Q==4&&(de=a[de>>>24]<<24|a[de>>>16&255]<<16|a[de>>>8&255]<<8|a[de&255]):(de=de<<8|de>>>24,de=a[de>>>24]<<24|a[de>>>16&255]<<16|a[de>>>8&255]<<8|a[de&255],de^=ce[oe/Q|0]<<24),te[oe]=te[oe-Q]^de}for(G=this._invKeySchedule=[],Q=0;Q<W;Q++)oe=W-Q,de=Q%4?te[oe]:te[oe-4],G[Q]=4>Q||4>=oe?de:O[a[de>>>24]]^T[a[de>>>16&255]]^B[a[de>>>8&255]]^N[a[de&255]]},encryptBlock:function(G,Q){this._doCryptBlock(G,Q,this._keySchedule,p,u,x,S,a)},decryptBlock:function(G,Q){var W=G[Q+1];G[Q+1]=G[Q+3],G[Q+3]=W,this._doCryptBlock(G,Q,this._invKeySchedule,O,T,B,N,c),W=G[Q+1],G[Q+1]=G[Q+3],G[Q+3]=W},_doCryptBlock:function(G,Q,W,te,oe,de,_e,le){for(var pe=this._nRounds,Ct=G[Q]^W[0],Et=G[Q+1]^W[1],xt=G[Q+2]^W[2],mt=G[Q+3]^W[3],we=4,xe=1;xe<pe;xe++)var It=te[Ct>>>24]^oe[Et>>>16&255]^de[xt>>>8&255]^_e[mt&255]^W[we++],ot=te[Et>>>24]^oe[xt>>>16&255]^de[mt>>>8&255]^_e[Ct&255]^W[we++],tt=te[xt>>>24]^oe[mt>>>16&255]^de[Ct>>>8&255]^_e[Et&255]^W[we++],mt=te[mt>>>24]^oe[Ct>>>16&255]^de[Et>>>8&255]^_e[xt&255]^W[we++],Ct=It,Et=ot,xt=tt;It=(le[Ct>>>24]<<24|le[Et>>>16&255]<<16|le[xt>>>8&255]<<8|le[mt&255])^W[we++],ot=(le[Et>>>24]<<24|le[xt>>>16&255]<<16|le[mt>>>8&255]<<8|le[Ct&255])^W[we++],tt=(le[xt>>>24]<<24|le[mt>>>16&255]<<16|le[Ct>>>8&255]<<8|le[Et&255])^W[we++],mt=(le[mt>>>24]<<24|le[Ct>>>16&255]<<16|le[Et>>>8&255]<<8|le[xt&255])^W[we++],G[Q]=It,G[Q+1]=ot,G[Q+2]=tt,G[Q+3]=mt},keySize:8});t.AES=n._createHelper(z)}(),function(){function t(_,I){var P=(this._lBlock>>>_^this._rBlock)&I;this._rBlock^=P,this._lBlock^=P<<_}function n(_,I){var P=(this._rBlock>>>_^this._lBlock)&I;this._lBlock^=P,this._rBlock^=P<<_}var a=l,p=a.lib,c=p.WordArray,p=p.BlockCipher,u=a.algo,x=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],S=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],O=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],T=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],B=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],N=u.DES=p.extend({_doReset:function(){for(var _=this._key.words,I=[],P=0;56>P;P++){var A=x[P]-1;I[P]=_[A>>>5]>>>31-A%32&1}for(_=this._subKeys=[],A=0;16>A;A++){for(var L=_[A]=[],K=O[A],P=0;24>P;P++)L[P/6|0]|=I[(S[P]-1+K)%28]<<31-P%6,L[4+(P/6|0)]|=I[28+(S[P+24]-1+K)%28]<<31-P%6;for(L[0]=L[0]<<1|L[0]>>>31,P=1;7>P;P++)L[P]>>>=4*(P-1)+3;L[7]=L[7]<<5|L[7]>>>27}for(I=this._invSubKeys=[],P=0;16>P;P++)I[P]=_[15-P]},encryptBlock:function(_,I){this._doCryptBlock(_,I,this._subKeys)},decryptBlock:function(_,I){this._doCryptBlock(_,I,this._invSubKeys)},_doCryptBlock:function(_,I,P){this._lBlock=_[I],this._rBlock=_[I+1],t.call(this,4,252645135),t.call(this,16,65535),n.call(this,2,858993459),n.call(this,8,16711935),t.call(this,1,1431655765);for(var A=0;16>A;A++){for(var L=P[A],K=this._lBlock,ie=this._rBlock,ae=0,se=0;8>se;se++)ae|=T[se][((ie^L[se])&B[se])>>>0];this._lBlock=ie,this._rBlock=K^ae}P=this._lBlock,this._lBlock=this._rBlock,this._rBlock=P,t.call(this,1,1431655765),n.call(this,8,16711935),n.call(this,2,858993459),t.call(this,16,65535),t.call(this,4,252645135),_[I]=this._lBlock,_[I+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});a.DES=p._createHelper(N),u=u.TripleDES=p.extend({_doReset:function(){var _=this._key.words;this._des1=N.createEncryptor(c.create(_.slice(0,2))),this._des2=N.createEncryptor(c.create(_.slice(2,4))),this._des3=N.createEncryptor(c.create(_.slice(4,6)))},encryptBlock:function(_,I){this._des1.encryptBlock(_,I),this._des2.decryptBlock(_,I),this._des3.encryptBlock(_,I)},decryptBlock:function(_,I){this._des3.decryptBlock(_,I),this._des2.encryptBlock(_,I),this._des1.decryptBlock(_,I)},keySize:6,ivSize:2,blockSize:2}),a.TripleDES=p._createHelper(u)}(),function(){var t=l,n=t.lib.WordArray;t.enc.Base64={stringify:function(a){var c=a.words,p=a.sigBytes,u=this._map;a.clamp(),a=[];for(var x=0;x<p;x+=3)for(var S=(c[x>>>2]>>>24-8*(x%4)&255)<<16|(c[x+1>>>2]>>>24-8*((x+1)%4)&255)<<8|c[x+2>>>2]>>>24-8*((x+2)%4)&255,O=0;4>O&&x+.75*O<p;O++)a.push(u.charAt(S>>>6*(3-O)&63));if(c=u.charAt(64))for(;a.length%4;)a.push(c);return a.join("")},parse:function(a){var c=a.length,p=this._map,u=p.charAt(64);u&&(u=a.indexOf(u),u!=-1&&(c=u));for(var u=[],x=0,S=0;S<c;S++)if(S%4){var O=p.indexOf(a.charAt(S-1))<<2*(S%4),T=p.indexOf(a.charAt(S))>>>6-2*(S%4);u[x>>>2]|=(O|T)<<24-8*(x%4),x++}return n.create(u,x)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function n(N,_,I,P,A,L,K){return N=N+(_&I|~_&P)+A+K,(N<<L|N>>>32-L)+_}function a(N,_,I,P,A,L,K){return N=N+(_&P|I&~P)+A+K,(N<<L|N>>>32-L)+_}function c(N,_,I,P,A,L,K){return N=N+(_^I^P)+A+K,(N<<L|N>>>32-L)+_}function p(N,_,I,P,A,L,K){return N=N+(I^(_|~P))+A+K,(N<<L|N>>>32-L)+_}for(var u=l,O=u.lib,x=O.WordArray,S=O.Hasher,O=u.algo,T=[],B=0;64>B;B++)T[B]=4294967296*t.abs(t.sin(B+1))|0;O=O.MD5=S.extend({_doReset:function(){this._hash=new x.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(N,_){for(var I=0;16>I;I++){var P=_+I,A=N[P];N[P]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}var I=this._hash.words,P=N[_+0],A=N[_+1],L=N[_+2],K=N[_+3],ie=N[_+4],ae=N[_+5],se=N[_+6],ce=N[_+7],z=N[_+8],G=N[_+9],Q=N[_+10],W=N[_+11],te=N[_+12],oe=N[_+13],de=N[_+14],_e=N[_+15],le=I[0],xe=I[1],we=I[2],pe=I[3],le=n(le,xe,we,pe,P,7,T[0]),pe=n(pe,le,xe,we,A,12,T[1]),we=n(we,pe,le,xe,L,17,T[2]),xe=n(xe,we,pe,le,K,22,T[3]),le=n(le,xe,we,pe,ie,7,T[4]),pe=n(pe,le,xe,we,ae,12,T[5]),we=n(we,pe,le,xe,se,17,T[6]),xe=n(xe,we,pe,le,ce,22,T[7]),le=n(le,xe,we,pe,z,7,T[8]),pe=n(pe,le,xe,we,G,12,T[9]),we=n(we,pe,le,xe,Q,17,T[10]),xe=n(xe,we,pe,le,W,22,T[11]),le=n(le,xe,we,pe,te,7,T[12]),pe=n(pe,le,xe,we,oe,12,T[13]),we=n(we,pe,le,xe,de,17,T[14]),xe=n(xe,we,pe,le,_e,22,T[15]),le=a(le,xe,we,pe,A,5,T[16]),pe=a(pe,le,xe,we,se,9,T[17]),we=a(we,pe,le,xe,W,14,T[18]),xe=a(xe,we,pe,le,P,20,T[19]),le=a(le,xe,we,pe,ae,5,T[20]),pe=a(pe,le,xe,we,Q,9,T[21]),we=a(we,pe,le,xe,_e,14,T[22]),xe=a(xe,we,pe,le,ie,20,T[23]),le=a(le,xe,we,pe,G,5,T[24]),pe=a(pe,le,xe,we,de,9,T[25]),we=a(we,pe,le,xe,K,14,T[26]),xe=a(xe,we,pe,le,z,20,T[27]),le=a(le,xe,we,pe,oe,5,T[28]),pe=a(pe,le,xe,we,L,9,T[29]),we=a(we,pe,le,xe,ce,14,T[30]),xe=a(xe,we,pe,le,te,20,T[31]),le=c(le,xe,we,pe,ae,4,T[32]),pe=c(pe,le,xe,we,z,11,T[33]),we=c(we,pe,le,xe,W,16,T[34]),xe=c(xe,we,pe,le,de,23,T[35]),le=c(le,xe,we,pe,A,4,T[36]),pe=c(pe,le,xe,we,ie,11,T[37]),we=c(we,pe,le,xe,ce,16,T[38]),xe=c(xe,we,pe,le,Q,23,T[39]),le=c(le,xe,we,pe,oe,4,T[40]),pe=c(pe,le,xe,we,P,11,T[41]),we=c(we,pe,le,xe,K,16,T[42]),xe=c(xe,we,pe,le,se,23,T[43]),le=c(le,xe,we,pe,G,4,T[44]),pe=c(pe,le,xe,we,te,11,T[45]),we=c(we,pe,le,xe,_e,16,T[46]),xe=c(xe,we,pe,le,L,23,T[47]),le=p(le,xe,we,pe,P,6,T[48]),pe=p(pe,le,xe,we,ce,10,T[49]),we=p(we,pe,le,xe,de,15,T[50]),xe=p(xe,we,pe,le,ae,21,T[51]),le=p(le,xe,we,pe,te,6,T[52]),pe=p(pe,le,xe,we,K,10,T[53]),we=p(we,pe,le,xe,Q,15,T[54]),xe=p(xe,we,pe,le,A,21,T[55]),le=p(le,xe,we,pe,z,6,T[56]),pe=p(pe,le,xe,we,_e,10,T[57]),we=p(we,pe,le,xe,se,15,T[58]),xe=p(xe,we,pe,le,oe,21,T[59]),le=p(le,xe,we,pe,ie,6,T[60]),pe=p(pe,le,xe,we,W,10,T[61]),we=p(we,pe,le,xe,L,15,T[62]),xe=p(xe,we,pe,le,G,21,T[63]);I[0]=I[0]+le|0,I[1]=I[1]+xe|0,I[2]=I[2]+we|0,I[3]=I[3]+pe|0},_doFinalize:function(){var N=this._data,_=N.words,I=8*this._nDataBytes,P=8*N.sigBytes;_[P>>>5]|=128<<24-P%32;var A=t.floor(I/4294967296);for(_[(P+64>>>9<<4)+15]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,_[(P+64>>>9<<4)+14]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,N.sigBytes=4*(_.length+1),this._process(),N=this._hash,_=N.words,I=0;4>I;I++)P=_[I],_[I]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360;return N},clone:function(){var N=S.clone.call(this);return N._hash=this._hash.clone(),N}}),u.MD5=S._createHelper(O),u.HmacMD5=S._createHmacHelper(O)}(Math),function(){var t=l,p=t.lib,n=p.WordArray,a=p.Hasher,c=[],p=t.algo.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,x){for(var S=this._hash.words,O=S[0],T=S[1],B=S[2],N=S[3],_=S[4],I=0;80>I;I++){if(16>I)c[I]=u[x+I]|0;else{var P=c[I-3]^c[I-8]^c[I-14]^c[I-16];c[I]=P<<1|P>>>31}P=(O<<5|O>>>27)+_+c[I],P=20>I?P+((T&B|~T&N)+1518500249):40>I?P+((T^B^N)+1859775393):60>I?P+((T&B|T&N|B&N)-1894007588):P+((T^B^N)-899497514),_=N,N=B,B=T<<30|T>>>2,T=O,O=P}S[0]=S[0]+O|0,S[1]=S[1]+T|0,S[2]=S[2]+B|0,S[3]=S[3]+N|0,S[4]=S[4]+_|0},_doFinalize:function(){var u=this._data,x=u.words,S=8*this._nDataBytes,O=8*u.sigBytes;return x[O>>>5]|=128<<24-O%32,x[(O+64>>>9<<4)+14]=Math.floor(S/4294967296),x[(O+64>>>9<<4)+15]=S,u.sigBytes=4*x.length,this._process(),this._hash},clone:function(){var u=a.clone.call(this);return u._hash=this._hash.clone(),u}});t.SHA1=a._createHelper(p),t.HmacSHA1=a._createHmacHelper(p)}(),function(t){for(var n=l,I=n.lib,a=I.WordArray,c=I.Hasher,I=n.algo,p=[],u=[],x=function(A){return 4294967296*(A-(A|0))|0},S=2,O=0;64>O;){var T;e:{T=S;for(var B=t.sqrt(T),N=2;N<=B;N++)if(!(T%N)){T=!1;break e}T=!0}T&&(8>O&&(p[O]=x(t.pow(S,.5))),u[O]=x(t.pow(S,1/3)),O++),S++}var _=[],I=I.SHA256=c.extend({_doReset:function(){this._hash=new a.init(p.slice(0))},_doProcessBlock:function(P,A){for(var L=this._hash.words,K=L[0],ie=L[1],ae=L[2],se=L[3],ce=L[4],z=L[5],G=L[6],Q=L[7],W=0;64>W;W++){if(16>W)_[W]=P[A+W]|0;else{var te=_[W-15],oe=_[W-2];_[W]=((te<<25|te>>>7)^(te<<14|te>>>18)^te>>>3)+_[W-7]+((oe<<15|oe>>>17)^(oe<<13|oe>>>19)^oe>>>10)+_[W-16]}te=Q+((ce<<26|ce>>>6)^(ce<<21|ce>>>11)^(ce<<7|ce>>>25))+(ce&z^~ce&G)+u[W]+_[W],oe=((K<<30|K>>>2)^(K<<19|K>>>13)^(K<<10|K>>>22))+(K&ie^K&ae^ie&ae),Q=G,G=z,z=ce,ce=se+te|0,se=ae,ae=ie,ie=K,K=te+oe|0}L[0]=L[0]+K|0,L[1]=L[1]+ie|0,L[2]=L[2]+ae|0,L[3]=L[3]+se|0,L[4]=L[4]+ce|0,L[5]=L[5]+z|0,L[6]=L[6]+G|0,L[7]=L[7]+Q|0},_doFinalize:function(){var P=this._data,A=P.words,L=8*this._nDataBytes,K=8*P.sigBytes;return A[K>>>5]|=128<<24-K%32,A[(K+64>>>9<<4)+14]=t.floor(L/4294967296),A[(K+64>>>9<<4)+15]=L,P.sigBytes=4*A.length,this._process(),this._hash},clone:function(){var P=c.clone.call(this);return P._hash=this._hash.clone(),P}});n.SHA256=c._createHelper(I),n.HmacSHA256=c._createHmacHelper(I)}(Math),function(){var t=l,n=t.lib.WordArray,c=t.algo,a=c.SHA256,c=c.SHA224=a.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var p=a._doFinalize.call(this);return p.sigBytes-=4,p}});t.SHA224=a._createHelper(c),t.HmacSHA224=a._createHmacHelper(c)}(),function(){function t(){return c.create.apply(c,arguments)}for(var n=l,a=n.lib.Hasher,u=n.x64,c=u.Word,p=u.WordArray,u=n.algo,x=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],S=[],O=0;80>O;O++)S[O]=t();u=u.SHA512=a.extend({_doReset:function(){this._hash=new p.init([new c.init(1779033703,4089235720),new c.init(3144134277,2227873595),new c.init(1013904242,4271175723),new c.init(2773480762,1595750129),new c.init(1359893119,2917565137),new c.init(2600822924,725511199),new c.init(528734635,4215389547),new c.init(1541459225,327033209)])},_doProcessBlock:function(T,B){for(var ie=this._hash.words,N=ie[0],_=ie[1],I=ie[2],P=ie[3],A=ie[4],L=ie[5],K=ie[6],ie=ie[7],ae=N.high,se=N.low,ce=_.high,z=_.low,G=I.high,Q=I.low,W=P.high,te=P.low,oe=A.high,de=A.low,_e=L.high,le=L.low,pe=K.high,we=K.low,xe=ie.high,It=ie.low,ot=ae,tt=se,mt=ce,Ct=z,Et=G,xt=Q,Er=W,Nt=te,ze=oe,Ye=de,ct=_e,lt=le,Kt=pe,pt=we,Pr=xe,Ki=It,hi=0;80>hi;hi++){var Mi=S[hi];if(16>hi)var ri=Mi.high=T[B+2*hi]|0,Ge=Mi.low=T[B+2*hi+1]|0;else{var ri=S[hi-15],Ge=ri.high,wi=ri.low,ri=(Ge>>>1|wi<<31)^(Ge>>>8|wi<<24)^Ge>>>7,wi=(wi>>>1|Ge<<31)^(wi>>>8|Ge<<24)^(wi>>>7|Ge<<25),zi=S[hi-2],Ge=zi.high,rt=zi.low,zi=(Ge>>>19|rt<<13)^(Ge<<3|rt>>>29)^Ge>>>6,rt=(rt>>>19|Ge<<13)^(rt<<3|Ge>>>29)^(rt>>>6|Ge<<26),Ge=S[hi-7],ss=Ge.high,Oi=S[hi-16],Ci=Oi.high,Oi=Oi.low,Ge=wi+Ge.low,ri=ri+ss+(Ge>>>0<wi>>>0?1:0),Ge=Ge+rt,ri=ri+zi+(Ge>>>0<rt>>>0?1:0),Ge=Ge+Oi,ri=ri+Ci+(Ge>>>0<Oi>>>0?1:0);Mi.high=ri,Mi.low=Ge}var ss=ze&ct^~ze&Kt,Oi=Ye&lt^~Ye&pt,Mi=ot&mt^ot&Et^mt&Et,Xd=tt&Ct^tt&xt^Ct&xt,wi=(ot>>>28|tt<<4)^(ot<<30|tt>>>2)^(ot<<25|tt>>>7),zi=(tt>>>28|ot<<4)^(tt<<30|ot>>>2)^(tt<<25|ot>>>7),rt=x[hi],Qd=rt.high,va=rt.low,rt=Ki+((Ye>>>14|ze<<18)^(Ye>>>18|ze<<14)^(Ye<<23|ze>>>9)),Ci=Pr+((ze>>>14|Ye<<18)^(ze>>>18|Ye<<14)^(ze<<23|Ye>>>9))+(rt>>>0<Ki>>>0?1:0),rt=rt+Oi,Ci=Ci+ss+(rt>>>0<Oi>>>0?1:0),rt=rt+va,Ci=Ci+Qd+(rt>>>0<va>>>0?1:0),rt=rt+Ge,Ci=Ci+ri+(rt>>>0<Ge>>>0?1:0),Ge=zi+Xd,Mi=wi+Mi+(Ge>>>0<zi>>>0?1:0),Pr=Kt,Ki=pt,Kt=ct,pt=lt,ct=ze,lt=Ye,Ye=Nt+rt|0,ze=Er+Ci+(Ye>>>0<Nt>>>0?1:0)|0,Er=Et,Nt=xt,Et=mt,xt=Ct,mt=ot,Ct=tt,tt=rt+Ge|0,ot=Ci+Mi+(tt>>>0<rt>>>0?1:0)|0}se=N.low=se+tt,N.high=ae+ot+(se>>>0<tt>>>0?1:0),z=_.low=z+Ct,_.high=ce+mt+(z>>>0<Ct>>>0?1:0),Q=I.low=Q+xt,I.high=G+Et+(Q>>>0<xt>>>0?1:0),te=P.low=te+Nt,P.high=W+Er+(te>>>0<Nt>>>0?1:0),de=A.low=de+Ye,A.high=oe+ze+(de>>>0<Ye>>>0?1:0),le=L.low=le+lt,L.high=_e+ct+(le>>>0<lt>>>0?1:0),we=K.low=we+pt,K.high=pe+Kt+(we>>>0<pt>>>0?1:0),It=ie.low=It+Ki,ie.high=xe+Pr+(It>>>0<Ki>>>0?1:0)},_doFinalize:function(){var T=this._data,B=T.words,N=8*this._nDataBytes,_=8*T.sigBytes;return B[_>>>5]|=128<<24-_%32,B[(_+128>>>10<<5)+30]=Math.floor(N/4294967296),B[(_+128>>>10<<5)+31]=N,T.sigBytes=4*B.length,this._process(),this._hash.toX32()},clone:function(){var T=a.clone.call(this);return T._hash=this._hash.clone(),T},blockSize:32}),n.SHA512=a._createHelper(u),n.HmacSHA512=a._createHmacHelper(u)}(),function(){var t=l,p=t.x64,n=p.Word,a=p.WordArray,p=t.algo,c=p.SHA512,p=p.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var u=c._doFinalize.call(this);return u.sigBytes-=16,u}});t.SHA384=c._createHelper(p),t.HmacSHA384=c._createHmacHelper(p)}(),function(){var t=l,T=t.lib,n=T.WordArray,a=T.Hasher,T=t.algo,c=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),p=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),x=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),S=n.create([0,1518500249,1859775393,2400959708,2840853838]),O=n.create([1352829926,1548603684,1836072691,2053994217,0]),T=T.RIPEMD160=a.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(B,N){for(var _=0;16>_;_++){var I=N+_,P=B[I];B[I]=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360}var I=this._hash.words,P=S.words,A=O.words,L=c.words,K=p.words,ie=u.words,ae=x.words,se,ce,z,G,Q,W,te,oe,de,_e;W=se=I[0],te=ce=I[1],oe=z=I[2],de=G=I[3],_e=Q=I[4];for(var le,_=0;80>_;_+=1)le=se+B[N+L[_]]|0,le=16>_?le+((ce^z^G)+P[0]):32>_?le+((ce&z|~ce&G)+P[1]):48>_?le+(((ce|~z)^G)+P[2]):64>_?le+((ce&G|z&~G)+P[3]):le+((ce^(z|~G))+P[4]),le|=0,le=le<<ie[_]|le>>>32-ie[_],le=le+Q|0,se=Q,Q=G,G=z<<10|z>>>22,z=ce,ce=le,le=W+B[N+K[_]]|0,le=16>_?le+((te^(oe|~de))+A[0]):32>_?le+((te&de|oe&~de)+A[1]):48>_?le+(((te|~oe)^de)+A[2]):64>_?le+((te&oe|~te&de)+A[3]):le+((te^oe^de)+A[4]),le|=0,le=le<<ae[_]|le>>>32-ae[_],le=le+_e|0,W=_e,_e=de,de=oe<<10|oe>>>22,oe=te,te=le;le=I[1]+z+de|0,I[1]=I[2]+G+_e|0,I[2]=I[3]+Q+W|0,I[3]=I[4]+se+te|0,I[4]=I[0]+ce+oe|0,I[0]=le},_doFinalize:function(){var B=this._data,N=B.words,_=8*this._nDataBytes,I=8*B.sigBytes;for(N[I>>>5]|=128<<24-I%32,N[(I+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,B.sigBytes=4*(N.length+1),this._process(),B=this._hash,N=B.words,_=0;5>_;_++)I=N[_],N[_]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360;return B},clone:function(){var B=a.clone.call(this);return B._hash=this._hash.clone(),B}});t.RIPEMD160=a._createHelper(T),t.HmacRIPEMD160=a._createHmacHelper(T)}(),function(){var t=l,n=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,typeof c=="string"&&(c=n.parse(c));var p=a.blockSize,u=4*p;c.sigBytes>u&&(c=a.finalize(c)),c.clamp();for(var x=this._oKey=c.clone(),S=this._iKey=c.clone(),O=x.words,T=S.words,B=0;B<p;B++)O[B]^=1549556828,T[B]^=909522486;x.sigBytes=S.sigBytes=u,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var c=this._hasher;return a=c.finalize(a),c.reset(),c.finalize(this._oKey.clone().concat(a))}})}(),function(){var t=l,c=t.lib,n=c.Base,a=c.WordArray,c=t.algo,p=c.HMAC,u=c.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:c.SHA1,iterations:1}),init:function(x){this.cfg=this.cfg.extend(x)},compute:function(x,S){for(var P=this.cfg,O=p.create(P.hasher,x),T=a.create(),B=a.create([1]),N=T.words,_=B.words,I=P.keySize,P=P.iterations;N.length<I;){var A=O.update(S).finalize(B);O.reset();for(var L=A.words,K=L.length,ie=A,ae=1;ae<P;ae++){ie=O.finalize(ie),O.reset();for(var se=ie.words,ce=0;ce<K;ce++)L[ce]^=se[ce]}T.concat(A),_[0]++}return T.sigBytes=4*I,T}});t.PBKDF2=function(x,S,O){return u.create(O).compute(x,S)}}();var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m="=";function C(t){var n,a,c="";for(n=0;n+3<=t.length;n+=3)a=parseInt(t.substring(n,n+3),16),c+=d.charAt(a>>6)+d.charAt(a&63);for(n+1==t.length?(a=parseInt(t.substring(n,n+1),16),c+=d.charAt(a<<2)):n+2==t.length&&(a=parseInt(t.substring(n,n+2),16),c+=d.charAt(a>>2)+d.charAt((a&3)<<4));(c.length&3)>0;)c+=m;return c}function h(t){var n="",a,c=0,p,u;for(a=0;a<t.length&&t.charAt(a)!=m;++a)u=d.indexOf(t.charAt(a)),!(u<0)&&(c==0?(n+=U(u>>2),p=u&3,c=1):c==1?(n+=U(p<<2|u>>4),p=u&15,c=2):c==2?(n+=U(p),n+=U(u>>2),p=u&3,c=3):(n+=U(p<<2|u>>4),n+=U(u&15),c=0));return c==1&&(n+=U(p<<2)),n}function v(t){var n=h(t),a,c=new Array;for(a=0;2*a<n.length;++a)c[a]=parseInt(n.substring(2*a,2*a+2),16);return c}var D;function E(t,n,a){t!=null&&(typeof t=="number"?this.fromNumber(t,n,a):n==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,n))}function R(){return new E(null)}function b(t,n,a,c,p,u){for(;--u>=0;){var x=n*this[t++]+a[c]+p;p=Math.floor(x/67108864),a[c++]=x&67108863}return p}function H(t,n,a,c,p,u){for(var x=n&32767,S=n>>15;--u>=0;){var O=this[t]&32767,T=this[t++]>>15,B=S*O+T*x;O=x*O+((B&32767)<<15)+a[c]+(p&1073741823),p=(O>>>30)+(B>>>15)+S*T+(p>>>30),a[c++]=O&1073741823}return p}function j(t,n,a,c,p,u){for(var x=n&16383,S=n>>14;--u>=0;){var O=this[t]&16383,T=this[t++]>>14,B=S*O+T*x;O=x*O+((B&16383)<<14)+a[c]+p,p=(O>>28)+(B>>14)+S*T,a[c++]=O&268435455}return p}i.appName=="Microsoft Internet Explorer"?(E.prototype.am=H,D=30):i.appName!="Netscape"?(E.prototype.am=b,D=26):(E.prototype.am=j,D=28),E.prototype.DB=D,E.prototype.DM=(1<<D)-1,E.prototype.DV=1<<D;var k=52;E.prototype.FV=Math.pow(2,k),E.prototype.F1=k-D,E.prototype.F2=2*D-k;var y="0123456789abcdefghijklmnopqrstuvwxyz",f=new Array,w,F;for(w=48,F=0;F<=9;++F)f[w++]=F;for(w=97,F=10;F<36;++F)f[w++]=F;for(w=65,F=10;F<36;++F)f[w++]=F;function U(t){return y.charAt(t)}function q(t,n){var a=f[t.charCodeAt(n)];return a??-1}function V(t){for(var n=this.t-1;n>=0;--n)t[n]=this[n];t.t=this.t,t.s=this.s}function $(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function J(t){var n=R();return n.fromInt(t),n}function X(t,n){var a;if(n==16)a=4;else if(n==8)a=3;else if(n==256)a=8;else if(n==2)a=1;else if(n==32)a=5;else if(n==4)a=2;else{this.fromRadix(t,n);return}this.t=0,this.s=0;for(var c=t.length,p=!1,u=0;--c>=0;){var x=a==8?t[c]&255:q(t,c);if(x<0){t.charAt(c)=="-"&&(p=!0);continue}p=!1,u==0?this[this.t++]=x:u+a>this.DB?(this[this.t-1]|=(x&(1<<this.DB-u)-1)<<u,this[this.t++]=x>>this.DB-u):this[this.t-1]|=x<<u,u+=a,u>=this.DB&&(u-=this.DB)}a==8&&t[0]&128&&(this.s=-1,u>0&&(this[this.t-1]|=(1<<this.DB-u)-1<<u)),this.clamp(),p&&E.ZERO.subTo(this,this)}function ee(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function re(t){if(this.s<0)return"-"+this.negate().toString(t);var n;if(t==16)n=4;else if(t==8)n=3;else if(t==2)n=1;else if(t==32)n=5;else if(t==4)n=2;else return this.toRadix(t);var a=(1<<n)-1,c,p=!1,u="",x=this.t,S=this.DB-x*this.DB%n;if(x-- >0)for(S<this.DB&&(c=this[x]>>S)>0&&(p=!0,u=U(c));x>=0;)S<n?(c=(this[x]&(1<<S)-1)<<n-S,c|=this[--x]>>(S+=this.DB-n)):(c=this[x]>>(S-=n)&a,S<=0&&(S+=this.DB,--x)),c>0&&(p=!0),p&&(u+=U(c));return p?u:"0"}function ne(){var t=R();return E.ZERO.subTo(this,t),t}function Ce(){return this.s<0?this.negate():this}function Re(t){var n=this.s-t.s;if(n!=0)return n;var a=this.t;if(n=a-t.t,n!=0)return this.s<0?-n:n;for(;--a>=0;)if((n=this[a]-t[a])!=0)return n;return 0}function ke(t){var n=1,a;return(a=t>>>16)!=0&&(t=a,n+=16),(a=t>>8)!=0&&(t=a,n+=8),(a=t>>4)!=0&&(t=a,n+=4),(a=t>>2)!=0&&(t=a,n+=2),(a=t>>1)!=0&&(t=a,n+=1),n}function Y(){return this.t<=0?0:this.DB*(this.t-1)+ke(this[this.t-1]^this.s&this.DM)}function he(t,n){var a;for(a=this.t-1;a>=0;--a)n[a+t]=this[a];for(a=t-1;a>=0;--a)n[a]=0;n.t=this.t+t,n.s=this.s}function be(t,n){for(var a=t;a<this.t;++a)n[a-t]=this[a];n.t=Math.max(this.t-t,0),n.s=this.s}function me(t,n){var a=t%this.DB,c=this.DB-a,p=(1<<c)-1,u=Math.floor(t/this.DB),x=this.s<<a&this.DM,S;for(S=this.t-1;S>=0;--S)n[S+u+1]=this[S]>>c|x,x=(this[S]&p)<<a;for(S=u-1;S>=0;--S)n[S]=0;n[u]=x,n.t=this.t+u+1,n.s=this.s,n.clamp()}function Te(t,n){n.s=this.s;var a=Math.floor(t/this.DB);if(a>=this.t){n.t=0;return}var c=t%this.DB,p=this.DB-c,u=(1<<c)-1;n[0]=this[a]>>c;for(var x=a+1;x<this.t;++x)n[x-a-1]|=(this[x]&u)<<p,n[x-a]=this[x]>>c;c>0&&(n[this.t-a-1]|=(this.s&u)<<p),n.t=this.t-a,n.clamp()}function Be(t,n){for(var a=0,c=0,p=Math.min(t.t,this.t);a<p;)c+=this[a]-t[a],n[a++]=c&this.DM,c>>=this.DB;if(t.t<this.t){for(c-=t.s;a<this.t;)c+=this[a],n[a++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;a<t.t;)c-=t[a],n[a++]=c&this.DM,c>>=this.DB;c-=t.s}n.s=c<0?-1:0,c<-1?n[a++]=this.DV+c:c>0&&(n[a++]=c),n.t=a,n.clamp()}function st(t,n){var a=this.abs(),c=t.abs(),p=a.t;for(n.t=p+c.t;--p>=0;)n[p]=0;for(p=0;p<c.t;++p)n[p+a.t]=a.am(0,c[p],n,p,0,a.t);n.s=0,n.clamp(),this.s!=t.s&&E.ZERO.subTo(n,n)}function ti(t){for(var n=this.abs(),a=t.t=2*n.t;--a>=0;)t[a]=0;for(a=0;a<n.t-1;++a){var c=n.am(a,n[a],t,2*a,0,1);(t[a+n.t]+=n.am(a+1,2*n[a],t,2*a+1,c,n.t-a-1))>=n.DV&&(t[a+n.t]-=n.DV,t[a+n.t+1]=1)}t.t>0&&(t[t.t-1]+=n.am(a,n[a],t,2*a,0,1)),t.s=0,t.clamp()}function Gt(t,n,a){var c=t.abs();if(!(c.t<=0)){var p=this.abs();if(p.t<c.t){n!=null&&n.fromInt(0),a!=null&&this.copyTo(a);return}a==null&&(a=R());var u=R(),x=this.s,S=t.s,O=this.DB-ke(c[c.t-1]);O>0?(c.lShiftTo(O,u),p.lShiftTo(O,a)):(c.copyTo(u),p.copyTo(a));var T=u.t,B=u[T-1];if(B!=0){var N=B*(1<<this.F1)+(T>1?u[T-2]>>this.F2:0),_=this.FV/N,I=(1<<this.F1)/N,P=1<<this.F2,A=a.t,L=A-T,K=n??R();for(u.dlShiftTo(L,K),a.compareTo(K)>=0&&(a[a.t++]=1,a.subTo(K,a)),E.ONE.dlShiftTo(T,K),K.subTo(u,u);u.t<T;)u[u.t++]=0;for(;--L>=0;){var ie=a[--A]==B?this.DM:Math.floor(a[A]*_+(a[A-1]+P)*I);if((a[A]+=u.am(0,ie,a,L,0,T))<ie)for(u.dlShiftTo(L,K),a.subTo(K,a);a[A]<--ie;)a.subTo(K,a)}n!=null&&(a.drShiftTo(T,n),x!=S&&E.ZERO.subTo(n,n)),a.t=T,a.clamp(),O>0&&a.rShiftTo(O,a),x<0&&E.ZERO.subTo(a,a)}}}function nr(t){var n=R();return this.abs().divRemTo(t,null,n),this.s<0&&n.compareTo(E.ZERO)>0&&t.subTo(n,n),n}function _i(t){this.m=t}function Un(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function sr(t){return t}function qr(t){t.divRemTo(this.m,null,t)}function qi(t,n,a){t.multiplyTo(n,a),this.reduce(a)}function qn(t,n){t.squareTo(n),this.reduce(n)}_i.prototype.convert=Un,_i.prototype.revert=sr,_i.prototype.reduce=qr,_i.prototype.mulTo=qi,_i.prototype.sqrTo=qn;function yr(){if(this.t<1)return 0;var t=this[0];if(!(t&1))return 0;var n=t&3;return n=n*(2-(t&15)*n)&15,n=n*(2-(t&255)*n)&255,n=n*(2-((t&65535)*n&65535))&65535,n=n*(2-t*n%this.DV)%this.DV,n>0?this.DV-n:-n}function Jt(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function _r(t){var n=R();return t.abs().dlShiftTo(this.m.t,n),n.divRemTo(this.m,null,n),t.s<0&&n.compareTo(E.ZERO)>0&&this.m.subTo(n,n),n}function Vn(t){var n=R();return t.copyTo(n),this.reduce(n),n}function Vr(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var n=0;n<this.m.t;++n){var a=t[n]&32767,c=a*this.mpl+((a*this.mph+(t[n]>>15)*this.mpl&this.um)<<15)&t.DM;for(a=n+this.m.t,t[a]+=this.m.am(0,c,t,n,0,this.m.t);t[a]>=t.DV;)t[a]-=t.DV,t[++a]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function Kr(t,n){t.squareTo(n),this.reduce(n)}function Ot(t,n,a){t.multiplyTo(n,a),this.reduce(a)}Jt.prototype.convert=_r,Jt.prototype.revert=Vn,Jt.prototype.reduce=Vr,Jt.prototype.mulTo=Ot,Jt.prototype.sqrTo=Kr;function ki(){return(this.t>0?this[0]&1:this.s)==0}function ar(t,n){if(t>4294967295||t<1)return E.ONE;var a=R(),c=R(),p=n.convert(this),u=ke(t)-1;for(p.copyTo(a);--u>=0;)if(n.sqrTo(a,c),(t&1<<u)>0)n.mulTo(c,p,a);else{var x=a;a=c,c=x}return n.revert(a)}function He(t,n){var a;return t<256||n.isEven()?a=new _i(n):a=new Jt(n),this.exp(t,a)}E.prototype.copyTo=V,E.prototype.fromInt=$,E.prototype.fromString=X,E.prototype.clamp=ee,E.prototype.dlShiftTo=he,E.prototype.drShiftTo=be,E.prototype.lShiftTo=me,E.prototype.rShiftTo=Te,E.prototype.subTo=Be,E.prototype.multiplyTo=st,E.prototype.squareTo=ti,E.prototype.divRemTo=Gt,E.prototype.invDigit=yr,E.prototype.isEven=ki,E.prototype.exp=ar,E.prototype.toString=re,E.prototype.negate=ne,E.prototype.abs=Ce,E.prototype.compareTo=Re,E.prototype.bitLength=Y,E.prototype.mod=nr,E.prototype.modPowInt=He,E.ZERO=J(0),E.ONE=J(1);function $e(){var t=R();return this.copyTo(t),t}function Ue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function at(){return this.t==0?this.s:this[0]<<24>>24}function Ke(){return this.t==0?this.s:this[0]<<16>>16}function or(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function et(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Vi(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var n=this.chunkSize(t),a=Math.pow(t,n),c=J(a),p=R(),u=R(),x="";for(this.divRemTo(c,p,u);p.signum()>0;)x=(a+u.intValue()).toString(t).substr(1)+x,p.divRemTo(c,p,u);return u.intValue().toString(t)+x}function ii(t,n){this.fromInt(0),n==null&&(n=10);for(var a=this.chunkSize(n),c=Math.pow(n,a),p=!1,u=0,x=0,S=0;S<t.length;++S){var O=q(t,S);if(O<0){t.charAt(S)=="-"&&this.signum()==0&&(p=!0);continue}x=n*x+O,++u>=a&&(this.dMultiply(c),this.dAddOffset(x,0),u=0,x=0)}u>0&&(this.dMultiply(Math.pow(n,u)),this.dAddOffset(x,0)),p&&E.ZERO.subTo(this,this)}function zr(t,n,a){if(typeof n=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,a),this.testBit(t-1)||this.bitwiseTo(E.ONE.shiftLeft(t-1),Kn,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(n);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(E.ONE.shiftLeft(t-1),this);else{var c=new Array,p=t&7;c.length=(t>>3)+1,n.nextBytes(c),p>0?c[0]&=(1<<p)-1:c[0]=0,this.fromString(c,256)}}function Wr(){var t=this.t,n=new Array;n[0]=this.s;var a=this.DB-t*this.DB%8,c,p=0;if(t-- >0)for(a<this.DB&&(c=this[t]>>a)!=(this.s&this.DM)>>a&&(n[p++]=c|this.s<<this.DB-a);t>=0;)a<8?(c=(this[t]&(1<<a)-1)<<8-a,c|=this[--t]>>(a+=this.DB-8)):(c=this[t]>>(a-=8)&255,a<=0&&(a+=this.DB,--t)),c&128&&(c|=-256),p==0&&(this.s&128)!=(c&128)&&++p,(p>0||c!=this.s)&&(n[p++]=c);return n}function Zc(t){return this.compareTo(t)==0}function el(t){return this.compareTo(t)<0?this:t}function tl(t){return this.compareTo(t)>0?this:t}function il(t,n,a){var c,p,u=Math.min(t.t,this.t);for(c=0;c<u;++c)a[c]=n(this[c],t[c]);if(t.t<this.t){for(p=t.s&this.DM,c=u;c<this.t;++c)a[c]=n(this[c],p);a.t=this.t}else{for(p=this.s&this.DM,c=u;c<t.t;++c)a[c]=n(p,t[c]);a.t=t.t}a.s=n(this.s,t.s),a.clamp()}function rl(t,n){return t&n}function nl(t){var n=R();return this.bitwiseTo(t,rl,n),n}function Kn(t,n){return t|n}function sl(t){var n=R();return this.bitwiseTo(t,Kn,n),n}function Qs(t,n){return t^n}function al(t){var n=R();return this.bitwiseTo(t,Qs,n),n}function Ys(t,n){return t&~n}function ol(t){var n=R();return this.bitwiseTo(t,Ys,n),n}function cl(){for(var t=R(),n=0;n<this.t;++n)t[n]=this.DM&~this[n];return t.t=this.t,t.s=~this.s,t}function ll(t){var n=R();return t<0?this.rShiftTo(-t,n):this.lShiftTo(t,n),n}function dl(t){var n=R();return t<0?this.lShiftTo(-t,n):this.rShiftTo(t,n),n}function ul(t){if(t==0)return-1;var n=0;return t&65535||(t>>=16,n+=16),t&255||(t>>=8,n+=8),t&15||(t>>=4,n+=4),t&3||(t>>=2,n+=2),t&1||++n,n}function hl(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+ul(this[t]);return this.s<0?this.t*this.DB:-1}function pl(t){for(var n=0;t!=0;)t&=t-1,++n;return n}function fl(){for(var t=0,n=this.s&this.DM,a=0;a<this.t;++a)t+=pl(this[a]^n);return t}function ml(t){var n=Math.floor(t/this.DB);return n>=this.t?this.s!=0:(this[n]&1<<t%this.DB)!=0}function gl(t,n){var a=E.ONE.shiftLeft(t);return this.bitwiseTo(a,n,a),a}function vl(t){return this.changeBit(t,Kn)}function bl(t){return this.changeBit(t,Ys)}function yl(t){return this.changeBit(t,Qs)}function _l(t,n){for(var a=0,c=0,p=Math.min(t.t,this.t);a<p;)c+=this[a]+t[a],n[a++]=c&this.DM,c>>=this.DB;if(t.t<this.t){for(c+=t.s;a<this.t;)c+=this[a],n[a++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;a<t.t;)c+=t[a],n[a++]=c&this.DM,c>>=this.DB;c+=t.s}n.s=c<0?-1:0,c>0?n[a++]=c:c<-1&&(n[a++]=this.DV+c),n.t=a,n.clamp()}function Sl(t){var n=R();return this.addTo(t,n),n}function wl(t){var n=R();return this.subTo(t,n),n}function Cl(t){var n=R();return this.multiplyTo(t,n),n}function xl(){var t=R();return this.squareTo(t),t}function El(t){var n=R();return this.divRemTo(t,n,null),n}function Pl(t){var n=R();return this.divRemTo(t,null,n),n}function Rl(t){var n=R(),a=R();return this.divRemTo(t,n,a),new Array(n,a)}function Tl(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Il(t,n){if(t!=0){for(;this.t<=n;)this[this.t++]=0;for(this[n]+=t;this[n]>=this.DV;)this[n]-=this.DV,++n>=this.t&&(this[this.t++]=0),++this[n]}}function Sr(){}function Zs(t){return t}function Dl(t,n,a){t.multiplyTo(n,a)}function Al(t,n){t.squareTo(n)}Sr.prototype.convert=Zs,Sr.prototype.revert=Zs,Sr.prototype.mulTo=Dl,Sr.prototype.sqrTo=Al;function Fl(t){return this.exp(t,new Sr)}function kl(t,n,a){var c=Math.min(this.t+t.t,n);for(a.s=0,a.t=c;c>0;)a[--c]=0;var p;for(p=a.t-this.t;c<p;++c)a[c+this.t]=this.am(0,t[c],a,c,0,this.t);for(p=Math.min(t.t,n);c<p;++c)this.am(0,t[c],a,c,0,n-c);a.clamp()}function Ol(t,n,a){--n;var c=a.t=this.t+t.t-n;for(a.s=0;--c>=0;)a[c]=0;for(c=Math.max(n-this.t,0);c<t.t;++c)a[this.t+c-n]=this.am(n-c,t[c],a,0,0,this.t+c-n);a.clamp(),a.drShiftTo(1,a)}function cr(t){this.r2=R(),this.q3=R(),E.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Ml(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var n=R();return t.copyTo(n),this.reduce(n),n}function Nl(t){return t}function Ll(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function jl(t,n){t.squareTo(n),this.reduce(n)}function Bl(t,n,a){t.multiplyTo(n,a),this.reduce(a)}cr.prototype.convert=Ml,cr.prototype.revert=Nl,cr.prototype.reduce=Ll,cr.prototype.mulTo=Bl,cr.prototype.sqrTo=jl;function Hl(t,n){var a=t.bitLength(),c,p=J(1),u;if(a<=0)return p;a<18?c=1:a<48?c=3:a<144?c=4:a<768?c=5:c=6,a<8?u=new _i(n):n.isEven()?u=new cr(n):u=new Jt(n);var x=new Array,S=3,O=c-1,T=(1<<c)-1;if(x[1]=u.convert(this),c>1){var B=R();for(u.sqrTo(x[1],B);S<=T;)x[S]=R(),u.mulTo(B,x[S-2],x[S]),S+=2}var N=t.t-1,_,I=!0,P=R(),A;for(a=ke(t[N])-1;N>=0;){for(a>=O?_=t[N]>>a-O&T:(_=(t[N]&(1<<a+1)-1)<<O-a,N>0&&(_|=t[N-1]>>this.DB+a-O)),S=c;!(_&1);)_>>=1,--S;if((a-=S)<0&&(a+=this.DB,--N),I)x[_].copyTo(p),I=!1;else{for(;S>1;)u.sqrTo(p,P),u.sqrTo(P,p),S-=2;S>0?u.sqrTo(p,P):(A=p,p=P,P=A),u.mulTo(P,x[_],p)}for(;N>=0&&!(t[N]&1<<a);)u.sqrTo(p,P),A=p,p=P,P=A,--a<0&&(a=this.DB-1,--N)}return u.revert(p)}function Ul(t){var n=this.s<0?this.negate():this.clone(),a=t.s<0?t.negate():t.clone();if(n.compareTo(a)<0){var c=n;n=a,a=c}var p=n.getLowestSetBit(),u=a.getLowestSetBit();if(u<0)return n;for(p<u&&(u=p),u>0&&(n.rShiftTo(u,n),a.rShiftTo(u,a));n.signum()>0;)(p=n.getLowestSetBit())>0&&n.rShiftTo(p,n),(p=a.getLowestSetBit())>0&&a.rShiftTo(p,a),n.compareTo(a)>=0?(n.subTo(a,n),n.rShiftTo(1,n)):(a.subTo(n,a),a.rShiftTo(1,a));return u>0&&a.lShiftTo(u,a),a}function ql(t){if(t<=0)return 0;var n=this.DV%t,a=this.s<0?t-1:0;if(this.t>0)if(n==0)a=this[0]%t;else for(var c=this.t-1;c>=0;--c)a=(n*a+this[c])%t;return a}function Vl(t){var n=t.isEven();if(this.isEven()&&n||t.signum()==0)return E.ZERO;for(var a=t.clone(),c=this.clone(),p=J(1),u=J(0),x=J(0),S=J(1);a.signum()!=0;){for(;a.isEven();)a.rShiftTo(1,a),n?((!p.isEven()||!u.isEven())&&(p.addTo(this,p),u.subTo(t,u)),p.rShiftTo(1,p)):u.isEven()||u.subTo(t,u),u.rShiftTo(1,u);for(;c.isEven();)c.rShiftTo(1,c),n?((!x.isEven()||!S.isEven())&&(x.addTo(this,x),S.subTo(t,S)),x.rShiftTo(1,x)):S.isEven()||S.subTo(t,S),S.rShiftTo(1,S);a.compareTo(c)>=0?(a.subTo(c,a),n&&p.subTo(x,p),u.subTo(S,u)):(c.subTo(a,c),n&&x.subTo(p,x),S.subTo(u,S))}if(c.compareTo(E.ONE)!=0)return E.ZERO;if(S.compareTo(t)>=0)return S.subtract(t);if(S.signum()<0)S.addTo(t,S);else return S;return S.signum()<0?S.add(t):S}var Mt=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Kl=(1<<26)/Mt[Mt.length-1];function zl(t){var n,a=this.abs();if(a.t==1&&a[0]<=Mt[Mt.length-1]){for(n=0;n<Mt.length;++n)if(a[0]==Mt[n])return!0;return!1}if(a.isEven())return!1;for(n=1;n<Mt.length;){for(var c=Mt[n],p=n+1;p<Mt.length&&c<Kl;)c*=Mt[p++];for(c=a.modInt(c);n<p;)if(c%Mt[n++]==0)return!1}return a.millerRabin(t)}function Wl(t){var n=this.subtract(E.ONE),a=n.getLowestSetBit();if(a<=0)return!1;var c=n.shiftRight(a);t=t+1>>1,t>Mt.length&&(t=Mt.length);for(var p=R(),u=0;u<t;++u){p.fromInt(Mt[Math.floor(Math.random()*Mt.length)]);var x=p.modPow(c,this);if(x.compareTo(E.ONE)!=0&&x.compareTo(n)!=0){for(var S=1;S++<a&&x.compareTo(n)!=0;)if(x=x.modPowInt(2,this),x.compareTo(E.ONE)==0)return!1;if(x.compareTo(n)!=0)return!1}}return!0}E.prototype.chunkSize=or,E.prototype.toRadix=Vi,E.prototype.fromRadix=ii,E.prototype.fromNumber=zr,E.prototype.bitwiseTo=il,E.prototype.changeBit=gl,E.prototype.addTo=_l,E.prototype.dMultiply=Tl,E.prototype.dAddOffset=Il,E.prototype.multiplyLowerTo=kl,E.prototype.multiplyUpperTo=Ol,E.prototype.modInt=ql,E.prototype.millerRabin=Wl,E.prototype.clone=$e,E.prototype.intValue=Ue,E.prototype.byteValue=at,E.prototype.shortValue=Ke,E.prototype.signum=et,E.prototype.toByteArray=Wr,E.prototype.equals=Zc,E.prototype.min=el,E.prototype.max=tl,E.prototype.and=nl,E.prototype.or=sl,E.prototype.xor=al,E.prototype.andNot=ol,E.prototype.not=cl,E.prototype.shiftLeft=ll,E.prototype.shiftRight=dl,E.prototype.getLowestSetBit=hl,E.prototype.bitCount=fl,E.prototype.testBit=ml,E.prototype.setBit=vl,E.prototype.clearBit=bl,E.prototype.flipBit=yl,E.prototype.add=Sl,E.prototype.subtract=wl,E.prototype.multiply=Cl,E.prototype.divide=El,E.prototype.remainder=Pl,E.prototype.divideAndRemainder=Rl,E.prototype.modPow=Hl,E.prototype.modInverse=Vl,E.prototype.pow=Fl,E.prototype.gcd=Ul,E.prototype.isProbablePrime=zl,E.prototype.square=xl;function zn(){this.i=0,this.j=0,this.S=new Array}function $l(t){var n,a,c;for(n=0;n<256;++n)this.S[n]=n;for(a=0,n=0;n<256;++n)a=a+this.S[n]+t[n%t.length]&255,c=this.S[n],this.S[n]=this.S[a],this.S[a]=c;this.i=0,this.j=0}function Gl(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}zn.prototype.init=$l,zn.prototype.next=Gl;function Jl(){return new zn}var Wn=256,$r,Xt,wt;function Xl(t){Xt[wt++]^=t&255,Xt[wt++]^=t>>8&255,Xt[wt++]^=t>>16&255,Xt[wt++]^=t>>24&255,wt>=Wn&&(wt-=Wn)}function $n(){Xl(new Date().getTime())}if(Xt==null){if(Xt=new Array,wt=0,r!==void 0&&(r.crypto!==void 0||r.msCrypto!==void 0)){if(Gn=r.crypto||r.msCrypto,Gn.getRandomValues)for(Jn=new Uint8Array(32),Gn.getRandomValues(Jn),di=0;di<32;++di)Xt[wt++]=Jn[di];else if(i.appName=="Netscape"&&i.appVersion<"5")for(Xn=r.crypto.random(32),di=0;di<Xn.length;++di)Xt[wt++]=Xn.charCodeAt(di)&255}for(;wt<Wn;)di=Math.floor(65536*Math.random()),Xt[wt++]=di>>>8,Xt[wt++]=di&255;wt=0,$n()}var di,Gn,Jn,Xn;function Ql(){if($r==null){for($n(),$r=Jl(),$r.init(Xt),wt=0;wt<Xt.length;++wt)Xt[wt]=0;wt=0}return $r.next()}function Yl(t){var n;for(n=0;n<t.length;++n)t[n]=Ql()}function lr(){}lr.prototype.nextBytes=Yl;function Ut(t,n){return new E(t,n)}function Me(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Zl(t,n){if(this.isPublic=!0,this.isPrivate=!1,typeof t!="string")this.n=t,this.e=n;else if(t!=null&&n!=null&&t.length>0&&n.length>0)this.n=Ut(t,16),this.e=parseInt(n,16);else throw"Invalid RSA public key"}function ed(t){return t.modPowInt(this.e,this.n)}Me.prototype.doPublic=ed,Me.prototype.setPublic=Zl,Me.prototype.type="RSA";function td(t,n,a){if(this.isPrivate=!0,typeof t!="string")this.n=t,this.e=n,this.d=a;else if(t!=null&&n!=null&&t.length>0&&n.length>0)this.n=Ut(t,16),this.e=parseInt(n,16),this.d=Ut(a,16);else throw"Invalid RSA private key"}function id(t,n,a,c,p,u,x,S){if(this.isPrivate=!0,this.isPublic=!1,t==null)throw"RSASetPrivateEx N == null";if(n==null)throw"RSASetPrivateEx E == null";if(t.length==0)throw"RSASetPrivateEx N.length == 0";if(n.length==0)throw"RSASetPrivateEx E.length == 0";if(t!=null&&n!=null&&t.length>0&&n.length>0)this.n=Ut(t,16),this.e=parseInt(n,16),this.d=Ut(a,16),this.p=Ut(c,16),this.q=Ut(p,16),this.dmp1=Ut(u,16),this.dmq1=Ut(x,16),this.coeff=Ut(S,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function rd(t,n){var a=new lr,c=t>>1;this.e=parseInt(n,16);for(var p=new E(n,16),u=t/2-100,x=E.ONE.shiftLeft(u);;){for(;this.p=new E(t-c,1,a),!(this.p.subtract(E.ONE).gcd(p).compareTo(E.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new E(c,1,a),!(this.q.subtract(E.ONE).gcd(p).compareTo(E.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var S=this.p;this.p=this.q,this.q=S}var O=this.q.subtract(this.p).abs();if(!(O.bitLength()<u||O.compareTo(x)<=0)){var T=this.p.subtract(E.ONE),B=this.q.subtract(E.ONE),N=T.multiply(B);if(N.gcd(p).compareTo(E.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==t)){this.d=p.modInverse(N),this.dmp1=this.d.mod(T),this.dmq1=this.d.mod(B),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function nd(t){if(this.p==null||this.q==null)return t.modPow(this.d,this.n);for(var n=t.mod(this.p).modPow(this.dmp1,this.p),a=t.mod(this.q).modPow(this.dmq1,this.q);n.compareTo(a)<0;)n=n.add(this.p);return n.subtract(a).multiply(this.coeff).mod(this.p).multiply(this.q).add(a)}Me.prototype.doPrivate=nd,Me.prototype.setPrivate=td,Me.prototype.setPrivateEx=id,Me.prototype.generate=rd;function yt(t,n){this.x=n,this.q=t}function sd(t){return t==this?!0:this.q.equals(t.q)&&this.x.equals(t.x)}function ad(){return this.x}function od(){return new yt(this.q,this.x.negate().mod(this.q))}function cd(t){return new yt(this.q,this.x.add(t.toBigInteger()).mod(this.q))}function ld(t){return new yt(this.q,this.x.subtract(t.toBigInteger()).mod(this.q))}function dd(t){return new yt(this.q,this.x.multiply(t.toBigInteger()).mod(this.q))}function ud(){return new yt(this.q,this.x.square().mod(this.q))}function hd(t){return new yt(this.q,this.x.multiply(t.toBigInteger().modInverse(this.q)).mod(this.q))}yt.prototype.equals=sd,yt.prototype.toBigInteger=ad,yt.prototype.negate=od,yt.prototype.add=cd,yt.prototype.subtract=ld,yt.prototype.multiply=dd,yt.prototype.square=ud,yt.prototype.divide=hd,yt.prototype.sqrt=function(){return new yt(this.q,this.x.sqrt().mod(this.q))};function We(t,n,a,c){this.curve=t,this.x=n,this.y=a,c==null?this.z=E.ONE:this.z=c,this.zinv=null}function pd(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function fd(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function md(t){if(t==this)return!0;if(this.isInfinity())return t.isInfinity();if(t.isInfinity())return this.isInfinity();var n,a;return n=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),n.equals(E.ZERO)?(a=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q),a.equals(E.ZERO)):!1}function gd(){return this.x==null&&this.y==null?!0:this.z.equals(E.ZERO)&&!this.y.toBigInteger().equals(E.ZERO)}function vd(){return new We(this.curve,this.x,this.y.negate(),this.z)}function bd(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var n=t.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(t.z)).mod(this.curve.q),a=t.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(t.z)).mod(this.curve.q);if(E.ZERO.equals(a))return E.ZERO.equals(n)?this.twice():this.curve.getInfinity();var c=new E("3"),p=this.x.toBigInteger(),u=this.y.toBigInteger();t.x.toBigInteger(),t.y.toBigInteger();var x=a.square(),S=x.multiply(a),O=p.multiply(x),T=n.square().multiply(this.z),B=T.subtract(O.shiftLeft(1)).multiply(t.z).subtract(S).multiply(a).mod(this.curve.q),N=O.multiply(c).multiply(n).subtract(u.multiply(S)).subtract(T.multiply(n)).multiply(t.z).add(n.multiply(S)).mod(this.curve.q),_=S.multiply(this.z).multiply(t.z).mod(this.curve.q);return new We(this.curve,this.curve.fromBigInteger(B),this.curve.fromBigInteger(N),_)}function yd(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=new E("3"),n=this.x.toBigInteger(),a=this.y.toBigInteger(),c=a.multiply(this.z),p=c.multiply(a).mod(this.curve.q),u=this.curve.a.toBigInteger(),x=n.square().multiply(t);E.ZERO.equals(u)||(x=x.add(this.z.square().multiply(u))),x=x.mod(this.curve.q);var S=x.square().subtract(n.shiftLeft(3).multiply(p)).shiftLeft(1).multiply(c).mod(this.curve.q),O=x.multiply(t).multiply(n).subtract(p.shiftLeft(1)).shiftLeft(2).multiply(p).subtract(x.square().multiply(x)).mod(this.curve.q),T=c.square().multiply(c).shiftLeft(3).mod(this.curve.q);return new We(this.curve,this.curve.fromBigInteger(S),this.curve.fromBigInteger(O),T)}function _d(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var n=t,a=n.multiply(new E("3")),c=this.negate(),p=this,u=this.curve.q.subtract(t),x=u.multiply(new E("3")),S=new We(this.curve,this.x,this.y),O=S.negate(),T;for(T=a.bitLength()-2;T>0;--T){p=p.twice();var B=a.testBit(T),N=n.testBit(T);B!=N&&(p=p.add(B?this:c))}for(T=x.bitLength()-2;T>0;--T){S=S.twice();var _=x.testBit(T),I=u.testBit(T);_!=I&&(S=S.add(_?S:O))}return p}function Sd(t,n,a){var c;t.bitLength()>a.bitLength()?c=t.bitLength()-1:c=a.bitLength()-1;for(var p=this.curve.getInfinity(),u=this.add(n);c>=0;)p=p.twice(),t.testBit(c)?a.testBit(c)?p=p.add(u):p=p.add(this):a.testBit(c)&&(p=p.add(n)),--c;return p}We.prototype.getX=pd,We.prototype.getY=fd,We.prototype.equals=md,We.prototype.isInfinity=gd,We.prototype.negate=vd,We.prototype.add=bd,We.prototype.twice=yd,We.prototype.multiply=_d,We.prototype.multiplyTwo=Sd;function Di(t,n,a){this.q=t,this.a=this.fromBigInteger(n),this.b=this.fromBigInteger(a),this.infinity=new We(this,null,null)}function wd(){return this.q}function Cd(){return this.a}function xd(){return this.b}function Ed(t){return t==this?!0:this.q.equals(t.q)&&this.a.equals(t.a)&&this.b.equals(t.b)}function Pd(){return this.infinity}function Rd(t){return new yt(this.q,t)}function Td(t){switch(parseInt(t.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var n=t.substr(0,2);t.substr(2);var a=this.fromBigInteger(new E(O,16)),c=this.getA(),p=this.getB(),u=a.square().add(c).multiply(a).add(p),x=u.sqrt();return n=="03"&&(x=x.negate()),new We(this,a,x);case 4:case 6:case 7:var S=(t.length-2)/2,O=t.substr(2,S),T=t.substr(S+2,S);return new We(this,this.fromBigInteger(new E(O,16)),this.fromBigInteger(new E(T,16)));default:return null}}Di.prototype.getQ=wd,Di.prototype.getA=Cd,Di.prototype.getB=xd,Di.prototype.equals=Ed,Di.prototype.getInfinity=Pd,Di.prototype.fromBigInteger=Rd,Di.prototype.decodePointHex=Td,yt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},We.prototype.getEncoded=function(t){var n=function(u,x){var S=u.toByteArrayUnsigned();if(x<S.length)S=S.slice(S.length-x);else for(;x>S.length;)S.unshift(0);return S},a=this.getX().toBigInteger(),c=this.getY().toBigInteger(),p=n(a,32);return t?c.isEven()?p.unshift(2):p.unshift(3):(p.unshift(4),p=p.concat(n(c,32))),p},We.decodeFrom=function(t,n){n[0];var a=n.length-1,c=n.slice(1,1+a/2),p=n.slice(1+a/2,1+a);c.unshift(0),p.unshift(0);var u=new E(c),x=new E(p);return new We(t,t.fromBigInteger(u),t.fromBigInteger(x))},We.decodeFromHex=function(t,n){n.substr(0,2);var a=n.length-2,c=n.substr(2,a/2),p=n.substr(2+a/2,a/2),u=new E(c,16),x=new E(p,16);return new We(t,t.fromBigInteger(u),t.fromBigInteger(x))},We.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var n=t.x.subtract(this.x),a=t.y.subtract(this.y),c=a.divide(n),p=c.square().subtract(this.x).subtract(t.x),u=c.multiply(this.x.subtract(p)).subtract(this.y);return new We(this.curve,p,u)},We.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=this.curve.fromBigInteger(E.valueOf(2)),n=this.curve.fromBigInteger(E.valueOf(3)),a=this.x.square().multiply(n).add(this.curve.a).divide(this.y.multiply(t)),c=a.square().subtract(this.x.multiply(t)),p=a.multiply(this.x.subtract(c)).subtract(this.y);return new We(this.curve,c,p)},We.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var n=t,a=n.multiply(new E("3")),c=this.negate(),p=this,u;for(u=a.bitLength()-2;u>0;--u){p=p.twice();var x=a.testBit(u),S=n.testBit(u);x!=S&&(p=p.add2D(x?this:c))}return p},We.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),n=this.getY().toBigInteger(),a=this.curve.getA().toBigInteger(),c=this.curve.getB().toBigInteger(),p=this.curve.getQ(),u=n.multiply(n).mod(p),x=t.multiply(t).multiply(t).add(a.multiply(t)).add(c).mod(p);return u.equals(x)},We.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},We.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var n=this.getX().toBigInteger(),a=this.getY().toBigInteger();if(n.compareTo(E.ONE)<0||n.compareTo(t.subtract(E.ONE))>0)throw new Error("x coordinate out of bounds");if(a.compareTo(E.ONE)<0||a.compareTo(t.subtract(E.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var ea=function(){var t="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",n='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',a='(?:"'+n+'*")',c=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+t+"|"+a+")","g"),p=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),u={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function x(B,N,_){return N?u[N]:String.fromCharCode(parseInt(_,16))}var S=new String(""),O="\\",T=Object.hasOwnProperty;return function(B,N){var _=B.match(c),I,P=_[0],A=!1;P==="{"?I={}:P==="["?I=[]:(I=[],A=!0);for(var L,K=[I],ie=1-A,ae=_.length;ie<ae;++ie){P=_[ie];var se;switch(P.charCodeAt(0)){default:se=K[0],se[L||se.length]=+P,L=void 0;break;case 34:if(P=P.substring(1,P.length-1),P.indexOf(O)!==-1&&(P=P.replace(p,x)),se=K[0],!L)if(se instanceof Array)L=se.length;else{L=P||S;break}se[L]=P,L=void 0;break;case 91:se=K[0],K.unshift(se[L||se.length]=[]),L=void 0;break;case 93:K.shift();break;case 102:se=K[0],se[L||se.length]=!1,L=void 0;break;case 110:se=K[0],se[L||se.length]=null,L=void 0;break;case 116:se=K[0],se[L||se.length]=!0,L=void 0;break;case 123:se=K[0],K.unshift(se[L||se.length]={}),L=void 0;break;case 125:K.shift();break}}if(A){if(K.length!==1)throw new Error;I=I[0]}else if(K.length)throw new Error;if(N){var ce=function(z,G){var Q=z[G];if(Q&&typeof Q=="object"){var W=null;for(var te in Q)if(T.call(Q,te)&&Q!==z){var oe=ce(Q,te);oe!==void 0?Q[te]=oe:(W||(W=[]),W.push(te))}if(W)for(var de=W.length;--de>=0;)delete Q[W[de]]}return N.call(z,G,Q)};I=ce({"":I},"")}return I}}();(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),g.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var n=t.toString(16);return n.length%2==1&&(n="0"+n),n},this.bigIntToMinTwosComplementsHex=function(t){return xr(t)},this.getPEMStringFromHex=function(t,n){return Tt(t,n)},this.newObject=function(t){var n=g,a=n.asn1,c=a.ASN1Object,p=a.DERBoolean,u=a.DERInteger,x=a.DERBitString,S=a.DEROctetString,O=a.DERNull,T=a.DERObjectIdentifier,B=a.DEREnumerated,N=a.DERUTF8String,_=a.DERNumericString,I=a.DERPrintableString,P=a.DERTeletexString,A=a.DERIA5String,L=a.DERUTCTime,K=a.DERGeneralizedTime,ie=a.DERVisibleString,ae=a.DERBMPString,se=a.DERSequence,ce=a.DERSet,z=a.DERTaggedObject,G=a.ASN1Util.newObject;if(t instanceof a.ASN1Object)return t;var Q=Object.keys(t);if(Q.length!=1)throw new Error("key of param shall be only one.");var W=Q[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+W+":")==-1)throw new Error("undefined key: "+W);if(W=="bool")return new p(t[W]);if(W=="int")return new u(t[W]);if(W=="bitstr")return new x(t[W]);if(W=="octstr")return new S(t[W]);if(W=="null")return new O(t[W]);if(W=="oid")return new T(t[W]);if(W=="enum")return new B(t[W]);if(W=="utf8str")return new N(t[W]);if(W=="numstr")return new _(t[W]);if(W=="prnstr")return new I(t[W]);if(W=="telstr")return new P(t[W]);if(W=="ia5str")return new A(t[W]);if(W=="utctime")return new L(t[W]);if(W=="gentime")return new K(t[W]);if(W=="visstr")return new ie(t[W]);if(W=="bmpstr")return new ae(t[W]);if(W=="asn1")return new c(t[W]);if(W=="seq"){for(var te=t[W],oe=[],de=0;de<te.length;de++){var _e=G(te[de]);oe.push(_e)}return new se({array:oe})}if(W=="set"){for(var te=t[W],oe=[],de=0;de<te.length;de++){var _e=G(te[de]);oe.push(_e)}return new ce({array:oe})}if(W=="tag"){var le=t[W];if(Object.prototype.toString.call(le)==="[object Array]"&&le.length==3){var pe=G(le[2]);return new z({tag:le[0],explicit:le[1],obj:pe})}else return new z(le)}},this.jsonToASN1HEX=function(t){var n=this.newObject(t);return n.tohex()}},g.asn1.ASN1Util.oidHexToInt=function(t){for(var p="",n=parseInt(t.substr(0,2),16),a=Math.floor(n/40),c=n%40,p=a+"."+c,u="",x=2;x<t.length;x+=2){var S=parseInt(t.substr(x,2),16),O=("00000000"+S.toString(2)).slice(-8);if(u=u+O.substr(1,7),O.substr(0,1)=="0"){var T=new E(u,2);p=p+"."+T.toString(10),u=""}}return p},g.asn1.ASN1Util.oidIntToHex=function(t){var n=function(S){var O=S.toString(16);return O.length==1&&(O="0"+O),O},a=function(S){var O="",T=new E(S,10),B=T.toString(2),N=7-B.length%7;N==7&&(N=0);for(var _="",I=0;I<N;I++)_+="0";B=_+B;for(var I=0;I<B.length-1;I+=7){var P=B.substr(I,7);I!=B.length-7&&(P="1"+P),O+=n(parseInt(P,2))}return O};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var c="",p=t.split("."),u=parseInt(p[0])*40+parseInt(p[1]);c+=n(u),p.splice(0,2);for(var x=0;x<p.length;x++)c+=a(p[x]);return c},g.asn1.ASN1Object=function(t){var n="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+n.length+",v="+this.hV);var a=this.hV.length/2,c=a.toString(16);if(c.length%2==1&&(c="0"+c),a<128)return c;var p=c.length/2;if(p>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+a.toString(16));var u=128+p;return u.toString(16)+c},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(a){this.params=a},t!=null&&t.tlv!=null&&(this.hTLV=t.tlv,this.isModified=!1)},g.asn1.DERAbstractString=function(t){g.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(n){this.hTLV=null,this.isModified=!0,this.s=n,this.hV=Jr(this.s).toLowerCase()},this.setStringHex=function(n){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.getFreshValueHex=function(){return this.hV},typeof t<"u"&&(typeof t=="string"?this.setString(t):typeof t.str<"u"?this.setString(t.str):typeof t.hex<"u"&&this.setStringHex(t.hex))},ye(g.asn1.DERAbstractString,g.asn1.ASN1Object),g.asn1.DERAbstractTime=function(t){g.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(n){var a=n.getTime()+n.getTimezoneOffset()*6e4,c=new Date(a);return c},this.formatDate=function(n,a,c){var p=this.zeroPadding,u=this.localDateToUTC(n),x=String(u.getFullYear());a=="utc"&&(x=x.substr(2,2));var S=p(String(u.getMonth()+1),2),O=p(String(u.getDate()),2),T=p(String(u.getHours()),2),B=p(String(u.getMinutes()),2),N=p(String(u.getSeconds()),2),_=x+S+O+T+B+N;if(c===!0){var I=u.getMilliseconds();if(I!=0){var P=p(String(I),3);P=P.replace(/[0]+$/,""),_=_+"."+P}}return _+"Z"},this.zeroPadding=function(n,a){return n.length>=a?n:new Array(a-n.length+1).join("0")+n},this.setByParam=function(n){this.hV=null,this.hTLV=null,this.params=n},this.getString=function(){},this.setString=function(n){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=n},this.setByDate=function(n){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=n},this.setByDateValue=function(n,a,c,p,u,x){var S=new Date(Date.UTC(n,a-1,c,p,u,x,0));this.setByDate(S)},this.getFreshValueHex=function(){return this.hV}},ye(g.asn1.DERAbstractTime,g.asn1.ASN1Object),g.asn1.DERAbstractStructured=function(t){g.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(n){this.hTLV=null,this.isModified=!0,this.asn1Array=n},this.appendASN1Object=function(n){this.hTLV=null,this.isModified=!0,this.asn1Array.push(n)},this.asn1Array=new Array,typeof t<"u"&&typeof t.array<"u"&&(this.asn1Array=t.array)},ye(g.asn1.DERAbstractStructured,g.asn1.ASN1Object),g.asn1.DERBoolean=function(t){g.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",t==!1?this.hTLV="010100":this.hTLV="0101ff"},ye(g.asn1.DERBoolean,g.asn1.ASN1Object),g.asn1.DERInteger=function(t){g.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var n=xr;this.setByBigInteger=function(a){this.isModified=!0,this.params={bigint:a}},this.setByInteger=function(a){this.isModified=!0,this.params=a},this.setValueHex=function(a){this.isModified=!0,this.params={hex:a}},this.getFreshValueHex=function(){var a=this.params,c=null;if(a==null)throw new Error("value not set");if(typeof a=="object"&&a.hex!=null)return this.hV=a.hex,this.hV;if(typeof a=="number")c=new E(String(a),10);else if(a.int!=null)c=new E(String(a.int),10);else if(a.bigint!=null)c=a.bigint;else throw new Error("wrong parameter");return this.hV=n(c),this.hV},t!=null&&(this.params=t)},ye(g.asn1.DERInteger,g.asn1.ASN1Object),g.asn1.DERBitString=function(t){if(t!==void 0&&typeof t.obj<"u"){var n=g.asn1.ASN1Util.newObject(t.obj);t.hex="00"+n.tohex()}g.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null,this.isModified=!0,this.hV=a},this.setUnusedBitsAndHexValue=function(a,c){if(a<0||7<a)throw"unused bits shall be from 0 to 7: u = "+a;var p="0"+a;this.hTLV=null,this.isModified=!0,this.hV=p+c},this.setByBinaryString=function(a){a=a.replace(/0+$/,"");var c=8-a.length%8;c==8&&(c=0),a+="0000000".substr(0,c);for(var p="",u=0;u<a.length-1;u+=8){var x=a.substr(u,8),S=parseInt(x,2).toString(16);S.length==1&&(S="0"+S),p+=S}this.hTLV=null,this.isModified=!0,this.hV="0"+c+p},this.setByBooleanArray=function(a){for(var c="",p=0;p<a.length;p++)a[p]==!0?c+="1":c+="0";this.setByBinaryString(c)},this.newFalseArray=function(a){for(var c=new Array(a),p=0;p<a;p++)c[p]=!1;return c},this.getFreshValueHex=function(){return this.hV},typeof t<"u"&&(typeof t=="string"&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):typeof t.hex<"u"?this.setHexValueIncludingUnusedBits(t.hex):typeof t.bin<"u"?this.setByBinaryString(t.bin):typeof t.array<"u"&&this.setByBooleanArray(t.array))},ye(g.asn1.DERBitString,g.asn1.ASN1Object),g.asn1.DEROctetString=function(t){if(t!==void 0&&typeof t.obj<"u"){var n=g.asn1.ASN1Util.newObject(t.obj);t.hex=n.tohex()}g.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},ye(g.asn1.DEROctetString,g.asn1.DERAbstractString),g.asn1.DERNull=function(){g.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ye(g.asn1.DERNull,g.asn1.ASN1Object),g.asn1.DERObjectIdentifier=function(t){g.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(n){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=n},this.setValueOidString=function(n){var a=la(n);if(a==null)throw new Error("malformed oid string: "+n);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueName=function(n){var a=g.asn1.x509.OID.name2oid(n);if(a!=="")this.setValueOidString(a);else throw new Error("DERObjectIdentifier oidName undefined: "+n)},this.setValueNameOrOid=function(n){n.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(n):this.setValueName(n)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(n){typeof n=="string"?this.setValueNameOrOid(n):n.oid!==void 0?this.setValueNameOrOid(n.oid):n.name!==void 0?this.setValueNameOrOid(n.name):n.hex!==void 0&&this.setValueHex(n.hex)},t!==void 0&&this.setByParam(t)},ye(g.asn1.DERObjectIdentifier,g.asn1.ASN1Object),g.asn1.DEREnumerated=function(t){g.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(n){this.hTLV=null,this.isModified=!0,this.hV=xr(n)},this.setByInteger=function(n){var a=new E(String(n),10);this.setByBigInteger(a)},this.setValueHex=function(n){this.hV=n},this.getFreshValueHex=function(){return this.hV},typeof t<"u"&&(typeof t.int<"u"?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):typeof t.hex<"u"&&this.setValueHex(t.hex))},ye(g.asn1.DEREnumerated,g.asn1.ASN1Object),g.asn1.DERUTF8String=function(t){g.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},ye(g.asn1.DERUTF8String,g.asn1.DERAbstractString),g.asn1.DERNumericString=function(t){g.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},ye(g.asn1.DERNumericString,g.asn1.DERAbstractString),g.asn1.DERPrintableString=function(t){g.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},ye(g.asn1.DERPrintableString,g.asn1.DERAbstractString),g.asn1.DERTeletexString=function(t){g.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},ye(g.asn1.DERTeletexString,g.asn1.DERAbstractString),g.asn1.DERIA5String=function(t){g.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},ye(g.asn1.DERIA5String,g.asn1.DERAbstractString),g.asn1.DERVisibleString=function(t){g.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="1a"},ye(g.asn1.DERVisibleString,g.asn1.DERAbstractString),g.asn1.DERBMPString=function(t){g.asn1.DERBMPString.superclass.constructor.call(this,t),this.hT="1e"},ye(g.asn1.DERBMPString,g.asn1.DERAbstractString),g.asn1.DERUTCTime=function(t){g.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var n=this.params;if(this.params==null&&(n={date:new Date}),typeof n=="string")if(n.match(/^[0-9]{12}Z$/)||n.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=qt(n);else throw new Error("malformed string for UTCTime: "+n);else if(n.str!=null)this.hV=qt(n.str);else if(n.date==null&&n.millis==!0){var a=new Date;this.hV=qt(this.formatDate(a,"utc",!0))}else if(n.date!=null&&n.date instanceof Date){var c=n.millis===!0;this.hV=qt(this.formatDate(n.date,"utc",c))}else n instanceof Date&&(this.hV=qt(this.formatDate(n,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},t!=null&&this.setByParam(t)},ye(g.asn1.DERUTCTime,g.asn1.DERAbstractTime),g.asn1.DERGeneralizedTime=function(t){g.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.params=t,this.getFreshValueHex=function(){var n=this.params;if(this.params==null&&(n={date:new Date}),typeof n=="string")if(n.match(/^[0-9]{14}Z$/)||n.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=qt(n);else throw new Error("malformed string for GeneralizedTime: "+n);else if(n.str!=null)this.hV=qt(n.str);else if(n.date==null&&n.millis==!0){var a=new Date;this.hV=qt(this.formatDate(a,"gen",!0))}else if(n.date!=null&&n.date instanceof Date){var c=n.millis===!0;this.hV=qt(this.formatDate(n.date,"gen",c))}else n instanceof Date&&(this.hV=qt(this.formatDate(n,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},t!=null&&this.setByParam(t)},ye(g.asn1.DERGeneralizedTime,g.asn1.DERAbstractTime),g.asn1.DERSequence=function(t){g.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var n="",a=0;a<this.asn1Array.length;a++){var c=this.asn1Array[a];n+=c.tohex()}return this.hV=n,this.hV}},ye(g.asn1.DERSequence,g.asn1.DERAbstractStructured),g.asn1.DERSet=function(t){g.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var n=new Array,a=0;a<this.asn1Array.length;a++){var c=this.asn1Array[a];n.push(c.tohex())}return this.sortFlag==!0&&n.sort(),this.hV=n.join(""),this.hV},typeof t<"u"&&typeof t.sortflag<"u"&&t.sortflag==!1&&(this.sortFlag=!1)},ye(g.asn1.DERSet,g.asn1.DERAbstractStructured),g.asn1.DERTaggedObject=function(t){g.asn1.DERTaggedObject.superclass.constructor.call(this);var n=g.asn1,a=Ee,c=a.getV;a.isASN1HEX;var p=n.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(u,x,S){this.params={tag:x,explicit:u,obj:S}},this.getFreshValueHex=function(){var u=this.params;if(u.explicit==null&&(u.explicit=!0),u.tage!=null&&(u.tag=u.tage,u.explicit=!0),u.tagi!=null&&(u.tag=u.tagi,u.explicit=!1),u.str!=null)this.hV=Jr(u.str);else if(u.hex!=null)this.hV=u.hex;else if(u.obj!=null){var x;u.obj instanceof n.ASN1Object?x=u.obj.tohex():typeof u.obj=="object"&&(x=p(u.obj).tohex()),u.explicit?this.hV=x:this.hV=c(x,0)}else throw new Error("str, hex nor obj not specified");return u.tag==null&&(u.tag="a0"),this.hT=u.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(u){this.params=u},t!==void 0&&this.setByParam(t)},ye(g.asn1.DERTaggedObject,g.asn1.ASN1Object);var Ee=new function(){};Ee.getLblen=function(t,n){if(t.substr(n+2,1)!="8")return 1;var a=parseInt(t.substr(n+3,1));return a==0?-1:0<a&&a<10?a+1:-2},Ee.getL=function(t,n){var a=Ee.getLblen(t,n);return a<1?"":t.substr(n+2,a*2)},Ee.getVblen=function(t,n){var a,c;return a=Ee.getL(t,n),a==""?-1:(a.substr(0,1)==="8"?c=new E(a.substr(2),16):c=new E(a,16),c.intValue())},Ee.getVidx=function(t,n){var a=Ee.getLblen(t,n);return a<0?a:n+(a+1)*2},Ee.getV=function(t,n){var a=Ee.getVidx(t,n),c=Ee.getVblen(t,n);return t.substr(a,c*2)},Ee.getTLV=function(t,n){return t.substr(n,2)+Ee.getL(t,n)+Ee.getV(t,n)},Ee.getTLVblen=function(t,n){return 2+Ee.getLblen(t,n)*2+Ee.getVblen(t,n)*2},Ee.getNextSiblingIdx=function(t,n){var a=Ee.getVidx(t,n),c=Ee.getVblen(t,n);return a+c*2},Ee.getChildIdx=function(t,n){var a=Ee,c=[],p,u,x;p=a.getVidx(t,n),u=a.getVblen(t,n)*2,t.substr(n,2)=="03"&&(p+=2,u-=2),x=0;for(var S=p;x<=u;){var O=a.getTLVblen(t,S);if(x+=O,x<=u&&c.push(S),S+=O,x>=u)break}return c},Ee.getNthChildIdx=function(t,n,a){var c=Ee.getChildIdx(t,n);return c[a]},Ee.getIdxbyList=function(t,n,a,c){var p=Ee,u,x;return a.length==0?c!==void 0&&t.substr(n,2)!==c?-1:n:(u=a.shift(),x=p.getChildIdx(t,n),u>=x.length?-1:p.getIdxbyList(t,x[u],a,c))},Ee.getIdxbyListEx=function(t,n,a,c){var p=Ee,u,x;if(a.length==0)return c!==void 0&&t.substr(n,2)!==c?-1:n;u=a.shift(),x=p.getChildIdx(t,n);for(var S=0,O=0;O<x.length;O++){var T=t.substr(x[O],2);if(typeof u=="number"&&!p.isContextTag(T)&&S==u||typeof u=="string"&&p.isContextTag(T,u))return p.getIdxbyListEx(t,x[O],a,c);p.isContextTag(T)||S++}return-1},Ee.getTLVbyList=function(t,n,a,c){var p=Ee,u=p.getIdxbyList(t,n,a,c);return u==-1||u>=t.length?null:p.getTLV(t,u)},Ee.getTLVbyListEx=function(t,n,a,c){var p=Ee,u=p.getIdxbyListEx(t,n,a,c);return u==-1?null:p.getTLV(t,u)},Ee.getVbyList=function(t,n,a,c,p){var u=Ee,x,S;return x=u.getIdxbyList(t,n,a,c),x==-1||x>=t.length?null:(S=u.getV(t,x),p===!0&&(S=S.substr(2)),S)},Ee.getVbyListEx=function(t,n,a,c,p){var u=Ee,x,S;return x=u.getIdxbyListEx(t,n,a,c),x==-1?null:(S=u.getV(t,x),t.substr(x,2)=="03"&&p!==!1&&(S=S.substr(2)),S)},Ee.getInt=function(t,n,a){a==null&&(a=-1);try{var c=t.substr(n,2);if(c!="02"&&c!="03")return a;var p=Ee.getV(t,n);return c=="02"?parseInt(p,16):ua(p)}catch{return a}},Ee.getOID=function(t,n,a){a==null&&(a=null);try{if(t.substr(n,2)!="06")return a;var c=Ee.getV(t,n);return tn(c)}catch{return a}},Ee.getOIDName=function(t,n,a){a==null&&(a=null);try{var c=Ee.getOID(t,n,a);if(c==a)return a;var p=g.asn1.x509.OID.oid2name(c);return p==""?c:p}catch{return a}},Ee.getString=function(t,n,a){a==null&&(a=null);try{var c=Ee.getV(t,n);return Vt(c)}catch{return a}},Ee.hextooidstr=function(t){var n=function(N,_){return N.length>=_?N:new Array(_-N.length+1).join("0")+N},a=[],c=t.substr(0,2),p=parseInt(c,16);a[0]=new String(Math.floor(p/40)),a[1]=new String(p%40);for(var u=t.substr(2),x=[],S=0;S<u.length/2;S++)x.push(parseInt(u.substr(S*2,2),16));for(var O=[],T="",S=0;S<x.length;S++)x[S]&128?T=T+n((x[S]&127).toString(2),7):(T=T+n((x[S]&127).toString(2),7),O.push(new String(parseInt(T,2))),T="");var B=a.join(".");return O.length>0&&(B=B+"."+O.join(".")),B},Ee.dump=function(t,n,a,c){var p=Ee,u=p.getV,x=p.dump,S=p.getChildIdx,O=t;t instanceof g.asn1.ASN1Object&&(O=t.tohex());var T=function(G,Q){if(G.length<=Q*2)return G;var W=G.substr(0,Q)+"..(total "+G.length/2+"bytes).."+G.substr(G.length-Q,Q);return W};n===void 0&&(n={ommit_long_octet:32}),a===void 0&&(a=0),c===void 0&&(c="");var B=n.ommit_long_octet,ce=O.substr(a,2);if(ce=="01"){var N=u(O,a);return N=="00"?c+`BOOLEAN FALSE
`:c+`BOOLEAN TRUE
`}if(ce=="02"){var N=u(O,a);return c+"INTEGER "+T(N,B)+`
`}if(ce=="03"){var N=u(O,a);if(p.isASN1HEX(N.substr(2))){var _=c+`BITSTRING, encapsulates
`;return _=_+x(N.substr(2),n,0,c+"  "),_}else return c+"BITSTRING "+T(N,B)+`
`}if(ce=="04"){var N=u(O,a);if(p.isASN1HEX(N)){var _=c+`OCTETSTRING, encapsulates
`;return _=_+x(N,n,0,c+"  "),_}else return c+"OCTETSTRING "+T(N,B)+`
`}if(ce=="05")return c+`NULL
`;if(ce=="06"){var I=u(O,a),P=g.asn1.ASN1Util.oidHexToInt(I),A=g.asn1.x509.OID.oid2name(P),L=P.replace(/\./g," ");return A!=""?c+"ObjectIdentifier "+A+" ("+L+`)
`:c+"ObjectIdentifier ("+L+`)
`}if(ce=="0a")return c+"ENUMERATED "+parseInt(u(O,a))+`
`;if(ce=="0c")return c+"UTF8String '"+Qe(u(O,a))+`'
`;if(ce=="13")return c+"PrintableString '"+Qe(u(O,a))+`'
`;if(ce=="14")return c+"TeletexString '"+Qe(u(O,a))+`'
`;if(ce=="16")return c+"IA5String '"+Qe(u(O,a))+`'
`;if(ce=="17")return c+"UTCTime "+Qe(u(O,a))+`
`;if(ce=="18")return c+"GeneralizedTime "+Qe(u(O,a))+`
`;if(ce=="1a")return c+"VisualString '"+Qe(u(O,a))+`'
`;if(ce=="1e")return c+"BMPString '"+is(u(O,a))+`'
`;if(ce=="30"){if(O.substr(a,4)=="3000")return c+`SEQUENCE {}
`;var _=c+`SEQUENCE
`,K=S(O,a),ie=n;if((K.length==2||K.length==3)&&O.substr(K[0],2)=="06"&&O.substr(K[K.length-1],2)=="04"){var A=p.oidname(u(O,K[0])),ae=JSON.parse(JSON.stringify(n));ae.x509ExtName=A,ie=ae}for(var se=0;se<K.length;se++)_=_+x(O,ie,K[se],c+"  ");return _}if(ce=="31"){for(var _=c+`SET
`,K=S(O,a),se=0;se<K.length;se++)_=_+x(O,n,K[se],c+"  ");return _}var ce=parseInt(ce,16);if(ce&128){var z=ce&31;if(ce&32){for(var _=c+"["+z+`]
`,K=S(O,a),se=0;se<K.length;se++)_=_+x(O,n,K[se],c+"  ");return _}else{var N=u(O,a);if(Ee.isASN1HEX(N)){var _=c+"["+z+`]
`;return _=_+x(N,n,0,c+"  "),_}else(N.substr(0,8)=="68747470"||n.x509ExtName==="subjectAltName"&&z==2)&&(N=Qe(N));var _=c+"["+z+"] "+N+`
`;return _}}return c+"UNKNOWN("+ce+") "+u(O,a)+`
`},Ee.parse=function(t){var n=Ee,a=n.parse,c=n.isASN1HEX,p=n.getV,u=n.getTLV,x=n.getChildIdx,S=g.asn1,O=S.ASN1Util.oidHexToInt,T=S.x509.OID.oid2name,B=Qe,N=is,_=Od,I={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},P=function(W){for(var te=[],oe=x(W,0),de=0;de<oe.length;de++){var _e=oe[de],le=u(W,_e),pe=a(le);te.push(pe)}return te},A=t.substr(0,2),L={},K=p(t,0);if(A=="01")return t=="0101ff"?{bool:!0}:{bool:!1};if(A=="02")return{int:{hex:K}};if(A=="03")try{if(K.substr(0,2)!="00")throw"not encap";var ie=K.substr(2);if(!c(ie))throw"not encap";return{bitstr:{obj:a(ie)}}}catch{var ae=null;return K.length<=10&&(ae=pa(K)),ae==null?{bitstr:{hex:K}}:{bitstr:{bin:ae}}}else if(A=="04")try{if(!c(K))throw"not encap";return{octstr:{obj:a(K)}}}catch{return{octstr:{hex:K}}}else{if(A=="05")return{null:""};if(A=="06"){var se=O(K),ce=T(se);return ce==""?{oid:se}:{oid:ce}}else{if(A=="0a")return K.length>4?{enum:{hex:K}}:{enum:parseInt(K,16)};if(A=="30"||A=="31")return L[I[A]]=P(t),L;if(A=="14"){var z=_(K);return L[I[A]]={str:z},L}else if(A=="1e"){var z=N(K);return L[I[A]]={str:z},L}else if(":0c:12:13:16:17:18:1a:".indexOf(A)!=-1){var z=B(K);return L[I[A]]={str:z},L}else if(A.match(/^8[0-9]$/)){var z=B(K);return z==null|z==""?{tag:{tag:A,explicit:!1,hex:K}}:z.match(/[\x00-\x1F\x7F-\x9F]/)!=null||z.match(/[\u0000-\u001F\u0080–\u009F]/)!=null?{tag:{tag:A,explicit:!1,hex:K}}:{tag:{tag:A,explicit:!1,str:z}}}else if(A.match(/^a[0-9]$/))try{if(!c(K))throw new Error("not encap");return{tag:{tag:A,explicit:!0,obj:a(K)}}}catch{return{tag:{tag:A,explicit:!0,hex:K}}}else{var G=new g.asn1.ASN1Object;G.hV=K;var Q=G.getLengthHexFromValue();return{asn1:{tlv:A+Q+K}}}}}},Ee.isContextTag=function(t,n){t=t.toLowerCase();var a,c;try{a=parseInt(t,16)}catch{return-1}if(n===void 0)return(a&192)==128;try{var p=n.match(/^\[[0-9]+\]$/);return p==null||(c=parseInt(n.substr(1,n.length-1),10),c>31)?!1:(a&192)==128&&(a&31)==c}catch{return!1}},Ee.isASN1HEX=function(t){var n=Ee;if(t.length%2==1)return!1;var a=n.getVblen(t,0),c=t.substr(0,2),p=n.getL(t,0),u=t.length-c.length-p.length;return u==a*2},Ee.checkStrictDER=function(t,n,a,c,p){var u=Ee;if(a===void 0){if(typeof t!="string")throw new Error("not hex string");if(t=t.toLowerCase(),!g.lang.String.isHex(t))throw new Error("not hex string");a=t.length,c=t.length/2,c<128?p=1:p=Math.ceil(c.toString(16))+1}var x=u.getL(t,n);if(x.length>p*2)throw new Error("L of TLV too long: idx="+n);var S=u.getVblen(t,n);if(S>c)throw new Error("value of L too long than hex: idx="+n);var O=u.getTLV(t,n),T=O.length-2-u.getL(t,n).length;if(T!==S*2)throw new Error("V string length and L's value not the same:"+T+"/"+S*2);if(n===0&&t.length!=O.length)throw new Error("total length and TLV length unmatch:"+t.length+"!="+O.length);var B=t.substr(n,2);if(B==="02"){var N=u.getVidx(t,n);if(t.substr(N,2)=="00"&&t.charCodeAt(N+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(B,16)&32){for(var _=u.getVblen(t,n),I=0,P=u.getChildIdx(t,n),A=0;A<P.length;A++){var L=u.getTLV(t,P[A]);I+=L.length,u.checkStrictDER(t,P[A],a,c,p)}if(_*2!=I)throw new Error("sum of children's TLV length and L unmatch: "+_*2+"!="+I)}},Ee.oidname=function(t){var n=g.asn1;g.lang.String.isHex(t)&&(t=n.ASN1Util.oidHexToInt(t));var a=n.x509.OID.oid2name(t);return a===""&&(a=t),a},(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),(typeof g.asn1.x509>"u"||!g.asn1.x509)&&(g.asn1.x509={}),g.asn1.x509.Certificate=function(t){g.asn1.x509.Certificate.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERBitString,p=a.DERSequence,u=a.x509,x=u.TBSCertificate,S=u.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(O){this.params=O},this.sign=function(){var O=this.params,T=O.sigalg;O.sigalg.name!=null&&(T=O.sigalg.name);var B=O.tbsobj.tohex(),N=new g.crypto.Signature({alg:T});N.init(O.cakey),N.updateHex(B),O.sighex=N.sign()},this.getPEM=function(){return Tt(this.tohex(),"CERTIFICATE")},this.tohex=function(){var O=this.params;if((O.tbsobj==null||O.tbsobj==null)&&(O.tbsobj=new x(O)),O.sighex==null&&O.cakey!=null&&this.sign(),O.sighex==null)throw new Error("sighex or cakey parameter not defined");var T=[];T.push(O.tbsobj),T.push(new S({name:O.sigalg})),T.push(new c({hex:"00"+O.sighex}));var B=new p({array:T});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&(this.params=t)},ye(g.asn1.x509.Certificate,g.asn1.ASN1Object),g.asn1.x509.TBSCertificate=function(t){g.asn1.x509.TBSCertificate.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.x509,p=a.DERTaggedObject,u=a.DERInteger,x=a.DERSequence,S=c.AlgorithmIdentifier,O=c.Time,T=c.X500Name,B=c.Extensions,N=c.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(_){this.params=_},this.tohex=function(){var _=[],I=this.params;if(I.version!=null||I.version!=1){var P=2;I.version!=null&&(P=I.version-1);var A=new p({obj:new u({int:P})});_.push(A)}_.push(new u(I.serial)),_.push(new S({name:I.sigalg})),_.push(new T(I.issuer)),_.push(new x({array:[new O(I.notbefore),new O(I.notafter)]})),_.push(new T(I.subject)),_.push(new N(qe.getKey(I.sbjpubkey))),I.ext!==void 0&&I.ext.length>0&&_.push(new p({tag:"a3",obj:new B(I.ext)}));var L=new g.asn1.DERSequence({array:_});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.TBSCertificate,g.asn1.ASN1Object),g.asn1.x509.Extensions=function(t){g.asn1.x509.Extensions.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERSequence,p=a.x509;this.aParam=[],this.setByParam=function(u){this.aParam=u},this.tohex=function(){for(var u=[],x=0;x<this.aParam.length;x++){var S=this.aParam[x],O=S.extname,T=null;if(S.extn!=null)T=new p.PrivateExtension(S);else if(O=="subjectKeyIdentifier")T=new p.SubjectKeyIdentifier(S);else if(O=="keyUsage")T=new p.KeyUsage(S);else if(O=="subjectAltName")T=new p.SubjectAltName(S);else if(O=="issuerAltName")T=new p.IssuerAltName(S);else if(O=="basicConstraints")T=new p.BasicConstraints(S);else if(O=="nameConstraints")T=new p.NameConstraints(S);else if(O=="cRLDistributionPoints")T=new p.CRLDistributionPoints(S);else if(O=="certificatePolicies")T=new p.CertificatePolicies(S);else if(O=="policyMappings")T=new p.PolicyMappings(S);else if(O=="policyConstraints")T=new p.PolicyConstraints(S);else if(O=="inhibitAnyPolicy")T=new p.InhibitAnyPolicy(S);else if(O=="authorityKeyIdentifier")T=new p.AuthorityKeyIdentifier(S);else if(O=="extKeyUsage")T=new p.ExtKeyUsage(S);else if(O=="authorityInfoAccess")T=new p.AuthorityInfoAccess(S);else if(O=="cRLNumber")T=new p.CRLNumber(S);else if(O=="cRLReason")T=new p.CRLReason(S);else if(O=="ocspNonce")T=new p.OCSPNonce(S);else if(O=="ocspNoCheck")T=new p.OCSPNoCheck(S);else if(O=="adobeTimeStamp")T=new p.AdobeTimeStamp(S);else if(O=="subjectDirectoryAttributes")T=new p.SubjectDirectoryAttributes(S);else throw new Error("extension not supported:"+JSON.stringify(S));T!=null&&u.push(T)}var B=new c({array:u});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.x509.Extensions,g.asn1.ASN1Object),g.asn1.x509.Extension=function(t){g.asn1.x509.Extension.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERObjectIdentifier,p=a.DEROctetString;a.DERBitString;var u=a.DERBoolean,x=a.DERSequence;this.tohex=function(){var S=new c({oid:this.oid}),O=new p({hex:this.getExtnValueHex()}),T=new Array;T.push(S),this.critical&&T.push(new u),T.push(O);var B=new x({array:T});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,t!==void 0&&t.critical!==void 0&&(this.critical=t.critical)},ye(g.asn1.x509.Extension,g.asn1.ASN1Object),g.asn1.x509.KeyUsage=function(t){g.asn1.x509.KeyUsage.superclass.constructor.call(this,t);var n=Error,a={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var c=this.getBinValue();return this.asn1ExtnValue=new g.asn1.DERBitString({bin:c}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var c=this.params;if(typeof c!="object"||typeof c.names!="object"&&typeof c.bin!="string")throw new n("parameter not yet set");if(c.names!=null)return nn(c.names,a);if(c.bin!=null)return c.bin;throw new n("parameter not set properly")},this.oid="2.5.29.15",t!==void 0&&(this.params=t)},ye(g.asn1.x509.KeyUsage,g.asn1.x509.Extension),g.asn1.x509.BasicConstraints=function(t){g.asn1.x509.BasicConstraints.superclass.constructor.call(this,t);var n=g.asn1,a=n.DERBoolean,c=n.DERInteger,p=n.DERSequence;this.getExtnValueHex=function(){var u=new Array;this.cA&&u.push(new a),this.pathLen>-1&&u.push(new c({int:this.pathLen}));var x=new p({array:u});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,t!==void 0&&(t.cA!==void 0&&(this.cA=t.cA),t.pathLen!==void 0&&(this.pathLen=t.pathLen))},ye(g.asn1.x509.BasicConstraints,g.asn1.x509.Extension),g.asn1.x509.CRLDistributionPoints=function(t){g.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(p){for(var u=[],x=0;x<p.length;x++)if(p[x]instanceof g.asn1.ASN1Object)u.push(p[x]);else{var S=new c.DistributionPoint(p[x]);u.push(S)}this.asn1ExtnValue=new a.DERSequence({array:u})},this.setByOneURI=function(p){var u=new c.DistributionPoint({fulluri:p});this.setByDPArray([u])},this.oid="2.5.29.31",t!==void 0&&(t.array!==void 0?this.setByDPArray(t.array):t.uri!==void 0&&this.setByOneURI(t.uri))},ye(g.asn1.x509.CRLDistributionPoints,g.asn1.x509.Extension),g.asn1.x509.DistributionPoint=function(t){g.asn1.x509.DistributionPoint.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.x509.DistributionPointName;this.tohex=function(){var p=new a.DERSequence;if(this.asn1DP!=null){var u=new a.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});p.appendASN1Object(u)}return this.hTLV=p.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(t.dpobj!==void 0?this.asn1DP=t.dpobj:t.dpname!==void 0?this.asn1DP=new c(t.dpname):t.fulluri!==void 0&&(this.asn1DP=new c({full:[{uri:t.fulluri}]})))},ye(g.asn1.x509.DistributionPoint,g.asn1.ASN1Object),g.asn1.x509.DistributionPointName=function(t){g.asn1.x509.DistributionPointName.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new c({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0)if(a.x509.GeneralNames.prototype.isPrototypeOf(t))this.type="full",this.tag="a0",this.asn1V=t;else if(t.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new a.x509.GeneralNames(t.full);else throw new Error("This class supports GeneralNames only as argument")},ye(g.asn1.x509.DistributionPointName,g.asn1.ASN1Object),g.asn1.x509.CertificatePolicies=function(t){g.asn1.x509.CertificatePolicies.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.x509,p=a.DERSequence,u=c.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var x=[],S=0;S<this.params.array.length;S++)x.push(new u(this.params.array[S]));var O=new p({array:x});return this.asn1ExtnValue=O,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",t!==void 0&&(this.params=t)},ye(g.asn1.x509.CertificatePolicies,g.asn1.x509.Extension),g.asn1.x509.PolicyInformation=function(t){g.asn1.x509.PolicyInformation.superclass.constructor.call(this,t);var n=g.asn1,a=n.DERSequence,c=n.DERObjectIdentifier,p=n.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var u=[new c(this.params.policyoid)];if(this.params.array!==void 0){for(var x=[],S=0;S<this.params.array.length;S++)x.push(new p(this.params.array[S]));x.length>0&&u.push(new a({array:x}))}var O=new a({array:u});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(this.params=t)},ye(g.asn1.x509.PolicyInformation,g.asn1.ASN1Object),g.asn1.x509.PolicyQualifierInfo=function(t){g.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,t);var n=g.asn1,a=n.DERSequence,c=n.DERIA5String,p=n.DERObjectIdentifier,u=n.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var x=new a({array:[new p({oid:"1.3.6.1.5.5.7.2.1"}),new c({str:this.params.cps})]});return x.tohex()}if(this.params.unotice!=null){var x=new a({array:[new p({oid:"1.3.6.1.5.5.7.2.2"}),new u(this.params.unotice)]});return x.tohex()}},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(this.params=t)},ye(g.asn1.x509.PolicyQualifierInfo,g.asn1.ASN1Object),g.asn1.x509.UserNotice=function(t){g.asn1.x509.UserNotice.superclass.constructor.call(this,t);var n=g.asn1.DERSequence;g.asn1.DERInteger;var a=g.asn1.x509.DisplayText,c=g.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var p=[];this.params.noticeref!==void 0&&p.push(new c(this.params.noticeref)),this.params.exptext!==void 0&&p.push(new a(this.params.exptext));var u=new n({array:p});return u.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(this.params=t)},ye(g.asn1.x509.UserNotice,g.asn1.ASN1Object),g.asn1.x509.NoticeReference=function(t){g.asn1.x509.NoticeReference.superclass.constructor.call(this,t);var n=g.asn1.DERSequence,a=g.asn1.DERInteger,c=g.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var p=[];if(this.params.org!==void 0&&p.push(new c(this.params.org)),this.params.noticenum!==void 0){for(var u=[],x=this.params.noticenum,S=0;S<x.length;S++)u.push(new a(x[S]));p.push(new n({array:u}))}if(p.length==0)throw new Error("parameter is empty");var O=new n({array:p});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(this.params=t)},ye(g.asn1.x509.NoticeReference,g.asn1.ASN1Object),g.asn1.x509.DisplayText=function(t){g.asn1.x509.DisplayText.superclass.constructor.call(this,t),this.hT="0c",t!==void 0&&(t.type==="ia5"?this.hT="16":t.type==="vis"?this.hT="1a":t.type==="bmp"&&(this.hT="1e"))},ye(g.asn1.x509.DisplayText,g.asn1.DERAbstractString),g.asn1.x509.PolicyMappings=function(t){g.asn1.x509.PolicyMappings.superclass.constructor.call(this,t);var n=g,a=n.asn1;a.x509;var c=a.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var p=this.params,u=[],x=0;x<p.array.length;x++){var S=p.array[x];u.push({seq:[{oid:S[0]},{oid:S[1]}]})}return this.asn1ExtnValue=c({seq:u}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",t!==void 0&&(this.params=t)},ye(g.asn1.x509.PolicyMappings,g.asn1.x509.Extension),g.asn1.x509.PolicyConstraints=function(t){g.asn1.x509.PolicyConstraints.superclass.constructor.call(this,t);var n=g,a=n.asn1;a.x509;var c=a.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var p=this.params,u=[];return p.reqexp!=null&&u.push({tag:{tagi:"80",obj:{int:p.reqexp}}}),p.inhibit!=null&&u.push({tag:{tagi:"81",obj:{int:p.inhibit}}}),this.asn1ExtnValue=c({seq:u}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",t!==void 0&&(this.params=t)},ye(g.asn1.x509.PolicyConstraints,g.asn1.x509.Extension),g.asn1.x509.InhibitAnyPolicy=function(t){g.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,t);var n=g,a=n.asn1;a.x509;var c=a.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=c({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",t!==void 0&&(this.params=t)},ye(g.asn1.x509.InhibitAnyPolicy,g.asn1.x509.Extension),g.asn1.x509.NameConstraints=function(t){g.asn1.x509.NameConstraints.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.x509,p=a.ASN1Util.newObject,u=c.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var x=this.params,S=[];if(x.permit!=null&&x.permit.length!=null){for(var O=[],T=0;T<x.permit.length;T++)O.push(new u(x.permit[T]));S.push({tag:{tagi:"a0",obj:{seq:O}}})}if(x.exclude!=null&&x.exclude.length!=null){for(var B=[],T=0;T<x.exclude.length;T++)B.push(new u(x.exclude[T]));S.push({tag:{tagi:"a1",obj:{seq:B}}})}return this.asn1ExtnValue=p({seq:S}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",t!==void 0&&(this.params=t)},ye(g.asn1.x509.NameConstraints,g.asn1.x509.Extension),g.asn1.x509.GeneralSubtree=function(t){g.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var n=g.asn1,a=n.x509,c=a.GeneralName,p=n.ASN1Util.newObject;this.params=null,this.setByParam=function(u){this.params=u},this.tohex=function(){var u=this.params,x=[new c(u)];u.min!=null&&x.push({tag:{tagi:"80",obj:{int:u.min}}}),u.max!=null&&x.push({tag:{tagi:"81",obj:{int:u.max}}});var S=p({seq:x});return S.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.GeneralSubtree,g.asn1.ASN1Object),g.asn1.x509.ExtKeyUsage=function(t){g.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,t);var n=g,a=n.asn1;this.setPurposeArray=function(c){this.asn1ExtnValue=new a.DERSequence;for(var p=0;p<c.length;p++){var u=new a.DERObjectIdentifier(c[p]);this.asn1ExtnValue.appendASN1Object(u)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",t!==void 0&&t.array!==void 0&&this.setPurposeArray(t.array)},ye(g.asn1.x509.ExtKeyUsage,g.asn1.x509.Extension),g.asn1.x509.AuthorityKeyIdentifier=function(t){g.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.DERTaggedObject,p=a.x509.GeneralNames;n.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var u=new Array;this.asn1KID&&u.push(new c({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&u.push(new c({explicit:!1,tag:"a1",obj:new p([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&u.push(new c({explicit:!1,tag:"82",obj:this.asn1CertSN}));var x=new a.DERSequence({array:u});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(u){if(u.str!==void 0||u.hex!==void 0)this.asn1KID=new g.asn1.DEROctetString(u);else if(typeof u=="object"&&g.crypto.Util.isKey(u)||typeof u=="string"&&u.indexOf("BEGIN ")!=-1){var x=u;typeof u=="string"&&(x=qe.getKey(u));var S=qe.getKeyID(x);this.asn1KID=new g.asn1.DEROctetString({hex:S})}},this.setCertIssuerByParam=function(u){u.str!==void 0||u.ldapstr!==void 0||u.hex!==void 0||u.certsubject!==void 0||u.certissuer!==void 0?this.asn1CertIssuer=new g.asn1.x509.X500Name(u):typeof u=="string"&&u.indexOf("BEGIN ")!=-1&&u.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new g.asn1.x509.X500Name({certissuer:u}))},this.setCertSNByParam=function(u){if(u.str!==void 0||u.bigint!==void 0||u.hex!==void 0)this.asn1CertSN=new g.asn1.DERInteger(u);else if(typeof u=="string"&&u.indexOf("BEGIN ")!=-1&&u.indexOf("CERTIFICATE")){var x=new Oe;x.readCertPEM(u);var S=x.getSerialNumberHex();this.asn1CertSN=new g.asn1.DERInteger({hex:S})}},this.oid="2.5.29.35",t!==void 0&&(t.kid!==void 0&&this.setKIDByParam(t.kid),t.issuer!==void 0&&this.setCertIssuerByParam(t.issuer),t.sn!==void 0&&this.setCertSNByParam(t.sn),t.issuersn!==void 0&&typeof t.issuersn=="string"&&t.issuersn.indexOf("BEGIN ")!=-1&&t.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(t.issuersn),this.setCertIssuerByParam(t.issuersn)))},ye(g.asn1.x509.AuthorityKeyIdentifier,g.asn1.x509.Extension),g.asn1.x509.SubjectKeyIdentifier=function(t){g.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(p){if(p.str!==void 0||p.hex!==void 0)this.asn1KID=new c(p);else if(typeof p=="object"&&g.crypto.Util.isKey(p)||typeof p=="string"&&p.indexOf("BEGIN")!=-1){var u=p;typeof p=="string"&&(u=qe.getKey(p));var x=qe.getKeyID(u);this.asn1KID=new g.asn1.DEROctetString({hex:x})}},this.oid="2.5.29.14",t!==void 0&&t.kid!==void 0&&this.setKIDByParam(t.kid)},ye(g.asn1.x509.SubjectKeyIdentifier,g.asn1.x509.Extension),g.asn1.x509.AuthorityInfoAccess=function(t){g.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,t),this.setAccessDescriptionArray=function(n){for(var a=new Array,c=g,p=c.asn1,u=p.DERSequence,x=p.DERObjectIdentifier,S=p.x509.GeneralName,O=0;O<n.length;O++){var T,B=n[O];if(B.ocsp!==void 0)T=new u({array:[new x({oid:"1.3.6.1.5.5.7.48.1"}),new S({uri:B.ocsp})]});else if(B.caissuer!==void 0)T=new u({array:[new x({oid:"1.3.6.1.5.5.7.48.2"}),new S({uri:B.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(B));a.push(T)}this.asn1ExtnValue=new u({array:a})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",t!==void 0&&t.array!==void 0&&this.setAccessDescriptionArray(t.array)},ye(g.asn1.x509.AuthorityInfoAccess,g.asn1.x509.Extension),g.asn1.x509.SubjectAltName=function(t){g.asn1.x509.SubjectAltName.superclass.constructor.call(this,t),this.setNameArray=function(n){this.asn1ExtnValue=new g.asn1.x509.GeneralNames(n)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",t!==void 0&&t.array!==void 0&&this.setNameArray(t.array)},ye(g.asn1.x509.SubjectAltName,g.asn1.x509.Extension),g.asn1.x509.IssuerAltName=function(t){g.asn1.x509.IssuerAltName.superclass.constructor.call(this,t),this.setNameArray=function(n){this.asn1ExtnValue=new g.asn1.x509.GeneralNames(n)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",t!==void 0&&t.array!==void 0&&this.setNameArray(t.array)},ye(g.asn1.x509.IssuerAltName,g.asn1.x509.Extension),g.asn1.x509.SubjectDirectoryAttributes=function(t){g.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,t);var n=g.asn1,a=n.DERSequence,c=n.ASN1Util.newObject,p=n.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var u=[],x=0;x<this.params.array.length;x++){var S=this.params.array[x];if(S.attr!=null&&S.array!=null){var O={seq:[{oid:S.attr},{set:S.array}]};u.push(c(O));continue}var T={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(S.attr=="dateOfBirth")T.seq[0].oid=p(S.attr),T.seq[1].set[0]={gentime:S.str};else if(S.attr=="placeOfBirth")T.seq[0].oid=p(S.attr),T.seq[1].set[0]={utf8str:S.str};else if(S.attr=="gender")T.seq[0].oid=p(S.attr),T.seq[1].set[0]={prnstr:S.str};else if(S.attr=="countryOfCitizenship")T.seq[0].oid=p(S.attr),T.seq[1].set[0]={prnstr:S.str};else if(S.attr=="countryOfResidence")T.seq[0].oid=p(S.attr),T.seq[1].set[0]={prnstr:S.str};else throw new Error("unsupported attribute: "+S.attr);u.push(new c(T))}var B=new a({array:u});return this.asn1ExtnValue=B,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",t!==void 0&&(this.params=t)},ye(g.asn1.x509.SubjectDirectoryAttributes,g.asn1.x509.Extension),g.asn1.x509.PrivateExtension=function(t){g.asn1.x509.PrivateExtension.superclass.constructor.call(this,t);var n=g,a=n.lang.String.isHex,c=n.asn1,p=c.x509.OID.name2oid,u=c.ASN1Util.newObject;this.params=null,this.setByParam=function(x){this.oid=p(x.extname),this.params=x},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var x=this.params.extn;if(typeof x=="string"&&a(x))return x;if(typeof x=="object")try{return u(x).tohex()}catch{}throw new Error("unsupported extn value")},t!=null&&this.setByParam(t)},ye(g.asn1.x509.PrivateExtension,g.asn1.x509.Extension),g.asn1.x509.CRL=function(t){g.asn1.x509.CRL.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERSequence,p=a.DERBitString,u=a.x509,x=u.AlgorithmIdentifier,S=u.TBSCertList;this.params=void 0,this.setByParam=function(O){this.params=O},this.sign=function(){var O=new S(this.params).tohex(),T=new g.crypto.Signature({alg:this.params.sigalg});T.init(this.params.cakey),T.updateHex(O);var B=T.sign();this.params.sighex=B},this.getPEM=function(){return Tt(this.tohex(),"X509 CRL")},this.tohex=function(){var O=this.params;if(O.tbsobj==null&&(O.tbsobj=new S(O)),O.sighex==null&&O.cakey!=null&&this.sign(),O.sighex==null)throw new Error("sighex or cakey parameter not defined");var T=[];T.push(O.tbsobj),T.push(new x({name:O.sigalg})),T.push(new p({hex:"00"+O.sighex}));var B=new c({array:T});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&(this.params=t)},ye(g.asn1.x509.CRL,g.asn1.ASN1Object),g.asn1.x509.TBSCertList=function(t){g.asn1.x509.TBSCertList.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERInteger,p=a.DERSequence,u=a.DERTaggedObject;a.DERObjectIdentifier;var x=a.x509,S=x.AlgorithmIdentifier,O=x.Time,T=x.Extensions,B=x.X500Name;this.params=null,this.setByParam=function(N){this.params=N},this.getRevCertSequence=function(){for(var N=[],_=this.params.revcert,I=0;I<_.length;I++){var P=[new c(_[I].sn),new O(_[I].date)];_[I].ext!=null&&P.push(new T(_[I].ext)),N.push(new p({array:P}))}return new p({array:N})},this.tohex=function(){var N=[],_=this.params;if(_.version!=null){var I=_.version-1,P=new c({int:I});N.push(P)}if(N.push(new S({name:_.sigalg})),N.push(new B(_.issuer)),N.push(new O(_.thisupdate)),_.nextupdate!=null&&N.push(new O(_.nextupdate)),_.revcert!=null&&N.push(this.getRevCertSequence()),_.ext!=null){var A=new T(_.ext);N.push(new u({tag:"a0",explicit:!0,obj:A}))}var L=new p({array:N});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.TBSCertList,g.asn1.ASN1Object),g.asn1.x509.CRLEntry=function(t){g.asn1.x509.CRLEntry.superclass.constructor.call(this);var n=g,a=n.asn1;this.setCertSerial=function(c){this.sn=new a.DERInteger(c)},this.setRevocationDate=function(c){this.time=new a.x509.Time(c)},this.tohex=function(){var c=new a.DERSequence({array:[this.sn,this.time]});return this.TLV=c.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(t.time!==void 0&&this.setRevocationDate(t.time),t.sn!==void 0&&this.setCertSerial(t.sn))},ye(g.asn1.x509.CRLEntry,g.asn1.ASN1Object),g.asn1.x509.CRLNumber=function(t){g.asn1.x509.CRLNumber.superclass.constructor.call(this,t),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new g.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",t!=null&&(this.params=t)},ye(g.asn1.x509.CRLNumber,g.asn1.x509.Extension),g.asn1.x509.CRLReason=function(t){g.asn1.x509.CRLReason.superclass.constructor.call(this,t),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new g.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",t!=null&&(this.params=t)},ye(g.asn1.x509.CRLReason,g.asn1.x509.Extension),g.asn1.x509.OCSPNonce=function(t){g.asn1.x509.OCSPNonce.superclass.constructor.call(this,t),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new g.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",t!=null&&(this.params=t)},ye(g.asn1.x509.OCSPNonce,g.asn1.x509.Extension),g.asn1.x509.OCSPNoCheck=function(t){g.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,t),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new g.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",t!=null&&(this.params=t)},ye(g.asn1.x509.OCSPNoCheck,g.asn1.x509.Extension),g.asn1.x509.AdobeTimeStamp=function(t){g.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,t);var n=g,a=n.asn1,c=a.DERInteger,p=a.DERBoolean,u=a.DERSequence,x=a.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var S=this.params,O=[new c(1)];return O.push(new x({uri:S.uri})),S.reqauth!=null&&O.push(new p(S.reqauth)),this.asn1ExtnValue=new u({array:O}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.AdobeTimeStamp,g.asn1.x509.Extension),g.asn1.x509.X500Name=function(t){g.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var n=g,a=n.asn1,c=a.x509,p=c.RDN;this.setByString=function(u,x){x!==void 0&&(this.sRule=x);var S=u.split("/");S.shift();for(var O=[],T=0;T<S.length;T++)if(S[T].match(/^[^=]+=.+$/))O.push(S[T]);else{var B=O.length-1;O[B]=O[B]+"/"+S[T]}for(var T=0;T<O.length;T++)this.asn1Array.push(new p({str:O[T],rule:this.sRule}))},this.setByLdapString=function(u,x){x!==void 0&&(this.sRule=x);var S=c.X500Name.ldapToCompat(u);this.setByString(S,x)},this.setByObject=function(u,x){x!==void 0&&(this.sRule=x);for(var S in u)if(u.hasOwnProperty(S)){var O=new p({str:S+"="+u[S],rule:this.sRule});this.asn1Array?this.asn1Array.push(O):this.asn1Array=[O]}},this.setByParam=function(u){if(u.rule!==void 0&&(this.sRule=u.rule),u.array!==void 0)this.paramArray=u.array;else if(u.str!==void 0)this.setByString(u.str);else if(u.ldapstr!==void 0)this.setByLdapString(u.ldapstr);else if(u.hex!==void 0)this.hTLV=u.hex;else if(u.certissuer!==void 0){var x=new Oe;x.readCertPEM(u.certissuer),this.hTLV=x.getIssuerHex()}else if(u.certsubject!==void 0){var x=new Oe;x.readCertPEM(u.certsubject),this.hTLV=x.getSubjectHex()}else typeof u=="object"&&u.certsubject===void 0&&u.certissuer===void 0&&this.setByObject(u)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var u=0;u<this.paramArray.length;u++){var x={array:this.paramArray[u]};this.sRule!="utf8"&&(x.rule=this.sRule);var S=new p(x);this.asn1Array.push(S)}var O=new a.DERSequence({array:this.asn1Array});return this.hTLV=O.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.X500Name,g.asn1.ASN1Object),g.asn1.x509.X500Name.compatToLDAP=function(t){if(t.substr(0,1)!=="/")throw"malformed input";t=t.substr(1);var n=t.split("/");return n.reverse(),n=n.map(function(a){return a.replace(/,/,"\\,")}),n.join(",")},g.asn1.x509.X500Name.onelineToLDAP=function(t){return g.asn1.x509.X500Name.compatToLDAP(t)},g.asn1.x509.X500Name.ldapToCompat=function(t){for(var n=t.split(","),a=!1,c=[],p=0;n.length>0;p++){var u=n.shift();if(a===!0){var x=c.pop(),S=(x+","+u).replace(/\\,/g,",");c.push(S),a=!1}else c.push(u);u.substr(-1,1)==="\\"&&(a=!0)}return c=c.map(function(O){return O.replace("/","\\/")}),c.reverse(),"/"+c.join("/")},g.asn1.x509.X500Name.ldapToOneline=function(t){return g.asn1.x509.X500Name.ldapToCompat(t)},g.asn1.x509.RDN=function(t){g.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var n=g.asn1.x509.AttributeTypeAndValue;this.setByParam=function(a){a.rule!==void 0&&(this.sRule=a.rule),a.str!==void 0&&this.addByMultiValuedString(a.str),a.array!==void 0&&(this.paramArray=a.array)},this.addByString=function(a){this.asn1Array.push(new g.asn1.x509.AttributeTypeAndValue({str:a,rule:this.sRule}))},this.addByMultiValuedString=function(a){for(var c=g.asn1.x509.RDN.parseString(a),p=0;p<c.length;p++)this.addByString(c[p])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var a=0;a<this.paramArray.length;a++){var c=this.paramArray[a];c.rule!==void 0&&this.sRule!="utf8"&&(c.rule=this.sRule);var p=new n(c);this.asn1Array.push(p)}var u=new g.asn1.DERSet({array:this.asn1Array});return this.TLV=u.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.RDN,g.asn1.ASN1Object),g.asn1.x509.RDN.parseString=function(t){for(var n=t.split(/\+/),a=!1,c=[],p=0;n.length>0;p++){var u=n.shift();if(a===!0){var x=c.pop(),S=(x+"+"+u).replace(/\\\+/g,"+");c.push(S),a=!1}else c.push(u);u.substr(-1,1)==="\\"&&(a=!0)}for(var O=!1,T=[],p=0;c.length>0;p++){var u=c.shift();if(O===!0){var B=T.pop();if(u.match(/"$/)){var S=(B+"+"+u).replace(/^([^=]+)="(.*)"$/,"$1=$2");T.push(S),O=!1}else T.push(B+"+"+u)}else T.push(u);u.match(/^[^=]+="/)&&(O=!0)}return T},g.asn1.x509.AttributeTypeAndValue=function(t){g.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var n=g,a=n.asn1,c=a.DERSequence,p=a.DERUTF8String,u=a.DERPrintableString,x=a.DERTeletexString,S=a.DERIA5String,O=a.DERVisibleString,T=a.DERBMPString,B=n.lang.String.isMail,N=n.lang.String.isPrintable;this.setByParam=function(_){if(_.rule!==void 0&&(this.sRule=_.rule),_.ds!==void 0&&(this.dsType=_.ds),_.value===void 0&&_.str!==void 0){var I=_.str,P=I.match(/^([^=]+)=(.+)$/);if(P)this.sType=P[1],this.sValue=P[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=_.type,this.sValue=_.value},this.setByString=function(_,I){I!==void 0&&(this.sRule=I);var P=_.match(/^([^=]+)=(.+)$/);if(P)this.setByAttrTypeAndValueStr(P[1],P[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var _=this.sType,I=this.sValue,P=this.sRule;return P==="prn"?_=="CN"&&B(I)?"ia5":N(I)?"prn":"utf8":P==="utf8"?_=="CN"&&B(I)?"ia5":_=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(_,I,P){P!==void 0&&(this.sRule=P),this.sType=_,this.sValue=I},this.getValueObj=function(_,I){if(_=="utf8")return new p({str:I});if(_=="prn")return new u({str:I});if(_=="tel")return new x({str:I});if(_=="ia5")return new S({str:I});if(_=="vis")return new O({str:I});if(_=="bmp")return new T({str:I});throw new Error("unsupported directory string type: type="+_+" value="+I)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var _=g.asn1.x509.OID.atype2obj(this.sType),I=this.getValueObj(this.dsType,this.sValue),P=new c({array:[_,I]});return this.TLV=P.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.AttributeTypeAndValue,g.asn1.ASN1Object),g.asn1.x509.SubjectPublicKeyInfo=function(t){g.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERInteger,p=a.DERBitString,u=a.DERObjectIdentifier,x=a.DERSequence,S=a.ASN1Util.newObject,O=a.x509,T=O.AlgorithmIdentifier,B=n.crypto;B.ECDSA,B.DSA,this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var N=new x({array:[this.asn1AlgId,this.asn1SubjPKey]});return N},this.tohex=function(){var N=this.getASN1Object();return this.hTLV=N.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(N){try{if(N instanceof Me){var _=S({seq:[{int:{bigint:N.n}},{int:{int:N.e}}]}),I=_.tohex();this.asn1AlgId=new T({name:"rsaEncryption"}),this.asn1SubjPKey=new p({hex:"00"+I})}}catch{}try{if(N instanceof g.crypto.ECDSA){var P=new u({name:N.curveName});this.asn1AlgId=new T({name:"ecPublicKey",asn1params:P}),this.asn1SubjPKey=new p({hex:"00"+N.pubKeyHex})}}catch{}try{if(N instanceof g.crypto.DSA){var P=new S({seq:[{int:{bigint:N.p}},{int:{bigint:N.q}},{int:{bigint:N.g}}]});this.asn1AlgId=new T({name:"dsa",asn1params:P});var A=new c({bigint:N.y});this.asn1SubjPKey=new p({hex:"00"+A.tohex()})}}catch{}},t!==void 0&&this.setPubKey(t)},ye(g.asn1.x509.SubjectPublicKeyInfo,g.asn1.ASN1Object),g.asn1.x509.Time=function(t){g.asn1.x509.Time.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERUTCTime,p=a.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(u){this.timeParams=u},this.setByParam=function(u){this.params=u},this.getType=function(u){return u.match(/^[0-9]{12}Z$/)?"utc":u.match(/^[0-9]{14}Z$/)?"gen":u.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":u.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var u=this.params,x=null;if(typeof u=="string"&&(u={str:u}),u!=null&&u.str&&(u.type==null||u.type==null)&&(u.type=this.getType(u.str)),u!=null&&u.str?(u.type=="utc"&&(x=new c(u.str)),u.type=="gen"&&(x=new p(u.str))):this.type=="gen"?x=new p:x=new c,x==null)throw new Error("wrong setting for Time");return this.TLV=x.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},g.asn1.x509.Time_bak=function(t){g.asn1.x509.Time_bak.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERUTCTime,p=a.DERGeneralizedTime;this.setTimeParams=function(u){this.timeParams=u},this.tohex=function(){var u=null;return this.timeParams!=null?this.type=="utc"?u=new c(this.timeParams):u=new p(this.timeParams):this.type=="utc"?u=new c:u=new p,this.TLV=u.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",t!==void 0&&(t.type!==void 0?this.type=t.type:t.str!==void 0&&(t.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),t.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=t)},ye(g.asn1.x509.Time,g.asn1.ASN1Object),g.asn1.x509.AlgorithmIdentifier=function(t){g.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var n=g,a=n.asn1,c=a.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var u=null;for(var x in c)x===this.nameAlg&&(u=c[x]);if(u!==null)return this.hTLV=u,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=a.x509.OID.name2obj(this.nameAlg));var S=[this.asn1Alg];this.asn1Params!==null&&S.push(this.asn1Params);var O=new a.DERSequence({array:S});return this.hTLV=O.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&(t.name!==void 0&&(this.nameAlg=t.name),t.asn1params!==void 0&&(this.asn1Params=t.asn1params),t.paramempty!==void 0&&(this.paramEmpty=t.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var p=this.nameAlg.toLowerCase();p.substr(-7,7)!=="withdsa"&&p.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new a.DERNull)}},ye(g.asn1.x509.AlgorithmIdentifier,g.asn1.ASN1Object),g.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},g.asn1.x509.GeneralName=function(t){g.asn1.x509.GeneralName.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.x509,p=c.X500Name,u=c.OtherName,x=a.DERIA5String;a.DERPrintableString;var S=a.DEROctetString,O=a.DERTaggedObject,T=a.ASN1Object,B=Error;this.params=null,this.setByParam=function(N){this.params=N},this.tohex=function(){var N=this.params,_,P,I,P=!1;if(N.other!==void 0)_="a0",I=new u(N.other);else if(N.rfc822!==void 0)_="81",I=new x({str:N.rfc822});else if(N.dns!==void 0)_="82",I=new x({str:N.dns});else if(N.dn!==void 0)_="a4",P=!0,typeof N.dn=="string"?I=new p({str:N.dn}):N.dn instanceof g.asn1.x509.X500Name?I=N.dn:I=new p(N.dn);else if(N.ldapdn!==void 0)_="a4",P=!0,I=new p({ldapstr:N.ldapdn});else if(N.certissuer!==void 0||N.certsubj!==void 0){_="a4",P=!0;var A,L,K=null;if(N.certsubj!==void 0?(A=!1,L=N.certsubj):(A=!0,L=N.certissuer),L.match(/^[0-9A-Fa-f]+$/),L.indexOf("-----BEGIN ")!=-1&&(K=ut(L)),K==null)throw new Error("certsubj/certissuer not cert");var ie=new Oe;ie.hex=K;var ae;A?ae=ie.getIssuerHex():ae=ie.getSubjectHex(),I=new T,I.hTLV=ae}else if(N.uri!==void 0)_="86",I=new x({str:N.uri});else if(N.ip!==void 0){_="87";var se,ce=N.ip;try{if(ce.match(/^[0-9a-f]+$/)){var z=ce.length;if(z==8||z==16||z==32||z==64)se=ce;else throw"err"}else se=ts(ce)}catch(Q){throw new B("malformed IP address: "+N.ip+":"+Q.message)}I=new S({hex:se})}else throw new B("improper params");var G=new O({tag:_,explicit:P,obj:I});return G.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.GeneralName,g.asn1.ASN1Object),g.asn1.x509.GeneralNames=function(t){g.asn1.x509.GeneralNames.superclass.constructor.call(this);var n=g,a=n.asn1;this.setByParamArray=function(c){for(var p=0;p<c.length;p++){var u=new a.x509.GeneralName(c[p]);this.asn1Array.push(u)}},this.tohex=function(){var c=new a.DERSequence({array:this.asn1Array});return c.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof t<"u"&&this.setByParamArray(t)},ye(g.asn1.x509.GeneralNames,g.asn1.ASN1Object),g.asn1.x509.OtherName=function(t){g.asn1.x509.OtherName.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DERObjectIdentifier,p=a.DERSequence,u=a.ASN1Util.newObject;this.params=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(x.oid==null||x.value==null)throw new Error("oid or value not specified");var S=new c({oid:x.oid}),O=u({tag:{tag:"a0",explicit:!0,obj:x.value}}),T=new p({array:[S,O]});return T.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.x509.OtherName,g.asn1.ASN1Object),g.asn1.x509.OID=new function(){var t=g.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(n){if(typeof this.objCache[n]<"u")return this.objCache[n];if(typeof this.name2oidList[n]>"u")throw"Name of ObjectIdentifier not defined: "+n;var a=this.name2oidList[n],c=new t({oid:a});return this.objCache[n]=c,c},this.atype2obj=function(n){if(this.objCache[n]!==void 0)return this.objCache[n];var a;if(n.match(/^\d+\.\d+\.[0-9.]+$/))a=n;else if(this.atype2oidList[n]!==void 0)a=this.atype2oidList[n];else if(this.name2oidList[n]!==void 0)a=this.name2oidList[n];else throw new Error("AttributeType name undefined: "+n);var c=new t({oid:a});return this.objCache[n]=c,c},this.registerOIDs=function(n){if(this.checkOIDs(n))for(var a in n)this.name2oidList[a]=n[a]},this.checkOIDs=function(n){try{var a=Object.keys(n);return a.length==0?!1:(a.map(function(c,p,u){var x=this[c];if(!x.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},n),!0)}catch{return!1}}},g.asn1.x509.OID.oid2name=function(t){var n=g.asn1.x509.OID.name2oidList;for(var a in n)if(n[a]==t)return a;return""},g.asn1.x509.OID.oid2atype=function(t){var n=g.asn1.x509.OID.atype2oidList;for(var a in n)if(n[a]==t)return a;return t},g.asn1.x509.OID.name2oid=function(t){if(t.match(/^[0-9.]+$/))return t;var n=g.asn1.x509.OID.name2oidList;return n[t]===void 0?"":n[t]},g.asn1.x509.X509Util={},g.asn1.x509.X509Util.newCertPEM=function(t){var n=g.asn1.x509;n.TBSCertificate;var a=n.Certificate,c=new a(t);return c.getPEM()},(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),(typeof g.asn1.cms>"u"||!g.asn1.cms)&&(g.asn1.cms={}),g.asn1.cms.Attribute=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.DERSet,x=c.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(S){this.params=S},this.getValueArray=function(){throw new n("not yet implemented abstract")},this.tohex=function(){var S=new x({oid:this.typeOid}),O=new u({array:this.getValueArray()}),T=new p({array:[S,O]});return T.tohex()},this.getEncodedHex=function(){return this.tohex()}},ye(g.asn1.cms.Attribute,g.asn1.ASN1Object),g.asn1.cms.ContentType=function(t){var n=g,a=n.asn1;a.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var c=new a.DERObjectIdentifier(this.params.type);return[c]},t!=null&&this.setByParam(t)},ye(g.asn1.cms.ContentType,g.asn1.cms.Attribute),g.asn1.cms.MessageDigest=function(t){var n=g,a=n.asn1,c=a.DEROctetString,p=a.cms;p.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var u=new c(this.params);return[u]},t!=null&&this.setByParam(t)},ye(g.asn1.cms.MessageDigest,g.asn1.cms.Attribute),g.asn1.cms.SigningTime=function(t){var n=g,a=n.asn1;a.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var c=new a.x509.Time(this.params);return[c]},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SigningTime,g.asn1.cms.Attribute),g.asn1.cms.SigningCertificate=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.cms,x=u.ESSCertID;a.crypto,u.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new n("parameter 'array' not specified");for(var S=this.params.array,O=[],T=0;T<S.length;T++){var B=S[T];t.hasis==!1&&typeof B=="string"&&(B.indexOf("-----BEGIN")!=-1||Ee.isASN1HEX(B))&&(B={cert:B}),B.hasis!=!1&&t.hasis==!1&&(B.hasis=!1),O.push(new x(B))}var N=new p({array:O}),_=new p({array:[N]});return[_]},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SigningCertificate,g.asn1.cms.Attribute),g.asn1.cms.ESSCertID=function(t){g.asn1.cms.ESSCertID.superclass.constructor.call(this);var n=Error,a=g,c=a.asn1,p=c.DEROctetString,u=c.DERSequence,x=c.cms.IssuerSerial;this.params=null,this.getCertHash=function(S,O){if(S.hash!=null)return S.hash;if(typeof S=="string"&&S.indexOf("-----BEGIN")==-1&&!Ee.isASN1HEX(S))return S;var T;if(typeof S=="string")T=S;else if(S.cert!=null)T=S.cert;else throw new n("hash nor cert unspecified");var B;T.indexOf("-----BEGIN")!=-1?B=ut(T):B=T,typeof S=="string"&&(S.indexOf("-----BEGIN")!=-1?B=ut(S):Ee.isASN1HEX(S)&&(B=S));var N;if(S.alg!=null)N=S.alg;else if(O!=null)N=O;else throw new n("hash alg unspecified");return a.crypto.Util.hashHex(B,N)},this.tohex=function(){var S=this.params,O=this.getCertHash(S,"sha1"),T=[];T.push(new p({hex:O})),(typeof S=="string"&&S.indexOf("-----BEGIN")!=-1||S.cert!=null&&S.hasis!=!1||S.issuer!=null&&S.serial!=null)&&T.push(new x(S));var B=new u({array:T});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.ESSCertID,g.asn1.ASN1Object),g.asn1.cms.SigningCertificateV2=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence;c.x509;var u=c.cms,x=u.ESSCertIDv2;a.crypto,u.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new n("parameter 'array' not specified");for(var S=this.params.array,O=[],T=0;T<S.length;T++){var B=S[T];(t.alg!=null||t.hasis==!1)&&typeof B=="string"&&(B.indexOf("-----BEGIN")!=-1||Ee.isASN1HEX(B))&&(B={cert:B}),B.alg==null&&t.alg!=null&&(B.alg=t.alg),B.hasis!=!1&&t.hasis==!1&&(B.hasis=!1),O.push(new x(B))}var N=new p({array:O}),_=new p({array:[N]});return[_]},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SigningCertificateV2,g.asn1.cms.Attribute),g.asn1.cms.ESSCertIDv2=function(t){g.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.DEROctetString,p=a.DERSequence,u=a.cms.IssuerSerial,x=a.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var S=this.params,O=this.getCertHash(S,"sha256"),T=[];S.alg!=null&&S.alg!="sha256"&&T.push(new x({name:S.alg})),T.push(new c({hex:O})),(typeof S=="string"&&S.indexOf("-----BEGIN")!=-1||S.cert!=null&&S.hasis!=!1||S.issuer!=null&&S.serial!=null)&&T.push(new u(S));var B=new p({array:T});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.ESSCertIDv2,g.asn1.cms.ESSCertID),g.asn1.cms.IssuerSerial=function(t){var n=Error,a=g,c=a.asn1,p=c.DERInteger,u=c.DERSequence,x=c.cms,S=c.x509,O=S.GeneralNames,T=Oe;x.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(B){this.params=B},this.tohex=function(){var B=this.params,N,_;if(typeof B=="string"&&B.indexOf("-----BEGIN")!=-1||B.cert!=null){var I;B.cert!=null?I=B.cert:I=B;var P=new T;P.readCertPEM(I),N=P.getIssuer(),_={hex:P.getSerialNumberHex()}}else if(B.issuer!=null&&B.serial)N=B.issuer,_=B.serial;else throw new n("cert or issuer and serial parameter not specified");var A=new O([{dn:N}]),L=new p(_),K=new u({array:[A,L]});return K.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.IssuerSerial,g.asn1.ASN1Object),g.asn1.cms.SignerIdentifier=function(t){var n=g,a=n.asn1;a.DERInteger,a.DERSequence;var c=a.cms,p=c.IssuerAndSerialNumber,u=c.SubjectKeyIdentifier,x=a.x509;x.X500Name,c.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var S=this.params;if(S.type=="isssn"){var O=new p(S);return O.tohex()}else if(S.type=="skid"){var T=new u(S);return T.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SignerIdentifier,g.asn1.ASN1Object),g.asn1.cms.IssuerAndSerialNumber=function(t){var n=g,a=n.asn1,c=a.DERInteger,p=a.DERSequence,u=a.cms,x=a.x509,S=x.X500Name,O=Oe,T=Error;u.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var B=this.params,N,_;if(typeof B=="string"&&B.indexOf("-----BEGIN")!=-1||B.cert!=null){var I;B.cert!=null?I=B.cert:I=B;var P=new O;P.readCertPEM(I),N=P.getIssuer(),_={hex:P.getSerialNumberHex()}}else if(B.issuer!=null&&B.serial)N=B.issuer,_=B.serial;else throw new T("cert or issuer and serial parameter not specified");var A=new S(N),L=new c(_),K=new p({array:[A,L]});return K.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(B){this.params=B},t!=null&&this.setByParam(t)},ye(g.asn1.cms.IssuerAndSerialNumber,g.asn1.ASN1Object),g.asn1.cms.SubjectKeyIdentifier=function(t){var n=g,a=n.asn1;a.DERInteger,a.DERSequence;var c=a.ASN1Util.newObject,p=a.cms;p.IssuerAndSerialName,p.SubjectKeyIdentifier;var u=a.x509;u.X500Name;var x=Oe,S=Error;p.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var O=this.params;if(O.cert==null&&O.skid==null)throw new S("property cert nor skid undefined");var T;if(O.cert!=null){var B=new x(O.cert),N=B.getExtSubjectKeyIdentifier();T=N.kid.hex}else O.skid!=null&&(T=O.skid);var _=c({tag:{tage:"a0",obj:{octstr:{hex:T}}}});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SubjectKeyIdentifier,g.asn1.ASN1Object),g.asn1.cms.AttributeList=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSet,u=c.cms;u.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(this.hTLV!=null)return this.hTLV;var S=!0;x.sortflag!=null&&(S=x.sortflag);for(var O=x.array,T=[],B=0;B<O.length;B++){var N=O[B],_=N.attr;if(_=="contentType")T.push(new u.ContentType(N));else if(_=="messageDigest")T.push(new u.MessageDigest(N));else if(_=="signingTime")T.push(new u.SigningTime(N));else if(_=="signingCertificate")T.push(new u.SigningCertificate(N));else if(_=="signingCertificateV2")T.push(new u.SigningCertificateV2(N));else if(_=="signaturePolicyIdentifier")T.push(new g.asn1.cades.SignaturePolicyIdentifier(N));else if(_=="signatureTimeStamp"||_=="timeStampToken")T.push(new g.asn1.cades.SignatureTimeStamp(N));else throw new n("unknown attr: "+_)}var I=new p({array:T,sortflag:S});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.AttributeList,g.asn1.ASN1Object),g.asn1.cms.SignerInfo=function(t){var n=Error,a=g,c=a.asn1,p=c.DERInteger,u=c.DEROctetString,x=c.DERSequence,S=c.DERTaggedObject,O=c.cms,T=O.SignerIdentifier,B=O.AttributeList;O.ContentType,O.EncapsulatedContentInfo,O.MessageDigest,O.SignedData;var N=c.x509,_=N.AlgorithmIdentifier,I=a.crypto,P=qe;O.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var A=this.params,L=A.sigalg,K=new B(A.sattrs).tohex(),ie=P.getKey(A.signkey),ae=new I.Signature({alg:L});ae.init(ie),ae.updateHex(K);var se=ae.sign();A.sighex=se},this.tohex=function(){var A=this.params,L=[];if(L.push(new p({int:A.version})),L.push(new T(A.id)),L.push(new _({name:A.hashalg})),A.sattrs!=null){var K=new B(A.sattrs);try{L.push(new S({tag:"a0",explicit:!1,obj:K}))}catch(ae){throw new n("si sattr error: "+ae)}}if(A.sigalgfield!=null?L.push(new _({name:A.sigalgfield})):L.push(new _({name:A.sigalg})),A.sighex==null&&A.signkey!=null&&this.sign(),L.push(new u({hex:A.sighex})),A.uattrs!=null){var K=new B(A.uattrs);try{L.push(new S({tag:"a1",explicit:!1,obj:K}))}catch(se){throw new n("si uattr error: "+se)}}var ie=new x({array:L});return ie.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SignerInfo,g.asn1.ASN1Object),g.asn1.cms.EncapsulatedContentInfo=function(t){var n=g,a=n.asn1,c=a.DERTaggedObject,p=a.DERSequence,u=a.DERObjectIdentifier,x=a.DEROctetString,S=a.cms;S.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var O=this.params,T=[];if(T.push(new u(O.type)),O.content!=null&&(O.content.hex!=null||O.content.str!=null)&&O.isDetached!=!0){var B=new x(O.content),N=new c({tag:"a0",explicit:!0,obj:B});T.push(N)}var _=new p({array:T});return _.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(O){this.params=O},t!=null&&this.setByParam(t)},ye(g.asn1.cms.EncapsulatedContentInfo,g.asn1.ASN1Object),g.asn1.cms.ContentInfo=function(t){var n=g,a=n.asn1,c=a.DERTaggedObject,p=a.DERSequence,u=a.DERObjectIdentifier,x=a.x509;x.OID.name2obj,g.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var S=this.params,O=[];O.push(new u(S.type));var T=new c({tag:"a0",explicit:!0,obj:S.obj});O.push(T);var B=new p({array:O});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(S){this.params=S},t!=null&&this.setByParam(t)},ye(g.asn1.cms.ContentInfo,g.asn1.ASN1Object),g.asn1.cms.SignedData=function(t){var n=g,a=n.asn1;a.ASN1Object;var c=a.DERInteger,p=a.DERSet,u=a.DERSequence;a.DERTaggedObject;var x=a.cms,S=x.EncapsulatedContentInfo,O=x.SignerInfo,T=x.ContentInfo,B=x.CertificateSet,N=x.RevocationInfoChoices,_=a.x509,I=_.AlgorithmIdentifier;g.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var P=this.params;this._setDigestAlgs(P),this._setContentTypeByEContent(P),this._setMessageDigestByEContent(P),this._setSignerInfoVersion(P),this._setSignedDataVersion(P)},this._setDigestAlgs=function(P){for(var A={},L=P.sinfos,K=0;K<L.length;K++){var ie=L[K];A[ie.hashalg]=1}P.hashalgs=Object.keys(A).sort()},this._setContentTypeByEContent=function(P){for(var A=P.econtent.type,L=P.sinfos,K=0;K<L.length;K++){var ie=L[K],ae=this._getAttrParamByName(ie,"contentType");ae.type=A}},this._setMessageDigestByEContent=function(P){var A=P.econtent;P.econtent.type;var L=A.content.hex;L==null&&A.type=="data"&&A.content.str!=null&&(L=Si(A.content.str));for(var K=P.sinfos,ie=0;ie<K.length;ie++){var ae=K[ie],se=ae.hashalg,ce=this._getAttrParamByName(ae,"messageDigest"),z=g.crypto.Util.hashHex(L,se);ce.hex=z}},this._getAttrParamByName=function(P,A){for(var L=P.sattrs.array,K=0;K<L.length;K++)if(L[K].attr==A)return L[K]},this._setSignerInfoVersion=function(P){for(var A=P.sinfos,L=0;L<A.length;L++){var K=A[L],ie=1;K.id.type=="skid"&&(ie=3),K.version=ie}},this._setSignedDataVersion=function(P){var A=this._getSignedDataVersion(P);P.version=A},this._getSignedDataVersion=function(P){if(P.revinfos!=null)for(var A=P.revinfos,L=0;L<A.length;L++){var K=A[L];if(K.ocsp!=null)return 5}for(var ie=P.sinfos,L=0;L<ie.length;L++){var ae=P.sinfos[L];if(ae.version==3)return 3}return P.econtent.type!="data"?3:1},this.tohex=function(){var P=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),P.fixed!=!0&&this.checkAndFixParam();var A=[];A.push(new c({int:P.version}));for(var L=[],K=0;K<P.hashalgs.length;K++){var ie=P.hashalgs[K];L.push(new I({name:ie}))}A.push(new p({array:L})),A.push(new S(P.econtent)),P.certs!=null&&A.push(new B(P.certs)),P.revinfos!=null&&A.push(new N(P.revinfos));for(var ae=[],K=0;K<P.sinfos.length;K++){var se=P.sinfos[K];ae.push(new O(se))}A.push(new p({array:ae}));var ce=new u({array:A});return ce.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var P=new T({type:"signed-data",obj:this});return P},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.SignedData,g.asn1.ASN1Object),g.asn1.cms.CertificateSet=function(t){g.asn1.cms.CertificateSet.superclass.constructor.call(this);var n=Error,a=g.asn1,c=a.DERTaggedObject,p=a.DERSet,u=a.ASN1Object;this.params=null,this.tohex=function(){var x=this.params,S=[],O;if(x instanceof Array)O=x;else if(x.array!=null)O=x.array;else throw new n("cert array not specified");for(var T=0;T<O.length;T++){var B=O[T],N=ut(B),_=new u;_.hTLV=N,S.push(_)}var I={array:S};x.sortflag==!1&&(I.sortflag=!1);var P=new p(I),A=new c({tag:"a0",explicit:!1,obj:P});return A.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.CertificateSet,g.asn1.ASN1Object),g.asn1.cms.RevocationInfoChoices=function(t){g.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var n=this.params;if(!n instanceof Array)throw new Error("params is not array");for(var a=[],c=0;c<n.length;c++)a.push(new g.asn1.cms.RevocationInfoChoice(n[c]));var p=g.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:a}}});return p.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.RevocationInfoChoices,g.asn1.ASN1Object),g.asn1.cms.RevocationInfoChoice=function(t){g.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var n=this.params;if(n.crl!=null&&typeof n.crl=="string"){var a=n.crl;return n.crl.indexOf("-----BEGIN")!=-1&&(a=ut(n.crl)),a}else if(n.ocsp!=null){var c=g.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new g.asn1.cms.OtherRevocationFormat(n)}});return c.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.RevocationInfoChoice,g.asn1.ASN1Object),g.asn1.cms.OtherRevocationFormat=function(t){g.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var n=Error,a=g,c=a.asn1,p=c.ASN1Util.newObject,u=a.lang.String.isHex;this.params=null,this.tohex=function(){var x=this.params;if(x.ocsp==null)throw new n("property ocsp not specified");if(!u(x.ocsp)||!Ee.isASN1HEX(x.ocsp))throw new n("ocsp value not ASN.1 hex string");var S=p({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:x.ocsp}}]});return S.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cms.OtherRevocationFormat,g.asn1.ASN1Object),g.asn1.cms.CMSUtil=new function(){},g.asn1.cms.CMSUtil.newSignedData=function(t){return new g.asn1.cms.SignedData(t)},g.asn1.cms.CMSUtil.verifySignedData=function(t){var n=g,a=n.asn1,c=a.cms;c.SignerInfo,c.SignedData,c.SigningTime,c.SigningCertificate,c.SigningCertificateV2;var p=a.cades;p.SignaturePolicyIdentifier;var u=n.lang.String.isHex,x=Ee,S=x.getVbyList,O=x.getTLVbyList,T=x.getIdxbyList,B=x.getChildIdx,N=x.getTLV,_=x.oidname,I=n.crypto.Util.hashHex;t.cms===void 0&&u(t.cms);var P=t.cms,A=function(Q,W){for(var te,oe=3;oe<6;oe++)if(te=T(Q,0,[1,0,oe]),te!==void 0){var de=Q.substr(te,2);de==="a0"&&(W.certsIdx=te),de==="a1"&&(W.revinfosIdx=te),de==="31"&&(W.signerinfosIdx=te)}},L=function(Q,W){var te=W.signerinfosIdx;if(te!==void 0){var oe=B(Q,te);W.signerInfoIdxList=oe;for(var de=0;de<oe.length;de++){var _e=oe[de],le={idx:_e};K(Q,le),W.signerInfos.push(le)}}},K=function(Q,W){var te=W.idx;W.signerid_issuer1=O(Q,te,[1,0],"30"),W.signerid_serial1=S(Q,te,[1,1],"02"),W.hashalg=_(S(Q,te,[2,0],"06"));var oe=T(Q,te,[3],"a0");W.idxSignedAttrs=oe,ie(Q,W,oe);var de=B(Q,te),_e=de.length;if(_e<6)throw"malformed SignerInfo";W.sigalg=_(S(Q,te,[_e-2,0],"06")),W.sigval=S(Q,te,[_e-1],"04")},ie=function(Q,W,te){var oe=B(Q,te);W.signedAttrIdxList=oe;for(var de=0;de<oe.length;de++){var _e=oe[de],le=S(Q,_e,[0],"06"),pe;le==="2a864886f70d010905"?(pe=Qe(S(Q,_e,[1,0])),W.saSigningTime=pe):le==="2a864886f70d010904"&&(pe=S(Q,_e,[1,0],"04"),W.saMessageDigest=pe)}},ae=function(Q,W){if(S(Q,0,[0],"06")!=="2a864886f70d010702")return W;W.cmsType="signedData",W.econtent=S(Q,0,[1,0,2,1,0]),A(Q,W),W.signerInfos=[],L(Q,W)},se=function(Q,W){for(var te=W.parse.signerInfos,oe=te.length,de=!0,_e=0;_e<oe;_e++){var le=te[_e];z(Q,W,le),le.isValid||(de=!1)}W.isValid=de},ce=function(Q,W,te,oe){var de=W.parse.certsIdx,_e;if(W.certs===void 0){_e=[],W.certkeys=[];for(var le=B(Q,de),pe=0;pe<le.length;pe++){var we=N(Q,le[pe]),xe=new Oe;xe.readCertHex(we),_e[pe]=xe,W.certkeys[pe]=xe.getPublicKey()}W.certs=_e}else _e=W.certs;W.cccc=_e.length,W.cccci=le.length;for(var pe=0;pe<_e.length;pe++){var It=xe.getIssuerHex(),ot=xe.getSerialNumberHex();te.signerid_issuer1===It&&te.signerid_serial1===ot&&(te.certkey_idx=pe)}},z=function(Q,W,te,oe){te.verifyDetail={};var de=te.verifyDetail,_e=W.parse.econtent,le=te.hashalg,pe=te.saMessageDigest;de.validMessageDigest=!1,I(_e,le)===pe&&(de.validMessageDigest=!0),ce(Q,W,te),de.validSignatureValue=!1;var we=te.sigalg,xe="31"+N(Q,te.idxSignedAttrs).substr(2);te.signedattrshex=xe;var It=W.certs[te.certkey_idx].getPublicKey(),ot=new g.crypto.Signature({alg:we});ot.init(It),ot.updateHex(xe);var tt=ot.verify(te.sigval);de.validSignatureValue_isValid=tt,tt===!0&&(de.validSignatureValue=!0),te.isValid=!1,de.validMessageDigest&&de.validSignatureValue&&(te.isValid=!0)},G={isValid:!1,parse:{}};return ae(P,G.parse),se(P,G),G},g.asn1.cms.CMSParser=function(){var t=Error,n=Oe,a=new n,c=Ee,p=c.getV,u=c.getTLV;c.getIdxbyList;var x=c.getTLVbyList,S=c.getTLVbyListEx,O=c.getVbyList,T=c.getVbyListEx,B=c.getChildIdx;this.getCMSSignedData=function(N){var _=x(N,0,[1,0]),I=this.getSignedData(_);return I},this.getSignedData=function(N){var _=B(N,0),I={},P=p(N,_[0]),A=parseInt(P,16);I.version=A;var L=u(N,_[1]);I.hashalgs=this.getHashAlgArray(L);var K=u(N,_[2]);I.econtent=this.getEContent(K);var ie=S(N,0,["[0]"]);ie!=null&&(I.certs=this.getCertificateSet(ie)),S(N,0,["[1]"]);var ae=S(N,0,[3]);return I.sinfos=this.getSignerInfos(ae),I},this.getHashAlgArray=function(N){for(var _=B(N,0),I=new n,P=[],A=0;A<_.length;A++){var L=u(N,_[A]),K=I.getAlgorithmIdentifierName(L);P.push(K)}return P},this.getEContent=function(N){var _={},I=O(N,0,[0]),P=O(N,0,[1,0]);return _.type=g.asn1.x509.OID.oid2name(Ee.hextooidstr(I)),_.content={hex:P},_},this.getSignerInfos=function(N){for(var _=[],I=B(N,0),P=0;P<I.length;P++){var A=u(N,I[P]),L=this.getSignerInfo(A);_.push(L)}return _},this.getSignerInfo=function(N){var _={},I=B(N,0),P=c.getInt(N,I[0],-1);P!=-1&&(_.version=P);var A=u(N,I[1]),L=this.getIssuerAndSerialNumber(A);_.id=L;var K=u(N,I[2]),ie=a.getAlgorithmIdentifierName(K);_.hashalg=ie;var ae=S(N,0,["[0]"]);if(ae!=null){var se=this.getAttributeList(ae);_.sattrs=se}var ce=S(N,0,[3]),z=a.getAlgorithmIdentifierName(ce);_.sigalg=z;var G=T(N,0,[4]);_.sighex=G;var Q=S(N,0,["[1]"]);if(Q!=null){var W=this.getAttributeList(Q);_.uattrs=W}return _},this.getSignerIdentifier=function(N){if(N.substr(0,2)=="30")return this.getIssuerAndSerialNumber(N);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(N){var _={type:"isssn"},I=B(N,0),P=u(N,I[0]);_.issuer=a.getX500Name(P);var A=p(N,I[1]);return _.serial={hex:A},_},this.getAttributeList=function(N){for(var _=[],I=B(N,0),P=0;P<I.length;P++){var A=u(N,I[P]),L=this.getAttribute(A);_.push(L)}return{array:_}},this.getAttribute=function(N){var _={},I=B(N,0),P=c.getOID(N,I[0]),A=g.asn1.x509.OID.oid2name(P);_.attr=A;var L=u(N,I[1]),K=B(L,0);if(K.length==1)_.valhex=u(L,K[0]);else{for(var ie=[],ae=0;ae<K.length;ae++)ie.push(u(L,K[ae]));_.valhex=ie}return A=="contentType"?this.setContentType(_):A=="messageDigest"?this.setMessageDigest(_):A=="signingTime"?this.setSigningTime(_):A=="signingCertificate"?this.setSigningCertificate(_):A=="signingCertificateV2"?this.setSigningCertificateV2(_):A=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(_),_},this.setContentType=function(N){var _=c.getOIDName(N.valhex,0,null);_!=null&&(N.type=_,delete N.valhex)},this.setSigningTime=function(N){var _=p(N.valhex,0),I=Qe(_);N.str=I,delete N.valhex},this.setMessageDigest=function(N){var _=p(N.valhex,0);N.hex=_,delete N.valhex},this.setSigningCertificate=function(N){var _=B(N.valhex,0);if(_.length>0){for(var I=u(N.valhex,_[0]),P=B(I,0),A=[],L=0;L<P.length;L++){var K=u(I,P[L]),ie=this.getESSCertID(K);A.push(ie)}N.array=A}if(_.length>1){var ae=u(N.valhex,_[1]);N.polhex=ae}delete N.valhex},this.setSignaturePolicyIdentifier=function(N){var _=B(N.valhex,0);if(_.length>0){var I=c.getOID(N.valhex,_[0]);N.oid=I}if(_.length>1){var P=new n,A=B(N.valhex,_[1]),L=u(N.valhex,A[0]),K=P.getAlgorithmIdentifierName(L);N.alg=K;var ie=p(N.valhex,A[1]);N.hash=ie}delete N.valhex},this.setSigningCertificateV2=function(N){var _=B(N.valhex,0);if(_.length>0){for(var I=u(N.valhex,_[0]),P=B(I,0),A=[],L=0;L<P.length;L++){var K=u(I,P[L]),ie=this.getESSCertIDv2(K);A.push(ie)}N.array=A}if(_.length>1){var ae=u(N.valhex,_[1]);N.polhex=ae}delete N.valhex},this.getESSCertID=function(N){var _={},I=B(N,0);if(I.length>0){var P=p(N,I[0]);_.hash=P}if(I.length>1){var A=u(N,I[1]),L=this.getIssuerSerial(A);L.serial!=null&&(_.serial=L.serial),L.issuer!=null&&(_.issuer=L.issuer)}return _},this.getESSCertIDv2=function(N){var _={},I=B(N,0);if(I.length<1||3<I.length)throw new t("wrong number of elements");var P=0;if(N.substr(I[0],2)=="30"){var A=u(N,I[0]);_.alg=a.getAlgorithmIdentifierName(A),P++}else _.alg="sha256";var L=p(N,I[P]);if(_.hash=L,I.length>P+1){var K=u(N,I[P+1]),ie=this.getIssuerSerial(K);_.issuer=ie.issuer,_.serial=ie.serial}return _},this.getIssuerSerial=function(N){var _={},I=B(N,0),P=u(N,I[0]),A=a.getGeneralNames(P),L=A[0].dn;_.issuer=L;var K=p(N,I[1]);return _.serial={hex:K},_},this.getCertificateSet=function(N){for(var _=B(N,0),I=[],P=0;P<_.length;P++){var A=u(N,_[P]);if(A.substr(0,2)=="30"){var L=Tt(A,"CERTIFICATE");I.push(L)}}return{array:I,sortflag:!1}}},(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),(typeof g.asn1.tsp>"u"||!g.asn1.tsp)&&(g.asn1.tsp={}),g.asn1.tsp.TimeStampToken=function(t){var n=g,a=n.asn1,c=a.tsp;c.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var p=new c.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=p.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.TimeStampToken,g.asn1.cms.SignedData),g.asn1.tsp.TSTInfo=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.DERInteger,u=a.DERBoolean,x=a.DERGeneralizedTime,S=a.DERObjectIdentifier,O=a.DERTaggedObject,T=a.tsp,B=T.MessageImprint,N=T.Accuracy;a.x509.X500Name;var _=a.x509.GeneralName;if(T.TSTInfo.superclass.constructor.call(this),this.dVersion=new p({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var I=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(I.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(I.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(I.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");I.push(this.dGenTime),this.dAccuracy!=null&&I.push(this.dAccuracy),this.dOrdering!=null&&I.push(this.dOrdering),this.dNonce!=null&&I.push(this.dNonce),this.dTsa!=null&&I.push(this.dTsa);var P=new c({array:I});return this.hTLV=P.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0){if(typeof t.policy=="string"){if(!t.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new S({oid:t.policy})}t.messageImprint!==void 0&&(this.dMessageImprint=new B(t.messageImprint)),t.serial!==void 0&&(this.dSerial=new p(t.serial)),t.genTime!==void 0&&(this.dGenTime=new x(t.genTime)),t.accuracy!==void 0&&(this.dAccuracy=new N(t.accuracy)),t.ordering!==void 0&&t.ordering==!0&&(this.dOrdering=new u),t.nonce!==void 0&&(this.dNonce=new p(t.nonce)),t.tsa!==void 0&&(this.dTsa=new O({tag:"a0",explicit:!0,obj:new _({dn:t.tsa})}))}},ye(g.asn1.tsp.TSTInfo,g.asn1.ASN1Object),g.asn1.tsp.Accuracy=function(t){var n=g,a=n.asn1,c=a.ASN1Util.newObject;a.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var p=this.params,u=[];return p.seconds!=null&&typeof p.seconds=="number"&&u.push({int:p.seconds}),p.millis!=null&&typeof p.millis=="number"&&u.push({tag:{tagi:"80",obj:{int:p.millis}}}),p.micros!=null&&typeof p.micros=="number"&&u.push({tag:{tagi:"81",obj:{int:p.micros}}}),c({seq:u}).tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.Accuracy,g.asn1.ASN1Object),g.asn1.tsp.MessageImprint=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.DEROctetString,u=a.x509,x=u.AlgorithmIdentifier;a.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var S=this.params,O=new x({name:S.alg}),T=new p({hex:S.hash}),B=new c({array:[O,T]});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.tsp.MessageImprint,g.asn1.ASN1Object),g.asn1.tsp.TimeStampReq=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.DERInteger,u=a.DERBoolean;a.ASN1Object;var x=a.DERObjectIdentifier,S=a.tsp,O=S.MessageImprint;S.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var T=this.params,B=[];B.push(new p({int:1})),T.messageImprint instanceof g.asn1.ASN1Object?B.push(T.messageImprint):B.push(new O(T.messageImprint)),T.policy!=null&&B.push(new x(T.policy)),T.nonce!=null&&B.push(new p(T.nonce)),T.certreq==!0&&B.push(new u);var N=new c({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.TimeStampReq,g.asn1.ASN1Object),g.asn1.tsp.TimeStampResp=function(t){var n=g,a=n.asn1,c=a.DERSequence;a.ASN1Object;var p=a.tsp,u=p.PKIStatusInfo;p.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var x=this.params,S=[];if(x.econtent!=null||x.tst!=null)if(x.statusinfo!=null?S.push(new u(x.statusinfo)):S.push(new u("granted")),x.econtent!=null)S.push(new p.TimeStampToken(x).getContentInfo());else if(x.tst instanceof a.ASN1Object)S.push(x.tst);else throw new Error("improper member tst value");else if(x.statusinfo!=null)S.push(new u(x.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var O=new c({array:S});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.TimeStampResp,g.asn1.ASN1Object),g.asn1.tsp.PKIStatusInfo=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.tsp,x=u.PKIStatus,S=u.PKIFreeText,O=u.PKIFailureInfo;u.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var T=this.params,B=[];if(typeof T=="string")B.push(new x(T));else{if(T.status==null)throw new n("property 'status' unspecified");B.push(new x(T.status)),T.statusstr!=null&&B.push(new S(T.statusstr)),T.failinfo!=null&&B.push(new O(T.failinfo))}var N=new p({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.PKIStatusInfo,g.asn1.ASN1Object),g.asn1.tsp.PKIStatus=function(t){var n=Error,a=g,c=a.asn1,p=c.DERInteger,u=c.tsp;u.PKIStatus.superclass.constructor.call(this);var x={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var S=this.params,O;if(typeof S=="string")try{O=x[S]}catch{throw new n("undefined name: "+S)}else if(typeof S=="number")O=S;else throw new n("unsupported params");return new p({int:O}).tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.PKIStatus,g.asn1.ASN1Object),g.asn1.tsp.PKIFreeText=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.DERUTF8String,x=c.tsp;x.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var S=this.params;if(!S instanceof Array)throw new n("wrong params: not array");for(var O=[],T=0;T<S.length;T++)O.push(new u({str:S[T]}));var B=new p({array:O});return B.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.PKIFreeText,g.asn1.ASN1Object),g.asn1.tsp.PKIFailureInfo=function(t){var n=Error,a=g,c=a.asn1,p=c.DERBitString,u=c.tsp,x=u.PKIFailureInfo,S={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};x.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var O=this.params,T=0;if(typeof O=="number"&&0<=O&&O<=25){T|=1<<O;for(var B=T.toString(2),N="",_=B.length-1;_>=0;_--)N+=B[_];return N}else{if(typeof O=="string"&&S[O]!=null)return nn([O],S);if(typeof O=="object"&&O.length!=null)return nn(O,S);throw new n("wrong params")}},this.tohex=function(){this.params;var O=this.getBinValue();return new p({bin:O}).tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.tsp.PKIFailureInfo,g.asn1.ASN1Object),g.asn1.tsp.AbstractTSAAdapter=function(t){this.getTSTHex=function(n,a){throw"not implemented yet"}},g.asn1.tsp.SimpleTSAAdapter=function(t){var n=g,a=n.asn1,c=a.tsp,p=n.crypto.Util.hashHex;c.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(u,x){var S=p(u,x);this.params.econtent.content.messageImprint={alg:x,hash:S},this.params.econtent.content.serial={int:this.serial++};var O=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:O};var T=new c.TimeStampToken(this.params);return T.getContentInfoEncodedHex()},t!==void 0&&(this.params=t)},ye(g.asn1.tsp.SimpleTSAAdapter,g.asn1.tsp.AbstractTSAAdapter),g.asn1.tsp.FixedTSAAdapter=function(t){var n=g,a=n.asn1,c=a.tsp,p=n.crypto.Util.hashHex;c.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(u,x){var S=p(u,x);this.params.econtent.content.messageImprint={alg:x,hash:S};var O=new c.TimeStampToken(this.params);return O.getContentInfoEncodedHex()},t!==void 0&&(this.params=t)},ye(g.asn1.tsp.FixedTSAAdapter,g.asn1.tsp.AbstractTSAAdapter),g.asn1.tsp.TSPUtil=new function(){},g.asn1.tsp.TSPUtil.newTimeStampToken=function(t){return new g.asn1.tsp.TimeStampToken(t)},g.asn1.tsp.TSPUtil.parseTimeStampReq=function(t){var n=new g.asn1.tsp.TSPParser;return n.getTimeStampReq(t)},g.asn1.tsp.TSPUtil.parseMessageImprint=function(t){var n=new g.asn1.tsp.TSPParser;return n.getMessageImprint(t)},g.asn1.tsp.TSPParser=function(){var t=Oe,n=new t,a=Ee,c=a.getV,p=a.getTLV,u=a.getIdxbyList;a.getTLVbyListEx;var x=a.getChildIdx,S=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],O={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(T){var B=x(T,0);if(B.length==1)return this.getPKIStatusInfo(p(T,B[0]));if(B.length>1){var N=this.getPKIStatusInfo(p(T,B[0])),_=p(T,B[1]),I=this.getToken(_);return I.statusinfo=N,I}},this.getToken=function(T){var B=new g.asn1.cms.CMSParser,N=B.getCMSSignedData(T);return this.setTSTInfo(N),N},this.setTSTInfo=function(T){var B=T.econtent;if(B.type=="tstinfo"){var N=B.content.hex,_=this.getTSTInfo(N);B.content=_}},this.getTSTInfo=function(T){var B={},N=x(T,0),_=c(T,N[1]);B.policy=tn(_);var I=p(T,N[2]);B.messageImprint=this.getMessageImprint(I);var P=c(T,N[3]);B.serial={hex:P};var A=c(T,N[4]);B.genTime={str:Qe(A)};var L=0;if(N.length>5&&T.substr(N[5],2)=="30"){var K=p(T,N[5]);B.accuracy=this.getAccuracy(K),L++}if(N.length>5+L&&T.substr(N[5+L],2)=="01"){var ie=c(T,N[5+L]);ie=="ff"&&(B.ordering=!0),L++}if(N.length>5+L&&T.substr(N[5+L],2)=="02"){var ae=c(T,N[5+L]);B.nonce={hex:ae},L++}if(N.length>5+L&&T.substr(N[5+L],2)=="a0"){var se=p(T,N[5+L]);se="30"+se.substr(2),pGeneralNames=n.getGeneralNames(se);var ce=pGeneralNames[0].dn;B.tsa=ce,L++}if(N.length>5+L&&T.substr(N[5+L],2)=="a1"){var z=p(T,N[5+L]);z="30"+z.substr(2);var G=n.getExtParamArray(z);B.ext=G,L++}return B},this.getAccuracy=function(T){for(var B={},N=x(T,0),_=0;_<N.length;_++){var I=T.substr(N[_],2),P=c(T,N[_]),A=parseInt(P,16);I=="02"?B.seconds=A:I=="80"?B.millis=A:I=="81"&&(B.micros=A)}return B},this.getMessageImprint=function(T){if(T.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var B={};x(T,0);var N=u(T,0,[0,0]),_=c(T,N),I=a.hextooidstr(_),P=g.asn1.x509.OID.oid2name(I);if(P=="")throw new Error("hashAlg name undefined: "+I);var A=P,L=u(T,0,[1]);return B.alg=A,B.hash=c(T,L),B},this.getPKIStatusInfo=function(T){var B={},N=x(T,0),_=0;try{var I=c(T,N[0]),P=parseInt(I,16);B.status=S[P]}catch{}if(N.length>1&&T.substr(N[1],2)=="30"){var A=p(T,N[1]);B.statusstr=this.getPKIFreeText(A),_++}if(N.length>_&&T.substr(N[1+_],2)=="03"){var L=p(T,N[1+_]);B.failinfo=this.getPKIFailureInfo(L)}return B},this.getPKIFreeText=function(T){for(var B=[],N=x(T,0),_=0;_<N.length;_++)B.push(a.getString(T,N[_]));return B},this.getPKIFailureInfo=function(T){var B=a.getInt(T,0);return O[B]!=null?O[B]:B},this.getTimeStampReq=function(T){var B={};B.certreq=!1;var N=x(T,0);if(N.length<2)throw new Error("TimeStampReq must have at least 2 items");var _=p(T,N[1]);B.messageImprint=g.asn1.tsp.TSPUtil.parseMessageImprint(_);for(var I=2;I<N.length;I++){var P=N[I],A=T.substr(P,2);if(A=="06"){var L=c(T,P);B.policy=a.hextooidstr(L)}A=="02"&&(B.nonce=c(T,P)),A=="01"&&(B.certreq=!0)}return B}},(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),(typeof g.asn1.cades>"u"||!g.asn1.cades)&&(g.asn1.cades={}),g.asn1.cades.SignaturePolicyIdentifier=function(t){var n=g,a=n.asn1,c=a.cades,p=c.SignaturePolicyId;c.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new p(this.params)]},this.setByParam=function(u){this.params=u},t!=null&&this.setByParam(t)},ye(g.asn1.cades.SignaturePolicyIdentifier,g.asn1.cms.Attribute),g.asn1.cades.SignaturePolicyId=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.DERObjectIdentifier,u=a.x509;u.AlgorithmIdentifier;var x=a.cades,S=x.SignaturePolicyId,O=x.OtherHashAlgAndValue;S.superclass.constructor.call(this),this.params=null,this.tohex=function(){var T=this.params,B=[];B.push(new p(T.oid)),B.push(new O(T));var N=new c({array:B});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(T){this.params=T},t!=null&&this.setByParam(t)},ye(g.asn1.cades.SignaturePolicyId,g.asn1.ASN1Object),g.asn1.cades.OtherHashAlgAndValue=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.DEROctetString,x=c.x509,S=x.AlgorithmIdentifier,O=c.cades,T=O.OtherHashAlgAndValue;T.superclass.constructor.call(this),this.params=null,this.tohex=function(){var B=this.params;if(B.alg==null)throw new n("property 'alg' not specified");if(B.hash==null&&B.cert==null)throw new n("property 'hash' nor 'cert' not specified");var N=null;if(B.hash!=null)N=B.hash;else if(B.cert!=null){if(typeof B.cert!="string")throw new n("cert not string");var _=B.cert;B.cert.indexOf("-----BEGIN")!=-1&&(_=ut(B.cert)),N=g.crypto.Util.hashHex(_,B.alg)}var I=[];I.push(new S({name:B.alg})),I.push(new u({hex:N}));var P=new p({array:I});return P.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cades.OtherHashAlgAndValue,g.asn1.ASN1Object),g.asn1.cades.OtherHashValue=function(t){g.asn1.cades.OtherHashValue.superclass.constructor.call(this);var n=Error,a=g;a.lang.String.isHex;var c=a.asn1,p=c.DEROctetString;a.crypto.Util.hashHex,this.params=null,this.tohex=function(){var u=this.params;if(u.hash==null&&u.cert==null)throw new n("hash or cert not specified");var x=null;if(u.hash!=null)x=u.hash;else if(u.cert!=null){if(typeof u.cert!="string")throw new n("cert not string");var S=u.cert;u.cert.indexOf("-----BEGIN")!=-1&&(S=ut(u.cert)),x=g.crypto.Util.hashHex(S,"sha1")}return new p({hex:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cades.OtherHashValue,g.asn1.ASN1Object),g.asn1.cades.SignatureTimeStamp=function(t){var n=Error,a=g,c=a.lang.String.isHex,p=a.asn1,u=p.ASN1Object;p.x509;var x=p.cades;x.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var S=this.params;if(S.tst!=null)if(c(S.tst)){var O=new u;return O.hTLV=S.tst,[O]}else{if(S.tst instanceof u)return[S.tst];throw new n("params.tst has wrong value")}else if(S.res!=null){var T=S.res;if(T instanceof u&&(T=T.tohex()),typeof T!="string"||!c(T))throw new n("params.res has wrong value");Ee.getTLVbyList(T,0,[1]);var O=new u;return O.hTLV=S.tst,[O]}},t!=null&&this.setByParam(t)},ye(g.asn1.cades.SignatureTimeStamp,g.asn1.cms.Attribute),g.asn1.cades.CompleteCertificateRefs=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.cades,x=u.OtherCertID,S=a.lang.String.isHex;u.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var O=this.params,T=[],B=0;B<O.array.length;B++){var N=O.array[B];if(typeof N=="string")if(N.indexOf("-----BEGIN")!=-1)N={cert:N};else if(S(N))N={hash:N};else throw new n("unsupported value: "+N);O.alg!=null&&N.alg==null&&(N.alg=O.alg),O.hasis!=null&&N.hasis==null&&(N.hasis=O.hasis);var _=new x(N);T.push(_)}var I=new p({array:T});return[I]},t!=null&&this.setByParam(t)},ye(g.asn1.cades.CompleteCertificateRefs,g.asn1.cms.Attribute),g.asn1.cades.OtherCertID=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.cms,u=p.IssuerSerial,x=a.cades,S=x.OtherHashValue,O=x.OtherHashAlgAndValue;x.OtherCertID.superclass.constructor.call(this),this.params=t,this.tohex=function(){var T=this.params;typeof T=="string"&&(T.indexOf("-----BEGIN")!=-1?T={cert:T}:_isHex(T)&&(T={hash:T}));var B=[],N=null;if(T.alg!=null?N=new O(T):N=new S(T),B.push(N),T.cert!=null&&T.hasis==!0||T.issuer!=null&&T.serial!=null){var _=new u(T);B.push(_)}var I=new c({array:B});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cades.OtherCertID,g.asn1.ASN1Object),g.asn1.cades.OtherHash=function(t){var n=g,a=n.asn1;a.cms;var c=a.cades,p=c.OtherHashAlgAndValue,u=c.OtherHashValue;n.crypto.Util.hashHex;var x=n.lang.String.isHex;c.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var S=this.params;typeof S=="string"&&(S.indexOf("-----BEGIN")!=-1?S={cert:S}:x(S)&&(S={hash:S}));var O=null;return S.alg!=null?O=new p(S):O=new u(S),O.tohex()},this.getEncodedHex=function(){return this.tohex()},t!=null&&this.setByParam(t)},ye(g.asn1.cades.OtherHash,g.asn1.ASN1Object),g.asn1.cades.CAdESUtil=new function(){},g.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(t){var n=new g.asn1.cms.CMSParser,a=n.getCMSSignedData(t);return a},g.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(t,n,a){var c=Ee,p=c.getChildIdx,u=c.getTLV,x=c.getV,S=g,O=S.asn1,T=O.ASN1Object,B=O.cms,N=B.AttributeList,_=B.SignerInfo,I={},P=p(t,n);if(P.length!=6)throw"not supported items for SignerInfo (!=6)";var A=P.shift();I.version=u(t,A);var L=P.shift();I.si=u(t,L);var K=P.shift();I.digalg=u(t,K);var ie=P.shift();I.sattrs=u(t,ie);var ae=P.shift();I.sigalg=u(t,ae);var se=P.shift();I.sig=u(t,se),I.sigval=x(t,se);var ce=null;return I.obj=new _,ce=new T,ce.hTLV=I.version,I.obj.dCMSVersion=ce,ce=new T,ce.hTLV=I.si,I.obj.dSignerIdentifier=ce,ce=new T,ce.hTLV=I.digalg,I.obj.dDigestAlgorithm=ce,ce=new T,ce.hTLV=I.sattrs,I.obj.dSignedAttrs=ce,ce=new T,ce.hTLV=I.sigalg,I.obj.dSigAlg=ce,ce=new T,ce.hTLV=I.sig,I.obj.dSig=ce,I.obj.dUnsignedAttrs=new N,I},(typeof g.asn1.csr>"u"||!g.asn1.csr)&&(g.asn1.csr={}),g.asn1.csr.CertificationRequest=function(t){var n=g,a=n.asn1,c=a.DERBitString,p=a.DERSequence,u=a.csr;a.x509;var x=u.CertificationRequestInfo;u.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(S){this.params=S},this.sign=function(){var S=new x(this.params).tohex(),O=new g.crypto.Signature({alg:this.params.sigalg});O.init(this.params.sbjprvkey),O.updateHex(S);var T=O.sign();this.params.sighex=T},this.getPEM=function(){return Tt(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var S=this.params,O=new g.asn1.csr.CertificationRequestInfo(this.params),T=new g.asn1.x509.AlgorithmIdentifier({name:S.sigalg});if(S.sighex==null&&S.sbjprvkey!=null&&this.sign(),S.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var B=new c({hex:"00"+S.sighex}),N=new p({array:[O,T,B]});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.csr.CertificationRequest,g.asn1.ASN1Object),g.asn1.csr.CertificationRequestInfo=function(t){var n=g,a=n.asn1;a.DERBitString;var c=a.DERSequence,p=a.DERInteger,u=a.DERUTF8String,x=a.DERTaggedObject,S=a.ASN1Util.newObject,O=a.csr,T=a.x509,B=T.X500Name,N=T.Extensions,_=T.SubjectPublicKeyInfo;O.AttributeList,O.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(P){P!=null&&(this.params=P)},this.tohex=function(){var P=this.params,A=[];if(A.push(new p({int:0})),A.push(new B(P.subject)),A.push(new _(qe.getKey(P.sbjpubkey))),P.attrs!=null){var L=I(P.attrs),K=S({tag:{tage:"a0",obj:L}});A.push(K)}else if(P.extreq!=null){var ie=new N(P.extreq),K=S({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[ie]}]}}});A.push(K)}else A.push(new x({tag:"a0",explicit:!1,obj:new u({str:""})}));var ae=new c({array:A});return ae.tohex()},this.getEncodedHex=function(){return this.tohex()};function I(P){for(var A=Error,L=g.asn1.x509.Extensions,K=[],ie=0;ie<P.length;ie++){var ae=P[ie],se=ae.attr;if(se=="extensionRequest"){var ce=new L(ae.ext),z={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[ce]}]};K.push(z)}else if(se=="unstructuredName"){var z={seq:[{oid:"1.2.840.113549.1.9.2"},{set:ae.names}]};K.push(z)}else if(se=="challengePassword"){var z={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:ae.password}]}]};K.push(z)}else throw new A("unknown CSR attribute")}return{set:K}}t!=null&&this.setByParam(t)},ye(g.asn1.csr.CertificationRequestInfo,g.asn1.ASN1Object),g.asn1.csr.AttributeList=function(t){},ye(g.asn1.csr.AttributeList,g.asn1.ASN1Object),g.asn1.csr.CSRUtil=new function(){},g.asn1.csr.CSRUtil.newCSRPEM=function(t){var n=g.asn1.csr,a=new n.CertificationRequest(t),c=a.getPEM();return c},g.asn1.csr.CSRUtil.getParam=function(t,n){var a=Ee,c=a.getV,p=a.getIdxbyList,u=a.getTLVbyList,x=a.getTLVbyListEx,S=a.getVbyListEx,O=function(ie){var ae=p(ie,0,[0,3,0,0],"06");return c(ie,ae)!="2a864886f70d01090e"?null:u(ie,0,[0,3,0,1,0],"30")},T={};if(t.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var B=ut(t,"CERTIFICATE REQUEST");n&&(T.tbs=u(B,0,[0]));try{var N=x(B,0,[0,1]);if(N=="3000")T.subject={};else{var A=new Oe;T.subject=A.getX500Name(N)}}catch{}var _=x(B,0,[0,2]),I=qe.getKey(_,null,"pkcs8pub");T.sbjpubkey=qe.getPEM(I,"PKCS8PUB");var P=O(B),A=new Oe;P!=null&&(T.extreq=A.getExtParamArray(P));try{var L=x(B,0,[1],"30"),A=new Oe;T.sigalg=A.getAlgorithmIdentifierName(L)}catch{}try{var K=S(B,0,[2]);T.sighex=K}catch{}return T},g.asn1.csr.CSRUtil.verifySignature=function(t){try{var n=null;if(typeof t=="string"&&t.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?n=g.asn1.csr.CSRUtil.getParam(t,!0):typeof t=="object"&&t.sbjpubkey!=null&&t.sigalg!=null&&t.sighex!=null&&t.tbs!=null&&(n=t),n==null)return!1;var a=new g.crypto.Signature({alg:n.sigalg});return a.init(n.sbjpubkey),a.updateHex(n.tbs),a.verify(n.sighex)}catch(c){return alert(c),!1}},(typeof g>"u"||!g)&&(g={}),(typeof g.asn1>"u"||!g.asn1)&&(g.asn1={}),(typeof g.asn1.ocsp>"u"||!g.asn1.ocsp)&&(g.asn1.ocsp={}),g.asn1.ocsp.DEFAULT_HASH="sha1",g.asn1.ocsp.OCSPResponse=function(t){g.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),g.asn1.DEREnumerated;var n=g.asn1.ASN1Util.newObject,a=g.asn1.ocsp.ResponseBytes,c=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var p=this.params.resstatus;return typeof p=="number"?p:typeof p!="string"?-1:c.indexOf(p)},this.setByParam=function(p){this.params=p},this.tohex=function(){var p=this.params,u=this._getStatusCode();if(u==-1)throw new Error("responseStatus not supported: "+p.resstatus);if(u!=0)return n({seq:[{enum:{int:u}}]}).tohex();var x=new a(p);return n({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:x}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.OCSPResponse,g.asn1.ASN1Object),g.asn1.ocsp.ResponseBytes=function(t){g.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var n=g.asn1,a=n.DERSequence,c=n.DERObjectIdentifier,p=n.DEROctetString,u=n.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(x.restype!="ocspBasic")throw new Error("not supported responseType: "+x.restype);var S=new u(x),O=[];O.push(new c({name:"ocspBasic"})),O.push(new p({hex:S.tohex()}));var T=new a({array:O});return T.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.ResponseBytes,g.asn1.ASN1Object),g.asn1.ocsp.BasicOCSPResponse=function(t){g.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var n=Error,a=g.asn1,c=a.ASN1Object,p=a.DERSequence;a.DERGeneralizedTime;var u=a.DERTaggedObject,x=a.DERBitString;a.x509.Extensions;var S=a.x509.AlgorithmIdentifier,O=a.ocsp;O.ResponderID,_SingleResponseList=O.SingleResponseList,_ResponseData=O.ResponseData,this.params=null,this.setByParam=function(T){this.params=T},this.sign=function(){var T=this.params,B=T.tbsresp.tohex(),N=new g.crypto.Signature({alg:T.sigalg});N.init(T.reskey),N.updateHex(B),T.sighex=N.sign()},this.tohex=function(){var T=this.params;T.tbsresp==null&&(T.tbsresp=new _ResponseData(T)),T.sighex==null&&T.reskey!=null&&this.sign();var B=[];if(B.push(T.tbsresp),B.push(new S({name:T.sigalg})),B.push(new x({hex:"00"+T.sighex})),T.certs!=null&&T.certs.length!=null){for(var N=[],_=0;_<T.certs.length;_++){var I=T.certs[_],P=null;if(Ee.isASN1HEX(I))P=I;else if(I.match(/-----BEGIN/))P=ut(I);else throw new n("certs["+_+"] not hex or PEM");N.push(new c({tlv:P}))}var A=new p({array:N});B.push(new u({tag:"a0",explicit:!0,obj:A}))}var L=new p({array:B});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.BasicOCSPResponse,g.asn1.ASN1Object),g.asn1.ocsp.ResponseData=function(t){g.asn1.ocsp.ResponseData.superclass.constructor.call(this);var n=g.asn1,a=n.DERSequence,c=n.DERGeneralizedTime,p=n.DERTaggedObject,u=n.x509.Extensions,x=n.ocsp,S=x.ResponderID;_SingleResponseList=x.SingleResponseList,this.params=null,this.tohex=function(){var O=this.params;O.respid!=null,O.prodat!=null,O.array!=null;var T=[];if(T.push(new S(O.respid)),T.push(new c(O.prodat)),T.push(new _SingleResponseList(O.array)),O.ext!=null){var B=new u(O.ext);T.push(new p({tag:"a1",explicit:!0,obj:B}))}var N=new a({array:T});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(O){this.params=O},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.ResponseData,g.asn1.ASN1Object),g.asn1.ocsp.ResponderID=function(t){g.asn1.ocsp.ResponderID.superclass.constructor.call(this);var n=g,a=n.asn1,c=a.ASN1Util.newObject,p=a.x509.X500Name,u=n.lang.String.isHex,x=Error;this.params=null,this.tohex=function(){var S=this.params;if(S.key!=null){var O=null;if(typeof S.key=="string"){if(u(S.key)&&(O=S.key),S.key.match(/-----BEGIN CERTIFICATE/)){var T=new Oe(S.key),B=T.getExtSubjectKeyIdentifier();B!=null&&(O=B.kid.hex)}}else if(S.key instanceof Oe){var B=S.key.getExtSubjectKeyIdentifier();B!=null&&(O=B.kid.hex)}if(O==null)throw new x("wrong key member value");var N=c({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:O}}}});return N.tohex()}else if(S.name!=null){var _=null;if(typeof S.name=="string"&&S.name.match(/-----BEGIN CERTIFICATE/)){var T=new Oe(S.name);_=T.getSubject()}else S.name instanceof Oe?_=S.name.getSubject():typeof S.name=="object"&&(S.name.array!=null||S.name.str!=null)&&(_=S.name);if(_==null)throw new x("wrong name member value");var N=c({tag:{tag:"a1",explicit:!0,obj:new p(_)}});return N.tohex()}throw new x("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(S){this.params=S},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.ResponderID,g.asn1.ASN1Object),g.asn1.ocsp.SingleResponseList=function(t){g.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var n=g.asn1,a=n.DERSequence,c=n.ocsp.SingleResponse;this.params=null,this.tohex=function(){var p=this.params;if(typeof p!="object"||p.length==null)throw new Error("params not specified properly");for(var u=[],x=0;x<p.length;x++)u.push(new c(p[x]));var S=new a({array:u});return S.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(p){this.params=p},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.SingleResponseList,g.asn1.ASN1Object),g.asn1.ocsp.SingleResponse=function(t){var n=Error,a=g,c=a.asn1,p=c.DERSequence,u=c.DERGeneralizedTime,x=c.DERTaggedObject,S=c.ocsp,O=S.CertID,T=S.CertStatus,B=c.x509,N=B.Extensions;S.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var _=this.params,I=[];if(_.certid==null)throw new n("certid unspecified");if(_.status==null)throw new n("status unspecified");if(_.thisupdate==null)throw new n("thisupdate unspecified");if(I.push(new O(_.certid)),I.push(new T(_.status)),I.push(new u(_.thisupdate)),_.nextupdate!=null){var P=new u(_.nextupdate);I.push(new x({tag:"a0",explicit:!0,obj:P}))}if(_.ext!=null){var A=new N(_.ext);I.push(new x({tag:"a1",explicit:!0,obj:A}))}var L=new p({array:I});return L.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(_){this.params=_},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.SingleResponse,g.asn1.ASN1Object),g.asn1.ocsp.CertID=function(t){var n=g,a=n.asn1,c=a.DEROctetString,p=a.DERInteger,u=a.DERSequence,x=a.x509,S=x.AlgorithmIdentifier,O=a.ocsp;O.DEFAULT_HASH;var T=n.crypto,B=T.Util.hashHex,N=Oe,_=Ee,I=_.getVbyList;O.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(P,A,L,K){K==null&&(K=this.DEFAULT_HASH),this.params={alg:K,issname:P,isskey:A,sbjsn:L}},this.setByCert=function(P,A,L){L==null&&(L=this.DEFAULT_HASH),this.params={alg:L,issuerCert:P,subjectCert:A}},this.getParamByCerts=function(P,A,L){L==null&&(L=this.DEFAULT_HASH);var K=new N(P),ie=new N(A),ae=B(K.getSubjectHex(),L),se=K.getPublicKeyHex(),ce=B(I(se,0,[1],"03",!0),L),z=ie.getSerialNumberHex(),G={alg:L,issname:ae,isskey:ce,sbjsn:z};return G},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var P=this.params,A,L,K,ie;if(P.alg==null?ie=this.DEFAULT_HASH:ie=P.alg,P.issuerCert!=null&&P.subjectCert!=null){var ae=this.getParamByCerts(P.issuerCert,P.subjectCert,ie);A=ae.issname,L=ae.isskey,K=ae.sbjsn}else if(P.issname!=null&&P.isskey!=null&&P.sbjsn!=null)A=P.issname,L=P.isskey,K=P.sbjsn;else throw new Error("required param members not defined");var se=new S({name:ie}),ce=new c({hex:A}),z=new c({hex:L}),G=new p({hex:K}),Q=new u({array:[se,ce,z,G]});return this.hTLV=Q.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.CertID,g.asn1.ASN1Object),g.asn1.ocsp.CertStatus=function(t){g.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var n=this.params;if(n.status=="good")return"8000";if(n.status=="unknown")return"8200";if(n.status=="revoked"){var a=[{gentime:{str:n.time}}];n.reason!=null&&a.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:n.reason}}}});var c={tag:"a1",explicit:!1,obj:{seq:a}};return g.asn1.ASN1Util.newObject({tag:c}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(n){this.params=n},t!==void 0&&this.setByParam(t)},ye(g.asn1.ocsp.CertStatus,g.asn1.ASN1Object),g.asn1.ocsp.Request=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.ocsp;if(p.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var x=[];if(this.dReqCert===null)throw"reqCert not set";x.push(this.dReqCert);var S=new c({array:x});return this.hTLV=S.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof t<"u"){var u=new p.CertID(t);this.dReqCert=u}},ye(g.asn1.ocsp.Request,g.asn1.ASN1Object),g.asn1.ocsp.TBSRequest=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.ocsp;p.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(u){for(var x=[],S=0;S<u.length;S++){var O=new p.Request(u[0]);x.push(O)}this.dRequestList=x},this.tohex=function(){var u=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var x=new c({array:this.dRequestList});if(u.push(x),this.dRequestExt!==null)throw"requestExtensions not supported";var S=new c({array:u});return this.hTLV=S.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&t.reqList!==void 0&&this.setRequestListByParam(t.reqList)},ye(g.asn1.ocsp.TBSRequest,g.asn1.ASN1Object),g.asn1.ocsp.OCSPRequest=function(t){var n=g,a=n.asn1,c=a.DERSequence,p=a.ocsp;if(p.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var x=[];if(this.dTbsRequest!==null)x.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var S=new c({array:x});return this.hTLV=S.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},t!==void 0&&t.reqList!==void 0){var u=new p.TBSRequest(t);this.dTbsRequest=u}},ye(g.asn1.ocsp.OCSPRequest,g.asn1.ASN1Object),g.asn1.ocsp.OCSPUtil={},g.asn1.ocsp.OCSPUtil.getRequestHex=function(t,n,a){var c=g,p=c.asn1,u=p.ocsp;a===void 0&&(a=u.DEFAULT_HASH);var x={alg:a,issuerCert:t,subjectCert:n},S=new u.OCSPRequest({reqList:[x]});return S.tohex()},g.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(t){var n=Ee,a=n.getVbyList,c=n.getVbyListEx,p=n.getIdxbyList;n.getIdxbyListEx;var u=n.getV,x={};try{var S=c(t,0,[0],"0a");x.responseStatus=parseInt(S,16)}catch{}if(x.responseStatus!==0)return x;try{var O=p(t,0,[1,0,1,0,0,2,0,1]);t.substr(O,2)==="80"?x.certStatus="good":t.substr(O,2)==="a1"?(x.certStatus="revoked",x.revocationTime=Qe(a(t,O,[0]))):t.substr(O,2)==="82"&&(x.certStatus="unknown")}catch{}try{var T=p(t,0,[1,0,1,0,0,2,0,2]);x.thisUpdate=Qe(u(t,T))}catch{}try{var B=p(t,0,[1,0,1,0,0,2,0,3]);t.substr(B,2)==="a0"&&(x.nextUpdate=Qe(a(t,B,[0])))}catch{}return x},g.asn1.ocsp.OCSPParser=function(){var t=Error,n=Oe,a=new n,c=Ee,p=c.getV,u=c.getTLV,x=c.getIdxbyList,S=c.getVbyList,O=c.getTLVbyList,T=c.getVbyListEx,B=c.getTLVbyListEx,N=c.getChildIdx;this.getOCSPRequest=function(_){var I=N(_,0);if(I.length!=1&&I.length!=2)throw new t("wrong number elements: "+I.length);var P=this.getTBSRequest(u(_,I[0]));return P},this.getTBSRequest=function(_){var I={},P=B(_,0,[0],"30");I.array=this.getRequestList(P);var A=B(_,0,["[2]",0],"30");return A!=null&&(I.ext=a.getExtParamArray(A)),I},this.getRequestList=function(_){for(var I=[],P=N(_,0),A=0;A<P.length;A++){var _=u(_,P[A]);I.push(this.getRequest(_))}return I},this.getRequest=function(_){var I=N(_,0);if(I.length!=1&&I.length!=2)throw new t("wrong number elements: "+I.length);var P=this.getCertID(u(_,I[0]));if(I.length==2){var A=x(_,0,[1,0]);P.ext=a.getExtParamArray(u(_,A))}return P},this.getCertID=function(_){var I=N(_,0);if(I.length!=4)throw new t("wrong number elements: "+I.length);var P=new n,A={};return A.alg=P.getAlgorithmIdentifierName(u(_,I[0])),A.issname=p(_,I[1]),A.isskey=p(_,I[2]),A.sbjsn=p(_,I[3]),A},this.getOCSPResponse=function(_){var I=N(_,0),P,A=p(_,I[0]),L=parseInt(A);if(I.length==1)return{resstatus:L};var K=O(_,0,[1,0]);return P=this.getResponseBytes(K),P.resstatus=L,P},this.getResponseBytes=function(_){var I=N(_,0),P,A=O(_,0,[1,0]);P=this.getBasicOCSPResponse(A);var L=p(_,I[0]);return P.restype=g.asn1.x509.OID.oid2name(tn(L)),P},this.getBasicOCSPResponse=function(_){var I=N(_,0),P;P=this.getResponseData(u(_,I[0]));var A=new Oe;P.alg=A.getAlgorithmIdentifierName(u(_,I[1]));var L=p(_,I[2]);P.sighex=L.substr(2);var K=T(_,0,["[0]"]);if(K!=null){for(var ie=N(K,0),ae=[],se=0;se<ie.length;se++){var ce=u(K,ie[se]);ae.push(ce)}P.certs=ae}return P},this.getResponseData=function(_){var I=N(_,0),P=I.length,A={},L=0;_.substr(I[0],2)=="a0"&&L++,A.respid=this.getResponderID(u(_,I[L++]));var K=p(_,I[L++]);if(A.prodat=Qe(K),A.array=this.getSingleResponseList(u(_,I[L++])),_.substr(I[P-1],2)=="a1"){var ie=O(_,I[P-1],[0]),ae=new Oe;A.ext=ae.getExtParamArray(ie)}return A},this.getResponderID=function(_){var I={};if(_.substr(0,2)=="a2"){var P=S(_,0,[0]);I.key=P}if(_.substr(0,2)=="a1"){var A=O(_,0,[0]),L=new Oe;I.name=L.getX500Name(A)}return I},this.getSingleResponseList=function(_){for(var I=N(_,0),P=[],A=0;A<I.length;A++){var L=this.getSingleResponse(u(_,I[A]));P.push(L)}return P},this.getSingleResponse=function(_){var I=N(_,0),P={},A=this.getCertID(u(_,I[0]));P.certid=A;var L=this.getCertStatus(u(_,I[1]));if(P.status=L,_.substr(I[2],2)=="18"){var K=p(_,I[2]);P.thisupdate=Qe(K)}for(var ie=3;ie<I.length;ie++){if(_.substr(I[ie],2)=="a0"){var ae=S(_,I[ie],[0],"18");P.nextupdate=Qe(ae)}if(_.substr(I[ie],2)=="a1"){var se=new Oe,ce=O(_,0,[ie,0]);P.ext=se.getExtParamArray(ce)}}return P},this.getCertStatus=function(_){var I={};if(_=="8000")return{status:"good"};if(_=="8200")return{status:"unknown"};if(_.substr(0,2)=="a1"){I.status="revoked";var P=S(_,0,[0]),A=Qe(P);I.time=A}return I}};var g;(typeof g>"u"||!g)&&(g={}),(typeof g.lang>"u"||!g.lang)&&(g.lang={}),g.lang.String=function(){};function ta(t){for(var n=new Array,a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n}function ia(t){for(var n="",a=0;a<t.length;a++)n=n+String.fromCharCode(t[a]);return n}function Gr(t){for(var n="",a=0;a<t.length;a++){var c=t[a].toString(16);c.length==1&&(c="0"+c),n=n+c}return n}function qt(t){return Gr(ta(t))}function Id(t){return C(qt(t))}function Dd(t){return dr(C(qt(t)))}function Ad(t){return ia(v(wr(t)))}function dr(t){return t=t.replace(/\=/g,""),t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t}function wr(t){return t.length%4==2?t=t+"==":t.length%4==3&&(t=t+"="),t=t.replace(/-/g,"+"),t=t.replace(/_/g,"/"),t}function _t(t){return t.length%2==1&&(t="0"+t),dr(C(t))}function it(t){return h(wr(t))}var Cr,ui;typeof Buffer=="function"?(Cr=function(t){return dr(Buffer.from(t,"utf8").toString("base64"))},ui=function(t){return Buffer.from(wr(t),"base64").toString("utf8")}):(Cr=function(t){return _t(Qr(en(t)))},ui=function(t){return decodeURIComponent(Yr(it(t)))});function Fd(t){return C(Qr(en(t)))}function kd(t){return decodeURIComponent(Yr(h(t)))}function Jr(t){return Qr(en(t)).toLowerCase()}function Qe(t){try{return decodeURIComponent(Yr(t))}catch{return null}}function Od(t){return Qe(Md(t))}function Md(t){for(var n=t.match(/.{1,2}/g),a=[],c=0;c<n.length;c++){var p=parseInt(n[c],16);161<=p&&p<=191?(a.push("c2"),a.push(n[c])):192<=p&&p<=255?(a.push("c3"),a.push((p-64).toString(16))):a.push(n[c])}return a.join("")}function Vt(t){for(var n="",a=0;a<t.length-1;a+=2)n+=String.fromCharCode(parseInt(t.substr(a,2),16));return n}function Si(t){for(var n="",a=0;a<t.length;a++)n+=("0"+t.charCodeAt(a).toString(16)).slice(-2);return n}function Qn(t){return C(t)}function Nd(t){return Xr(Qn(t),64)}function Xr(t,n){return t=t.replace(new RegExp("(.{"+n+"})","g"),`$1\r
`),t=t.replace(/\s+$/,""),t}function ra(t){var n=t.replace(/[^0-9A-Za-z\/+=]*/g,""),a=h(n);return a}function Ld(t,n){return"-----BEGIN "+n+`-----\r
`+Xr(t,64)+`\r
-----END `+n+`-----\r
`}function Tt(t,n){return"-----BEGIN "+n+`-----\r
`+Xr(Qn(t),64)+`\r
-----END `+n+`-----\r
`}function ut(t,n){if(t.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return n!==void 0?(t=t.replace(new RegExp("^[^]*-----BEGIN "+n+"-----"),""),t=t.replace(new RegExp("-----END "+n+"-----[^]*$"),"")):(t=t.replace(/^[^]*-----BEGIN [^-]+-----/,""),t=t.replace(/-----END [^-]+-----[^]*$/,"")),ra(t)}function jd(t){return t.indexOf("-----BEGIN ")==-1||t.indexOf("-----END ")==-1?null:(t=t.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),t=t.replace(/-----END [\s\S]+$/m,""),t=t.replace(/\s+/g,""),t.match(/^[0-9a-zA-Z+/=]+$/)?t:null)}function Bd(t){if(t.length%2!=0)throw"input is not even length";if(t.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var n=new ArrayBuffer(t.length/2),a=new DataView(n),c=0;c<t.length/2;c++)a.setUint8(c,parseInt(t.substr(c*2,2),16));return n}function Hd(t){for(var n="",a=new DataView(t),c=0;c<t.byteLength;c++)n+=("00"+a.getUint8(c).toString(16)).slice(-2);return n}function Yn(t){var n,a,c,p,u,x,S,O,T,B;if(t=sa(t),B=t.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),B)return n=parseInt(B[1]),a=parseInt(B[2])-1,c=parseInt(B[3]),p=parseInt(B[4]),u=parseInt(B[5]),x=parseInt(B[6]),S=0,O=B[7],O!==""&&(T=(O.substr(1)+"00").substr(0,3),S=parseInt(T)),Date.UTC(n,a,c,p,u,x,S);throw new Error("unsupported zulu format: "+t)}function Ud(t){var n=new Date(t),a=("0000"+n.getUTCFullYear()).slice(-4),c=("00"+(n.getUTCMonth()+1)).slice(-2),p=("00"+n.getUTCDate()).slice(-2),u=("00"+n.getUTCHours()).slice(-2),x=("00"+n.getUTCMinutes()).slice(-2),S=("00"+n.getUTCSeconds()).slice(-2),O=("000"+n.getUTCMilliseconds()).slice(-3);return O=O.replace(/0+$/,""),O=O!=""?"."+O:O,a+c+p+u+x+S+O+"Z"}function na(t){return Math.round(Yn(t)/1e3)}function qd(t){return new Date(Yn(t))}function Vd(t,n,a){var c,p=t.getUTCFullYear();if(n){if(p<1950||2049<p)throw"not proper year for UTCTime: "+p;c=(""+p).slice(-2)}else c=("000"+p).slice(-4);if(c+=("0"+(t.getUTCMonth()+1)).slice(-2),c+=("0"+t.getUTCDate()).slice(-2),c+=("0"+t.getUTCHours()).slice(-2),c+=("0"+t.getUTCMinutes()).slice(-2),c+=("0"+t.getUTCSeconds()).slice(-2),a){var u=t.getUTCMilliseconds();u!==0&&(u=("00"+u).slice(-3),u=u.replace(/0+$/g,""),c+="."+u)}return c+="Z",c}function sa(t){return t.match(/^[0-9]{12}Z$/)||t.match(/^[0-9]{12}[.][0-9]*Z$/)?t.match(/^[0-4]/)?"20"+t:"19"+t:t}function Qr(t){return t.replace(/%/g,"")}function Yr(t){return t.replace(/(..)/g,"%$1")}function Zn(t){var n="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw n;t=t.toLowerCase();var a=t.split(":").length-1;if(a<2)throw n;var c=":".repeat(7-a+2);t=t.replace("::",c);var p=t.split(":");if(p.length!=8)throw n;for(var u=0;u<8;u++)p[u]=("0000"+p[u]).slice(-4);return p.join("")}function es(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+t);t=t.toLowerCase();var n=t.match(/.{1,4}/g);n=n.map(function(p){return p.replace(/^0+/,"")}),n=n.map(function(p){return p==""?"0":p}),t=":"+n.join(":")+":";var a=t.match(/:(0:){2,}/g);if(a==null)return t.slice(1,-1);var c=a.sort().slice(-1)[0];return t=t.replace(c.substr(0,c.length-1),":"),t.substr(0,2)!="::"&&(t=t.substr(1)),t.substr(-2,2)!="::"&&(t=t.substr(0,t.length-1)),t}function Zr(t){var n=new Error("malformed hex value");if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw n;if(t.length==8){var a;try{return a=parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16),a}catch{throw n}}else if(t.length==16)try{return Zr(t.substr(0,8))+"/"+aa(t.substr(8))}catch{throw n}else{if(t.length==32)return es(t);if(t.length==64){try{return es(t.substr(0,32))+"/"+aa(t.substr(32))}catch{throw n}return}else return t}}function aa(t){var n=new Error("malformed mask"),a;try{a=new E(t,16).toString(2)}catch{throw n}if(!a.match(/^1*0*$/))throw n;return a.replace(/0+$/,"").length}function ts(t){var n=new Error("malformed IP address");if(t=t.toLowerCase(t),!t.match(/^[0-9a-f.:/]+$/))throw n;if(t.match(/^[0-9.]+$/)){var a=t.split(".");if(a.length!==4)throw n;var c="";try{for(var p=0;p<4;p++){var u=parseInt(a[p]);c+=("0"+u.toString(16)).slice(-2)}return c}catch{throw n}}else if(t.match(/^[0-9.]+\/[0-9]+$/)){var x=t.split("/");return ts(x[0])+oa(parseInt(x[1]),32)}else{if(t.match(/^[0-9a-f:]+$/)&&t.indexOf(":")!==-1)return Zn(t);if(t.match(/^[0-9a-f:]+\/[0-9]+$/)&&t.indexOf(":")!==-1){var x=t.split("/");return Zn(x[0])+oa(parseInt(x[1]),128)}else throw n}}function oa(t,n){if(n==32&&t==0)return"00000000";if(n==128&&t==0)return"00000000000000000000000000000000";var a=Array(t+1).join("1")+Array(n-t+1).join("0");return new E(a,2).toString(16)}function is(t){function n(p){var u=parseInt(p.substr(0,2),16),x=parseInt(p.substr(2),16);if(u==0&x<128)return String.fromCharCode(x);if(u<8){var S=192|(u&7)<<3|(x&192)>>6,O=128|x&63;return Qe(S.toString(16)+O.toString(16))}var S=224|(u&240)>>4,O=128|(u&15)<<2|(x&192)>>6,T=128|x&63;return Qe(S.toString(16)+O.toString(16)+T.toString(16))}var a=t.match(/.{4}/g),c=a.map(n);return c.join("")}function en(t){for(var n=encodeURIComponent(t),a="",c=0;c<n.length;c++)n[c]=="%"?(a=a+n.substr(c,3),c=c+2):a=a+"%"+qt(n[c]);return a}function Kd(t){return t=t.replace(/\r\n/mg,`
`),t}function zd(t){return t=t.replace(/\r\n/mg,`
`),t=t.replace(/\n/mg,`\r
`),t}g.lang.String.isInteger=function(t){return t.match(/^[0-9]+$/)?!0:!!t.match(/^-[0-9]+$/)},g.lang.String.isHex=function(t){return ca(t)};function ca(t){return!!(t.length%2==0&&(t.match(/^[0-9a-f]+$/)||t.match(/^[0-9A-F]+$/)))}g.lang.String.isBase64=function(t){return t=t.replace(/\s+/g,""),!!(t.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&t.length%4==0)},g.lang.String.isBase64URL=function(t){return t.match(/[+/=]/)?!1:(t=wr(t),g.lang.String.isBase64(t))};function rs(t){return!!t.match(/^[0-9A-Za-z-_.]+$/)}g.lang.String.isIntegerArray=function(t){return t=t.replace(/\s+/g,""),!!t.match(/^\[[0-9,]+\]$/)},g.lang.String.isPrintable=function(t){return t.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},g.lang.String.isIA5=function(t){return t.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},g.lang.String.isMail=function(t){return t.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function ns(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}function Wd(t){t=t.replace(/^\s*\[\s*/,""),t=t.replace(/\s*\]\s*$/,""),t=t.replace(/\s*/g,"");try{var n=t.split(/,/).map(function(a,c,p){var u=parseInt(a);if(u<0||255<u)throw"integer not in range 0-255";var x=("00"+u.toString(16)).slice(-2);return x}).join("");return n}catch(a){throw"malformed integer array string: "+a}}var $d=function(t,n){var a=t.length;t.length>n.length&&(a=n.length);for(var c=0;c<a;c++)if(t.charCodeAt(c)!=n.charCodeAt(c))return c;return t.length!=n.length?a:-1};function la(t){var n=function(S){var O=S.toString(16);return O.length==1&&(O="0"+O),O},a=function(S){var O="",T=parseInt(S,10),B=T.toString(2),N=7-B.length%7;N==7&&(N=0);for(var _="",I=0;I<N;I++)_+="0";B=_+B;for(var I=0;I<B.length-1;I+=7){var P=B.substr(I,7);I!=B.length-7&&(P="1"+P),O+=n(parseInt(P,2))}return O};try{if(!t.match(/^[0-9.]+$/))return null;var c="",p=t.split("."),u=parseInt(p[0],10)*40+parseInt(p[1],10);c+=n(u),p.splice(0,2);for(var x=0;x<p.length;x++)c+=a(p[x]);return c}catch{return null}}function tn(t){if(!ca(t))return null;try{var n=[],a=t.substr(0,2),c=parseInt(a,16);n[0]=new String(Math.floor(c/40)),n[1]=new String(c%40);for(var p=t.substr(2),u=[],x=0;x<p.length/2;x++)u.push(parseInt(p.substr(x*2,2),16));for(var S=[],O="",x=0;x<u.length;x++)u[x]&128?O=O+rn((u[x]&127).toString(2),7):(O=O+rn((u[x]&127).toString(2),7),S.push(new String(parseInt(O,2))),O="");var T=n.join(".");return S.length>0&&(T=T+"."+S.join(".")),T}catch{return null}}function da(t){var n=new E(String(t),10);return xr(n)}function xr(t){var n=t.toString(16);if(n.substr(0,1)!="-")return n.length%2==1?n="0"+n:n.match(/^[0-7]/)||(n="00"+n),n;var a=n.substr(1),c=a.length;c%2==1?c+=1:n.match(/^[0-7]/)||(c+=2);for(var p="",u=0;u<c;u++)p+="f";var x=new E(p,16),S=x.xor(t).add(E.ONE);return n=S.toString(16).replace(/^-/,""),n}var rn=function(t,n,a){return a==null&&(a="0"),t.length>=n?t:new Array(n-t.length+1).join(a)+t};function ua(t){if(t.length%2!=0||(t=t.toLowerCase(),t.match(/^[0-9a-f]+$/)==null))return-1;try{var n=t.substr(0,2);if(n=="00")return parseInt(t.substr(2),16);var a=parseInt(n,16);if(a>7)return-1;var c=t.substr(2),p=parseInt(c,16).toString(2);p=="0"&&(p="00000000"),p=p.slice(0,0-a);var u=parseInt(p,2);return u==NaN?-1:u}catch{return-1}}function ha(t){if(typeof t!="number"||t<0)return null;var n=Number(t).toString(2),a=8-n.length%8;a==8&&(a=0),n=n+rn("",a,"0");var c=parseInt(n,2).toString(16);c.length%2==1&&(c="0"+c);var p="0"+a;return p+c}function pa(t){if(typeof t!="string"||t.length%2!=0||!t.match(/^[0-9a-f]+$/))return null;try{var n=parseInt(t.substr(0,2),16);if(n<0||7<n)return null;for(var a=t.substr(2),c="",p=0;p<a.length;p+=2){var u=a.substr(p,2),x=parseInt(u,16).toString(2);x=("0000000"+x).slice(-8),c+=x}return c.substr(0,c.length-n)}catch{return null}}function Gd(t){if(typeof t!="string"||t.match(/^[01]+$/)==null)return null;try{var n=parseInt(t,2);return ha(n)}catch{return null}}function nn(t,n){for(var a=0,c=0;c<t.length;c++)a|=1<<n[t[c]];for(var p=a.toString(2),u="",c=p.length-1;c>=0;c--)u+=p[c];return u}function ht(t,c,a){if(typeof t=="object"){for(var c=String(c).split("."),p=0;p<c.length&&t;p++){var u=c[p];u.match(/^[0-9]+$/)&&(u=parseInt(u)),t=t[u]}return t||t===!1?t:a}}function ye(t,n){var a=function(){};a.prototype=n.prototype,t.prototype=new a,t.prototype.constructor=t,t.superclass=n.prototype,n.prototype.constructor==Object.prototype.constructor&&(n.prototype.constructor=n)}(typeof g>"u"||!g)&&(g={}),(typeof g.crypto>"u"||!g.crypto)&&(g.crypto={}),g.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:l.algo.MD5,sha1:l.algo.SHA1,sha224:l.algo.SHA224,sha256:l.algo.SHA256,sha384:l.algo.SHA384,sha512:l.algo.SHA512,ripemd160:l.algo.RIPEMD160},this.getDigestInfoHex=function(t,n){if(typeof this.DIGESTINFOHEAD[n]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+n;return this.DIGESTINFOHEAD[n]+t},this.getPaddedDigestInfoHex=function(t,n,a){var c=this.getDigestInfoHex(t,n),p=a/4;if(c.length+22>p)throw"key is too short for SigAlg: keylen="+a+","+n;for(var u="0001",x="00"+c,S="",O=p-u.length-x.length,T=0;T<O;T+=2)S+="ff";var B=u+S+x;return B},this.hashString=function(t,n){var a=new g.crypto.MessageDigest({alg:n});return a.digestString(t)},this.hashHex=function(t,n){var a=new g.crypto.MessageDigest({alg:n});return a.digestHex(t)},this.sha1=function(t){return this.hashString(t,"sha1")},this.sha256=function(t){return this.hashString(t,"sha256")},this.sha256Hex=function(t){return this.hashHex(t,"sha256")},this.sha512=function(t){return this.hashString(t,"sha512")},this.sha512Hex=function(t){return this.hashHex(t,"sha512")},this.isKey=function(t){return t instanceof Me||t instanceof g.crypto.DSA||t instanceof g.crypto.ECDSA}},g.crypto.Util.md5=function(t){var n=new g.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return n.digestString(t)},g.crypto.Util.ripemd160=function(t){var n=new g.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return n.digestString(t)},g.crypto.Util.SECURERANDOMGEN=new lr,g.crypto.Util.getRandomHexOfNbytes=function(t){var n=new Array(t);return g.crypto.Util.SECURERANDOMGEN.nextBytes(n),Gr(n)},g.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new E(g.crypto.Util.getRandomHexOfNbytes(t),16)},g.crypto.Util.getRandomHexOfNbits=function(t){var n=t%8,a=(t-n)/8,c=new Array(a+1);return g.crypto.Util.SECURERANDOMGEN.nextBytes(c),c[0]=(255<<n&255^255)&c[0],Gr(c)},g.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new E(g.crypto.Util.getRandomHexOfNbits(t),16)},g.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var n=t.bitLength();;){var a=g.crypto.Util.getRandomBigIntegerOfNbits(n);if(t.compareTo(a)!=-1)return a}},g.crypto.Util.getRandomBigIntegerMinToMax=function(t,n){var a=t.compareTo(n);if(a==1)throw"biMin is greater than biMax";if(a==0)return t;var c=n.subtract(t),p=g.crypto.Util.getRandomBigIntegerZeroToMax(c);return p.add(t)},g.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(n,a){if(n=g.crypto.MessageDigest.getCanonicalAlgName(n),n!==null&&a===void 0&&(a=g.crypto.Util.DEFAULTPROVIDER[n]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)!=-1&&a=="cryptojs"){try{this.md=g.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n].create()}catch(c){throw"setAlgAndProvider hash alg set fail alg="+n+"/"+c}this.updateString=function(c){this.md.update(c)},this.updateHex=function(c){var p=l.enc.Hex.parse(c);this.md.update(p)},this.digest=function(){var c=this.md.finalize();return c.toString(l.enc.Hex)},this.digestString=function(c){return this.updateString(c),this.digest()},this.digestHex=function(c){return this.updateHex(c),this.digest()}}if(":sha256:".indexOf(n)!=-1&&a=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(c){throw"setAlgAndProvider hash alg set fail alg="+n+"/"+c}this.updateString=function(c){this.md.update(c)},this.updateHex=function(c){var p=sjcl.codec.hex.toBits(c);this.md.update(p)},this.digest=function(){var c=this.md.finalize();return sjcl.codec.hex.fromBits(c)},this.digestString=function(c){return this.updateString(c),this.digest()},this.digestHex=function(c){return this.updateHex(c),this.digest()}}},this.updateString=function(n){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(n){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(n){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(n){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},t!==void 0&&t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=g.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},g.crypto.MessageDigest.getCanonicalAlgName=function(t){return typeof t=="string"&&(t=t.toLowerCase(),t=t.replace(/-/,"")),t},g.crypto.MessageDigest.getHashLength=function(t){var n=g.crypto.MessageDigest,a=n.getCanonicalAlgName(t);if(n.HASHLENGTH[a]===void 0)throw"not supported algorithm: "+t;return n.HASHLENGTH[a]},g.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},g.crypto.Mac=function(t){this.setAlgAndProvider=function(n,a){if(n=n.toLowerCase(),n==null&&(n="hmacsha1"),n=n.toLowerCase(),n.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+n;a===void 0&&(a=g.crypto.Util.DEFAULTPROVIDER[n]),this.algProv=n+"/"+a;var c=n.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)!=-1&&a=="cryptojs"){try{var p=g.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c];this.mac=l.algo.HMAC.create(p,this.pass)}catch(u){throw"setAlgAndProvider hash alg set fail hashAlg="+c+"/"+u}this.updateString=function(u){this.mac.update(u)},this.updateHex=function(u){var x=l.enc.Hex.parse(u);this.mac.update(x)},this.doFinal=function(){var u=this.mac.finalize();return u.toString(l.enc.Hex)},this.doFinalString=function(u){return this.updateString(u),this.doFinal()},this.doFinalHex=function(u){return this.updateHex(u),this.doFinal()}}},this.updateString=function(n){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(n){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(n){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(n){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(n){if(typeof n=="string"){var a=n;(n.length%2==1||!n.match(/^[0-9A-Fa-f]+$/))&&(a=Si(n)),this.pass=l.enc.Hex.parse(a);return}if(typeof n!="object")throw"KJUR.crypto.Mac unsupported password type: "+n;var a=null;if(n.hex!==void 0){if(n.hex.length%2!=0||!n.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+n.hex;a=n.hex}if(n.utf8!==void 0&&(a=Jr(n.utf8)),n.rstr!==void 0&&(a=Si(n.rstr)),n.b64!==void 0&&(a=h(n.b64)),n.b64u!==void 0&&(a=it(n.b64u)),a==null)throw"KJUR.crypto.Mac unsupported password type: "+n;this.pass=l.enc.Hex.parse(a)},t!==void 0&&(t.pass!==void 0&&this.setPassword(t.pass),t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=g.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},g.crypto.Signature=function(t){var n=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(a,c){for(var p="",u=c/4-a.length,x=0;x<u;x++)p=p+"0";return p+a},this.setAlgAndProvider=function(a,c){if(this._setAlgNames(),c!="cryptojs/jsrsa")throw new Error("provider not supported: "+c);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new g.crypto.MessageDigest({alg:this.mdAlgName})}catch(p){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+p)}this.init=function(p,u){var x=null;try{u===void 0?x=qe.getKey(p):x=qe.getKey(p,u)}catch(S){throw"init failed:"+S}if(x.isPrivate===!0)this.prvKey=x,this.state="SIGN";else if(x.isPublic===!0)this.pubKey=x,this.state="VERIFY";else throw"init failed.:"+x},this.updateString=function(p){this.md.updateString(p)},this.updateHex=function(p){this.md.updateHex(p)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&g.crypto.ECDSA!==void 0&&(this.prvKey=new g.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Me&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Me&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof g.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof g.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(p){return this.updateString(p),this.sign()},this.signHex=function(p){return this.updateHex(p),this.sign()},this.verify=function(p){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&g.crypto.ECDSA!==void 0&&(this.pubKey=new g.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Me&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,p,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Me&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,p);if(g.crypto.ECDSA!==void 0&&this.pubKey instanceof g.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,p);if(g.crypto.DSA!==void 0&&this.pubKey instanceof g.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,p);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,c){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,t!==void 0&&(t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0?this.provName=g.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),t.psssaltlen!==void 0&&(this.pssSaltLen=t.psssaltlen),t.prvkeypem!==void 0)){if(t.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var n=qe.getKey(t.prvkeypem);this.init(n)}catch(a){throw"fatal error to load pem private key: "+a}}},g.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof g>"u"||!g)&&(g={}),(typeof g.crypto>"u"||!g.crypto)&&(g.crypto={}),g.crypto.ECDSA=function(t){var n="secp256r1",a=Error,c=E,p=We,u=g.crypto.ECDSA,x=g.crypto.ECParameterDB,S=u.getName,O=Ee,T=O.getVbyListEx,B=O.isASN1HEX,N=new lr;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(_){return new c(_.bitLength(),N).mod(_.subtract(c.ONE)).add(c.ONE)},this.setNamedCurve=function(_){this.ecparams=x.getByName(_),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=_},this.setPrivateKeyHex=function(_){this.isPrivate=!0,this.prvKeyHex=_},this.setPublicKeyHex=function(_){this.isPublic=!0,this.pubKeyHex=_},this.getPublicKeyXYHex=function(){var _=this.pubKeyHex;if(_.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var I=this.ecparams.keycharlen;if(_.length!==2+I*2)throw"malformed public key hex length";var P={};return P.x=_.substr(2,I),P.y=_.substr(2+I),P},this.getShortNISTPCurveName=function(){var _=this.curveName;return _==="secp256r1"||_==="NIST P-256"||_==="P-256"||_==="prime256v1"?"P-256":_==="secp384r1"||_==="NIST P-384"||_==="P-384"?"P-384":_==="secp521r1"||_==="NIST P-521"||_==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var _=this.ecparams.n,I=this.getBigRandom(_),P=this.ecparams.keycharlen,A=("0000000000"+I.toString(16)).slice(-P);this.setPrivateKeyHex(A);var L=this.generatePublicKeyHex();return{ecprvhex:A,ecpubhex:L}},this.generatePublicKeyHex=function(){var _=new c(this.prvKeyHex,16),I=this.ecparams.G.multiply(_),P=I.getX().toBigInteger(),A=I.getY().toBigInteger(),L=this.ecparams.keycharlen,K=("0000000000"+P.toString(16)).slice(-L),ie=("0000000000"+A.toString(16)).slice(-L),ae="04"+K+ie;return this.setPublicKeyHex(ae),ae},this.signWithMessageHash=function(_){return this.signHex(_,this.prvKeyHex)},this.signHex=function(_,I){var P=new c(I,16),A=this.ecparams.n,L=new c(_.substring(0,this.ecparams.keycharlen),16);do var K=this.getBigRandom(A),ie=this.ecparams.G,ae=ie.multiply(K),se=ae.getX().toBigInteger().mod(A);while(se.compareTo(c.ZERO)<=0);var ce=K.modInverse(A).multiply(L.add(P.multiply(se))).mod(A);return u.biRSSigToASN1Sig(se,ce)},this.sign=function(_,I){var P=I,A=this.ecparams.n,L=c.fromByteArrayUnsigned(_);do var K=this.getBigRandom(A),ie=this.ecparams.G,ae=ie.multiply(K),se=ae.getX().toBigInteger().mod(A);while(se.compareTo(E.ZERO)<=0);var ce=K.modInverse(A).multiply(L.add(P.multiply(se))).mod(A);return this.serializeSig(se,ce)},this.verifyWithMessageHash=function(_,I){return this.verifyHex(_,I,this.pubKeyHex)},this.verifyHex=function(_,I,P){try{var A,L,K=u.parseSigHex(I);A=K.r,L=K.s;var ie=p.decodeFromHex(this.ecparams.curve,P),ae=new c(_.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(ae,A,L,ie)}catch{return!1}},this.verify=function(_,I,P){var A,L;if(Bitcoin.Util.isArray(I)){var K=this.parseSig(I);A=K.r,L=K.s}else if(typeof I=="object"&&I.r&&I.s)A=I.r,L=I.s;else throw"Invalid value for signature";var ie;if(P instanceof We)ie=P;else if(Bitcoin.Util.isArray(P))ie=p.decodeFrom(this.ecparams.curve,P);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var ae=c.fromByteArrayUnsigned(_);return this.verifyRaw(ae,A,L,ie)},this.verifyRaw=function(_,I,P,A){var L=this.ecparams.n,K=this.ecparams.G;if(I.compareTo(c.ONE)<0||I.compareTo(L)>=0||P.compareTo(c.ONE)<0||P.compareTo(L)>=0)return!1;var ie=P.modInverse(L),ae=_.multiply(ie).mod(L),se=I.multiply(ie).mod(L),ce=K.multiply(ae).add(A.multiply(se)),z=ce.getX().toBigInteger().mod(L);return z.equals(I)},this.serializeSig=function(_,I){var P=_.toByteArraySigned(),A=I.toByteArraySigned(),L=[];return L.push(2),L.push(P.length),L=L.concat(P),L.push(2),L.push(A.length),L=L.concat(A),L.unshift(L.length),L.unshift(48),L},this.parseSig=function(_){var I;if(_[0]!=48)throw new Error("Signature not a valid DERSequence");if(I=2,_[I]!=2)throw new Error("First element in signature must be a DERInteger");var P=_.slice(I+2,I+2+_[I+1]);if(I+=2+_[I+1],_[I]!=2)throw new Error("Second element in signature must be a DERInteger");var A=_.slice(I+2,I+2+_[I+1]);I+=2+_[I+1];var L=c.fromByteArrayUnsigned(P),K=c.fromByteArrayUnsigned(A);return{r:L,s:K}},this.parseSigCompact=function(_){if(_.length!==65)throw"Signature has the wrong length";var I=_[0]-27;if(I<0||I>7)throw"Invalid signature type";var P=this.ecparams.n,A=c.fromByteArrayUnsigned(_.slice(1,33)).mod(P),L=c.fromByteArrayUnsigned(_.slice(33,65)).mod(P);return{r:A,s:L,i:I}},this.readPKCS5PrvKeyHex=function(_){if(B(_)===!1)throw new Error("not ASN.1 hex string");var I,P,A;try{I=T(_,0,["[0]",0],"06"),P=T(_,0,[1],"04");try{A=T(_,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=S(I),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(A),this.setPrivateKeyHex(P),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(_){if(B(_)===!1)throw new a("not ASN.1 hex string");var I,P,A,L;try{I=T(_,0,[1,0],"06"),P=T(_,0,[1,1],"06"),A=T(_,0,[2,0,1],"04");try{L=T(_,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new a("malformed PKCS#8 plain ECC private key")}if(this.curveName=S(P),this.curveName===void 0)throw new a("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(L),this.setPrivateKeyHex(A),this.isPublic=!1},this.readPKCS8PubKeyHex=function(_){if(B(_)===!1)throw new a("not ASN.1 hex string");var I,P,A;try{I=T(_,0,[0,0],"06"),P=T(_,0,[0,1],"06"),A=T(_,0,[1],"03")}catch{throw new a("malformed PKCS#8 ECC public key")}if(this.curveName=S(P),this.curveName===null)throw new a("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(A)},this.readCertPubKeyHex=function(_,I){if(B(_)===!1)throw new a("not ASN.1 hex string");var P,A;try{P=T(_,0,[0,5,0,1],"06"),A=T(_,0,[0,5,1],"03")}catch{throw new a("malformed X.509 certificate ECC public key")}if(this.curveName=S(P),this.curveName===null)throw new a("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(A)},t!==void 0&&t.curve!==void 0&&(this.curveName=t.curve),this.curveName===void 0&&(this.curveName=n),this.setNamedCurve(this.curveName),t!==void 0&&(t.prv!==void 0&&this.setPrivateKeyHex(t.prv),t.pub!==void 0&&this.setPublicKeyHex(t.pub))},g.crypto.ECDSA.parseSigHex=function(t){var n=g.crypto.ECDSA.parseSigHexInHexRS(t),a=new E(n.r,16),c=new E(n.s,16);return{r:a,s:c}},g.crypto.ECDSA.parseSigHexInHexRS=function(t){var n=Ee,a=n.getChildIdx,c=n.getV;if(n.checkStrictDER(t,0),t.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var p=a(t,0);if(p.length!=2)throw new Error("signature shall have two elements");var u=p[0],x=p[1];if(t.substr(u,2)!="02")throw new Error("1st item not ASN.1 integer");if(t.substr(x,2)!="02")throw new Error("2nd item not ASN.1 integer");var S=c(t,u),O=c(t,x);return{r:S,s:O}},g.crypto.ECDSA.asn1SigToConcatSig=function(t){var n=g.crypto.ECDSA.parseSigHexInHexRS(t),a=n.r,c=n.s;if(a.length>=130&&a.length<=134){if(a.length%2!=0)throw Error("unknown ECDSA sig r length error");if(c.length%2!=0)throw Error("unknown ECDSA sig s length error");a.substr(0,2)=="00"&&(a=a.substr(2)),c.substr(0,2)=="00"&&(c=c.substr(2));var p=Math.max(a.length,c.length);return a=("000000"+a).slice(-p),c=("000000"+c).slice(-p),a+c}if(a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),c.substr(0,2)=="00"&&c.length%32==2&&(c=c.substr(2)),a.length%32==30&&(a="00"+a),c.length%32==30&&(c="00"+c),a.length%32!=0)throw Error("unknown ECDSA sig r length error");if(c.length%32!=0)throw Error("unknown ECDSA sig s length error");return a+c},g.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var n=t.substr(0,t.length/2),a=t.substr(t.length/2);return g.crypto.ECDSA.hexRSSigToASN1Sig(n,a)},g.crypto.ECDSA.hexRSSigToASN1Sig=function(t,n){var a=new E(t,16),c=new E(n,16);return g.crypto.ECDSA.biRSSigToASN1Sig(a,c)},g.crypto.ECDSA.biRSSigToASN1Sig=function(t,n){var a=g.asn1,c=new a.DERInteger({bigint:t}),p=new a.DERInteger({bigint:n}),u=new a.DERSequence({array:[c,p]});return u.tohex()},g.crypto.ECDSA.getName=function(t){return t==="2b8104001f"?"secp192k1":t==="2a8648ce3d030107"?"secp256r1":t==="2b8104000a"?"secp256k1":t==="2b81040021"?"secp224r1":t==="2b81040022"?"secp384r1":t==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)!==-1?"secp256r1":"|secp256k1|".indexOf(t)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(t)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(t)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(t)!==-1?"secp521r1":null},(typeof g>"u"||!g)&&(g={}),(typeof g.crypto>"u"||!g.crypto)&&(g.crypto={}),g.crypto.ECParameterDB=new function(){var t={},n={};function a(c){return new E(c,16)}this.getByName=function(c){var p=c;if(typeof n[p]<"u"&&(p=n[c]),typeof t[p]<"u")return t[p];throw"unregistered EC curve name: "+p},this.regist=function(c,p,u,x,S,O,T,B,N,_,I,P){t[c]={};var A=a(u),L=a(x),K=a(S),ie=a(O),ae=a(T),se=new Di(A,L,K),ce=se.decodePointHex("04"+B+N);t[c].name=c,t[c].keylen=p,t[c].keycharlen=Math.ceil(p/8)*2,t[c].curve=se,t[c].G=ce,t[c].n=ie,t[c].h=ae,t[c].oid=I,t[c].info=P;for(var z=0;z<_.length;z++)n[_[z]]=c}},g.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),g.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),g.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),g.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),g.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),g.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),g.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),g.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),g.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),g.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof g>"u"||!g)&&(g={}),(typeof g.crypto>"u"||!g.crypto)&&(g.crypto={}),g.crypto.DSA=function(){var t=Ee;t.getVbyList;var n=t.getVbyListEx,a=t.isASN1HEX,c=E;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(p,u,x,S,O){this.isPrivate=!0,this.p=p,this.q=u,this.g=x,this.y=S,this.x=O},this.setPrivateHex=function(p,u,x,S,O){var T,B,N,_,I;T=new E(p,16),B=new E(u,16),N=new E(x,16),typeof S=="string"&&S.length>1?_=new E(S,16):_=null,I=new E(O,16),this.setPrivate(T,B,N,_,I)},this.setPublic=function(p,u,x,S){this.isPublic=!0,this.p=p,this.q=u,this.g=x,this.y=S,this.x=null},this.setPublicHex=function(p,u,x,S){var O,T,B,N;O=new E(p,16),T=new E(u,16),B=new E(x,16),N=new E(S,16),this.setPublic(O,T,B,N)},this.signWithMessageHash=function(p){var u=this.p,x=this.q,S=this.g;this.y;var O=this.x,T=g.crypto.Util.getRandomBigIntegerMinToMax(E.ONE.add(E.ONE),x.subtract(E.ONE)),B=p.substr(0,x.bitLength()/4),N=new E(B,16),_=S.modPow(T,u).mod(x),I=T.modInverse(x).multiply(N.add(O.multiply(_))).mod(x),P=g.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:_}},{int:{bigint:I}}]});return P},this.verifyWithMessageHash=function(p,u){var x=this.p,S=this.q,O=this.g,T=this.y,B=this.parseASN1Signature(u),N=B[0],_=B[1],I=p.substr(0,S.bitLength()/4),P=new E(I,16);if(E.ZERO.compareTo(N)>0||N.compareTo(S)>0||E.ZERO.compareTo(_)>=0||_.compareTo(S)>0)throw"invalid DSA signature";var A=_.modInverse(S),L=P.multiply(A).mod(S),K=N.multiply(A).mod(S),ie=O.modPow(L,x).multiply(T.modPow(K,x)).mod(x).mod(S);return ie.compareTo(N)==0},this.parseASN1Signature=function(p){try{var u=new c(n(p,0,[0],"02"),16),x=new c(n(p,0,[1],"02"),16);return[u,x]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(p){var u,x,S,O,T;if(a(p)===!1)throw new Error("not ASN.1 hex string");try{u=n(p,0,[1],"02"),x=n(p,0,[2],"02"),S=n(p,0,[3],"02"),O=n(p,0,[4],"02"),T=n(p,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(u,x,S,O,T)},this.readPKCS8PrvKeyHex=function(p){var u,x,S,O;if(a(p)===!1)throw new Error("not ASN.1 hex string");try{u=n(p,0,[1,1,0],"02"),x=n(p,0,[1,1,1],"02"),S=n(p,0,[1,1,2],"02"),O=n(p,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(u,x,S,null,O)},this.readPKCS8PubKeyHex=function(p){var u,x,S,O;if(a(p)===!1)throw new Error("not ASN.1 hex string");try{u=n(p,0,[0,1,0],"02"),x=n(p,0,[0,1,1],"02"),S=n(p,0,[0,1,2],"02"),O=n(p,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(u,x,S,O)},this.readCertPubKeyHex=function(p,u){var x,S,O,T;if(a(p)===!1)throw new Error("not ASN.1 hex string");try{x=n(p,0,[0,5,0,1,0],"02"),S=n(p,0,[0,5,0,1,1],"02"),O=n(p,0,[0,5,0,1,2],"02"),T=n(p,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(x,S,O,T)}};var qe=function(){var t=function(P,A,L){return c(l.AES,P,A,L)},n=function(P,A,L){return c(l.TripleDES,P,A,L)},a=function(P,A,L){return c(l.DES,P,A,L)},c=function(P,A,L,K){var ie=l.enc.Hex.parse(A),ae=l.enc.Hex.parse(L),se=l.enc.Hex.parse(K),ce={};ce.key=ae,ce.iv=se,ce.ciphertext=ie;var z=P.decrypt(ce,ae,{iv:se});return l.enc.Hex.stringify(z)},p=function(P,A,L){return S(l.AES,P,A,L)},u=function(P,A,L){return S(l.TripleDES,P,A,L)},x=function(P,A,L){return S(l.DES,P,A,L)},S=function(P,A,L,K){var ie=l.enc.Hex.parse(A),ae=l.enc.Hex.parse(L),se=l.enc.Hex.parse(K),ce=P.encrypt(ie,ae,{iv:se}),z=l.enc.Hex.parse(ce.toString()),G=l.enc.Base64.stringify(z);return G},O={"AES-256-CBC":{proc:t,eproc:p,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:p,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:p,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:n,eproc:u,keylen:24,ivlen:8},"DES-CBC":{proc:a,eproc:x,keylen:8,ivlen:8}},T=function(P){var A=l.lib.WordArray.random(P),L=l.enc.Hex.stringify(A);return L},B=function(P){var A={},L=P.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));L&&(A.cipher=L[1],A.ivsalt=L[2]);var K=P.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));K&&(A.type=K[1]);var ie=-1,ae=0;P.indexOf(`\r
\r
`)!=-1&&(ie=P.indexOf(`\r
\r
`),ae=2),P.indexOf(`

`)!=-1&&(ie=P.indexOf(`

`),ae=1);var se=P.indexOf("-----END");if(ie!=-1&&se!=-1){var ce=P.substring(ie+ae*2,se-ae);ce=ce.replace(/\s+/g,""),A.data=ce}return A},N=function(P,A,L){for(var K=L.substring(0,16),ie=l.enc.Hex.parse(K),ae=l.enc.Utf8.parse(A),se=O[P].keylen+O[P].ivlen,ce="",z=null;;){var G=l.algo.MD5.create();if(z!=null&&G.update(z),G.update(ae),G.update(ie),z=G.finalize(),ce=ce+l.enc.Hex.stringify(z),ce.length>=se*2)break}var Q={};return Q.keyhex=ce.substr(0,O[P].keylen*2),Q.ivhex=ce.substr(O[P].keylen*2,O[P].ivlen*2),Q},_=function(P,A,L,K){var ie=l.enc.Base64.parse(P),ae=l.enc.Hex.stringify(ie),se=O[A].proc,ce=se(ae,L,K);return ce},I=function(P,A,L,K){var ie=O[A].eproc,ae=ie(P,L,K);return ae};return{version:"1.0.0",parsePKCS5PEM:function(P){return B(P)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(P,A,L){return N(P,A,L)},decryptKeyB64:function(P,A,L,K){return _(P,A,L,K)},getDecryptedKeyHex:function(P,A){var L=B(P),K=L.cipher,ie=L.ivsalt,ae=L.data,se=N(K,A,ie),ce=se.keyhex,z=_(ae,K,ce,ie);return z},getEncryptedPKCS5PEMFromPrvKeyHex:function(P,A,L,K,ie){var W="";if((typeof K>"u"||K==null)&&(K="AES-256-CBC"),typeof O[K]>"u")throw new Error("KEYUTIL unsupported algorithm: "+K);if(typeof ie>"u"||ie==null){var ae=O[K].ivlen,se=T(ae);ie=se.toUpperCase()}var ce=N(K,L,ie),z=ce.keyhex,G=I(A,K,z,ie),Q=G.replace(/(.{64})/g,`$1\r
`),W="-----BEGIN "+P+` PRIVATE KEY-----\r
`;return W+=`Proc-Type: 4,ENCRYPTED\r
`,W+="DEK-Info: "+K+","+ie+`\r
`,W+=`\r
`,W+=Q,W+=`\r
-----END `+P+` PRIVATE KEY-----\r
`,W},getEncryptedPKCS8PEM:function(P,A,L){var K=this.getEncryptedPKCS8Hex(P,A,L);return Tt(K,"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(P,A,L){var K;L==null||L==null?K={}:K=JSON.parse(JSON.stringify(L)),K.plain=P,this.initPBES2Param(K),this.encryptPBES2Param(K,A);var ie=this.generatePBES2ASN1Param(K);return g.asn1.ASN1Util.newObject(ie).tohex()},initPBES2Param:function(P){if(ht(P,"encalg")==null&&(P.encalg="aes256-CBC"),ht(P,"iter")==null&&(P.iter=2048),ht(P,"prf")==null&&(P.prf="hmacWithSHA256"),ht(P,"salt")==null&&(P.salt=l.enc.Hex.stringify(l.lib.WordArray.random(8))),ht(P,"enciv")==null){var A;P.encalg=="des-EDE3-CBC"&&(A=8),P.encalg=="aes128-CBC"&&(A=16),P.encalg=="aes256-CBC"&&(A=16),P.enciv=l.enc.Hex.stringify(l.lib.WordArray.random(A))}},encryptPBES2Param:function(P,A){var L=qe.getDKFromPBES2Param(P,A);try{var K=g.crypto.Cipher.encrypt(P.plain,L,P.encalg,{iv:P.enciv})}catch{throw new Error("encrypt error: "+P.plain+" "+L+" "+P.encalg+" "+P.enciv)}P.enc=K},generatePBES2ASN1Param:function(P){var A={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:P.salt}},{int:{hex:da(P.iter)}}]}]},{seq:[{oid:P.encalg},{octstr:{hex:P.enciv}}]}]}]},{octstr:{hex:P.enc}}]};return P.prf!="hmacWithSHA1"&&A.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:P.prf},{null:""}]}),A},parseHexOfEncryptedPKCS8:function(P){var A=Ee,L=A.getChildIdx,K=A.getV,ie={},ae=L(P,0);if(ae.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+ae.length);ie.ciphertext=K(P,ae[1]);var se=L(P,ae[0]);if(se.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+se.length);if(K(P,se[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ce=L(P,se[1]);if(se.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ce.length);var z=L(P,ce[1]);if(z.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+z.length);if(K(P,z[0])!="2a864886f70d0307")throw"this only supports TripleDES";ie.encryptionSchemeAlg="TripleDES",ie.encryptionSchemeIV=K(P,z[1]);var G=L(P,ce[0]);if(G.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+G.length);if(K(P,G[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var Q=L(P,G[1]);if(Q.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+Q.length);ie.pbkdf2Salt=K(P,Q[0]);var W=K(P,Q[1]);try{ie.pbkdf2Iter=parseInt(W,16)}catch{throw new Error("malformed format pbkdf2Iter: "+W)}return ie},getPBKDF2KeyHexFromParam:function(P,A){var L=l.enc.Hex.parse(P.pbkdf2Salt),K=P.pbkdf2Iter,ie=l.PBKDF2(A,L,{keySize:192/32,iterations:K}),ae=l.enc.Hex.stringify(ie);return ae},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(P,A){var L=ut(P,"ENCRYPTED PRIVATE KEY"),K=this.parseHexOfEncryptedPKCS8(L),ie=qe.getPBKDF2KeyHexFromParam(K,A),ae={};ae.ciphertext=l.enc.Hex.parse(K.ciphertext);var se=l.enc.Hex.parse(ie),ce=l.enc.Hex.parse(K.encryptionSchemeIV),z=l.TripleDES.decrypt(ae,se,{iv:ce}),G=l.enc.Hex.stringify(z);return G},parsePBES2:function(P){var A=Ee.parse(P);if(ht(A,"seq.0.seq.0.oid")!="pkcs5PBES2"||ht(A,"seq.0.seq.1.seq.0.seq.0.oid")!="pkcs5PBKDF2")throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var L=ht(A,"seq.0.seq.1.seq.0.seq.1.seq");if(L==null)throw new Error("PBKDF2 parameter not found");var K=ht(L,"0.octstr.hex"),ie=ht(L,"1.int.hex"),ae=ht(L,"2.seq.0.oid","hmacWithSHA1"),se=-1;try{se=parseInt(ie,16)}catch{throw new Error("iter not proper value")}var ce=ht(A,"seq.0.seq.1.seq.1.seq.0.oid"),z=ht(A,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),G=ht(A,"seq.1.octstr.hex");if(ce==null||z==null||G==null)throw new Error("encalg, enciv or enc is undefined");var Q={salt:K,iter:se,prf:ae,encalg:ce,enciv:z,enc:G};return Q},getDKFromPBES2Param:function(P,A){var L={hmacWithSHA1:l.algo.SHA1,hmacWithSHA224:l.algo.SHA224,hmacWithSHA256:l.algo.SHA256,hmacWithSHA384:l.algo.SHA384,hmacWithSHA512:l.algo.SHA512},K={"des-EDE3-CBC":192/32,"aes128-CBC":128/32,"aes256-CBC":256/32},ie=L[P.prf];if(ie==null)throw new Error("unsupported prf");var ae=K[P.encalg];if(ae==null)throw new Error("unsupported encalg");var se=l.enc.Hex.parse(P.salt),ce=P.iter;try{var z=l.PBKDF2(A,se,{keySize:ae,iterations:ce,hasher:ie});return l.enc.Hex.stringify(z)}catch(G){throw new Error("PBKDF2 error: "+G+" "+JSON.stringify(P)+" "+A)}},getPlainHexFromEncryptedPKCS8PEM:function(P,A){if(P.indexOf("BEGIN ENCRYPTED PRIVATE KEY")==-1)throw new Error("not Encrypted PKCS#8 PEM string");var L=ut(P),K;try{K=qe.parsePBES2(L)}catch(ae){throw new Error("malformed PBES2 format: "+ae.message)}var ie=qe.getDKFromPBES2Param(K,A);return g.crypto.Cipher.decrypt(K.enc,ie,K.encalg,{iv:K.enciv})},getKeyFromEncryptedPKCS8PEM:function(P,A){var L=this.getPlainHexFromEncryptedPKCS8PEM(P,A),K=this.getKeyFromPlainPrivatePKCS8Hex(L);return K},parsePlainPrivatePKCS8Hex:function(P){var A=Ee,L=A.getChildIdx,K=A.getV,ie={};if(ie.algparam=null,P.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var ae=L(P,0);if(ae.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(P.substr(ae[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var se=L(P,ae[1]);if(se.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(P.substr(se[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(ie.algoid=K(P,se[0]),P.substr(se[1],2)=="06"&&(ie.algparam=K(P,se[1])),P.substr(ae[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return ie.keyidx=A.getVidx(P,ae[2]),ie},getKeyFromPlainPrivatePKCS8PEM:function(P){var A=ut(P,"PRIVATE KEY"),L=this.getKeyFromPlainPrivatePKCS8Hex(A);return L},getKeyFromPlainPrivatePKCS8Hex:function(P){var A=this.parsePlainPrivatePKCS8Hex(P),L;if(A.algoid=="2a864886f70d010101")L=new Me;else if(A.algoid=="2a8648ce380401")L=new g.crypto.DSA;else if(A.algoid=="2a8648ce3d0201")L=new g.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return L.readPKCS8PrvKeyHex(P),L},_getKeyFromPublicPKCS8Hex:function(P){var A,L=Ee.getVbyList(P,0,[0,0],"06");if(L==="2a864886f70d010101")A=new Me;else if(L==="2a8648ce380401")A=new g.crypto.DSA;else if(L==="2a8648ce3d0201")A=new g.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return A.readPKCS8PubKeyHex(P),A},parsePublicRawRSAKeyHex:function(P){var A=Ee,L=A.getChildIdx,K=A.getV,ie={};if(P.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var ae=L(P,0);if(ae.length!=2)throw new Error("malformed RSA key(code:002)");if(P.substr(ae[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(ie.n=K(P,ae[0]),P.substr(ae[1],2)!="02")throw new Error("malformed RSA key(code:004)");return ie.e=K(P,ae[1]),ie},parsePublicPKCS8Hex:function(P){var A=Ee,L=A.getChildIdx,K=A.getV,ie={};ie.algparam=null;var ae=L(P,0);if(ae.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+ae.length);var se=ae[0];if(P.substr(se,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ce=L(P,se);if(ce.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(P.substr(ce[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(ie.algoid=K(P,ce[0]),P.substr(ce[1],2)=="06"?ie.algparam=K(P,ce[1]):P.substr(ce[1],2)=="30"&&(ie.algparam={},ie.algparam.p=A.getVbyList(P,ce[1],[0],"02"),ie.algparam.q=A.getVbyList(P,ce[1],[1],"02"),ie.algparam.g=A.getVbyList(P,ce[1],[2],"02")),P.substr(ae[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return ie.key=K(P,ae[1]).substr(2),ie}}}();qe.getKey=function(t,n,a){var c=Ee,p=c.getChildIdx;c.getV;var u=c.getVbyList,x=g.crypto,S=x.ECDSA,O=x.DSA,T=Me,B=ut,N=qe;if(typeof T<"u"&&t instanceof T||typeof S<"u"&&t instanceof S||typeof O<"u"&&t instanceof O)return t;if(t.curve!==void 0&&t.xy!==void 0&&t.d===void 0)return new S({pub:t.xy,curve:t.curve});if(t.curve!==void 0&&t.d!==void 0)return new S({prv:t.d,curve:t.curve});if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d===void 0){var _=new T;return _.setPublic(t.n,t.e),_}if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.co!==void 0&&t.qi===void 0){var _=new T;return _.setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),_}if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p===void 0){var _=new T;return _.setPrivate(t.n,t.e,t.d),_}if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x===void 0){var _=new O;return _.setPublic(t.p,t.q,t.g,t.y),_}if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x!==void 0){var _=new O;return _.setPrivate(t.p,t.q,t.g,t.y,t.x),_}if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d===void 0){var _=new T;return _.setPublic(it(t.n),it(t.e)),_}if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.qi!==void 0){var _=new T;return _.setPrivateEx(it(t.n),it(t.e),it(t.d),it(t.p),it(t.q),it(t.dp),it(t.dq),it(t.qi)),_}if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0){var _=new T;return _.setPrivate(it(t.n),it(t.e),it(t.d)),_}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d===void 0){var I=new S({curve:t.crv}),P=I.ecparams.keycharlen,A=("0000000000"+it(t.x)).slice(-P),L=("0000000000"+it(t.y)).slice(-P),K="04"+A+L;return I.setPublicKeyHex(K),I}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d!==void 0){var I=new S({curve:t.crv}),P=I.ecparams.keycharlen,A=("0000000000"+it(t.x)).slice(-P),L=("0000000000"+it(t.y)).slice(-P),K="04"+A+L,ie=("0000000000"+it(t.d)).slice(-P);return I.setPublicKeyHex(K),I.setPrivateKeyHex(ie),I}if(a==="pkcs5prv"){var ae=t,c=Ee,se,_;if(se=p(ae,0),se.length===9)_=new T,_.readPKCS5PrvKeyHex(ae);else if(se.length===6)_=new O,_.readPKCS5PrvKeyHex(ae);else if(se.length>2&&ae.substr(se[1],2)==="04")_=new S,_.readPKCS5PrvKeyHex(ae);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return _}if(a==="pkcs8prv"){var _=N.getKeyFromPlainPrivatePKCS8Hex(t);return _}if(a==="pkcs8pub")return N._getKeyFromPublicPKCS8Hex(t);if(a==="x509pub")return Oe.getPublicKeyFromCertHex(t);if(t.indexOf("-END CERTIFICATE-",0)!=-1||t.indexOf("-END X509 CERTIFICATE-",0)!=-1||t.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return Oe.getPublicKeyFromCertPEM(t);if(t.indexOf("-END PUBLIC KEY-")!=-1){var ce=ut(t,"PUBLIC KEY");return N._getKeyFromPublicPKCS8Hex(ce)}if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var z=B(t,"RSA PRIVATE KEY");return N.getKey(z,null,"pkcs5prv")}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var G=B(t,"DSA PRIVATE KEY"),Q=u(G,0,[1],"02"),W=u(G,0,[2],"02"),te=u(G,0,[3],"02"),oe=u(G,0,[4],"02"),de=u(G,0,[5],"02"),_=new O;return _.setPrivate(new E(Q,16),new E(W,16),new E(te,16),new E(oe,16),new E(de,16)),_}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var z=B(t,"EC PRIVATE KEY");return N.getKey(z,null,"pkcs5prv")}if(t.indexOf("-END PRIVATE KEY-")!=-1)return N.getKeyFromPlainPrivatePKCS8PEM(t);if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var _e=N.getDecryptedKeyHex(t,n),le=new Me;return le.readPKCS5PrvKeyHex(_e),le}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var G=N.getDecryptedKeyHex(t,n),_=u(G,0,[1],"04"),pe=u(G,0,[2,0],"06"),we=u(G,0,[3,0],"03").substr(2),xe="";if(g.crypto.OID.oidhex2name[pe]!==void 0)xe=g.crypto.OID.oidhex2name[pe];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+pe);var I=new S({curve:xe});return I.setPublicKeyHex(we),I.setPrivateKeyHex(_),I.isPublic=!1,I}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var G=N.getDecryptedKeyHex(t,n),Q=u(G,0,[1],"02"),W=u(G,0,[2],"02"),te=u(G,0,[3],"02"),oe=u(G,0,[4],"02"),de=u(G,0,[5],"02"),_=new O;return _.setPrivate(new E(Q,16),new E(W,16),new E(te,16),new E(oe,16),new E(de,16)),_}if(t.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return N.getKeyFromEncryptedPKCS8PEM(t,n);throw new Error("not supported argument")},qe.generateKeypair=function(t,n){if(t=="RSA"){var a=n,c=new Me;c.generate(a,"10001"),c.isPrivate=!0,c.isPublic=!0;var p=new Me,u=c.n.toString(16),x=c.e.toString(16);p.setPublic(u,x),p.isPrivate=!1,p.isPublic=!0;var S={};return S.prvKeyObj=c,S.pubKeyObj=p,S}else if(t=="EC"){var O=n,T=new g.crypto.ECDSA({curve:O}),B=T.generateKeyPairHex(),c=new g.crypto.ECDSA({curve:O});c.setPublicKeyHex(B.ecpubhex),c.setPrivateKeyHex(B.ecprvhex),c.isPrivate=!0,c.isPublic=!1;var p=new g.crypto.ECDSA({curve:O});p.setPublicKeyHex(B.ecpubhex),p.isPrivate=!1,p.isPublic=!0;var S={};return S.prvKeyObj=c,S.pubKeyObj=p,S}else throw new Error("unknown algorithm: "+t)},qe.getPEM=function(t,n,a,c,p,u){var x=g,S=x.asn1,O=S.DERObjectIdentifier,T=S.DERInteger,B=S.ASN1Util.newObject,N=S.x509,_=N.SubjectPublicKeyInfo,I=x.crypto,P=I.DSA,A=I.ECDSA,L=Me;function K(pe){var we=B({seq:[{int:0},{int:{bigint:pe.n}},{int:pe.e},{int:{bigint:pe.d}},{int:{bigint:pe.p}},{int:{bigint:pe.q}},{int:{bigint:pe.dmp1}},{int:{bigint:pe.dmq1}},{int:{bigint:pe.coeff}}]});return we}function ie(pe){var we=B({seq:[{int:1},{octstr:{hex:pe.prvKeyHex}},{tag:["a0",!0,{oid:{name:pe.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+pe.pubKeyHex}}]}]});return we}function ae(pe){var we=B({seq:[{int:0},{int:{bigint:pe.p}},{int:{bigint:pe.q}},{int:{bigint:pe.g}},{int:{bigint:pe.y}},{int:{bigint:pe.x}}]});return we}if((L!==void 0&&t instanceof L||P!==void 0&&t instanceof P||A!==void 0&&t instanceof A)&&t.isPublic==!0&&(n===void 0||n=="PKCS8PUB")){var se=new _(t),ce=se.tohex();return Tt(ce,"PUBLIC KEY")}if(n=="PKCS1PRV"&&L!==void 0&&t instanceof L&&(a===void 0||a==null)&&t.isPrivate==!0){var se=K(t),ce=se.tohex();return Tt(ce,"RSA PRIVATE KEY")}if(n=="PKCS1PRV"&&A!==void 0&&t instanceof A&&(a===void 0||a==null)&&t.isPrivate==!0){var z=new O({name:t.curveName}),G=z.tohex(),Q=ie(t),W=Q.tohex(),te="";return te+=Tt(G,"EC PARAMETERS"),te+=Tt(W,"EC PRIVATE KEY"),te}if(n=="PKCS1PRV"&&P!==void 0&&t instanceof P&&(a===void 0||a==null)&&t.isPrivate==!0){var se=ae(t),ce=se.tohex();return Tt(ce,"DSA PRIVATE KEY")}if(n=="PKCS5PRV"&&L!==void 0&&t instanceof L&&a!==void 0&&a!=null&&t.isPrivate==!0){var se=K(t),ce=se.tohex();return c===void 0&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ce,a,c,u)}if(n=="PKCS5PRV"&&A!==void 0&&t instanceof A&&a!==void 0&&a!=null&&t.isPrivate==!0){var se=ie(t),ce=se.tohex();return c===void 0&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ce,a,c,u)}if(n=="PKCS5PRV"&&P!==void 0&&t instanceof P&&a!==void 0&&a!=null&&t.isPrivate==!0){var se=ae(t),ce=se.tohex();return c===void 0&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ce,a,c,u)}var oe=function(pe,we){if(typeof we=="string")return qe.getEncryptedPKCS8PEM(pe,we);if(typeof we=="object"&&ht(we,"passcode")!=null){var xe=JSON.parse(JSON.stringify(we)),It=xe.passcode;return delete xe.passcode,qe.getEncryptedPKCS8PEM(pe,It,xe)}};if(n=="PKCS8PRV"&&L!=null&&t instanceof L&&t.isPrivate==!0){var de=K(t),_e=de.tohex(),se=B({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:_e}}]}),ce=se.tohex();return a===void 0||a==null?Tt(ce,"PRIVATE KEY"):oe(ce,a)}if(n=="PKCS8PRV"&&A!==void 0&&t instanceof A&&t.isPrivate==!0){var le={seq:[{int:1},{octstr:{hex:t.prvKeyHex}}]};typeof t.pubKeyHex=="string"&&le.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]});var de=new B(le),_e=de.tohex(),se=B({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:_e}}]}),ce=se.tohex();return a===void 0||a==null?Tt(ce,"PRIVATE KEY"):oe(ce,a)}if(n=="PKCS8PRV"&&P!==void 0&&t instanceof P&&t.isPrivate==!0){var de=new T({bigint:t.x}),_e=de.tohex(),se=B({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:_e}}]}),ce=se.tohex();return a===void 0||a==null?Tt(ce,"PRIVATE KEY"):oe(ce,a)}throw new Error("unsupported object nor format")},qe.getKeyFromCSRPEM=function(t){var n=ut(t,"CERTIFICATE REQUEST"),a=qe.getKeyFromCSRHex(n);return a},qe.getKeyFromCSRHex=function(t){var n=qe.parseCSRHex(t),a=qe.getKey(n.p8pubkeyhex,null,"pkcs8pub");return a},qe.parseCSRHex=function(t){var n=Ee,a=n.getChildIdx,c=n.getTLV,p={},u=t;if(u.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var x=a(u,0);if(x.length<1)throw new Error("malformed CSR(code:002)");if(u.substr(x[0],2)!="30")throw new Error("malformed CSR(code:003)");var S=a(u,x[0]);if(S.length<3)throw new Error("malformed CSR(code:004)");return p.p8pubkeyhex=c(u,S[2]),p},qe.getKeyID=function(t){var n=qe,a=Ee;typeof t=="string"&&t.indexOf("BEGIN ")!=-1&&(t=n.getKey(t));var c=ut(n.getPEM(t)),p=a.getIdxbyList(c,0,[1]),u=a.getV(c,p).substring(2);return g.crypto.Util.hashHex(u,"sha1")},qe.getJWK=function(t,n,a,c,p){var u,x={},S,O=g.crypto.Util.hashHex;if(typeof t=="string")u=qe.getKey(t),t.indexOf("CERTIFICATE")!=-1&&(S=ut(t));else if(typeof t=="object")t instanceof Oe?(u=t.getPublicKey(),S=t.hex):u=t;else throw new Error("unsupported keyinfo type");if(u instanceof Me&&u.isPrivate)x.kty="RSA",x.n=_t(u.n.toString(16)),x.e=_t(u.e.toString(16)),x.d=_t(u.d.toString(16)),x.p=_t(u.p.toString(16)),x.q=_t(u.q.toString(16)),x.dp=_t(u.dmp1.toString(16)),x.dq=_t(u.dmq1.toString(16)),x.qi=_t(u.coeff.toString(16));else if(u instanceof Me&&u.isPublic)x.kty="RSA",x.n=_t(u.n.toString(16)),x.e=_t(u.e.toString(16));else if(u instanceof g.crypto.ECDSA&&u.isPrivate){var T=u.getShortNISTPCurveName();if(T!=="P-256"&&T!=="P-384"&&T!=="P-521")throw new Error("unsupported curve name for JWT: "+T);var B=u.getPublicKeyXYHex();x.kty="EC",x.crv=T,x.x=_t(B.x),x.y=_t(B.y),x.d=_t(u.prvKeyHex)}else if(u instanceof g.crypto.ECDSA&&u.isPublic){var T=u.getShortNISTPCurveName();if(T!=="P-256"&&T!=="P-384"&&T!=="P-521")throw new Error("unsupported curve name for JWT: "+T);var B=u.getPublicKeyXYHex();x.kty="EC",x.crv=T,x.x=_t(B.x),x.y=_t(B.y)}if(x.kty==null)throw new Error("unsupported keyinfo");return!u.isPrivate&&n!=!0&&(x.kid=g.jws.JWS.getJWKthumbprint(x)),S!=null&&a!=!0&&(x.x5c=[C(S)]),S!=null&&c!=!0&&(x.x5t=dr(C(O(S,"sha1")))),S!=null&&p!=!0&&(x["x5t#S256"]=dr(C(O(S,"sha256")))),x},qe.getJWKFromKey=function(t){return qe.getJWK(t,!0,!0,!0,!0)},Me.getPosArrayOfChildrenFromHex=function(t){return Ee.getChildIdx(t,0)},Me.getHexValueArrayOfChildrenFromHex=function(t){var n=Ee,a=n.getV,_=Me.getPosArrayOfChildrenFromHex(t),c=a(t,_[0]),p=a(t,_[1]),u=a(t,_[2]),x=a(t,_[3]),S=a(t,_[4]),O=a(t,_[5]),T=a(t,_[6]),B=a(t,_[7]),N=a(t,_[8]),_=new Array;return _.push(c,p,u,x,S,O,T,B,N),_},Me.prototype.readPrivateKeyFromPEMString=function(t){var n=ut(t),a=Me.getHexValueArrayOfChildrenFromHex(n);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},Me.prototype.readPKCS5PrvKeyHex=function(t){var n=Me.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},Me.prototype.readPKCS8PrvKeyHex=function(t){var n,a,c,p,u,x,S,O,T=Ee,B=T.getVbyListEx;if(T.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");try{n=B(t,0,[2,0,1],"02"),a=B(t,0,[2,0,2],"02"),c=B(t,0,[2,0,3],"02"),p=B(t,0,[2,0,4],"02"),u=B(t,0,[2,0,5],"02"),x=B(t,0,[2,0,6],"02"),S=B(t,0,[2,0,7],"02"),O=B(t,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(n,a,c,p,u,x,S,O)},Me.prototype.readPKCS5PubKeyHex=function(t){var n=Ee,a=n.getV;if(n.isASN1HEX(t)===!1)throw new Error("keyHex is not ASN.1 hex string");var c=n.getChildIdx(t,0);if(c.length!==2||t.substr(c[0],2)!=="02"||t.substr(c[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var p=a(t,c[0]),u=a(t,c[1]);this.setPublic(p,u)},Me.prototype.readPKCS8PubKeyHex=function(t){var n=Ee;if(n.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");if(n.getTLVbyListEx(t,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var a=n.getTLVbyListEx(t,0,[1,0]);this.readPKCS5PubKeyHex(a)},Me.prototype.readCertPubKeyHex=function(t,n){var a,c;a=new Oe,a.readCertHex(t),c=a.getPublicKeyHex(),this.readPKCS8PubKeyHex(c)};function fa(t,n){for(var a="",c=n/4-t.length,p=0;p<c;p++)a=a+"0";return a+t}Me.prototype.sign=function(t,n){var a=function(p){return g.crypto.Util.hashString(p,n)},c=a(t);return this.signWithMessageHash(c,n)},Me.prototype.signWithMessageHash=function(t,n){var a=g.crypto.Util.getPaddedDigestInfoHex(t,n,this.n.bitLength()),c=Ut(a,16),p=this.doPrivate(c),u=p.toString(16);return fa(u,this.n.bitLength())};function ma(t,n,a){for(var c="",p=0;c.length<n;)c+=Vt(a(Si(t+String.fromCharCode.apply(String,[(p&4278190080)>>24,(p&16711680)>>16,(p&65280)>>8,p&255])))),p+=1;return c}Me.prototype.signPSS=function(t,n,a){var c=function(u){return g.crypto.Util.hashHex(u,n)},p=c(Si(t));return a===void 0&&(a=-1),this.signWithMessageHashPSS(p,n,a)},Me.prototype.signWithMessageHashPSS=function(t,n,a){var c=Vt(t),p=c.length,u=this.n.bitLength()-1,x=Math.ceil(u/8),S,O=function(L){return g.crypto.Util.hashHex(L,n)};if(a===-1||a===void 0)a=p;else if(a===-2)a=x-p-2;else if(a<-2)throw new Error("invalid salt length");if(x<p+a+2)throw new Error("data too long");var T="";a>0&&(T=new Array(a),new lr().nextBytes(T),T=String.fromCharCode.apply(String,T));var B=Vt(O(Si("\0\0\0\0\0\0\0\0"+c+T))),N=[];for(S=0;S<x-a-p-2;S+=1)N[S]=0;var _=String.fromCharCode.apply(String,N)+""+T,I=ma(B,_.length,O),P=[];for(S=0;S<_.length;S+=1)P[S]=_.charCodeAt(S)^I.charCodeAt(S);var A=65280>>8*x-u&255;for(P[0]&=~A,S=0;S<p;S++)P.push(B.charCodeAt(S));return P.push(188),fa(this.doPrivate(new E(P)).toString(16),this.n.bitLength())};function ga(t){for(var n in g.crypto.Util.DIGESTINFOHEAD){var a=g.crypto.Util.DIGESTINFOHEAD[n],c=a.length;if(t.substring(0,c)==a){var p=[n,t.substring(c)];return p}}return[]}Me.prototype.verify=function(t,n){if(n=n.toLowerCase(),n.match(/^[0-9a-f]+$/)==null)return!1;var a=Ut(n,16),c=this.n.bitLength();if(a.bitLength()>c)return!1;var p=this.doPublic(a),u=p.toString(16);if(u.length+3!=c/4)return!1;var x=u.replace(/^1f+00/,""),S=ga(x);if(S.length==0)return!1;var O=S[0],T=S[1],B=function(_){return g.crypto.Util.hashString(_,O)},N=B(t);return T==N},Me.prototype.verifyWithMessageHash=function(t,n){if(n.length!=Math.ceil(this.n.bitLength()/4))return!1;var a=Ut(n,16);if(a.bitLength()>this.n.bitLength())return 0;var c=this.doPublic(a),p=c.toString(16).replace(/^1f+00/,""),u=ga(p);if(u.length==0)return!1;u[0];var x=u[1];return x==t},Me.prototype.verifyPSS=function(t,n,a,c){var p=function(x){return g.crypto.Util.hashHex(x,a)},u=p(Si(t));return c===void 0&&(c=-1),this.verifyWithMessageHashPSS(u,n,a,c)},Me.prototype.verifyWithMessageHashPSS=function(t,n,a,c){if(n.length!=Math.ceil(this.n.bitLength()/4))return!1;var p=new E(n,16),u=function(ie){return g.crypto.Util.hashHex(ie,a)},x=Vt(t),S=x.length,O=this.n.bitLength()-1,T=Math.ceil(O/8),B;if(c===-1||c===void 0)c=S;else if(c===-2)c=T-S-2;else if(c<-2)throw new Error("invalid salt length");if(T<S+c+2)throw new Error("data too long");var N=this.doPublic(p).toByteArray();for(B=0;B<N.length;B+=1)N[B]&=255;for(;N.length<T;)N.unshift(0);if(N[T-1]!==188)throw new Error("encoded message does not end in 0xbc");N=String.fromCharCode.apply(String,N);var _=N.substr(0,T-S-1),I=N.substr(_.length,S),P=65280>>8*T-O&255;if(_.charCodeAt(0)&P)throw new Error("bits beyond keysize not zero");var A=ma(I,_.length,u),L=[];for(B=0;B<_.length;B+=1)L[B]=_.charCodeAt(B)^A.charCodeAt(B);L[0]&=~P;var K=T-S-c-2;for(B=0;B<K;B+=1)if(L[B]!==0)throw new Error("leftmost octets not zero");if(L[K]!==1)throw new Error("0x01 marker not found");return I===Vt(u(Si("\0\0\0\0\0\0\0\0"+x+String.fromCharCode.apply(String,L.slice(-c)))))},Me.SALT_LEN_HLEN=-1,Me.SALT_LEN_MAX=-2,Me.SALT_LEN_RECOVER=-2;function Oe(t){var n=Ee,a=n.getChildIdx,c=n.getV;n.dump;var p=n.parse,u=n.getTLV,x=n.getVbyList,S=n.getVbyListEx,O=n.getTLVbyList,T=n.getTLVbyListEx,B=n.getIdxbyList,N=n.getIdxbyListEx,_=n.getVidx,I=n.getInt,P=n.oidname,A=n.hextooidstr,L=ut,K,ie=Error;try{K=g.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var z=O(this.hex,0,[0,0]);if(z.substr(0,2)=="a0"){var G=O(z,0,[0]),Q=I(G,0);if(Q<0||2<Q)throw new Error("malformed version field");return this.version=Q+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return S(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var z=T(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(z)},this.getAlgorithmIdentifierName=function(z){for(var G in K)if(z===K[G])return G;return P(S(z,0,[0],"06"))},this.getIssuer=function(z,G){return this.getX500Name(this.getIssuerHex(),z,G)},this.getIssuerHex=function(){return O(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var z=this.getIssuer();return z.str},this.getSubject=function(z,G){return this.getX500Name(this.getSubjectHex(),z,G)},this.getSubjectHex=function(){return O(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var z=this.getSubject();return z.str},this.getNotBefore=function(){var z=x(this.hex,0,[0,4+this.foffset,0]);return z=z.replace(/(..)/g,"%$1"),z=decodeURIComponent(z),z},this.getNotAfter=function(){var z=x(this.hex,0,[0,4+this.foffset,1]);return z=z.replace(/(..)/g,"%$1"),z=decodeURIComponent(z),z},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return O(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var z=this.getSPKI();return z==null?null:x(z,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return B(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var z=this.getPublicKeyIdx();return B(this.hex,z,[1,0],"30")},this.getPublicKey=function(){return qe.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var z=O(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(z)},this.getSignatureValueHex=function(){return x(this.hex,0,[2],"03",!0)},this.verifySignature=function(z){var G=this.getSignatureAlgorithmField(),Q=this.getSignatureValueHex(),W=O(this.hex,0,[0],"30"),te=new g.crypto.Signature({alg:G});return te.init(z),te.updateHex(W),te.verify(Q)},this.parseExt=function(z){var G,Q,W;if(z===void 0){if(W=this.hex,this.version!==3)return-1;G=B(W,0,[0,7,0],"30"),Q=a(W,G)}else{W=ut(z);var te=B(W,0,[0,3,0,0],"06");if(c(W,te)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}G=B(W,0,[0,3,0,1,0],"30"),Q=a(W,G),this.hex=W}this.aExtInfo=new Array;for(var oe=0;oe<Q.length;oe++){var de={};de.critical=!1;var _e=a(W,Q[oe]),le=0;_e.length===3&&(de.critical=!0,le=1),de.oid=n.hextooidstr(x(W,Q[oe],[0],"06"));var pe=B(W,Q[oe],[1+le]);de.vidx=_(W,pe),this.aExtInfo.push(de)}},this.getExtInfo=function(z){var G=this.aExtInfo,Q=z;if(z.match(/^[0-9.]+$/)||(Q=g.asn1.x509.OID.name2oid(z)),Q!==""){for(var W=0;W<G.length;W++)if(G[W].oid===Q)return G[W]}},this.getCriticalExtV=function(z,G,Q){if(G!=null)return[G,Q];var W=this.getExtInfo(z);return W==null?[null,null]:[u(this.hex,W.vidx),W.critical]},this.getExtBasicConstraints=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("basicConstraints");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"basicConstraints"};if(G&&(W.critical=!0),z==="3000")return W;if(z==="30030101ff")return W.cA=!0,W;if(z.substr(0,12)==="30060101ff02"){var te=c(z,10),oe=parseInt(te,16);return W.cA=!0,W.pathLen=oe,W}throw new Error("hExtV parse error: "+z)},this.getExtNameConstraints=function(z,G){var Q=this.getCriticalExtV("nameConstraints",z,G);if(z=Q[0],G=Q[1],z!=null){var W={extname:"nameConstraints"};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++){for(var de=[],_e=a(z,te[oe]),le=0;le<_e.length;le++){var pe=u(z,_e[le]),we=this.getGeneralSubtree(pe);de.push(we)}var xe=z.substr(te[oe],2);xe=="a0"?W.permit=de:xe=="a1"&&(W.exclude=de)}return W}},this.getGeneralSubtree=function(z){var G=a(z,0),Q=G.length;if(Q<1||2<Q)throw new Error("wrong num elements");for(var W=this.getGeneralName(u(z,G[0])),te=1;te<Q;te++){var oe=z.substr(G[te],2),de=c(z,G[te]),_e=parseInt(de,16);oe=="80"&&(W.min=_e),oe=="81"&&(W.max=_e)}return W},this.getExtKeyUsage=function(z,G){var Q=this.getCriticalExtV("keyUsage",z,G);if(z=Q[0],G=Q[1],z!=null){var W={extname:"keyUsage"};return G&&(W.critical=!0),W.names=this.getExtKeyUsageString(z).split(","),W}},this.getExtKeyUsageBin=function(z){if(z===void 0){var G=this.getExtInfo("keyUsage");if(G===void 0)return"";z=u(this.hex,G.vidx)}if(z.length!=8&&z.length!=10)throw new Error("malformed key usage value: "+z);var Q="000000000000000"+parseInt(z.substr(6),16).toString(2);return z.length==8&&(Q=Q.slice(-8)),z.length==10&&(Q=Q.slice(-16)),Q=Q.replace(/0+$/,""),Q==""&&(Q="0"),Q},this.getExtKeyUsageString=function(z){for(var G=this.getExtKeyUsageBin(z),Q=new Array,W=0;W<G.length;W++)G.substr(W,1)=="1"&&Q.push(Oe.KEYUSAGE_NAME[W]);return Q.join(",")},this.getExtSubjectKeyIdentifier=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("subjectKeyIdentifier");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"subjectKeyIdentifier"};G&&(W.critical=!0);var te=c(z,0);return W.kid={hex:te},W},this.getExtAuthorityKeyIdentifier=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("authorityKeyIdentifier");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"authorityKeyIdentifier"};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++){var de=z.substr(te[oe],2);if(de==="80"&&(W.kid={hex:c(z,te[oe])}),de==="a1"){var _e=u(z,te[oe]),le=this.getGeneralNames(_e);W.issuer=le[0].dn}de==="82"&&(W.sn={hex:c(z,te[oe])})}return W},this.getExtExtKeyUsage=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("extKeyUsage");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"extKeyUsage",array:[]};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++)W.array.push(P(c(z,te[oe])));return W},this.getExtExtKeyUsageName=function(){var z=this.getExtInfo("extKeyUsage");if(z===void 0)return z;var G=new Array,Q=u(this.hex,z.vidx);if(Q==="")return G;for(var W=a(Q,0),te=0;te<W.length;te++)G.push(P(c(Q,W[te])));return G},this.getExtSubjectAltName=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("subjectAltName");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"subjectAltName",array:[]};return G&&(W.critical=!0),W.array=this.getGeneralNames(z),W},this.getExtIssuerAltName=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("issuerAltName");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"issuerAltName",array:[]};return G&&(W.critical=!0),W.array=this.getGeneralNames(z),W},this.getGeneralNames=function(z){for(var G=a(z,0),Q=[],W=0;W<G.length;W++){var te=this.getGeneralName(u(z,G[W]));te!==void 0&&Q.push(te)}return Q},this.getGeneralName=function(z){var G=z.substr(0,2),Q=c(z,0),W=Vt(Q);if(G=="81")return{rfc822:W};if(G=="82")return{dns:W};if(G=="86")return{uri:W};if(G=="87")return{ip:Zr(Q)};if(G=="a4")return{dn:this.getX500Name(Q)};if(G=="a0")return{other:this.getOtherName(z)}},this.getExtSubjectAltName2=function(){var z,G,Q,W=this.getExtInfo("subjectAltName");if(W===void 0)return W;for(var te=new Array,oe=u(this.hex,W.vidx),de=a(oe,0),_e=0;_e<de.length;_e++)Q=oe.substr(de[_e],2),z=c(oe,de[_e]),Q==="81"&&(G=Qe(z),te.push(["MAIL",G])),Q==="82"&&(G=Qe(z),te.push(["DNS",G])),Q==="84"&&(G=Oe.hex2dn(z,0),te.push(["DN",G])),Q==="86"&&(G=Qe(z),te.push(["URI",G])),Q==="87"&&(G=Zr(z),te.push(["IP",G]));return te},this.getExtCRLDistributionPoints=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("cRLDistributionPoints");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"cRLDistributionPoints",array:[]};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++){var de=u(z,te[oe]);W.array.push(this.getDistributionPoint(de))}return W},this.getDistributionPoint=function(z){for(var G={},Q=a(z,0),W=0;W<Q.length;W++){var te=z.substr(Q[W],2),oe=u(z,Q[W]);te=="a0"&&(G.dpname=this.getDistributionPointName(oe))}return G},this.getDistributionPointName=function(z){for(var G={},Q=a(z,0),W=0;W<Q.length;W++){var te=z.substr(Q[W],2),oe=u(z,Q[W]);te=="a0"&&(G.full=this.getGeneralNames(oe))}return G},this.getExtCRLDistributionPointsURI=function(){var z=this.getExtCRLDistributionPoints();if(z==null)return z;for(var G=z.array,Q=[],W=0;W<G.length;W++)try{G[W].dpname.full[0].uri!=null&&Q.push(G[W].dpname.full[0].uri)}catch{}return Q},this.getExtAIAInfo=function(){var z=this.getExtInfo("authorityInfoAccess");if(z===void 0)return z;for(var G={ocsp:[],caissuer:[]},Q=a(this.hex,z.vidx),W=0;W<Q.length;W++){var te=x(this.hex,Q[W],[0],"06"),oe=x(this.hex,Q[W],[1],"86");te==="2b06010505073001"&&G.ocsp.push(Qe(oe)),te==="2b06010505073002"&&G.caissuer.push(Qe(oe))}return G},this.getExtAuthorityInfoAccess=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("authorityInfoAccess");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"authorityInfoAccess",array:[]};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++){var de=S(z,te[oe],[0],"06"),_e=x(z,te[oe],[1],"86"),le=Qe(_e);if(de=="2b06010505073001")W.array.push({ocsp:le});else if(de=="2b06010505073002")W.array.push({caissuer:le});else throw new Error("unknown method: "+de)}return W},this.getExtCertificatePolicies=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("certificatePolicies");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"certificatePolicies",array:[]};G&&(W.critical=!0);for(var te=a(z,0),oe=0;oe<te.length;oe++){var de=u(z,te[oe]),_e=this.getPolicyInformation(de);W.array.push(_e)}return W},this.getPolicyInformation=function(z){var G={},Q=x(z,0,[0],"06");G.policyoid=P(Q);var W=N(z,0,[1],"30");if(W!=-1){G.array=[];for(var te=a(z,W),oe=0;oe<te.length;oe++){var de=u(z,te[oe]),_e=this.getPolicyQualifierInfo(de);G.array.push(_e)}}return G},this.getOtherName=function(z){var G={},Q=a(z,0),W=x(z,Q[0],[],"06"),te=x(z,Q[1],[]);return G.oid=P(W),G.value=p(te),G},this.getPolicyQualifierInfo=function(z){var G={},Q=x(z,0,[0],"06");if(Q==="2b06010505070201"){var W=S(z,0,[1],"16");G.cps=Vt(W)}else if(Q==="2b06010505070202"){var te=O(z,0,[1],"30");G.unotice=this.getUserNotice(te)}return G},this.getUserNotice=function(z){var G=null;try{G=n.parse(z);var Q=this._asn1ToUnotice(G);return Q}catch{return}},this._asn1ToUnotice=function(z){try{for(var G={},Q=ht(z,"seq"),W=0;W<Q.length;W++){var te=this._asn1ToNoticeRef(Q[W]);te!=null&&(G.noticeref=te);var oe=this.asn1ToDisplayText(Q[W]);oe!=null&&(G.exptext=oe)}return Object.keys(G).length>0?G:void 0}catch{return}},this._asn1ToNoticeRef=function(z){try{for(var G={},Q=ht(z,"seq"),W=0;W<Q.length;W++){var te=this._asn1ToNoticeNum(Q[W]);te!=null&&(G.noticenum=te);var oe=this.asn1ToDisplayText(Q[W]);oe!=null&&(G.org=oe)}return Object.keys(G).length>0?G:void 0}catch{return}},this._asn1ToNoticeNum=function(z){try{for(var G=ht(z,"seq"),Q=[],W=0;W<G.length;W++){var te=G[W];Q.push(parseInt(ht(te,"int.hex"),16))}return Q}catch{return}},this.getDisplayText=function(z){var G={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},Q={};return Q.type=G[z.substr(0,2)],Q.str=Vt(c(z,0)),Q},this.asn1ToDisplayText=function(z){if(z.utf8str!=null)return{type:"utf8",str:z.utf8str.str};if(z.ia5str!=null)return{type:"ia5",str:z.ia5str.str};if(z.visstr!=null)return{type:"vis",str:z.visstr.str};if(z.bmpstr!=null)return{type:"bmp",str:z.bmpstr.str};if(z.prnstr!=null)return{type:"prn",str:z.prnstr.str}},this.getExtPolicyMappings=function(z,G){var Q=this.getCriticalExtV("policyMappings",z,G);if(z=Q[0],G=Q[1],z!=null){var W={extname:"policyMappings"};G&&(W.critical=!0);try{for(var te=p(z),oe=te.seq,de=[],_e=0;_e<oe.length;_e++){var le=oe[_e].seq;de.push([le[0].oid,le[1].oid])}W.array=de}catch{throw new ie("malformed policyMappings")}return W}},this.getExtPolicyConstraints=function(z,G){var Q=this.getCriticalExtV("policyConstraints",z,G);if(z=Q[0],G=Q[1],z!=null){var W={extname:"policyConstraints"};G&&(W.critical=!0);var te=p(z);try{for(var oe=te.seq,de=0;de<oe.length;de++){var _e=oe[de].tag;_e.explicit==!1&&(_e.tag=="80"&&(W.reqexp=parseInt(_e.hex,16)),_e.tag=="81"&&(W.inhibit=parseInt(_e.hex,16)))}}catch{return new ie("malformed policyConstraints value")}return W}},this.getExtInhibitAnyPolicy=function(z,G){var Q=this.getCriticalExtV("inhibitAnyPolicy",z,G);if(z=Q[0],G=Q[1],z!=null){var W={extname:"inhibitAnyPolicy"};G&&(W.critical=!0);var te=I(z,0);return te==-1?new ie("wrong value"):(W.skip=te,W)}},this.getExtCRLNumber=function(z,G){var Q={extname:"cRLNumber"};if(G&&(Q.critical=!0),z.substr(0,2)=="02")return Q.num={hex:c(z,0)},Q;throw new ie("hExtV parse error: "+z)},this.getExtCRLReason=function(z,G){var Q={extname:"cRLReason"};if(G&&(Q.critical=!0),z.substr(0,2)=="0a")return Q.code=parseInt(c(z,0),16),Q;throw new Error("hExtV parse error: "+z)},this.getExtOcspNonce=function(z,G){var Q={extname:"ocspNonce"};G&&(Q.critical=!0);var W=c(z,0);return Q.hex=W,Q},this.getExtOcspNoCheck=function(z,G){var Q={extname:"ocspNoCheck"};return G&&(Q.critical=!0),Q},this.getExtAdobeTimeStamp=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("adobeTimeStamp");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"adobeTimeStamp"};G&&(W.critical=!0);var te=a(z,0);if(te.length>1){var oe=u(z,te[1]),de=this.getGeneralName(oe);de.uri!=null&&(W.uri=de.uri)}if(te.length>2){var _e=u(z,te[2]);_e=="0101ff"&&(W.reqauth=!0),_e=="010100"&&(W.reqauth=!1)}return W},this.getExtSubjectDirectoryAttributes=function(z,G){if(z===void 0&&G===void 0){var Q=this.getExtInfo("subjectDirectoryAttributes");if(Q===void 0)return;z=u(this.hex,Q.vidx),G=Q.critical}var W={extname:"subjectDirectoryAttributes"};G&&(W.critical=!0);try{for(var te=p(z),oe=[],de=0;de<te.seq.length;de++){var _e=te.seq[de],le=ht(_e,"seq.0.oid"),pe=ht(_e,"seq.1.set");if(le==null||pe==null)throw"error";oe.push({attr:le,array:pe})}return W.array=oe,W}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var ae=function(z){var G={};try{var Q=z.seq[0].oid,W=g.asn1.x509.OID.name2oid(Q);G.type=g.asn1.x509.OID.oid2atype(W);var te=z.seq[1];if(te.utf8str!=null)G.ds="utf8",G.value=te.utf8str.str;else if(te.numstr!=null)G.ds="num",G.value=te.numstr.str;else if(te.telstr!=null)G.ds="tel",G.value=te.telstr.str;else if(te.prnstr!=null)G.ds="prn",G.value=te.prnstr.str;else if(te.ia5str!=null)G.ds="ia5",G.value=te.ia5str.str;else if(te.visstr!=null)G.ds="vis",G.value=te.visstr.str;else if(te.bmpstr!=null)G.ds="bmp",G.value=te.bmpstr.str;else throw"error";return G}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},se=function(z){try{return z.set.map(function(G){return ae(G)})}catch(G){throw new Error("improper ASN.1 parsed RDN: "+G)}},ce=function(z){try{return z.seq.map(function(G){return se(G)})}catch(G){throw new Error("improper ASN.1 parsed X500Name: "+G)}};this.getX500NameRule=function(z){for(var G=null,Q=[],W=0;W<z.length;W++)for(var te=z[W],oe=0;oe<te.length;oe++)Q.push(te[oe]);for(var W=0;W<Q.length;W++){var de=Q[W],_e=de.ds,le=de.value,pe=de.type;if(_e!="prn"&&_e!="utf8"&&_e!="ia5")return"mixed";if(_e=="ia5"){if(pe!="CN")return"mixed";if(g.lang.String.isMail(le))continue;return"mixed"}if(pe=="C"){if(_e=="prn")continue;return"mixed"}if(G==null)G=_e;else if(G!==_e)return"mixed"}return G??"prn"},this.getAttrTypeAndValue=function(z){var G=p(z);return ae(G)},this.getRDN=function(z){var G=p(z);return se(G)},this.getX500NameArray=function(z){var G=p(z);return ce(G)},this.getX500Name=function(z,G,Q){var W=this.getX500NameArray(z),te=this.dnarraytostr(W),oe={str:te};return oe.array=W,Q==!0&&(oe.hex=z),G==!0&&(oe.canon=this.c14nRDNArray(W)),oe},this.readCertPEM=function(z){this.readCertHex(L(z))},this.readCertHex=function(z){this.hex=z,this.getVersion();try{B(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(z){var G={};return z==null&&(z={}),G.version=this.getVersion(),G.serial={hex:this.getSerialNumberHex()},G.sigalg=this.getSignatureAlgorithmField(),G.issuer=this.getIssuer(z.dncanon,z.dnhex),G.notbefore=this.getNotBefore(),G.notafter=this.getNotAfter(),G.subject=this.getSubject(z.dncanon,z.dnhex),G.sbjpubkey=Tt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&(G.ext=this.getExtParamArray()),G.sighex=this.getSignatureValueHex(),z.tbshex==!0&&(G.tbshex=O(this.hex,0,[0])),z.nodnarray==!0&&(delete G.issuer.array,delete G.subject.array),G},this.getExtParamArray=function(z){if(z==null){var G=N(this.hex,0,[0,"[3]"]);G!=-1&&(z=T(this.hex,0,[0,"[3]",0],"30"))}for(var Q=[],W=a(z,0),te=0;te<W.length;te++){var oe=u(z,W[te]),de=this.getExtParam(oe);de!=null&&Q.push(de)}return Q},this.getExtParam=function(z){var G=a(z,0),Q=G.length;if(Q!=2&&Q!=3)throw new Error("wrong number elements in Extension: "+Q+" "+z);var W=A(x(z,0,[0],"06")),te=!1;Q==3&&O(z,0,[1])=="0101ff"&&(te=!0);var oe=O(z,0,[Q-1,0]),de=void 0;if(W=="2.5.29.14"?de=this.getExtSubjectKeyIdentifier(oe,te):W=="2.5.29.15"?de=this.getExtKeyUsage(oe,te):W=="2.5.29.17"?de=this.getExtSubjectAltName(oe,te):W=="2.5.29.18"?de=this.getExtIssuerAltName(oe,te):W=="2.5.29.19"?de=this.getExtBasicConstraints(oe,te):W=="2.5.29.30"?de=this.getExtNameConstraints(oe,te):W=="2.5.29.31"?de=this.getExtCRLDistributionPoints(oe,te):W=="2.5.29.32"?de=this.getExtCertificatePolicies(oe,te):W=="2.5.29.33"?de=this.getExtPolicyMappings(oe,te):W=="2.5.29.35"?de=this.getExtAuthorityKeyIdentifier(oe,te):W=="2.5.29.36"?de=this.getExtPolicyConstraints(oe,te):W=="2.5.29.37"?de=this.getExtExtKeyUsage(oe,te):W=="2.5.29.54"?de=this.getExtInhibitAnyPolicy(oe,te):W=="1.3.6.1.5.5.7.1.1"?de=this.getExtAuthorityInfoAccess(oe,te):W=="2.5.29.20"?de=this.getExtCRLNumber(oe,te):W=="2.5.29.21"?de=this.getExtCRLReason(oe,te):W=="2.5.29.9"?de=this.getExtSubjectDirectoryAttributes(oe,te):W=="1.3.6.1.5.5.7.48.1.2"?de=this.getExtOcspNonce(oe,te):W=="1.3.6.1.5.5.7.48.1.5"?de=this.getExtOcspNoCheck(oe,te):W=="1.2.840.113583.1.1.9.1"?de=this.getExtAdobeTimeStamp(oe,te):Oe.EXT_PARSER[W]!=null&&(de=Oe.EXT_PARSER[W](W,te,oe)),de!=null)return de;var _e={extname:W,extn:oe};try{_e.extn=p(oe)}catch{}return te&&(_e.critical=!0),_e},this.findExt=function(z,G){for(var Q=0;Q<z.length;Q++)if(z[Q].extname==G)return z[Q];return null},this.updateExtCDPFullURI=function(z,G){var Q=this.findExt(z,"cRLDistributionPoints");if(Q!=null&&Q.array!=null){for(var W=Q.array,te=0;te<W.length;te++)if(W[te].dpname!=null&&W[te].dpname.full!=null)for(var oe=W[te].dpname.full,de=0;de<oe.length;de++){var _e=oe[te];_e.uri!=null&&(_e.uri=G)}}},this.updateExtAIAOCSP=function(z,G){var Q=this.findExt(z,"authorityInfoAccess");if(Q!=null&&Q.array!=null)for(var W=Q.array,te=0;te<W.length;te++)W[te].ocsp!=null&&(W[te].ocsp=G)},this.updateExtAIACAIssuer=function(z,G){var Q=this.findExt(z,"authorityInfoAccess");if(Q!=null&&Q.array!=null)for(var W=Q.array,te=0;te<W.length;te++)W[te].caissuer!=null&&(W[te].caissuer=G)},this.dnarraytostr=function(z){function G(W){return W.map(function(te){return Q(te).replace(/\+/,"\\+")}).join("+")}function Q(W){return W.type+"="+W.value}return"/"+z.map(function(W){return G(W).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(z){var G;if(z.str!=null&&z.array==null){var Q=new g.asn1.x509.X500Name({str:z.str}),W=Q.tohex();G=this.getX500NameArray(W)}else G=z.array;z.canon==null&&(z.canon=this.c14nRDNArray(G))},this.c14nRDNArray=function(z){for(var G=[],Q=0;Q<z.length;Q++){for(var W=z[Q],te=[],oe=0;oe<W.length;oe++){var de=W[oe],_e=de.value;_e=_e.replace(/^\s*/,""),_e=_e.replace(/\s*$/,""),_e=_e.replace(/\s+/g," "),_e=_e.toLowerCase(),te.push(de.type.toLowerCase()+"="+_e)}G.push(te.join("+"))}return"/"+G.join("/")},this.getInfo=function(){var z=function(Nt){for(var ze="",Ye="    ",ct=`
`,lt=Nt.array,Kt=0;Kt<lt.length;Kt++){var pt=lt[Kt];if(pt.dn!=null&&(ze+=Ye+"dn: "+pt.dn.str+ct),pt.ip!=null&&(ze+=Ye+"ip: "+pt.ip+ct),pt.rfc822!=null&&(ze+=Ye+"rfc822: "+pt.rfc822+ct),pt.dns!=null&&(ze+=Ye+"dns: "+pt.dns+ct),pt.uri!=null&&(ze+=Ye+"uri: "+pt.uri+ct),pt.other!=null){var Pr=pt.other.oid,Ki=JSON.stringify(pt.other.value).replace(/\"/g,"");ze+=Ye+"other: "+Pr+"="+Ki+ct}}return ze=ze.replace(/\n$/,""),ze},G=function(Nt){for(var ze="",Ye=Nt.array,ct=0;ct<Ye.length;ct++){var lt=Ye[ct];if(ze+="    policy oid: "+lt.policyoid+`
`,lt.array!==void 0)for(var Kt=0;Kt<lt.array.length;Kt++){var pt=lt.array[Kt];pt.cps!==void 0&&(ze+="    cps: "+pt.cps+`
`)}}return ze},Q=function(Nt){for(var ze="",Ye=Nt.array,ct=0;ct<Ye.length;ct++){var lt=Ye[ct];try{lt.dpname.full[0].uri!==void 0&&(ze+="    "+lt.dpname.full[0].uri+`
`)}catch{}try{lt.dname.full[0].dn.hex!==void 0&&(ze+="    "+Oe.hex2dn(lt.dpname.full[0].dn.hex)+`
`)}catch{}}return ze},W=function(Nt){for(var ze="",Ye=Nt.array,ct=0;ct<Ye.length;ct++){var lt=Ye[ct];lt.caissuer!==void 0&&(ze+="    caissuer: "+lt.caissuer+`
`),lt.ocsp!==void 0&&(ze+="    ocsp: "+lt.ocsp+`
`)}return ze},te,oe,de;if(te=`Basic Fields
`,te+="  serial number: "+this.getSerialNumberHex()+`
`,te+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,te+="  issuer: "+this.getIssuerString()+`
`,te+="  notBefore: "+this.getNotBefore()+`
`,te+="  notAfter: "+this.getNotAfter()+`
`,te+="  subject: "+this.getSubjectString()+`
`,te+=`  subject public key info: 
`,oe=this.getPublicKey(),te+="    key algorithm: "+oe.type+`
`,oe.type==="RSA"&&(te+="    n="+ns(oe.n.toString(16)).substr(0,16)+`...
`,te+="    e="+ns(oe.e.toString(16))+`
`),de=this.aExtInfo,de!=null){te+=`X509v3 Extensions:
`;for(var _e=0;_e<de.length;_e++){var le=de[_e],pe=g.asn1.x509.OID.oid2name(le.oid);pe===""&&(pe=le.oid);var we="";if(le.critical===!0&&(we="CRITICAL"),te+="  "+pe+" "+we+`:
`,pe==="basicConstraints"){var xe=this.getExtBasicConstraints();xe.cA===void 0?te+=`    {}
`:(te+="    cA=true",xe.pathLen!==void 0&&(te+=", pathLen="+xe.pathLen),te+=`
`)}else if(pe=="policyMappings"){var It=this.getExtPolicyMappings().array,ot=It.map(function(Nt){var ze=Nt;return ze[0]+":"+ze[1]}).join(", ");te+="    "+ot+`
`}else if(pe=="policyConstraints"){var tt=this.getExtPolicyConstraints();te+="    ",tt.reqexp!=null&&(te+=" reqexp="+tt.reqexp),tt.inhibit!=null&&(te+=" inhibit="+tt.inhibit),te+=`
`}else if(pe=="inhibitAnyPolicy"){var tt=this.getExtInhibitAnyPolicy();te+="    skip="+tt.skip+`
`}else if(pe=="keyUsage")te+="    "+this.getExtKeyUsageString()+`
`;else if(pe=="subjectKeyIdentifier")te+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(pe=="authorityKeyIdentifier"){var mt=this.getExtAuthorityKeyIdentifier();mt.kid!==void 0&&(te+="    kid="+mt.kid.hex+`
`)}else if(pe=="extKeyUsage"){var Ct=this.getExtExtKeyUsage().array;te+="    "+Ct.join(", ")+`
`}else if(pe=="subjectAltName"){var Et=z(this.getExtSubjectAltName());te+=Et+`
`}else if(pe=="cRLDistributionPoints"){var xt=this.getExtCRLDistributionPoints();te+=Q(xt)}else if(pe=="authorityInfoAccess"){var Er=this.getExtAuthorityInfoAccess();te+=W(Er)}else pe=="certificatePolicies"&&(te+=G(this.getExtCertificatePolicies()))}}return te+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,te+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,te},typeof t=="string"&&(t.indexOf("-----BEGIN")!=-1?this.readCertPEM(t):g.lang.String.isHex(t)&&this.readCertHex(t))}Oe.EXT_PARSER={},Oe.registExtParser=function(t,n){Oe.EXT_PARSER[t]=n},Oe.hex2dn=function(t,n){n===void 0&&(n=0);var a=new Oe;Ee.getTLV(t,n);var c=a.getX500Name(t);return c.str},Oe.hex2rdn=function(t,n){if(n===void 0&&(n=0),t.substr(n,2)!=="31")throw new Error("malformed RDN");for(var a=new Array,c=Ee.getChildIdx(t,n),p=0;p<c.length;p++)a.push(Oe.hex2attrTypeValue(t,c[p]));return a=a.map(function(u){return u.replace("+","\\+")}),a.join("+")},Oe.hex2attrTypeValue=function(t,n){var a=Ee,c=a.getV;if(n===void 0&&(n=0),t.substr(n,2)!=="30")throw new Error("malformed attribute type and value");var p=a.getChildIdx(t,n);p.length!==2||t.substr(p[0],2);var u=c(t,p[0]),x=g.asn1.ASN1Util.oidHexToInt(u),S=g.asn1.x509.OID.oid2atype(x),O=c(t,p[1]),T=Vt(O);return S+"="+T},Oe.getPublicKeyFromCertHex=function(t){var n=new Oe;return n.readCertHex(t),n.getPublicKey()},Oe.getPublicKeyFromCertPEM=function(t){var n=new Oe;return n.readCertPEM(t),n.getPublicKey()},Oe.getPublicKeyInfoPropOfCertPEM=function(t){var n=Ee,a=n.getVbyList,c={},p,u;return c.algparam=null,p=new Oe,p.readCertPEM(t),u=p.getPublicKeyHex(),c.keyhex=a(u,0,[1],"03").substr(2),c.algoid=a(u,0,[0,0],"06"),c.algoid==="2a8648ce3d0201"&&(c.algparam=a(u,0,[0,1],"06")),c},Oe.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var Jd=function(t){var n=g,a=n.lang.String.isHex,c=Ee,p=c.getV,u=c.getTLV,x=c.getVbyList,S=c.getTLVbyList,O=c.getTLVbyListEx,T=c.getIdxbyList,B=c.getIdxbyListEx,N=c.getChildIdx,_=new Oe;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var I=T(this.hex,0,[0,0]),P=this.hex.substr(I,2);if(P=="02")this.posSigAlg=1;else if(P=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+P);var A=T(this.hex,0,[0,this.posSigAlg+3]),L=this.hex.substr(A,2);if(L=="17"||L=="18"){var K,ie;K=T(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,K!=-1&&(ie=this.hex.substr(K,2),ie=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(L=="30")this.posRevCert=this.posSigAlg+3;else if(L=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+L)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(x(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var I=S(this.hex,0,[0,this.posSigAlg],"30");return _.getAlgorithmIdentifierName(I)},this.getIssuer=function(){return _.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return S(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var I=x(this.hex,0,[0,this.posSigAlg+2]);return result=Vt(I)},this.getNextUpdate=function(){var I=T(this.hex,0,[0,this.posSigAlg+3]),P=this.hex.substr(I,2);return P!="17"&&P!="18"?null:Vt(p(this.hex,I))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var I=[],P=T(this.hex,0,[0,this.posRevCert]),A=N(this.hex,P),L=0;L<A.length;L++){var K=u(this.hex,A[L]);I.push(this.getRevCert(K))}return I},this.getRevCert=function(I){var P={},A=N(I,0);return P.sn={hex:x(I,0,[0],"02")},P.date=Vt(x(I,0,[1])),A.length==3&&(P.ext=_.getExtParamArray(S(I,0,[2]))),P},this.findRevCert=function(I){var P=new Oe(I),A=P.getSerialNumberHex();return this.findRevCertBySN(A)},this.findRevCertBySN=function(I){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var P=this.parsed.revcert,A=0;A<P.length;A++)if(I==P[A].sn.hex)return P[A];return null},this.getSignatureValueHex=function(){return x(this.hex,0,[2],"03",!0)},this.verifySignature=function(I){var P=this.getSignatureAlgorithmField(),A=this.getSignatureValueHex(),L=S(this.hex,0,[0],"30"),K=new g.crypto.Signature({alg:P});return K.init(I),K.updateHex(L),K.verify(A)},this.getParam=function(I){var P={},A=this.getVersion();A!=null&&(P.version=A),P.sigalg=this.getSignatureAlgorithmField(),P.issuer=this.getIssuer(),P.thisupdate=this.getThisUpdate();var L=this.getNextUpdate();L!=null&&(P.nextupdate=L);var K=this.getRevCertArray();K!=null&&(P.revcert=K);var ie=B(this.hex,0,[0,"[0]"]);if(ie!=-1){var ae=O(this.hex,0,[0,"[0]",0]);P.ext=_.getExtParamArray(ae)}return P.sighex=this.getSignatureValueHex(),this.parsed=P,typeof I=="object"&&(I.tbshex==!0&&(P.tbshex=S(this.hex,0,[0])),I.nodnarray==!0&&delete P.issuer.array),P},typeof t=="string"&&(a(t)?this.hex=t:t.match(/-----BEGIN X509 CRL/)&&(this.hex=ut(t)),this._setPos())};(typeof g>"u"||!g)&&(g={}),(typeof g.jws>"u"||!g.jws)&&(g.jws={}),g.jws.JWS=function(){var t=g,n=t.jws.JWS,a=n.isSafeJSONString;this.parseJWS=function(c,p){if(!(this.parsedJWS!==void 0&&(p||this.parsedJWS.sigvalH!==void 0))){var u=c.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(u==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var x=u[1],S=u[2],O=u[3],T=x+"."+S;if(this.parsedJWS={},this.parsedJWS.headB64U=x,this.parsedJWS.payloadB64U=S,this.parsedJWS.sigvalB64U=O,this.parsedJWS.si=T,!p){var B=it(O),N=Ut(B,16);this.parsedJWS.sigvalH=B,this.parsedJWS.sigvalBI=N}var _=ui(x),I=ui(S);if(this.parsedJWS.headS=_,this.parsedJWS.payloadS=I,!a(_,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+_}}},g.jws.JWS.sign=function(t,n,a,c,p){var u=g,x=u.jws,S=x.JWS,O=S.readSafeJSONString,T=S.isSafeJSONString,B=u.crypto;B.ECDSA;var N=B.Mac,_=B.Signature,I=JSON,P,A,L;if(typeof n!="string"&&typeof n!="object")throw"spHeader must be JSON string or object: "+n;if(typeof n=="object"&&(A=n,P=I.stringify(A)),typeof n=="string"){if(P=n,!T(P))throw"JWS Head is not safe JSON string: "+P;A=O(P)}if(L=a,typeof a=="object"&&(L=I.stringify(a)),(t==""||t==null)&&A.alg!==void 0&&(t=A.alg),t!=""&&t!=null&&A.alg===void 0&&(A.alg=t,P=I.stringify(A)),t!==A.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+A.alg;var K=null;if(S.jwsalg2sigalg[t]===void 0)throw"unsupported alg name: "+t;K=S.jwsalg2sigalg[t];var ie=Cr(P),ae=Cr(L),se=ie+"."+ae,ce="";if(K.substr(0,4)=="Hmac"){if(c===void 0)throw"mac key shall be specified for HS* alg";var z=new N({alg:K,prov:"cryptojs",pass:c});z.updateString(se),ce=z.doFinal()}else if(K.indexOf("withECDSA")!=-1){var G=new _({alg:K});G.init(c,p),G.updateString(se);var Q=G.sign();ce=g.crypto.ECDSA.asn1SigToConcatSig(Q)}else if(K!="none"){var G=new _({alg:K});G.init(c,p),G.updateString(se),ce=G.sign()}var W=_t(ce);return se+"."+W},g.jws.JWS.verify=function(t,n,a){var c=g,p=c.jws,u=p.JWS,x=u.readSafeJSONString,S=c.crypto,O=S.ECDSA,T=S.Mac,B=S.Signature,N;if(typeof Me!==void 0&&(N=Me),!rs(t))return!1;var _=t.split(".");if(_.length!==3)return!1;var I=_[0],P=_[1],A=I+"."+P,L=it(_[2]),K=x(ui(_[0])),ie=null,ae=null;if(K.alg===void 0)throw"algorithm not specified in header";if(ie=K.alg,ae=ie.substr(0,2),a!=null&&Object.prototype.toString.call(a)==="[object Array]"&&a.length>0){var se=":"+a.join(":")+":";if(se.indexOf(":"+ie+":")==-1)throw"algorithm '"+ie+"' not accepted in the list"}if(ie!="none"&&n===null)throw"key shall be specified to verify.";if(typeof n=="string"&&n.indexOf("-----BEGIN ")!=-1&&(n=qe.getKey(n)),(ae=="RS"||ae=="PS")&&!(n instanceof N))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ae=="ES"&&!(n instanceof O))throw"key shall be a ECDSA obj for ES* algs";var ce=null;if(u.jwsalg2sigalg[K.alg]===void 0)throw"unsupported alg name: "+ie;if(ce=u.jwsalg2sigalg[ie],ce=="none")throw"not supported";if(ce.substr(0,4)=="Hmac"){var z=null;if(n===void 0)throw"hexadecimal key shall be specified for HMAC";var G=new T({alg:ce,pass:n});return G.updateString(A),z=G.doFinal(),L==z}else if(ce.indexOf("withECDSA")!=-1){var Q=null;try{Q=O.concatSigToASN1Sig(L)}catch{return!1}var W=new B({alg:ce});return W.init(n),W.updateString(A),W.verify(Q)}else{var W=new B({alg:ce});return W.init(n),W.updateString(A),W.verify(L)}},g.jws.JWS.parse=function(t){var n=t.split("."),a={},c,p,u;if(n.length!=2&&n.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return c=n[0],p=n[1],n.length==3&&(u=n[2]),a.headerObj=g.jws.JWS.readSafeJSONString(ui(c)),a.payloadObj=g.jws.JWS.readSafeJSONString(ui(p)),a.headerPP=JSON.stringify(a.headerObj,null,"  "),a.payloadObj==null?a.payloadPP=ui(p):a.payloadPP=JSON.stringify(a.payloadObj,null,"  "),u!==void 0&&(a.sigHex=it(u)),a},g.jws.JWS.verifyJWT=function(t,n,a){var c=g,p=c.jws,u=p.JWS,x=u.readSafeJSONString,S=u.inArray,O=u.includedArray;if(!rs(t))return!1;var T=t.split(".");if(T.length!=3)return!1;var B=T[0],N=T[1];it(T[2]);var _=x(ui(B)),I=x(ui(N));if(_.alg===void 0)return!1;if(a.alg===void 0)throw"acceptField.alg shall be specified";if(!S(_.alg,a.alg)||I.iss!==void 0&&typeof a.iss=="object"&&!S(I.iss,a.iss)||I.sub!==void 0&&typeof a.sub=="object"&&!S(I.sub,a.sub))return!1;if(I.aud!==void 0&&typeof a.aud=="object"){if(typeof I.aud=="string"){if(!S(I.aud,a.aud))return!1}else if(typeof I.aud=="object"&&!O(I.aud,a.aud))return!1}var P=p.IntDate.getNow();return a.verifyAt!==void 0&&typeof a.verifyAt=="number"&&(P=a.verifyAt),(a.gracePeriod===void 0||typeof a.gracePeriod!="number")&&(a.gracePeriod=0),!(I.exp!==void 0&&typeof I.exp=="number"&&I.exp+a.gracePeriod<P||I.nbf!==void 0&&typeof I.nbf=="number"&&P<I.nbf-a.gracePeriod||I.iat!==void 0&&typeof I.iat=="number"&&P<I.iat-a.gracePeriod||I.jti!==void 0&&a.jti!==void 0&&I.jti!==a.jti||!u.verify(t,n,a.alg))},g.jws.JWS.includedArray=function(t,n){var a=g.jws.JWS.inArray;if(t===null||typeof t!="object"||typeof t.length!="number")return!1;for(var c=0;c<t.length;c++)if(!a(t[c],n))return!1;return!0},g.jws.JWS.inArray=function(t,n){if(n===null||typeof n!="object"||typeof n.length!="number")return!1;for(var a=0;a<n.length;a++)if(n[a]==t)return!0;return!1},g.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},g.jws.JWS.isSafeJSONString=function(t,n,a){var c=null;try{return c=ea(t),typeof c!="object"||c.constructor===Array?0:(n&&(n[a]=c),1)}catch{return 0}},g.jws.JWS.readSafeJSONString=function(t){var n=null;try{return n=ea(t),typeof n!="object"||n.constructor===Array?null:n}catch{return null}},g.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var n=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(n==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return n[1]},g.jws.JWS.getJWKthumbprint=function(t){if(t.kty!=="RSA"&&t.kty!=="EC"&&t.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var n="{";if(t.kty==="RSA"){if(typeof t.n!="string"||typeof t.e!="string")throw"wrong n and e value for RSA key";n+='"e":"'+t.e+'",',n+='"kty":"'+t.kty+'",',n+='"n":"'+t.n+'"}'}else if(t.kty==="EC"){if(typeof t.crv!="string"||typeof t.x!="string"||typeof t.y!="string")throw"wrong crv, x and y value for EC key";n+='"crv":"'+t.crv+'",',n+='"kty":"'+t.kty+'",',n+='"x":"'+t.x+'",',n+='"y":"'+t.y+'"}'}else if(t.kty==="oct"){if(typeof t.k!="string")throw"wrong k value for oct(symmetric) key";n+='"kty":"'+t.kty+'",',n+='"k":"'+t.k+'"}'}var a=Si(n),c=g.crypto.Util.hashHex(a,"sha256"),p=_t(c);return p},g.jws.IntDate={},g.jws.IntDate.get=function(t){var n=g.jws.IntDate,a=n.getNow,c=n.getZulu;if(t=="now")return a();if(t=="now + 1hour")return a()+60*60;if(t=="now + 1day")return a()+60*60*24;if(t=="now + 1month")return a()+60*60*24*30;if(t=="now + 1year")return a()+60*60*24*365;if(t.match(/Z$/))return c(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},g.jws.IntDate.getZulu=function(t){return na(t)},g.jws.IntDate.getNow=function(){var t=~~(new Date/1e3);return t},g.jws.IntDate.intDate2UTCString=function(t){var n=new Date(t*1e3);return n.toUTCString()},g.jws.IntDate.intDate2Zulu=function(t){var n=new Date(t*1e3),a=("0000"+n.getUTCFullYear()).slice(-4),c=("00"+(n.getUTCMonth()+1)).slice(-2),p=("00"+n.getUTCDate()).slice(-2),u=("00"+n.getUTCHours()).slice(-2),x=("00"+n.getUTCMinutes()).slice(-2),S=("00"+n.getUTCSeconds()).slice(-2);return a+c+p+u+x+S+"Z"},(typeof g>"u"||!g)&&(g={}),(typeof g.jws>"u"||!g.jws)&&(g.jws={}),g.jws.JWSJS=function(){var t=g,n=t.jws,a=n.JWS,c=a.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(p){this.init();var u=p.split(".");if(u.length!=3)throw"malformed input JWS";this.aHeader.push(u[0]),this.sPayload=u[1],this.aSignature.push(u[2])},this.addSignature=function(p,u,x,S){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var O=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var T=g.jws.JWS.sign(p,u,this.sPayload,x,S),B=T.split("."),N=B[0],_=B[2];this.aHeader.push(B[0]),this.aSignature.push(B[2])}catch(I){throw this.aHeader.length>O&&this.aHeader.pop(),this.aSignature.length>O&&this.aSignature.pop(),"addSignature failed: "+I}},this.verifyAll=function(p){if(this.aHeader.length!==p.length||this.aSignature.length!==p.length)return!1;for(var u=0;u<p.length;u++){var x=p[u];if(x.length!==2)return!1;var S=this.verifyNth(u,x[0],x[1]);if(S===!1)return!1}return!0},this.verifyNth=function(p,u,x){if(this.aHeader.length<=p||this.aSignature.length<=p)return!1;var S=this.aHeader[p],O=this.aSignature[p],T=S+"."+this.sPayload+"."+O,B=!1;try{B=a.verify(T,u,x)}catch{return!1}return B},this.readJWSJS=function(p){if(typeof p=="string"){var u=c(p);if(u==null)throw"argument is not safe JSON object string";this.aHeader=u.headers,this.sPayload=u.payload,this.aSignature=u.signatures}else try{if(p.headers.length>0)this.aHeader=p.headers;else throw"malformed header";if(typeof p.payload=="string")this.sPayload=p.payload;else throw"malformed signatures";if(p.signatures.length>0)this.aSignature=p.signatures;else throw"malformed signatures"}catch(x){throw"malformed JWS-JS JSON object: "+x}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}},e.SecureRandom=lr,e.rng_seed_time=$n,e.BigInteger=E,e.RSAKey=Me,e.ECDSA=g.crypto.ECDSA,e.DSA=g.crypto.DSA,e.Signature=g.crypto.Signature,e.MessageDigest=g.crypto.MessageDigest,e.Mac=g.crypto.Mac,e.KEYUTIL=qe,e.ASN1HEX=Ee,e.X509=Oe,e.X509CRL=Jd,e.CryptoJS=l,e.b64tohex=h,e.b64toBA=v,e.ECFieldElementFp=yt,e.ECPointFp=We,e.ECCurveFp=Di,e.stoBA=ta,e.BAtos=ia,e.BAtohex=Gr,e.stohex=qt,e.stob64=Id,e.stob64u=Dd,e.b64utos=Ad,e.b64tob64u=dr,e.b64utob64=wr,e.hex2b64=C,e.hextob64u=_t,e.b64utohex=it,e.utf8tob64u=Cr,e.b64utoutf8=ui,e.utf8tob64=Fd,e.b64toutf8=kd,e.utf8tohex=Jr,e.hextoutf8=Qe,e.hextorstr=Vt,e.rstrtohex=Si,e.hextob64=Qn,e.hextob64nl=Nd,e.b64nltohex=ra,e.hextopem=Tt,e.pemtohex=ut,e.hextoArrayBuffer=Bd,e.ArrayBuffertohex=Hd,e.zulutomsec=Yn,e.msectozulu=Ud,e.zulutosec=na,e.zulutodate=qd,e.datetozulu=Vd,e.uricmptohex=Qr,e.hextouricmp=Yr,e.ipv6tohex=Zn,e.hextoipv6=es,e.hextoip=Zr,e.iptohex=ts,e.ucs2hextoutf8=is,e.encodeURIComponentAll=en,e.newline_toUnix=Kd,e.newline_toDos=zd,e.hextoposhex=ns,e.intarystrtohex=Wd,e.strdiffidx=$d,e.oidtohex=la,e.hextooid=tn,e.strpad=rn,e.bitstrtoint=ua,e.inttobitstr=ha,e.bitstrtobinstr=pa,e.binstrtobitstr=Gd,e.isBase64URLDot=rs,e.namearraytobinstr=nn,e.extendClass=ye,e.foldnl=Xr,e.b64topem=Ld,e.pemtob64=jd,e.timeogen=sa,e.aryval=ht,e.inttohex=da,e.twoscompl=xr,e.KJUR=g,e.crypto=g.crypto,e.asn1=g.asn1,e.jws=g.jws,e.lang=g.lang,e.VERSION=s,e.VERSION_FULL=o}}),Ls=fe({"../../node_modules/isomorphic-ws/browser.js"(e,i){Z();var r=null;typeof WebSocket<"u"?r=WebSocket:typeof MozWebSocket<"u"?r=MozWebSocket:typeof global<"u"?r=global.WebSocket||global.MozWebSocket:typeof window<"u"?r=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(r=self.WebSocket||self.MozWebSocket),i.exports=r}}),uo=fe({"../../node_modules/deepmerge/dist/cjs.js"(e,i){Z();var r=function(w){return s(w)&&!o(w)};function s(f){return!!f&&typeof f=="object"}function o(f){var w=Object.prototype.toString.call(f);return w==="[object RegExp]"||w==="[object Date]"||m(f)}var l=typeof Symbol=="function"&&Symbol.for,d=l?Symbol.for("react.element"):60103;function m(f){return f.$$typeof===d}function C(f){return Array.isArray(f)?[]:{}}function h(f,w){return w.clone!==!1&&w.isMergeableObject(f)?k(C(f),f,w):f}function v(f,w,F){return f.concat(w).map(function(U){return h(U,F)})}function D(f,w){if(!w.customMerge)return k;var F=w.customMerge(f);return typeof F=="function"?F:k}function E(f){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(f).filter(function(w){return Object.propertyIsEnumerable.call(f,w)}):[]}function R(f){return Object.keys(f).concat(E(f))}function b(f,w){try{return w in f}catch{return!1}}function H(f,w){return b(f,w)&&!(Object.hasOwnProperty.call(f,w)&&Object.propertyIsEnumerable.call(f,w))}function j(f,w,F){var U={};return F.isMergeableObject(f)&&R(f).forEach(function(q){U[q]=h(f[q],F)}),R(w).forEach(function(q){H(f,q)||(b(f,q)&&F.isMergeableObject(w[q])?U[q]=D(q,F)(f[q],w[q],F):U[q]=h(w[q],F))}),U}function k(f,w,F){F=F||{},F.arrayMerge=F.arrayMerge||v,F.isMergeableObject=F.isMergeableObject||r,F.cloneUnlessOtherwiseSpecified=h;var U=Array.isArray(w),q=Array.isArray(f),V=U===q;return V?U?F.arrayMerge(f,w,F):j(f,w,F):h(w,F)}k.all=function(w,F){if(!Array.isArray(w))throw new Error("first argument should be an array");return w.reduce(function(U,q){return k(U,q,F)},{})};var y=k;i.exports=y}}),uu=fe({"../../node_modules/lodash/_listCacheClear.js"(e,i){Z();function r(){this.__data__=[],this.size=0}i.exports=r}}),ho=fe({"../../node_modules/lodash/eq.js"(e,i){Z();function r(s,o){return s===o||s!==s&&o!==o}i.exports=r}}),xn=fe({"../../node_modules/lodash/_assocIndexOf.js"(e,i){Z();var r=ho();function s(o,l){for(var d=o.length;d--;)if(r(o[d][0],l))return d;return-1}i.exports=s}}),hu=fe({"../../node_modules/lodash/_listCacheDelete.js"(e,i){Z();var r=xn(),s=Array.prototype,o=s.splice;function l(d){var m=this.__data__,C=r(m,d);if(C<0)return!1;var h=m.length-1;return C==h?m.pop():o.call(m,C,1),--this.size,!0}i.exports=l}}),pu=fe({"../../node_modules/lodash/_listCacheGet.js"(e,i){Z();var r=xn();function s(o){var l=this.__data__,d=r(l,o);return d<0?void 0:l[d][1]}i.exports=s}}),fu=fe({"../../node_modules/lodash/_listCacheHas.js"(e,i){Z();var r=xn();function s(o){return r(this.__data__,o)>-1}i.exports=s}}),mu=fe({"../../node_modules/lodash/_listCacheSet.js"(e,i){Z();var r=xn();function s(o,l){var d=this.__data__,m=r(d,o);return m<0?(++this.size,d.push([o,l])):d[m][1]=l,this}i.exports=s}}),En=fe({"../../node_modules/lodash/_ListCache.js"(e,i){Z();var r=uu(),s=hu(),o=pu(),l=fu(),d=mu();function m(C){var h=-1,v=C==null?0:C.length;for(this.clear();++h<v;){var D=C[h];this.set(D[0],D[1])}}m.prototype.clear=r,m.prototype.delete=s,m.prototype.get=o,m.prototype.has=l,m.prototype.set=d,i.exports=m}}),gu=fe({"../../node_modules/lodash/_stackClear.js"(e,i){Z();var r=En();function s(){this.__data__=new r,this.size=0}i.exports=s}}),vu=fe({"../../node_modules/lodash/_stackDelete.js"(e,i){Z();function r(s){var o=this.__data__,l=o.delete(s);return this.size=o.size,l}i.exports=r}}),bu=fe({"../../node_modules/lodash/_stackGet.js"(e,i){Z();function r(s){return this.__data__.get(s)}i.exports=r}}),yu=fe({"../../node_modules/lodash/_stackHas.js"(e,i){Z();function r(s){return this.__data__.has(s)}i.exports=r}}),po=fe({"../../node_modules/lodash/_freeGlobal.js"(e,i){Z();var r=typeof global=="object"&&global&&global.Object===Object&&global;i.exports=r}}),Fi=fe({"../../node_modules/lodash/_root.js"(e,i){Z();var r=po(),s=typeof self=="object"&&self&&self.Object===Object&&self,o=r||s||Function("return this")();i.exports=o}}),js=fe({"../../node_modules/lodash/_Symbol.js"(e,i){Z();var r=Fi(),s=r.Symbol;i.exports=s}}),_u=fe({"../../node_modules/lodash/_getRawTag.js"(e,i){Z();var r=js(),s=Object.prototype,o=s.hasOwnProperty,l=s.toString,d=r?r.toStringTag:void 0;function m(C){var h=o.call(C,d),v=C[d];try{C[d]=void 0;var D=!0}catch{}var E=l.call(C);return D&&(h?C[d]=v:delete C[d]),E}i.exports=m}}),Su=fe({"../../node_modules/lodash/_objectToString.js"(e,i){Z();var r=Object.prototype,s=r.toString;function o(l){return s.call(l)}i.exports=o}}),Pn=fe({"../../node_modules/lodash/_baseGetTag.js"(e,i){Z();var r=js(),s=_u(),o=Su(),l="[object Null]",d="[object Undefined]",m=r?r.toStringTag:void 0;function C(h){return h==null?h===void 0?d:l:m&&m in Object(h)?s(h):o(h)}i.exports=C}}),fo=fe({"../../node_modules/lodash/isObject.js"(e,i){Z();function r(s){var o=typeof s;return s!=null&&(o=="object"||o=="function")}i.exports=r}}),mo=fe({"../../node_modules/lodash/isFunction.js"(e,i){Z();var r=Pn(),s=fo(),o="[object AsyncFunction]",l="[object Function]",d="[object GeneratorFunction]",m="[object Proxy]";function C(h){if(!s(h))return!1;var v=r(h);return v==l||v==d||v==o||v==m}i.exports=C}}),wu=fe({"../../node_modules/lodash/_coreJsData.js"(e,i){Z();var r=Fi(),s=r["__core-js_shared__"];i.exports=s}}),Cu=fe({"../../node_modules/lodash/_isMasked.js"(e,i){Z();var r=wu(),s=function(){var l=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}();function o(l){return!!s&&s in l}i.exports=o}}),go=fe({"../../node_modules/lodash/_toSource.js"(e,i){Z();var r=Function.prototype,s=r.toString;function o(l){if(l!=null){try{return s.call(l)}catch{}try{return l+""}catch{}}return""}i.exports=o}}),xu=fe({"../../node_modules/lodash/_baseIsNative.js"(e,i){Z();var r=mo(),s=Cu(),o=fo(),l=go(),d=/[\\^$.*+?()[\]{}|]/g,m=/^\[object .+?Constructor\]$/,C=Function.prototype,h=Object.prototype,v=C.toString,D=h.hasOwnProperty,E=RegExp("^"+v.call(D).replace(d,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R(b){if(!o(b)||s(b))return!1;var H=r(b)?E:m;return H.test(l(b))}i.exports=R}}),Eu=fe({"../../node_modules/lodash/_getValue.js"(e,i){Z();function r(s,o){return s==null?void 0:s[o]}i.exports=r}}),gr=fe({"../../node_modules/lodash/_getNative.js"(e,i){Z();var r=xu(),s=Eu();function o(l,d){var m=s(l,d);return r(m)?m:void 0}i.exports=o}}),Bs=fe({"../../node_modules/lodash/_Map.js"(e,i){Z();var r=gr(),s=Fi(),o=r(s,"Map");i.exports=o}}),Rn=fe({"../../node_modules/lodash/_nativeCreate.js"(e,i){Z();var r=gr(),s=r(Object,"create");i.exports=s}}),Pu=fe({"../../node_modules/lodash/_hashClear.js"(e,i){Z();var r=Rn();function s(){this.__data__=r?r(null):{},this.size=0}i.exports=s}}),Ru=fe({"../../node_modules/lodash/_hashDelete.js"(e,i){Z();function r(s){var o=this.has(s)&&delete this.__data__[s];return this.size-=o?1:0,o}i.exports=r}}),Tu=fe({"../../node_modules/lodash/_hashGet.js"(e,i){Z();var r=Rn(),s="__lodash_hash_undefined__",o=Object.prototype,l=o.hasOwnProperty;function d(m){var C=this.__data__;if(r){var h=C[m];return h===s?void 0:h}return l.call(C,m)?C[m]:void 0}i.exports=d}}),Iu=fe({"../../node_modules/lodash/_hashHas.js"(e,i){Z();var r=Rn(),s=Object.prototype,o=s.hasOwnProperty;function l(d){var m=this.__data__;return r?m[d]!==void 0:o.call(m,d)}i.exports=l}}),Du=fe({"../../node_modules/lodash/_hashSet.js"(e,i){Z();var r=Rn(),s="__lodash_hash_undefined__";function o(l,d){var m=this.__data__;return this.size+=this.has(l)?0:1,m[l]=r&&d===void 0?s:d,this}i.exports=o}}),Au=fe({"../../node_modules/lodash/_Hash.js"(e,i){Z();var r=Pu(),s=Ru(),o=Tu(),l=Iu(),d=Du();function m(C){var h=-1,v=C==null?0:C.length;for(this.clear();++h<v;){var D=C[h];this.set(D[0],D[1])}}m.prototype.clear=r,m.prototype.delete=s,m.prototype.get=o,m.prototype.has=l,m.prototype.set=d,i.exports=m}}),Fu=fe({"../../node_modules/lodash/_mapCacheClear.js"(e,i){Z();var r=Au(),s=En(),o=Bs();function l(){this.size=0,this.__data__={hash:new r,map:new(o||s),string:new r}}i.exports=l}}),ku=fe({"../../node_modules/lodash/_isKeyable.js"(e,i){Z();function r(s){var o=typeof s;return o=="string"||o=="number"||o=="symbol"||o=="boolean"?s!=="__proto__":s===null}i.exports=r}}),Tn=fe({"../../node_modules/lodash/_getMapData.js"(e,i){Z();var r=ku();function s(o,l){var d=o.__data__;return r(l)?d[typeof l=="string"?"string":"hash"]:d.map}i.exports=s}}),Ou=fe({"../../node_modules/lodash/_mapCacheDelete.js"(e,i){Z();var r=Tn();function s(o){var l=r(this,o).delete(o);return this.size-=l?1:0,l}i.exports=s}}),Mu=fe({"../../node_modules/lodash/_mapCacheGet.js"(e,i){Z();var r=Tn();function s(o){return r(this,o).get(o)}i.exports=s}}),Nu=fe({"../../node_modules/lodash/_mapCacheHas.js"(e,i){Z();var r=Tn();function s(o){return r(this,o).has(o)}i.exports=s}}),Lu=fe({"../../node_modules/lodash/_mapCacheSet.js"(e,i){Z();var r=Tn();function s(o,l){var d=r(this,o),m=d.size;return d.set(o,l),this.size+=d.size==m?0:1,this}i.exports=s}}),vo=fe({"../../node_modules/lodash/_MapCache.js"(e,i){Z();var r=Fu(),s=Ou(),o=Mu(),l=Nu(),d=Lu();function m(C){var h=-1,v=C==null?0:C.length;for(this.clear();++h<v;){var D=C[h];this.set(D[0],D[1])}}m.prototype.clear=r,m.prototype.delete=s,m.prototype.get=o,m.prototype.has=l,m.prototype.set=d,i.exports=m}}),ju=fe({"../../node_modules/lodash/_stackSet.js"(e,i){Z();var r=En(),s=Bs(),o=vo(),l=200;function d(m,C){var h=this.__data__;if(h instanceof r){var v=h.__data__;if(!s||v.length<l-1)return v.push([m,C]),this.size=++h.size,this;h=this.__data__=new o(v)}return h.set(m,C),this.size=h.size,this}i.exports=d}}),Bu=fe({"../../node_modules/lodash/_Stack.js"(e,i){Z();var r=En(),s=gu(),o=vu(),l=bu(),d=yu(),m=ju();function C(h){var v=this.__data__=new r(h);this.size=v.size}C.prototype.clear=s,C.prototype.delete=o,C.prototype.get=l,C.prototype.has=d,C.prototype.set=m,i.exports=C}}),Hu=fe({"../../node_modules/lodash/_setCacheAdd.js"(e,i){Z();var r="__lodash_hash_undefined__";function s(o){return this.__data__.set(o,r),this}i.exports=s}}),Uu=fe({"../../node_modules/lodash/_setCacheHas.js"(e,i){Z();function r(s){return this.__data__.has(s)}i.exports=r}}),qu=fe({"../../node_modules/lodash/_SetCache.js"(e,i){Z();var r=vo(),s=Hu(),o=Uu();function l(d){var m=-1,C=d==null?0:d.length;for(this.__data__=new r;++m<C;)this.add(d[m])}l.prototype.add=l.prototype.push=s,l.prototype.has=o,i.exports=l}}),Vu=fe({"../../node_modules/lodash/_arraySome.js"(e,i){Z();function r(s,o){for(var l=-1,d=s==null?0:s.length;++l<d;)if(o(s[l],l,s))return!0;return!1}i.exports=r}}),Ku=fe({"../../node_modules/lodash/_cacheHas.js"(e,i){Z();function r(s,o){return s.has(o)}i.exports=r}}),bo=fe({"../../node_modules/lodash/_equalArrays.js"(e,i){Z();var r=qu(),s=Vu(),o=Ku(),l=1,d=2;function m(C,h,v,D,E,R){var b=v&l,H=C.length,j=h.length;if(H!=j&&!(b&&j>H))return!1;var k=R.get(C),y=R.get(h);if(k&&y)return k==h&&y==C;var f=-1,w=!0,F=v&d?new r:void 0;for(R.set(C,h),R.set(h,C);++f<H;){var U=C[f],q=h[f];if(D)var V=b?D(q,U,f,h,C,R):D(U,q,f,C,h,R);if(V!==void 0){if(V)continue;w=!1;break}if(F){if(!s(h,function($,J){if(!o(F,J)&&(U===$||E(U,$,v,D,R)))return F.push(J)})){w=!1;break}}else if(!(U===q||E(U,q,v,D,R))){w=!1;break}}return R.delete(C),R.delete(h),w}i.exports=m}}),zu=fe({"../../node_modules/lodash/_Uint8Array.js"(e,i){Z();var r=Fi(),s=r.Uint8Array;i.exports=s}}),Wu=fe({"../../node_modules/lodash/_mapToArray.js"(e,i){Z();function r(s){var o=-1,l=Array(s.size);return s.forEach(function(d,m){l[++o]=[m,d]}),l}i.exports=r}}),$u=fe({"../../node_modules/lodash/_setToArray.js"(e,i){Z();function r(s){var o=-1,l=Array(s.size);return s.forEach(function(d){l[++o]=d}),l}i.exports=r}}),Gu=fe({"../../node_modules/lodash/_equalByTag.js"(e,i){Z();var r=js(),s=zu(),o=ho(),l=bo(),d=Wu(),m=$u(),C=1,h=2,v="[object Boolean]",D="[object Date]",E="[object Error]",R="[object Map]",b="[object Number]",H="[object RegExp]",j="[object Set]",k="[object String]",y="[object Symbol]",f="[object ArrayBuffer]",w="[object DataView]",F=r?r.prototype:void 0,U=F?F.valueOf:void 0;function q(V,$,J,X,ee,re,ne){switch(J){case w:if(V.byteLength!=$.byteLength||V.byteOffset!=$.byteOffset)return!1;V=V.buffer,$=$.buffer;case f:return!(V.byteLength!=$.byteLength||!re(new s(V),new s($)));case v:case D:case b:return o(+V,+$);case E:return V.name==$.name&&V.message==$.message;case H:case k:return V==$+"";case R:var Ce=d;case j:var Re=X&C;if(Ce||(Ce=m),V.size!=$.size&&!Re)return!1;var ke=ne.get(V);if(ke)return ke==$;X|=h,ne.set(V,$);var Y=l(Ce(V),Ce($),X,ee,re,ne);return ne.delete(V),Y;case y:if(U)return U.call(V)==U.call($)}return!1}i.exports=q}}),Ju=fe({"../../node_modules/lodash/_arrayPush.js"(e,i){Z();function r(s,o){for(var l=-1,d=o.length,m=s.length;++l<d;)s[m+l]=o[l];return s}i.exports=r}}),Hs=fe({"../../node_modules/lodash/isArray.js"(e,i){Z();var r=Array.isArray;i.exports=r}}),Xu=fe({"../../node_modules/lodash/_baseGetAllKeys.js"(e,i){Z();var r=Ju(),s=Hs();function o(l,d,m){var C=d(l);return s(l)?C:r(C,m(l))}i.exports=o}}),Qu=fe({"../../node_modules/lodash/_arrayFilter.js"(e,i){Z();function r(s,o){for(var l=-1,d=s==null?0:s.length,m=0,C=[];++l<d;){var h=s[l];o(h,l,s)&&(C[m++]=h)}return C}i.exports=r}}),Yu=fe({"../../node_modules/lodash/stubArray.js"(e,i){Z();function r(){return[]}i.exports=r}}),Zu=fe({"../../node_modules/lodash/_getSymbols.js"(e,i){Z();var r=Qu(),s=Yu(),o=Object.prototype,l=o.propertyIsEnumerable,d=Object.getOwnPropertySymbols,m=d?function(C){return C==null?[]:(C=Object(C),r(d(C),function(h){return l.call(C,h)}))}:s;i.exports=m}}),eh=fe({"../../node_modules/lodash/_baseTimes.js"(e,i){Z();function r(s,o){for(var l=-1,d=Array(s);++l<s;)d[l]=o(l);return d}i.exports=r}}),In=fe({"../../node_modules/lodash/isObjectLike.js"(e,i){Z();function r(s){return s!=null&&typeof s=="object"}i.exports=r}}),th=fe({"../../node_modules/lodash/_baseIsArguments.js"(e,i){Z();var r=Pn(),s=In(),o="[object Arguments]";function l(d){return s(d)&&r(d)==o}i.exports=l}}),ih=fe({"../../node_modules/lodash/isArguments.js"(e,i){Z();var r=th(),s=In(),o=Object.prototype,l=o.hasOwnProperty,d=o.propertyIsEnumerable,m=r(function(){return arguments}())?r:function(C){return s(C)&&l.call(C,"callee")&&!d.call(C,"callee")};i.exports=m}}),rh=fe({"../../node_modules/lodash/stubFalse.js"(e,i){Z();function r(){return!1}i.exports=r}}),yo=fe({"../../node_modules/lodash/isBuffer.js"(e,i){Z();var r=Fi(),s=rh(),o=typeof e=="object"&&e&&!e.nodeType&&e,l=o&&typeof i=="object"&&i&&!i.nodeType&&i,d=l&&l.exports===o,m=d?r.Buffer:void 0,C=m?m.isBuffer:void 0,h=C||s;i.exports=h}}),nh=fe({"../../node_modules/lodash/_isIndex.js"(e,i){Z();var r=9007199254740991,s=/^(?:0|[1-9]\d*)$/;function o(l,d){var m=typeof l;return d=d??r,!!d&&(m=="number"||m!="symbol"&&s.test(l))&&l>-1&&l%1==0&&l<d}i.exports=o}}),_o=fe({"../../node_modules/lodash/isLength.js"(e,i){Z();var r=9007199254740991;function s(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=r}i.exports=s}}),sh=fe({"../../node_modules/lodash/_baseIsTypedArray.js"(e,i){Z();var r=Pn(),s=_o(),o=In(),l="[object Arguments]",d="[object Array]",m="[object Boolean]",C="[object Date]",h="[object Error]",v="[object Function]",D="[object Map]",E="[object Number]",R="[object Object]",b="[object RegExp]",H="[object Set]",j="[object String]",k="[object WeakMap]",y="[object ArrayBuffer]",f="[object DataView]",w="[object Float32Array]",F="[object Float64Array]",U="[object Int8Array]",q="[object Int16Array]",V="[object Int32Array]",$="[object Uint8Array]",J="[object Uint8ClampedArray]",X="[object Uint16Array]",ee="[object Uint32Array]",re={};re[w]=re[F]=re[U]=re[q]=re[V]=re[$]=re[J]=re[X]=re[ee]=!0,re[l]=re[d]=re[y]=re[m]=re[f]=re[C]=re[h]=re[v]=re[D]=re[E]=re[R]=re[b]=re[H]=re[j]=re[k]=!1;function ne(Ce){return o(Ce)&&s(Ce.length)&&!!re[r(Ce)]}i.exports=ne}}),ah=fe({"../../node_modules/lodash/_baseUnary.js"(e,i){Z();function r(s){return function(o){return s(o)}}i.exports=r}}),oh=fe({"../../node_modules/lodash/_nodeUtil.js"(e,i){Z();var r=po(),s=typeof e=="object"&&e&&!e.nodeType&&e,o=s&&typeof i=="object"&&i&&!i.nodeType&&i,l=o&&o.exports===s,d=l&&r.process,m=function(){try{var C=o&&o.require&&o.require("util").types;return C||d&&d.binding&&d.binding("util")}catch{}}();i.exports=m}}),So=fe({"../../node_modules/lodash/isTypedArray.js"(e,i){Z();var r=sh(),s=ah(),o=oh(),l=o&&o.isTypedArray,d=l?s(l):r;i.exports=d}}),ch=fe({"../../node_modules/lodash/_arrayLikeKeys.js"(e,i){Z();var r=eh(),s=ih(),o=Hs(),l=yo(),d=nh(),m=So(),C=Object.prototype,h=C.hasOwnProperty;function v(D,E){var R=o(D),b=!R&&s(D),H=!R&&!b&&l(D),j=!R&&!b&&!H&&m(D),k=R||b||H||j,y=k?r(D.length,String):[],f=y.length;for(var w in D)(E||h.call(D,w))&&!(k&&(w=="length"||H&&(w=="offset"||w=="parent")||j&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||d(w,f)))&&y.push(w);return y}i.exports=v}}),lh=fe({"../../node_modules/lodash/_isPrototype.js"(e,i){Z();var r=Object.prototype;function s(o){var l=o&&o.constructor,d=typeof l=="function"&&l.prototype||r;return o===d}i.exports=s}}),dh=fe({"../../node_modules/lodash/_overArg.js"(e,i){Z();function r(s,o){return function(l){return s(o(l))}}i.exports=r}}),uh=fe({"../../node_modules/lodash/_nativeKeys.js"(e,i){Z();var r=dh(),s=r(Object.keys,Object);i.exports=s}}),hh=fe({"../../node_modules/lodash/_baseKeys.js"(e,i){Z();var r=lh(),s=uh(),o=Object.prototype,l=o.hasOwnProperty;function d(m){if(!r(m))return s(m);var C=[];for(var h in Object(m))l.call(m,h)&&h!="constructor"&&C.push(h);return C}i.exports=d}}),ph=fe({"../../node_modules/lodash/isArrayLike.js"(e,i){Z();var r=mo(),s=_o();function o(l){return l!=null&&s(l.length)&&!r(l)}i.exports=o}}),fh=fe({"../../node_modules/lodash/keys.js"(e,i){Z();var r=ch(),s=hh(),o=ph();function l(d){return o(d)?r(d):s(d)}i.exports=l}}),mh=fe({"../../node_modules/lodash/_getAllKeys.js"(e,i){Z();var r=Xu(),s=Zu(),o=fh();function l(d){return r(d,o,s)}i.exports=l}}),gh=fe({"../../node_modules/lodash/_equalObjects.js"(e,i){Z();var r=mh(),s=1,o=Object.prototype,l=o.hasOwnProperty;function d(m,C,h,v,D,E){var R=h&s,b=r(m),H=b.length,j=r(C),k=j.length;if(H!=k&&!R)return!1;for(var y=H;y--;){var f=b[y];if(!(R?f in C:l.call(C,f)))return!1}var w=E.get(m),F=E.get(C);if(w&&F)return w==C&&F==m;var U=!0;E.set(m,C),E.set(C,m);for(var q=R;++y<H;){f=b[y];var V=m[f],$=C[f];if(v)var J=R?v($,V,f,C,m,E):v(V,$,f,m,C,E);if(!(J===void 0?V===$||D(V,$,h,v,E):J)){U=!1;break}q||(q=f=="constructor")}if(U&&!q){var X=m.constructor,ee=C.constructor;X!=ee&&"constructor"in m&&"constructor"in C&&!(typeof X=="function"&&X instanceof X&&typeof ee=="function"&&ee instanceof ee)&&(U=!1)}return E.delete(m),E.delete(C),U}i.exports=d}}),vh=fe({"../../node_modules/lodash/_DataView.js"(e,i){Z();var r=gr(),s=Fi(),o=r(s,"DataView");i.exports=o}}),bh=fe({"../../node_modules/lodash/_Promise.js"(e,i){Z();var r=gr(),s=Fi(),o=r(s,"Promise");i.exports=o}}),yh=fe({"../../node_modules/lodash/_Set.js"(e,i){Z();var r=gr(),s=Fi(),o=r(s,"Set");i.exports=o}}),_h=fe({"../../node_modules/lodash/_WeakMap.js"(e,i){Z();var r=gr(),s=Fi(),o=r(s,"WeakMap");i.exports=o}}),Sh=fe({"../../node_modules/lodash/_getTag.js"(e,i){Z();var r=vh(),s=Bs(),o=bh(),l=yh(),d=_h(),m=Pn(),C=go(),h="[object Map]",v="[object Object]",D="[object Promise]",E="[object Set]",R="[object WeakMap]",b="[object DataView]",H=C(r),j=C(s),k=C(o),y=C(l),f=C(d),w=m;(r&&w(new r(new ArrayBuffer(1)))!=b||s&&w(new s)!=h||o&&w(o.resolve())!=D||l&&w(new l)!=E||d&&w(new d)!=R)&&(w=function(F){var U=m(F),q=U==v?F.constructor:void 0,V=q?C(q):"";if(V)switch(V){case H:return b;case j:return h;case k:return D;case y:return E;case f:return R}return U}),i.exports=w}}),wh=fe({"../../node_modules/lodash/_baseIsEqualDeep.js"(e,i){Z();var r=Bu(),s=bo(),o=Gu(),l=gh(),d=Sh(),m=Hs(),C=yo(),h=So(),v=1,D="[object Arguments]",E="[object Array]",R="[object Object]",b=Object.prototype,H=b.hasOwnProperty;function j(k,y,f,w,F,U){var q=m(k),V=m(y),$=q?E:d(k),J=V?E:d(y);$=$==D?R:$,J=J==D?R:J;var X=$==R,ee=J==R,re=$==J;if(re&&C(k)){if(!C(y))return!1;q=!0,X=!1}if(re&&!X)return U||(U=new r),q||h(k)?s(k,y,f,w,F,U):o(k,y,$,f,w,F,U);if(!(f&v)){var ne=X&&H.call(k,"__wrapped__"),Ce=ee&&H.call(y,"__wrapped__");if(ne||Ce){var Re=ne?k.value():k,ke=Ce?y.value():y;return U||(U=new r),F(Re,ke,f,w,U)}}return re?(U||(U=new r),l(k,y,f,w,F,U)):!1}i.exports=j}}),Ch=fe({"../../node_modules/lodash/_baseIsEqual.js"(e,i){Z();var r=wh(),s=In();function o(l,d,m,C,h){return l===d?!0:l==null||d==null||!s(l)&&!s(d)?l!==l&&d!==d:r(l,d,m,C,o,h)}i.exports=o}}),wo=fe({"../../node_modules/lodash/isEqual.js"(e,i){Z();var r=Ch();function s(o,l){return r(o,l)}i.exports=s}}),xh=fe({"../../node_modules/ms/index.js"(e,i){Z();var r=1e3,s=r*60,o=s*60,l=o*24,d=l*7,m=l*365.25;i.exports=function(E,R){R=R||{};var b=typeof E;if(b==="string"&&E.length>0)return C(E);if(b==="number"&&isFinite(E))return R.long?v(E):h(E);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(E))};function C(E){if(E=String(E),!(E.length>100)){var R=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(E);if(R){var b=parseFloat(R[1]),H=(R[2]||"ms").toLowerCase();switch(H){case"years":case"year":case"yrs":case"yr":case"y":return b*m;case"weeks":case"week":case"w":return b*d;case"days":case"day":case"d":return b*l;case"hours":case"hour":case"hrs":case"hr":case"h":return b*o;case"minutes":case"minute":case"mins":case"min":case"m":return b*s;case"seconds":case"second":case"secs":case"sec":case"s":return b*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:return}}}}function h(E){var R=Math.abs(E);return R>=l?Math.round(E/l)+"d":R>=o?Math.round(E/o)+"h":R>=s?Math.round(E/s)+"m":R>=r?Math.round(E/r)+"s":E+"ms"}function v(E){var R=Math.abs(E);return R>=l?D(E,R,l,"day"):R>=o?D(E,R,o,"hour"):R>=s?D(E,R,s,"minute"):R>=r?D(E,R,r,"second"):E+" ms"}function D(E,R,b,H){var j=R>=b*1.5;return Math.round(E/b)+" "+H+(j?"s":"")}}}),Eh=fe({"../../node_modules/debug/src/common.js"(e,i){Z();function r(s){l.debug=l,l.default=l,l.coerce=D,l.disable=C,l.enable=m,l.enabled=h,l.humanize=xh(),l.destroy=E,Object.keys(s).forEach(R=>{l[R]=s[R]}),l.names=[],l.skips=[],l.formatters={};function o(R){let b=0;for(let H=0;H<R.length;H++)b=(b<<5)-b+R.charCodeAt(H),b|=0;return l.colors[Math.abs(b)%l.colors.length]}l.selectColor=o;function l(R){let b,H=null,j,k;function y(...f){if(!y.enabled)return;const w=y,F=Number(new Date),U=F-(b||F);w.diff=U,w.prev=b,w.curr=F,b=F,f[0]=l.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");let q=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,($,J)=>{if($==="%%")return"%";q++;const X=l.formatters[J];if(typeof X=="function"){const ee=f[q];$=X.call(w,ee),f.splice(q,1),q--}return $}),l.formatArgs.call(w,f),(w.log||l.log).apply(w,f)}return y.namespace=R,y.useColors=l.useColors(),y.color=l.selectColor(R),y.extend=d,y.destroy=l.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>H!==null?H:(j!==l.namespaces&&(j=l.namespaces,k=l.enabled(R)),k),set:f=>{H=f}}),typeof l.init=="function"&&l.init(y),y}function d(R,b){const H=l(this.namespace+(typeof b>"u"?":":b)+R);return H.log=this.log,H}function m(R){l.save(R),l.namespaces=R,l.names=[],l.skips=[];let b;const H=(typeof R=="string"?R:"").split(/[\s,]+/),j=H.length;for(b=0;b<j;b++)H[b]&&(R=H[b].replace(/\*/g,".*?"),R[0]==="-"?l.skips.push(new RegExp("^"+R.slice(1)+"$")):l.names.push(new RegExp("^"+R+"$")))}function C(){const R=[...l.names.map(v),...l.skips.map(v).map(b=>"-"+b)].join(",");return l.enable(""),R}function h(R){if(R[R.length-1]==="*")return!0;let b,H;for(b=0,H=l.skips.length;b<H;b++)if(l.skips[b].test(R))return!1;for(b=0,H=l.names.length;b<H;b++)if(l.names[b].test(R))return!0;return!1}function v(R){return R.toString().substring(2,R.toString().length-2).replace(/\.\*\?$/,"*")}function D(R){return R instanceof Error?R.stack||R.message:R}function E(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return l.enable(l.load()),l}i.exports=r}}),Dn=fe({"../../node_modules/debug/src/browser.js"(e,i){Z(),e.formatArgs=s,e.save=o,e.load=l,e.useColors=r,e.storage=d(),e.destroy=(()=>{let C=!1;return()=>{C||(C=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(C){if(C[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+C[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;C.splice(1,0,h,"color: inherit");let v=0,D=0;C[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(v++,E==="%c"&&(D=v))}),C.splice(D,0,h)}e.log=console.debug||console.log||(()=>{});function o(C){try{C?e.storage.setItem("debug",C):e.storage.removeItem("debug")}catch{}}function l(){let C;try{C=e.storage.getItem("debug")}catch{}return!C&&typeof hr<"u"&&"env"in hr&&(C=hr.env.DEBUG),C}function d(){try{return localStorage}catch{}}i.exports=Eh()(e);var{formatters:m}=i.exports;m.j=function(C){try{return JSON.stringify(C)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}}),St=fe({"../../node_modules/mediasoup-client/lib/Logger.js"(e){Z();var i=e&&e.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var r=i(Dn()),s="mediasoup-client",o=class{constructor(l){l?(this._debug=(0,r.default)(`${s}:${l}`),this._warn=(0,r.default)(`${s}:WARN:${l}`),this._error=(0,r.default)(`${s}:ERROR:${l}`)):(this._debug=(0,r.default)(s),this._warn=(0,r.default)(`${s}:WARN`),this._error=(0,r.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};e.Logger=o}}),Ph=fe({"../../node_modules/events/events.js"(e,i){Z();var r=typeof Reflect=="object"?Reflect:null,s=r&&typeof r.apply=="function"?r.apply:function(q,V,$){return Function.prototype.apply.call(q,V,$)},o;r&&typeof r.ownKeys=="function"?o=r.ownKeys:Object.getOwnPropertySymbols?o=function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:o=function(q){return Object.getOwnPropertyNames(q)};function l(U){console&&console.warn&&console.warn(U)}var d=Number.isNaN||function(q){return q!==q};function m(){m.init.call(this)}i.exports=m,i.exports.once=f,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var C=10;function h(U){if(typeof U!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof U)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return C},set:function(U){if(typeof U!="number"||U<0||d(U))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+U+".");C=U}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(q){if(typeof q!="number"||q<0||d(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this};function v(U){return U._maxListeners===void 0?m.defaultMaxListeners:U._maxListeners}m.prototype.getMaxListeners=function(){return v(this)},m.prototype.emit=function(q){for(var V=[],$=1;$<arguments.length;$++)V.push(arguments[$]);var J=q==="error",X=this._events;if(X!==void 0)J=J&&X.error===void 0;else if(!J)return!1;if(J){var ee;if(V.length>0&&(ee=V[0]),ee instanceof Error)throw ee;var re=new Error("Unhandled error."+(ee?" ("+ee.message+")":""));throw re.context=ee,re}var ne=X[q];if(ne===void 0)return!1;if(typeof ne=="function")s(ne,this,V);else for(var Ce=ne.length,Re=j(ne,Ce),$=0;$<Ce;++$)s(Re[$],this,V);return!0};function D(U,q,V,$){var J,X,ee;if(h(V),X=U._events,X===void 0?(X=U._events=Object.create(null),U._eventsCount=0):(X.newListener!==void 0&&(U.emit("newListener",q,V.listener?V.listener:V),X=U._events),ee=X[q]),ee===void 0)ee=X[q]=V,++U._eventsCount;else if(typeof ee=="function"?ee=X[q]=$?[V,ee]:[ee,V]:$?ee.unshift(V):ee.push(V),J=v(U),J>0&&ee.length>J&&!ee.warned){ee.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+ee.length+" "+String(q)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=U,re.type=q,re.count=ee.length,l(re)}return U}m.prototype.addListener=function(q,V){return D(this,q,V,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(q,V){return D(this,q,V,!0)};function E(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(U,q,V){var $={fired:!1,wrapFn:void 0,target:U,type:q,listener:V},J=E.bind($);return J.listener=V,$.wrapFn=J,J}m.prototype.once=function(q,V){return h(V),this.on(q,R(this,q,V)),this},m.prototype.prependOnceListener=function(q,V){return h(V),this.prependListener(q,R(this,q,V)),this},m.prototype.removeListener=function(q,V){var $,J,X,ee,re;if(h(V),J=this._events,J===void 0)return this;if($=J[q],$===void 0)return this;if($===V||$.listener===V)--this._eventsCount===0?this._events=Object.create(null):(delete J[q],J.removeListener&&this.emit("removeListener",q,$.listener||V));else if(typeof $!="function"){for(X=-1,ee=$.length-1;ee>=0;ee--)if($[ee]===V||$[ee].listener===V){re=$[ee].listener,X=ee;break}if(X<0)return this;X===0?$.shift():k($,X),$.length===1&&(J[q]=$[0]),J.removeListener!==void 0&&this.emit("removeListener",q,re||V)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(q){var V,$,J;if($=this._events,$===void 0)return this;if($.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):$[q]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete $[q]),this;if(arguments.length===0){var X=Object.keys($),ee;for(J=0;J<X.length;++J)ee=X[J],ee!=="removeListener"&&this.removeAllListeners(ee);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(V=$[q],typeof V=="function")this.removeListener(q,V);else if(V!==void 0)for(J=V.length-1;J>=0;J--)this.removeListener(q,V[J]);return this};function b(U,q,V){var $=U._events;if($===void 0)return[];var J=$[q];return J===void 0?[]:typeof J=="function"?V?[J.listener||J]:[J]:V?y(J):j(J,J.length)}m.prototype.listeners=function(q){return b(this,q,!0)},m.prototype.rawListeners=function(q){return b(this,q,!1)},m.listenerCount=function(U,q){return typeof U.listenerCount=="function"?U.listenerCount(q):H.call(U,q)},m.prototype.listenerCount=H;function H(U){var q=this._events;if(q!==void 0){var V=q[U];if(typeof V=="function")return 1;if(V!==void 0)return V.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};function j(U,q){for(var V=new Array(q),$=0;$<q;++$)V[$]=U[$];return V}function k(U,q){for(;q+1<U.length;q++)U[q]=U[q+1];U.pop()}function y(U){for(var q=new Array(U.length),V=0;V<q.length;++V)q[V]=U[V].listener||U[V];return q}function f(U,q){return new Promise(function(V,$){function J(ee){U.removeListener(q,X),$(ee)}function X(){typeof U.removeListener=="function"&&U.removeListener("error",J),V([].slice.call(arguments))}F(U,q,X,{once:!0}),q!=="error"&&w(U,J,{once:!0})})}function w(U,q,V){typeof U.on=="function"&&F(U,"error",q,V)}function F(U,q,V,$){if(typeof U.on=="function")$.once?U.once(q,V):U.on(q,V);else if(typeof U.addEventListener=="function")U.addEventListener(q,function J(X){$.once&&U.removeEventListener(q,J),V(X)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof U)}}}),ir=fe({"../../node_modules/mediasoup-client/lib/EnhancedEventEmitter.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.EnhancedEventEmitter=void 0;var i=Ph(),r=St(),s=new r.Logger("EnhancedEventEmitter"),o=class extends i.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(l,...d){return super.emit(l,...d)}safeEmit(l,...d){const m=super.listenerCount(l);try{return super.emit(l,...d)}catch(C){return s.error("safeEmit() | event listener threw an error [eventName:%s]:%o",l,C),!!m}}on(l,d){return super.on(l,d),this}off(l,d){return super.off(l,d),this}addListener(l,d){return super.on(l,d),this}prependListener(l,d){return super.prependListener(l,d),this}once(l,d){return super.once(l,d),this}prependOnceListener(l,d){return super.prependOnceListener(l,d),this}removeListener(l,d){return super.off(l,d),this}removeAllListeners(l){return super.removeAllListeners(l),this}listenerCount(l){return super.listenerCount(l)}listeners(l){return super.listeners(l)}rawListeners(l){return super.rawListeners(l)}};e.EnhancedEventEmitter=o}}),Ei=fe({"../../node_modules/mediasoup-client/lib/errors.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.InvalidStateError=e.UnsupportedError=void 0;var i=class Co extends Error{constructor(o){super(o),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,Co):this.stack=new Error(o).stack}};e.UnsupportedError=i;var r=class xo extends Error{constructor(o){super(o),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,xo):this.stack=new Error(o).stack}};e.InvalidStateError=r}}),kt=fe({"../../node_modules/mediasoup-client/lib/utils.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.generateRandomNumber=e.clone=void 0;function i(s,o){return typeof s>"u"?o:JSON.parse(JSON.stringify(s))}e.clone=i;function r(){return Math.round(Math.random()*1e7)}e.generateRandomNumber=r}}),Rh=fe({"../../node_modules/h264-profile-level-id/index.js"(e){Z();var i=Dn()("h264-profile-level-id");i.log=console.info.bind(console);var r=1,s=2,o=3,l=4,d=5;e.ProfileConstrainedBaseline=r,e.ProfileBaseline=s,e.ProfileMain=o,e.ProfileConstrainedHigh=l,e.ProfileHigh=d;var m=0,C=10,h=11,v=12,D=13,E=20,R=21,b=22,H=30,j=31,k=32,y=40,f=41,w=42,F=50,U=51,q=52;e.Level1_b=m,e.Level1=C,e.Level1_1=h,e.Level1_2=v,e.Level1_3=D,e.Level2=E,e.Level2_1=R,e.Level2_2=b,e.Level3=H,e.Level3_1=j,e.Level3_2=k,e.Level4=y,e.Level4_1=f,e.Level4_2=w,e.Level5=F,e.Level5_1=U,e.Level5_2=q;var V=class{constructor(Y,he){this.profile=Y,this.level=he}};e.ProfileLevelId=V;var $=new V(r,j),J=16,X=class{constructor(Y){this._mask=~ne("x",Y),this._maskedValue=ne("1",Y)}isMatch(Y){return this._maskedValue===(Y&this._mask)}},ee=class{constructor(Y,he,be){this.profile_idc=Y,this.profile_iop=he,this.profile=be}},re=[new ee(66,new X("x1xx0000"),r),new ee(77,new X("1xxx0000"),r),new ee(88,new X("11xx0000"),r),new ee(66,new X("x0xx0000"),s),new ee(88,new X("10xx0000"),s),new ee(77,new X("0x0x0000"),o),new ee(100,new X("00000000"),d),new ee(100,new X("00001100"),l)];e.parseProfileLevelId=function(Y){if(typeof Y!="string"||Y.length!==6)return null;const he=parseInt(Y,16);if(he===0)return null;const be=he&255,me=he>>8&255,Te=he>>16&255;let Be;switch(be){case h:{Be=me&J?m:h;break}case C:case v:case D:case E:case R:case b:case H:case j:case k:case y:case f:case w:case F:case U:case q:{Be=be;break}default:return i("parseProfileLevelId() | unrecognized level_idc:%s",be),null}for(const st of re)if(Te===st.profile_idc&&st.profile_iop.isMatch(me))return new V(st.profile,Be);return i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},e.profileLevelIdToString=function(Y){if(Y.level==m)switch(Y.profile){case r:return"42f00b";case s:return"42100b";case o:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",Y.profile),null}let he;switch(Y.profile){case r:{he="42e0";break}case s:{he="4200";break}case o:{he="4d00";break}case l:{he="640c";break}case d:{he="6400";break}default:return i("profileLevelIdToString() | unrecognized profile:%s",Y.profile),null}let be=Y.level.toString(16);return be.length===1&&(be=`0${be}`),`${he}${be}`},e.parseSdpProfileLevelId=function(Y={}){const he=Y["profile-level-id"];return he?e.parseProfileLevelId(he):$},e.isSameProfile=function(Y={},he={}){const be=e.parseSdpProfileLevelId(Y),me=e.parseSdpProfileLevelId(he);return!!(be&&me&&be.profile===me.profile)},e.generateProfileLevelIdForAnswer=function(Y={},he={}){if(!Y["profile-level-id"]&&!he["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const be=e.parseSdpProfileLevelId(Y),me=e.parseSdpProfileLevelId(he);if(!be)throw new TypeError("invalid local_profile_level_id");if(!me)throw new TypeError("invalid remote_profile_level_id");if(be.profile!==me.profile)throw new TypeError("H264 Profile mismatch");const Te=ke(Y)&&ke(he),Be=be.level,st=me.level,ti=Re(Be,st),Gt=Te?Be:ti;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",be.profile,Gt),e.profileLevelIdToString(new V(be.profile,Gt))};function ne(Y,he){return(he[0]===Y)<<7|(he[1]===Y)<<6|(he[2]===Y)<<5|(he[3]===Y)<<4|(he[4]===Y)<<3|(he[5]===Y)<<2|(he[6]===Y)<<1|(he[7]===Y)<<0}function Ce(Y,he){return Y===m?he!==C&&he!==m:he===m?Y!==C:Y<he}function Re(Y,he){return Ce(Y,he)?Y:he}function ke(Y={}){const he=Y["level-asymmetry-allowed"];return he===1||he==="1"}}}),Zt=fe({"../../node_modules/mediasoup-client/lib/ortc.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(Y,he,be,me){me===void 0&&(me=be);var Te=Object.getOwnPropertyDescriptor(he,be);(!Te||("get"in Te?!he.__esModule:Te.writable||Te.configurable))&&(Te={enumerable:!0,get:function(){return he[be]}}),Object.defineProperty(Y,me,Te)}:function(Y,he,be,me){me===void 0&&(me=be),Y[me]=he[be]}),r=e&&e.__setModuleDefault||(Object.create?function(Y,he){Object.defineProperty(Y,"default",{enumerable:!0,value:he})}:function(Y,he){Y.default=he}),s=e&&e.__importStar||function(Y){if(Y&&Y.__esModule)return Y;var he={};if(Y!=null)for(var be in Y)be!=="default"&&Object.prototype.hasOwnProperty.call(Y,be)&&i(he,Y,be);return r(he,Y),he};Object.defineProperty(e,"__esModule",{value:!0}),e.canReceive=e.canSend=e.generateProbatorRtpParameters=e.reduceCodecs=e.getSendingRemoteRtpParameters=e.getSendingRtpParameters=e.getRecvRtpCapabilities=e.getExtendedRtpCapabilities=e.validateSctpStreamParameters=e.validateSctpParameters=e.validateNumSctpStreams=e.validateSctpCapabilities=e.validateRtcpParameters=e.validateRtpEncodingParameters=e.validateRtpHeaderExtensionParameters=e.validateRtpCodecParameters=e.validateRtpParameters=e.validateRtpHeaderExtension=e.validateRtcpFeedback=e.validateRtpCodecCapability=e.validateRtpCapabilities=void 0;var o=s(Rh()),l=s(kt()),d="probator",m=1234,C=127;function h(Y){if(typeof Y!="object")throw new TypeError("caps is not an object");if(Y.codecs&&!Array.isArray(Y.codecs))throw new TypeError("caps.codecs is not an array");Y.codecs||(Y.codecs=[]);for(const he of Y.codecs)v(he);if(Y.headerExtensions&&!Array.isArray(Y.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");Y.headerExtensions||(Y.headerExtensions=[]);for(const he of Y.headerExtensions)E(he)}e.validateRtpCapabilities=h;function v(Y){const he=new RegExp("^(audio|video)/(.+)","i");if(typeof Y!="object")throw new TypeError("codec is not an object");if(!Y.mimeType||typeof Y.mimeType!="string")throw new TypeError("missing codec.mimeType");const be=he.exec(Y.mimeType);if(!be)throw new TypeError("invalid codec.mimeType");if(Y.kind=be[1].toLowerCase(),Y.preferredPayloadType&&typeof Y.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof Y.clockRate!="number")throw new TypeError("missing codec.clockRate");Y.kind==="audio"?typeof Y.channels!="number"&&(Y.channels=1):delete Y.channels,(!Y.parameters||typeof Y.parameters!="object")&&(Y.parameters={});for(const me of Object.keys(Y.parameters)){let Te=Y.parameters[me];if(Te===void 0&&(Y.parameters[me]="",Te=""),typeof Te!="string"&&typeof Te!="number")throw new TypeError(`invalid codec parameter [key:${me}s, value:${Te}]`);if(me==="apt"&&typeof Te!="number")throw new TypeError("invalid codec apt parameter")}(!Y.rtcpFeedback||!Array.isArray(Y.rtcpFeedback))&&(Y.rtcpFeedback=[]);for(const me of Y.rtcpFeedback)D(me)}e.validateRtpCodecCapability=v;function D(Y){if(typeof Y!="object")throw new TypeError("fb is not an object");if(!Y.type||typeof Y.type!="string")throw new TypeError("missing fb.type");(!Y.parameter||typeof Y.parameter!="string")&&(Y.parameter="")}e.validateRtcpFeedback=D;function E(Y){if(typeof Y!="object")throw new TypeError("ext is not an object");if(Y.kind!=="audio"&&Y.kind!=="video")throw new TypeError("invalid ext.kind");if(!Y.uri||typeof Y.uri!="string")throw new TypeError("missing ext.uri");if(typeof Y.preferredId!="number")throw new TypeError("missing ext.preferredId");if(Y.preferredEncrypt&&typeof Y.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(Y.preferredEncrypt||(Y.preferredEncrypt=!1),Y.direction&&typeof Y.direction!="string")throw new TypeError("invalid ext.direction");Y.direction||(Y.direction="sendrecv")}e.validateRtpHeaderExtension=E;function R(Y){if(typeof Y!="object")throw new TypeError("params is not an object");if(Y.mid&&typeof Y.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(Y.codecs))throw new TypeError("missing params.codecs");for(const he of Y.codecs)b(he);if(Y.headerExtensions&&!Array.isArray(Y.headerExtensions))throw new TypeError("params.headerExtensions is not an array");Y.headerExtensions||(Y.headerExtensions=[]);for(const he of Y.headerExtensions)H(he);if(Y.encodings&&!Array.isArray(Y.encodings))throw new TypeError("params.encodings is not an array");Y.encodings||(Y.encodings=[]);for(const he of Y.encodings)j(he);if(Y.rtcp&&typeof Y.rtcp!="object")throw new TypeError("params.rtcp is not an object");Y.rtcp||(Y.rtcp={}),k(Y.rtcp)}e.validateRtpParameters=R;function b(Y){const he=new RegExp("^(audio|video)/(.+)","i");if(typeof Y!="object")throw new TypeError("codec is not an object");if(!Y.mimeType||typeof Y.mimeType!="string")throw new TypeError("missing codec.mimeType");const be=he.exec(Y.mimeType);if(!be)throw new TypeError("invalid codec.mimeType");if(typeof Y.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof Y.clockRate!="number")throw new TypeError("missing codec.clockRate");be[1].toLowerCase()==="audio"?typeof Y.channels!="number"&&(Y.channels=1):delete Y.channels,(!Y.parameters||typeof Y.parameters!="object")&&(Y.parameters={});for(const Te of Object.keys(Y.parameters)){let Be=Y.parameters[Te];if(Be===void 0&&(Y.parameters[Te]="",Be=""),typeof Be!="string"&&typeof Be!="number")throw new TypeError(`invalid codec parameter [key:${Te}s, value:${Be}]`);if(Te==="apt"&&typeof Be!="number")throw new TypeError("invalid codec apt parameter")}(!Y.rtcpFeedback||!Array.isArray(Y.rtcpFeedback))&&(Y.rtcpFeedback=[]);for(const Te of Y.rtcpFeedback)D(Te)}e.validateRtpCodecParameters=b;function H(Y){if(typeof Y!="object")throw new TypeError("ext is not an object");if(!Y.uri||typeof Y.uri!="string")throw new TypeError("missing ext.uri");if(typeof Y.id!="number")throw new TypeError("missing ext.id");if(Y.encrypt&&typeof Y.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");Y.encrypt||(Y.encrypt=!1),(!Y.parameters||typeof Y.parameters!="object")&&(Y.parameters={});for(const he of Object.keys(Y.parameters)){let be=Y.parameters[he];if(be===void 0&&(Y.parameters[he]="",be=""),typeof be!="string"&&typeof be!="number")throw new TypeError("invalid header extension parameter")}}e.validateRtpHeaderExtensionParameters=H;function j(Y){if(typeof Y!="object")throw new TypeError("encoding is not an object");if(Y.ssrc&&typeof Y.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(Y.rid&&typeof Y.rid!="string")throw new TypeError("invalid encoding.rid");if(Y.rtx&&typeof Y.rtx!="object")throw new TypeError("invalid encoding.rtx");if(Y.rtx&&typeof Y.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!Y.dtx||typeof Y.dtx!="boolean")&&(Y.dtx=!1),Y.scalabilityMode&&typeof Y.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}e.validateRtpEncodingParameters=j;function k(Y){if(typeof Y!="object")throw new TypeError("rtcp is not an object");if(Y.cname&&typeof Y.cname!="string")throw new TypeError("invalid rtcp.cname");(!Y.reducedSize||typeof Y.reducedSize!="boolean")&&(Y.reducedSize=!0)}e.validateRtcpParameters=k;function y(Y){if(typeof Y!="object")throw new TypeError("caps is not an object");if(!Y.numStreams||typeof Y.numStreams!="object")throw new TypeError("missing caps.numStreams");f(Y.numStreams)}e.validateSctpCapabilities=y;function f(Y){if(typeof Y!="object")throw new TypeError("numStreams is not an object");if(typeof Y.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof Y.MIS!="number")throw new TypeError("missing numStreams.MIS")}e.validateNumSctpStreams=f;function w(Y){if(typeof Y!="object")throw new TypeError("params is not an object");if(typeof Y.port!="number")throw new TypeError("missing params.port");if(typeof Y.OS!="number")throw new TypeError("missing params.OS");if(typeof Y.MIS!="number")throw new TypeError("missing params.MIS");if(typeof Y.maxMessageSize!="number")throw new TypeError("missing params.maxMessageSize")}e.validateSctpParameters=w;function F(Y){if(typeof Y!="object")throw new TypeError("params is not an object");if(typeof Y.streamId!="number")throw new TypeError("missing params.streamId");let he=!1;if(typeof Y.ordered=="boolean"?he=!0:Y.ordered=!0,Y.maxPacketLifeTime&&typeof Y.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(Y.maxRetransmits&&typeof Y.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(Y.maxPacketLifeTime&&Y.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(he&&Y.ordered&&(Y.maxPacketLifeTime||Y.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!he&&(Y.maxPacketLifeTime||Y.maxRetransmits)&&(Y.ordered=!1),Y.label&&typeof Y.label!="string")throw new TypeError("invalid params.label");if(Y.protocol&&typeof Y.protocol!="string")throw new TypeError("invalid params.protocol")}e.validateSctpStreamParameters=F;function U(Y,he){const be={codecs:[],headerExtensions:[]};for(const me of he.codecs||[]){if(ne(me))continue;const Te=(Y.codecs||[]).find(st=>Ce(st,me,{strict:!0,modify:!0}));if(!Te)continue;const Be={mimeType:Te.mimeType,kind:Te.kind,clockRate:Te.clockRate,channels:Te.channels,localPayloadType:Te.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:me.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:Te.parameters,remoteParameters:me.parameters,rtcpFeedback:ke(Te,me)};be.codecs.push(Be)}for(const me of be.codecs){const Te=Y.codecs.find(st=>ne(st)&&st.parameters.apt===me.localPayloadType),Be=he.codecs.find(st=>ne(st)&&st.parameters.apt===me.remotePayloadType);Te&&Be&&(me.localRtxPayloadType=Te.preferredPayloadType,me.remoteRtxPayloadType=Be.preferredPayloadType)}for(const me of he.headerExtensions){const Te=Y.headerExtensions.find(st=>Re(st,me));if(!Te)continue;const Be={kind:me.kind,uri:me.uri,sendId:Te.preferredId,recvId:me.preferredId,encrypt:Te.preferredEncrypt,direction:"sendrecv"};switch(me.direction){case"sendrecv":Be.direction="sendrecv";break;case"recvonly":Be.direction="sendonly";break;case"sendonly":Be.direction="recvonly";break;case"inactive":Be.direction="inactive";break}be.headerExtensions.push(Be)}return be}e.getExtendedRtpCapabilities=U;function q(Y){const he={codecs:[],headerExtensions:[]};for(const be of Y.codecs){const me={mimeType:be.mimeType,kind:be.kind,preferredPayloadType:be.remotePayloadType,clockRate:be.clockRate,channels:be.channels,parameters:be.localParameters,rtcpFeedback:be.rtcpFeedback};if(he.codecs.push(me),!be.remoteRtxPayloadType)continue;const Te={mimeType:`${be.kind}/rtx`,kind:be.kind,preferredPayloadType:be.remoteRtxPayloadType,clockRate:be.clockRate,parameters:{apt:be.remotePayloadType},rtcpFeedback:[]};he.codecs.push(Te)}for(const be of Y.headerExtensions){if(be.direction!=="sendrecv"&&be.direction!=="recvonly")continue;const me={kind:be.kind,uri:be.uri,preferredId:be.recvId,preferredEncrypt:be.encrypt,direction:be.direction};he.headerExtensions.push(me)}return he}e.getRecvRtpCapabilities=q;function V(Y,he){const be={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const me of he.codecs){if(me.kind!==Y)continue;const Te={mimeType:me.mimeType,payloadType:me.localPayloadType,clockRate:me.clockRate,channels:me.channels,parameters:me.localParameters,rtcpFeedback:me.rtcpFeedback};if(be.codecs.push(Te),me.localRtxPayloadType){const Be={mimeType:`${me.kind}/rtx`,payloadType:me.localRtxPayloadType,clockRate:me.clockRate,parameters:{apt:me.localPayloadType},rtcpFeedback:[]};be.codecs.push(Be)}}for(const me of he.headerExtensions){if(me.kind&&me.kind!==Y||me.direction!=="sendrecv"&&me.direction!=="sendonly")continue;const Te={uri:me.uri,id:me.sendId,encrypt:me.encrypt,parameters:{}};be.headerExtensions.push(Te)}return be}e.getSendingRtpParameters=V;function $(Y,he){const be={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const me of he.codecs){if(me.kind!==Y)continue;const Te={mimeType:me.mimeType,payloadType:me.localPayloadType,clockRate:me.clockRate,channels:me.channels,parameters:me.remoteParameters,rtcpFeedback:me.rtcpFeedback};if(be.codecs.push(Te),me.localRtxPayloadType){const Be={mimeType:`${me.kind}/rtx`,payloadType:me.localRtxPayloadType,clockRate:me.clockRate,parameters:{apt:me.localPayloadType},rtcpFeedback:[]};be.codecs.push(Be)}}for(const me of he.headerExtensions){if(me.kind&&me.kind!==Y||me.direction!=="sendrecv"&&me.direction!=="sendonly")continue;const Te={uri:me.uri,id:me.sendId,encrypt:me.encrypt,parameters:{}};be.headerExtensions.push(Te)}if(be.headerExtensions.some(me=>me.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const me of be.codecs)me.rtcpFeedback=(me.rtcpFeedback||[]).filter(Te=>Te.type!=="goog-remb");else if(be.headerExtensions.some(me=>me.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const me of be.codecs)me.rtcpFeedback=(me.rtcpFeedback||[]).filter(Te=>Te.type!=="transport-cc");else for(const me of be.codecs)me.rtcpFeedback=(me.rtcpFeedback||[]).filter(Te=>Te.type!=="transport-cc"&&Te.type!=="goog-remb");return be}e.getSendingRemoteRtpParameters=$;function J(Y,he){const be=[];if(!he)be.push(Y[0]),ne(Y[1])&&be.push(Y[1]);else{for(let me=0;me<Y.length;++me)if(Ce(Y[me],he)){be.push(Y[me]),ne(Y[me+1])&&be.push(Y[me+1]);break}if(be.length===0)throw new TypeError("no matching codec found")}return be}e.reduceCodecs=J;function X(Y){Y=l.clone(Y,{}),R(Y);const he={mid:d,codecs:[],headerExtensions:[],encodings:[{ssrc:m}],rtcp:{cname:"probator"}};return he.codecs.push(Y.codecs[0]),he.codecs[0].payloadType=C,he.headerExtensions=Y.headerExtensions,he}e.generateProbatorRtpParameters=X;function ee(Y,he){return he.codecs.some(be=>be.kind===Y)}e.canSend=ee;function re(Y,he){if(R(Y),Y.codecs.length===0)return!1;const be=Y.codecs[0];return he.codecs.some(me=>me.remotePayloadType===be.payloadType)}e.canReceive=re;function ne(Y){return Y?/.+\/rtx$/i.test(Y.mimeType):!1}function Ce(Y,he,{strict:be=!1,modify:me=!1}={}){const Te=Y.mimeType.toLowerCase(),Be=he.mimeType.toLowerCase();if(Te!==Be||Y.clockRate!==he.clockRate||Y.channels!==he.channels)return!1;switch(Te){case"video/h264":{if(be){const st=Y.parameters["packetization-mode"]||0,ti=he.parameters["packetization-mode"]||0;if(st!==ti||!o.isSameProfile(Y.parameters,he.parameters))return!1;let Gt;try{Gt=o.generateProfileLevelIdForAnswer(Y.parameters,he.parameters)}catch{return!1}me&&(Gt?(Y.parameters["profile-level-id"]=Gt,he.parameters["profile-level-id"]=Gt):(delete Y.parameters["profile-level-id"],delete he.parameters["profile-level-id"]))}break}case"video/vp9":{if(be){const st=Y.parameters["profile-id"]||0,ti=he.parameters["profile-id"]||0;if(st!==ti)return!1}break}}return!0}function Re(Y,he){return!(Y.kind&&he.kind&&Y.kind!==he.kind||Y.uri!==he.uri)}function ke(Y,he){const be=[];for(const me of Y.rtcpFeedback||[]){const Te=(he.rtcpFeedback||[]).find(Be=>Be.type===me.type&&(Be.parameter===me.parameter||!Be.parameter&&!me.parameter));Te&&be.push(Te)}return be}}}),Th=fe({"../../node_modules/awaitqueue/lib/Logger.js"(e){Z();var i=e&&e.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var r=i(Dn()),s="awaitqueue",o=class{constructor(l){l?(this._debug=(0,r.default)(`${s}:${l}`),this._warn=(0,r.default)(`${s}:WARN:${l}`),this._error=(0,r.default)(`${s}:ERROR:${l}`)):(this._debug=(0,r.default)(s),this._warn=(0,r.default)(`${s}:WARN`),this._error=(0,r.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};e.Logger=o}}),Ih=fe({"../../node_modules/awaitqueue/lib/index.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueue=e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=void 0;var i=Th(),r=new i.Logger,s=class Eo extends Error{constructor(m){super(m??"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Eo)}};e.AwaitQueueStoppedError=s;var o=class Po extends Error{constructor(m){super(m??"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Po)}};e.AwaitQueueRemovedTaskError=o;var l=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}push(d,m){return M(this,null,function*(){if(m=m??d.name,r.debug(`push() [name:${m}]`),typeof d!="function")throw new TypeError("given task is not a function");if(m)try{Object.defineProperty(d,"name",{value:m})}catch{}return new Promise((C,h)=>{const v={id:this.nextTaskId++,task:d,name:m,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:D=>{if(v.completed)return;v.completed=!0,this.pendingTasks.delete(v.id),r.debug(`resolving task [name:${v.name}]`),C(D);const[E]=this.pendingTasks.values();E&&!E.executedAt&&this.execute(E)},reject:D=>{if(!v.completed&&(v.completed=!0,this.pendingTasks.delete(v.id),r.debug(`rejecting task [name:${v.name}]: %s`,String(D)),h(D),!this.stopping)){const[E]=this.pendingTasks.values();E&&!E.executedAt&&this.execute(E)}}};this.pendingTasks.set(v.id,v),this.pendingTasks.size===1&&this.execute(v)})})}stop(){r.debug("stop()"),this.stopping=!0;for(const d of this.pendingTasks.values())r.debug(`stop() | stopping task [name:${d.name}]`),d.reject(new s);this.stopping=!1}remove(d){r.debug(`remove() [taskIdx:${d}]`);const m=Array.from(this.pendingTasks.values())[d];if(!m){r.debug(`stop() | no task with given idx [taskIdx:${d}]`);return}m.reject(new o)}dump(){const d=Date.now();let m=0;return Array.from(this.pendingTasks.values()).map(C=>({idx:m++,task:C.task,name:C.name,enqueuedTime:C.executedAt?C.executedAt-C.enqueuedAt:d-C.enqueuedAt,executionTime:C.executedAt?d-C.executedAt:0}))}execute(d){return M(this,null,function*(){if(r.debug(`execute() [name:${d.name}]`),d.executedAt)throw new Error("task already being executed");d.executedAt=Date.now();try{const m=yield d.task();d.resolve(m)}catch(m){d.reject(m)}})}};e.AwaitQueue=l}}),Dh=fe({"../../node_modules/queue-microtask/index.js"(e,i){Z();var r;i.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):s=>(r||(r=Promise.resolve())).then(s).catch(o=>setTimeout(()=>{throw o},0))}}),Ro=fe({"../../node_modules/mediasoup-client/lib/Producer.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.Producer=void 0;var i=St(),r=ir(),s=Ei(),o=new i.Logger("Producer"),l=class extends r.EnhancedEventEmitter{constructor({id:d,localId:m,rtpSender:C,track:h,rtpParameters:v,stopTracks:D,disableTrackOnPause:E,zeroRtpOnPause:R,appData:b}){super(),this._closed=!1,this._observer=new r.EnhancedEventEmitter,o.debug("constructor()"),this._id=d,this._localId=m,this._rtpSender=C,this._track=h,this._kind=h.kind,this._rtpParameters=v,this._paused=E?!h.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=D,this._disableTrackOnPause=E,this._zeroRtpOnPause=R,this._appData=b||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(d){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return M(this,null,function*(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((d,m)=>{this.safeEmit("@getstats",d,m)})})}pause(){if(o.debug("pause()"),this._closed){o.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((d,m)=>{this.safeEmit("@pause",d,m)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(o.debug("resume()"),this._closed){o.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((d,m)=>{this.safeEmit("@resume",d,m)}).catch(()=>{}),this._observer.safeEmit("resume")}replaceTrack(d){return M(this,arguments,function*({track:m}){if(o.debug("replaceTrack() [track:%o]",m),this._closed){if(m&&this._stopTracks)try{m.stop()}catch{}throw new s.InvalidStateError("closed")}else if(m&&m.readyState==="ended")throw new s.InvalidStateError("track ended");if(m===this._track){o.debug("replaceTrack() | same track, ignored");return}yield new Promise((C,h)=>{this.safeEmit("@replacetrack",m,C,h)}),this.destroyTrack(),this._track=m,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()})}setMaxSpatialLayer(d){return M(this,null,function*(){if(this._closed)throw new s.InvalidStateError("closed");if(this._kind!=="video")throw new s.UnsupportedError("not a video Producer");if(typeof d!="number")throw new TypeError("invalid spatialLayer");d!==this._maxSpatialLayer&&(yield new Promise((m,C)=>{this.safeEmit("@setmaxspatiallayer",d,m,C)}).catch(()=>{}),this._maxSpatialLayer=d)})}setRtpEncodingParameters(d){return M(this,null,function*(){if(this._closed)throw new s.InvalidStateError("closed");if(typeof d!="object")throw new TypeError("invalid params");yield new Promise((m,C)=>{this.safeEmit("@setrtpencodingparameters",d,m,C)})})}onTrackEnded(){o.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};e.Producer=l}}),To=fe({"../../node_modules/mediasoup-client/lib/Consumer.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.Consumer=void 0;var i=St(),r=ir(),s=Ei(),o=new i.Logger("Consumer"),l=class extends r.EnhancedEventEmitter{constructor({id:d,localId:m,producerId:C,rtpReceiver:h,track:v,rtpParameters:D,appData:E}){super(),this._closed=!1,this._observer=new r.EnhancedEventEmitter,o.debug("constructor()"),this._id=d,this._localId=m,this._producerId=C,this._rtpReceiver=h,this._track=v,this._rtpParameters=D,this._paused=!v.enabled,this._appData=E||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(d){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return M(this,null,function*(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((d,m)=>{this.safeEmit("@getstats",d,m)})})}pause(){if(o.debug("pause()"),this._closed){o.error("pause() | Consumer closed");return}if(this._paused){o.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(o.debug("resume()"),this._closed){o.error("resume() | Consumer closed");return}if(!this._paused){o.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){o.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};e.Consumer=l}}),Io=fe({"../../node_modules/mediasoup-client/lib/DataProducer.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.DataProducer=void 0;var i=St(),r=ir(),s=Ei(),o=new i.Logger("DataProducer"),l=class extends r.EnhancedEventEmitter{constructor({id:d,dataChannel:m,sctpStreamParameters:C,appData:h}){super(),this._closed=!1,this._observer=new r.EnhancedEventEmitter,o.debug("constructor()"),this._id=d,this._dataChannel=m,this._sctpStreamParameters=C,this._appData=h||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(d){this._dataChannel.bufferedAmountLowThreshold=d}get appData(){return this._appData}set appData(d){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(d){if(o.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(d)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(o.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",d=>{if(this._closed)return;let{error:m}=d;m||(m=new Error("unknown DataChannel error")),m.errorDetail==="sctp-failure"?o.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",m.sctpCauseCode,m.message):o.error('DataChannel "error" event: %o',m),this.safeEmit("error",m)}),this._dataChannel.addEventListener("close",()=>{this._closed||(o.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||o.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};e.DataProducer=l}}),Do=fe({"../../node_modules/mediasoup-client/lib/DataConsumer.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.DataConsumer=void 0;var i=St(),r=ir(),s=new i.Logger("DataConsumer"),o=class extends r.EnhancedEventEmitter{constructor({id:l,dataProducerId:d,dataChannel:m,sctpStreamParameters:C,appData:h}){super(),this._closed=!1,this._observer=new r.EnhancedEventEmitter,s.debug("constructor()"),this._id=l,this._dataProducerId=d,this._dataChannel=m,this._sctpStreamParameters=C,this._appData=h||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(l){this._dataChannel.binaryType=l}get appData(){return this._appData}set appData(l){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",l=>{if(this._closed)return;let{error:d}=l;d||(d=new Error("unknown DataChannel error")),d.errorDetail==="sctp-failure"?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",d.sctpCauseCode,d.message):s.error('DataChannel "error" event: %o',d),this.safeEmit("error",d)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",l=>{this._closed||this.safeEmit("message",l.data)})}};e.DataConsumer=o}}),Ao=fe({"../../node_modules/mediasoup-client/lib/Transport.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(f,w,F,U){U===void 0&&(U=F);var q=Object.getOwnPropertyDescriptor(w,F);(!q||("get"in q?!w.__esModule:q.writable||q.configurable))&&(q={enumerable:!0,get:function(){return w[F]}}),Object.defineProperty(f,U,q)}:function(f,w,F,U){U===void 0&&(U=F),f[U]=w[F]}),r=e&&e.__setModuleDefault||(Object.create?function(f,w){Object.defineProperty(f,"default",{enumerable:!0,value:w})}:function(f,w){f.default=w}),s=e&&e.__importStar||function(f){if(f&&f.__esModule)return f;var w={};if(f!=null)for(var F in f)F!=="default"&&Object.prototype.hasOwnProperty.call(f,F)&&i(w,f,F);return r(w,f),w},o=e&&e.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=void 0;var l=Ih(),d=o(Dh()),m=St(),C=ir(),h=Ei(),v=s(kt()),D=s(Zt()),E=Ro(),R=To(),b=Io(),H=Do(),j=new m.Logger("Transport"),k=class{constructor(f){this.consumerOptions=f,this.promise=new Promise((w,F)=>{this.resolve=w,this.reject=F})}},y=class extends C.EnhancedEventEmitter{constructor({direction:f,id:w,iceParameters:F,iceCandidates:U,dtlsParameters:q,sctpParameters:V,iceServers:$,iceTransportPolicy:J,additionalSettings:X,proprietaryConstraints:ee,appData:re,handlerFactory:ne,extendedRtpCapabilities:Ce,canProduceByKind:Re}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new l.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new C.EnhancedEventEmitter,j.debug("constructor() [id:%s, direction:%s]",w,f),this._id=w,this._direction=f,this._extendedRtpCapabilities=Ce,this._canProduceByKind=Re,this._maxSctpMessageSize=V?V.maxMessageSize:null,X=v.clone(X,{}),delete X.iceServers,delete X.iceTransportPolicy,delete X.bundlePolicy,delete X.rtcpMuxPolicy,delete X.sdpSemantics,this._handler=ne(),this._handler.run({direction:f,iceParameters:F,iceCandidates:U,dtlsParameters:q,sctpParameters:V,iceServers:$,iceTransportPolicy:J,additionalSettings:X,proprietaryConstraints:ee,extendedRtpCapabilities:Ce}),this._appData=re||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(f){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){j.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const f of this._producers.values())f.transportClosed();this._producers.clear();for(const f of this._consumers.values())f.transportClosed();this._consumers.clear();for(const f of this._dataProducers.values())f.transportClosed();this._dataProducers.clear();for(const f of this._dataConsumers.values())f.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}getStats(){return M(this,null,function*(){if(this._closed)throw new h.InvalidStateError("closed");return this._handler.getTransportStats()})}restartIce(f){return M(this,arguments,function*({iceParameters:w}){if(j.debug("restartIce()"),this._closed)throw new h.InvalidStateError("closed");if(!w)throw new TypeError("missing iceParameters");return this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.restartIce(w)}),"transport.restartIce()")})}updateIceServers(){return M(this,arguments,function*({iceServers:f}={}){if(j.debug("updateIceServers()"),this._closed)throw new h.InvalidStateError("closed");if(!Array.isArray(f))throw new TypeError("missing iceServers");return this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.updateIceServers(f)}),"transport.updateIceServers()")})}produce(){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U,stopTracks:q=!0,disableTrackOnPause:V=!0,zeroRtpOnPause:$=!1,appData:J={}}={}){if(j.debug("produce() [track:%o]",f),this._closed)throw new h.InvalidStateError("closed");if(f){if(this._direction!=="send")throw new h.UnsupportedError("not a sending Transport");if(this._canProduceByKind[f.kind]){if(f.readyState==="ended")throw new h.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(J&&typeof J!="object")throw new TypeError("if given, appData must be an object")}else throw new h.UnsupportedError(`cannot produce ${f.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(()=>M(this,null,function*(){let X;if(w&&!Array.isArray(w))throw TypeError("encodings must be an array");w&&w.length===0?X=void 0:w&&(X=w.map(Ce=>{const Re={active:!0};return Ce.active===!1&&(Re.active=!1),typeof Ce.dtx=="boolean"&&(Re.dtx=Ce.dtx),typeof Ce.scalabilityMode=="string"&&(Re.scalabilityMode=Ce.scalabilityMode),typeof Ce.scaleResolutionDownBy=="number"&&(Re.scaleResolutionDownBy=Ce.scaleResolutionDownBy),typeof Ce.maxBitrate=="number"&&(Re.maxBitrate=Ce.maxBitrate),typeof Ce.maxFramerate=="number"&&(Re.maxFramerate=Ce.maxFramerate),typeof Ce.adaptivePtime=="boolean"&&(Re.adaptivePtime=Ce.adaptivePtime),typeof Ce.priority=="string"&&(Re.priority=Ce.priority),typeof Ce.networkPriority=="string"&&(Re.networkPriority=Ce.networkPriority),Re}));const{localId:ee,rtpParameters:re,rtpSender:ne}=yield this._handler.send({track:f,encodings:X,codecOptions:F,codec:U});try{D.validateRtpParameters(re);const{id:Ce}=yield new Promise((ke,Y)=>{this.safeEmit("produce",{kind:f.kind,rtpParameters:re,appData:J},ke,Y)}),Re=new E.Producer({id:Ce,localId:ee,rtpSender:ne,track:f,rtpParameters:re,stopTracks:q,disableTrackOnPause:V,zeroRtpOnPause:$,appData:J});return this._producers.set(Re.id,Re),this.handleProducer(Re),this._observer.safeEmit("newproducer",Re),Re}catch(Ce){throw this._handler.stopSending(ee).catch(()=>{}),Ce}}),"transport.produce()").catch(X=>{if(q)try{f.stop()}catch{}throw X})})}consume(f){return M(this,arguments,function*({id:w,producerId:F,kind:U,rtpParameters:q,streamId:V,appData:$={}}){if(j.debug("consume()"),q=v.clone(q,void 0),this._closed)throw new h.InvalidStateError("closed");if(this._direction!=="recv")throw new h.UnsupportedError("not a receiving Transport");if(typeof w!="string")throw new TypeError("missing id");if(typeof F!="string")throw new TypeError("missing producerId");if(U!=="audio"&&U!=="video")throw new TypeError(`invalid kind '${U}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if($&&typeof $!="object")throw new TypeError("if given, appData must be an object");if(!D.canReceive(q,this._extendedRtpCapabilities))throw new h.UnsupportedError("cannot consume this Producer");const X=new k({id:w,producerId:F,kind:U,rtpParameters:q,streamId:V,appData:$});return this._pendingConsumerTasks.push(X),(0,d.default)(()=>{if(this._closed)throw new h.InvalidStateError("closed");this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),X.promise})}produceData(){return M(this,arguments,function*({ordered:f=!0,maxPacketLifeTime:w,maxRetransmits:F,label:U="",protocol:q="",appData:V={}}={}){if(j.debug("produceData()"),this._closed)throw new h.InvalidStateError("closed");if(this._direction!=="send")throw new h.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(V&&typeof V!="object")throw new TypeError("if given, appData must be an object")}else throw new h.UnsupportedError("SCTP not enabled by remote Transport");return(w||F)&&(f=!1),this._awaitQueue.push(()=>M(this,null,function*(){const{dataChannel:$,sctpStreamParameters:J}=yield this._handler.sendDataChannel({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q});D.validateSctpStreamParameters(J);const{id:X}=yield new Promise((re,ne)=>{this.safeEmit("producedata",{sctpStreamParameters:J,label:U,protocol:q,appData:V},re,ne)}),ee=new b.DataProducer({id:X,dataChannel:$,sctpStreamParameters:J,appData:V});return this._dataProducers.set(ee.id,ee),this.handleDataProducer(ee),this._observer.safeEmit("newdataproducer",ee),ee}),"transport.produceData()")})}consumeData(f){return M(this,arguments,function*({id:w,dataProducerId:F,sctpStreamParameters:U,label:q="",protocol:V="",appData:$={}}){if(j.debug("consumeData()"),U=v.clone(U,void 0),this._closed)throw new h.InvalidStateError("closed");if(this._direction!=="recv")throw new h.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof w!="string")throw new TypeError("missing id");if(typeof F!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if($&&typeof $!="object")throw new TypeError("if given, appData must be an object")}else throw new h.UnsupportedError("SCTP not enabled by remote Transport");return D.validateSctpStreamParameters(U),this._awaitQueue.push(()=>M(this,null,function*(){const{dataChannel:J}=yield this._handler.receiveDataChannel({sctpStreamParameters:U,label:q,protocol:V}),X=new H.DataConsumer({id:w,dataProducerId:F,dataChannel:J,sctpStreamParameters:U,appData:$});return this._dataConsumers.set(X.id,X),this.handleDataConsumer(X),this._observer.safeEmit("newdataconsumer",X),X}),"transport.consumeData()")})}createPendingConsumers(){return M(this,null,function*(){this._consumerCreationInProgress=!0,this._awaitQueue.push(()=>M(this,null,function*(){if(this._pendingConsumerTasks.length===0){j.debug("createPendingConsumers() | there is no Consumer to be created");return}const f=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let w;const F=[];for(const U of f){const{id:q,kind:V,rtpParameters:$,streamId:J}=U.consumerOptions;F.push({trackId:q,kind:V,rtpParameters:$,streamId:J})}try{const U=yield this._handler.receive(F);for(let q=0;q<U.length;q++){const V=f[q],$=U[q],{id:J,producerId:X,kind:ee,rtpParameters:re,appData:ne}=V.consumerOptions,{localId:Ce,rtpReceiver:Re,track:ke}=$,Y=new R.Consumer({id:J,localId:Ce,producerId:X,rtpReceiver:Re,track:ke,rtpParameters:re,appData:ne});this._consumers.set(Y.id,Y),this.handleConsumer(Y),!this._probatorConsumerCreated&&!w&&ee==="video"&&(w=Y),this._observer.safeEmit("newconsumer",Y),V.resolve(Y)}}catch(U){for(const q of f)q.reject(U)}if(w)try{const U=D.generateProbatorRtpParameters(w.rtpParameters);yield this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:U}]),j.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(U){j.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",U)}}),"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(()=>M(this,null,function*(){if(this._pendingPauseConsumers.size===0){j.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const f=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const w=f.map(F=>F.localId);yield this._handler.pauseReceiving(w)}catch(w){j.error("pausePendingConsumers() | failed to pause Consumers:",w)}}),"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(()=>M(this,null,function*(){if(this._pendingResumeConsumers.size===0){j.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const f=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const w=f.map(F=>F.localId);yield this._handler.resumeReceiving(w)}catch(w){j.error("resumePendingConsumers() | failed to resume Consumers:",w)}}),"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(()=>M(this,null,function*(){if(this._pendingCloseConsumers.size===0){j.debug("closePendingConsumers() | there is no Consumer to be closed");return}const f=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{yield this._handler.stopReceiving(f.map(w=>w.localId))}catch(w){j.error("closePendingConsumers() | failed to close Consumers:",w)}}),"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const f=this._handler;f.on("@connect",({dtlsParameters:w},F,U)=>{if(this._closed){U(new h.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:w},F,U)}),f.on("@connectionstatechange",w=>{w!==this._connectionState&&(j.debug("connection state changed to %s",w),this._connectionState=w,this._closed||this.safeEmit("connectionstatechange",w))})}handleProducer(f){f.on("@close",()=>{this._producers.delete(f.id),!this._closed&&this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.stopSending(f.localId)}),"producer @close event").catch(w=>j.warn("producer.close() failed:%o",w))}),f.on("@pause",(w,F)=>{this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.pauseSending(f.localId)}),"producer @pause event").then(w).catch(F)}),f.on("@resume",(w,F)=>{this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.resumeSending(f.localId)}),"producer @resume event").then(w).catch(F)}),f.on("@replacetrack",(w,F,U)=>{this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.replaceTrack(f.localId,w)}),"producer @replacetrack event").then(F).catch(U)}),f.on("@setmaxspatiallayer",(w,F,U)=>{this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.setMaxSpatialLayer(f.localId,w)}),"producer @setmaxspatiallayer event").then(F).catch(U)}),f.on("@setrtpencodingparameters",(w,F,U)=>{this._awaitQueue.push(()=>M(this,null,function*(){return this._handler.setRtpEncodingParameters(f.localId,w)}),"producer @setrtpencodingparameters event").then(F).catch(U)}),f.on("@getstats",(w,F)=>{if(this._closed)return F(new h.InvalidStateError("closed"));this._handler.getSenderStats(f.localId).then(w).catch(F)})}handleConsumer(f){f.on("@close",()=>{this._consumers.delete(f.id),this._pendingPauseConsumers.delete(f.id),this._pendingResumeConsumers.delete(f.id),!this._closed&&(this._pendingCloseConsumers.set(f.id,f),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),f.on("@pause",()=>{this._pendingResumeConsumers.has(f.id)&&this._pendingResumeConsumers.delete(f.id),this._pendingPauseConsumers.set(f.id,f),(0,d.default)(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),f.on("@resume",()=>{this._pendingPauseConsumers.has(f.id)&&this._pendingPauseConsumers.delete(f.id),this._pendingResumeConsumers.set(f.id,f),(0,d.default)(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),f.on("@getstats",(w,F)=>{if(this._closed)return F(new h.InvalidStateError("closed"));this._handler.getReceiverStats(f.localId).then(w).catch(F)})}handleDataProducer(f){f.on("@close",()=>{this._dataProducers.delete(f.id)})}handleDataConsumer(f){f.on("@close",()=>{this._dataConsumers.delete(f.id)})}};e.Transport=y}}),Pi=fe({"../../node_modules/mediasoup-client/lib/handlers/sdp/commonUtils.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(h,v,D,E){E===void 0&&(E=D);var R=Object.getOwnPropertyDescriptor(v,D);(!R||("get"in R?!v.__esModule:R.writable||R.configurable))&&(R={enumerable:!0,get:function(){return v[D]}}),Object.defineProperty(h,E,R)}:function(h,v,D,E){E===void 0&&(E=D),h[E]=v[D]}),r=e&&e.__setModuleDefault||(Object.create?function(h,v){Object.defineProperty(h,"default",{enumerable:!0,value:v})}:function(h,v){h.default=v}),s=e&&e.__importStar||function(h){if(h&&h.__esModule)return h;var v={};if(h!=null)for(var D in h)D!=="default"&&Object.prototype.hasOwnProperty.call(h,D)&&i(v,h,D);return r(v,h),v};Object.defineProperty(e,"__esModule",{value:!0}),e.applyCodecParameters=e.getCname=e.extractDtlsParameters=e.extractRtpCapabilities=void 0;var o=s(Ft());function l({sdpObject:h}){const v=new Map,D=[];let E=!1,R=!1;for(const H of h.media){const j=H.type;switch(j){case"audio":{if(E)continue;E=!0;break}case"video":{if(R)continue;R=!0;break}default:continue}for(const k of H.rtp){const y={kind:j,mimeType:`${j}/${k.codec}`,preferredPayloadType:k.payload,clockRate:k.rate,channels:k.encoding,parameters:{},rtcpFeedback:[]};v.set(y.preferredPayloadType,y)}for(const k of H.fmtp||[]){const y=o.parseParams(k.config),f=v.get(k.payload);f&&(y&&y.hasOwnProperty("profile-level-id")&&(y["profile-level-id"]=String(y["profile-level-id"])),f.parameters=y)}for(const k of H.rtcpFb||[]){const y={type:k.type,parameter:k.subtype};if(y.parameter||delete y.parameter,k.payload!=="*"){const f=v.get(k.payload);if(!f)continue;f.rtcpFeedback.push(y)}else for(const f of v.values())f.kind===j&&!/.+\/rtx$/i.test(f.mimeType)&&f.rtcpFeedback.push(y)}for(const k of H.ext||[]){if(k["encrypt-uri"])continue;const y={kind:j,uri:k.uri,preferredId:k.value};D.push(y)}}return{codecs:Array.from(v.values()),headerExtensions:D}}e.extractRtpCapabilities=l;function d({sdpObject:h}){const v=(h.media||[]).find(b=>b.iceUfrag&&b.port!==0);if(!v)throw new Error("no active media section found");const D=v.fingerprint||h.fingerprint;let E;switch(v.setup){case"active":E="client";break;case"passive":E="server";break;case"actpass":E="auto";break}return{role:E,fingerprints:[{algorithm:D.type,value:D.hash}]}}e.extractDtlsParameters=d;function m({offerMediaObject:h}){const v=(h.ssrcs||[]).find(D=>D.attribute==="cname");return v?v.value:""}e.getCname=m;function C({offerRtpParameters:h,answerMediaObject:v}){for(const D of h.codecs){const E=D.mimeType.toLowerCase();if(E!=="audio/opus"||!(v.rtp||[]).find(j=>j.payload===D.payloadType))continue;v.fmtp=v.fmtp||[];let b=v.fmtp.find(j=>j.payload===D.payloadType);b||(b={payload:D.payloadType,config:""},v.fmtp.push(b));const H=o.parseParams(b.config);switch(E){case"audio/opus":{const j=D.parameters["sprop-stereo"];j!==void 0&&(H.stereo=j?1:0);break}}b.config="";for(const j of Object.keys(H))b.config&&(b.config+=";"),b.config+=`${j}=${H[j]}`}}e.applyCodecParameters=C}}),vr=fe({"../../node_modules/mediasoup-client/lib/handlers/sdp/unifiedPlanUtils.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.addLegacySimulcast=e.getRtpEncodings=void 0;function i({offerMediaObject:s}){const o=new Set;for(const m of s.ssrcs||[]){const C=m.id;o.add(C)}if(o.size===0)throw new Error("no a=ssrc lines found");const l=new Map;for(const m of s.ssrcGroups||[]){if(m.semantics!=="FID")continue;let[C,h]=m.ssrcs.split(/\s+/);C=Number(C),h=Number(h),o.has(C)&&(o.delete(C),o.delete(h),l.set(C,h))}for(const m of o)l.set(m,null);const d=[];for(const[m,C]of l){const h={ssrc:m};C&&(h.rtx={ssrc:C}),d.push(h)}return d}e.getRtpEncodings=i;function r({offerMediaObject:s,numStreams:o}){if(o<=1)throw new TypeError("numStreams must be greater than 1");const l=(s.ssrcs||[]).find(b=>b.attribute==="msid");if(!l)throw new Error("a=ssrc line with msid information not found");const[d,m]=l.value.split(" "),C=l.id;let h;(s.ssrcGroups||[]).some(b=>{if(b.semantics!=="FID")return!1;const H=b.ssrcs.split(/\s+/);return Number(H[0])===C?(h=Number(H[1]),!0):!1});const v=s.ssrcs.find(b=>b.attribute==="cname");if(!v)throw new Error("a=ssrc line with cname information not found");const D=v.value,E=[],R=[];for(let b=0;b<o;++b)E.push(C+b),h&&R.push(h+b);s.ssrcGroups=[],s.ssrcs=[],s.ssrcGroups.push({semantics:"SIM",ssrcs:E.join(" ")});for(let b=0;b<E.length;++b){const H=E[b];s.ssrcs.push({id:H,attribute:"cname",value:D}),s.ssrcs.push({id:H,attribute:"msid",value:`${d} ${m}`})}for(let b=0;b<R.length;++b){const H=E[b],j=R[b];s.ssrcs.push({id:j,attribute:"cname",value:D}),s.ssrcs.push({id:j,attribute:"msid",value:`${d} ${m}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${H} ${j}`})}}e.addLegacySimulcast=r}}),An=fe({"../../node_modules/mediasoup-client/lib/handlers/ortc/utils.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.addNackSuppportForOpus=void 0;function i(r){var s;for(const o of r.codecs||[])(o.mimeType.toLowerCase()==="audio/opus"||o.mimeType.toLowerCase()==="audio/multiopus")&&!(!((s=o.rtcpFeedback)===null||s===void 0)&&s.some(l=>l.type==="nack"&&!l.parameter))&&(o.rtcpFeedback||(o.rtcpFeedback=[]),o.rtcpFeedback.push({type:"nack"}))}e.addNackSuppportForOpus=i}}),li=fe({"../../node_modules/mediasoup-client/lib/handlers/HandlerInterface.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.HandlerInterface=void 0;var i=ir(),r=class extends i.EnhancedEventEmitter{constructor(){super()}};e.HandlerInterface=r}}),Ah=fe({"../../node_modules/mediasoup-client/lib/handlers/sdp/MediaSection.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(v,D,E,R){R===void 0&&(R=E);var b=Object.getOwnPropertyDescriptor(D,E);(!b||("get"in b?!D.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return D[E]}}),Object.defineProperty(v,R,b)}:function(v,D,E,R){R===void 0&&(R=E),v[R]=D[E]}),r=e&&e.__setModuleDefault||(Object.create?function(v,D){Object.defineProperty(v,"default",{enumerable:!0,value:D})}:function(v,D){v.default=D}),s=e&&e.__importStar||function(v){if(v&&v.__esModule)return v;var D={};if(v!=null)for(var E in v)E!=="default"&&Object.prototype.hasOwnProperty.call(v,E)&&i(D,v,E);return r(D,v),D};Object.defineProperty(e,"__esModule",{value:!0}),e.OfferMediaSection=e.AnswerMediaSection=e.MediaSection=void 0;var o=s(Ft()),l=s(kt()),d=class{constructor({iceParameters:v,iceCandidates:D,dtlsParameters:E,planB:R=!1}){if(this._mediaObject={},this._planB=R,v&&this.setIceParameters(v),D){this._mediaObject.candidates=[];for(const b of D){const H={};H.component=1,H.foundation=b.foundation,H.ip=b.ip,H.port=b.port,H.priority=b.priority,H.transport=b.protocol,H.type=b.type,b.tcpType&&(H.tcptype=b.tcpType),this._mediaObject.candidates.push(H)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}E&&this.setDtlsRole(E.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(v){this._mediaObject.iceUfrag=v.usernameFragment,this._mediaObject.icePwd=v.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};e.MediaSection=d;var m=class extends d{constructor({iceParameters:v,iceCandidates:D,dtlsParameters:E,sctpParameters:R,plainRtpParameters:b,planB:H=!1,offerMediaObject:j,offerRtpParameters:k,answerRtpParameters:y,codecOptions:f,extmapAllowMixed:w=!1}){switch(super({iceParameters:v,iceCandidates:D,dtlsParameters:E,planB:H}),this._mediaObject.mid=String(j.mid),this._mediaObject.type=j.type,this._mediaObject.protocol=j.protocol,b?(this._mediaObject.connection={ip:b.ip,version:b.ipVersion},this._mediaObject.port=b.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),j.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const F of y.codecs){const U={payload:F.payloadType,codec:h(F),rate:F.clockRate};F.channels>1&&(U.encoding=F.channels),this._mediaObject.rtp.push(U);const q=l.clone(F.parameters,{});let V=l.clone(F.rtcpFeedback,[]);if(f){const{opusStereo:J,opusFec:X,opusDtx:ee,opusMaxPlaybackRate:re,opusMaxAverageBitrate:ne,opusPtime:Ce,opusNack:Re,videoGoogleStartBitrate:ke,videoGoogleMaxBitrate:Y,videoGoogleMinBitrate:he}=f,be=k.codecs.find(me=>me.payloadType===F.payloadType);switch(F.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{J!==void 0&&(be.parameters["sprop-stereo"]=J?1:0,q.stereo=J?1:0),X!==void 0&&(be.parameters.useinbandfec=X?1:0,q.useinbandfec=X?1:0),ee!==void 0&&(be.parameters.usedtx=ee?1:0,q.usedtx=ee?1:0),re!==void 0&&(q.maxplaybackrate=re),ne!==void 0&&(q.maxaveragebitrate=ne),Ce!==void 0&&(be.parameters.ptime=Ce,q.ptime=Ce),Re||(be.rtcpFeedback=be.rtcpFeedback.filter(me=>me.type!=="nack"||me.parameter),V=V.filter(me=>me.type!=="nack"||me.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{ke!==void 0&&(q["x-google-start-bitrate"]=ke),Y!==void 0&&(q["x-google-max-bitrate"]=Y),he!==void 0&&(q["x-google-min-bitrate"]=he);break}}}const $={payload:F.payloadType,config:""};for(const J of Object.keys(q))$.config&&($.config+=";"),$.config+=`${J}=${q[J]}`;$.config&&this._mediaObject.fmtp.push($);for(const J of V)this._mediaObject.rtcpFb.push({payload:F.payloadType,type:J.type,subtype:J.parameter})}this._mediaObject.payloads=y.codecs.map(F=>F.payloadType).join(" "),this._mediaObject.ext=[];for(const F of y.headerExtensions)(j.ext||[]).some(q=>q.uri===F.uri)&&this._mediaObject.ext.push({uri:F.uri,value:F.id});if(w&&j.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),j.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:j.simulcast.list1},this._mediaObject.rids=[];for(const F of j.rids||[])F.direction==="send"&&this._mediaObject.rids.push({id:F.id,direction:"recv"})}else if(j.simulcast_03){this._mediaObject.simulcast_03={value:j.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const F of j.rids||[])F.direction==="send"&&this._mediaObject.rids.push({id:F.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof j.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=R.port,this._mediaObject.maxMessageSize=R.maxMessageSize):j.sctpmap&&(this._mediaObject.payloads=R.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:R.port,maxMessageSize:R.maxMessageSize});break}}}setDtlsRole(v){switch(v){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass";break}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(v){var D;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const E={};for(const H of v)H.rid&&(E[H.rid]=H);const R=this._mediaObject.simulcast.list1,b=o.parseSimulcastStreamList(R);for(const H of b)for(const j of H)j.paused=!(!((D=E[j.scid])===null||D===void 0)&&D.active);this._mediaObject.simulcast.list1=b.map(H=>H.map(j=>`${j.paused?"~":""}${j.scid}`).join(",")).join(";")}};e.AnswerMediaSection=m;var C=class extends d{constructor({iceParameters:v,iceCandidates:D,dtlsParameters:E,sctpParameters:R,plainRtpParameters:b,planB:H=!1,mid:j,kind:k,offerRtpParameters:y,streamId:f,trackId:w,oldDataChannelSpec:F=!1}){switch(super({iceParameters:v,iceCandidates:D,dtlsParameters:E,planB:H}),this._mediaObject.mid=String(j),this._mediaObject.type=k,b?(this._mediaObject.connection={ip:b.ip,version:b.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=b.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},R?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),k){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${f||"-"} ${w}`);for(const $ of y.codecs){const J={payload:$.payloadType,codec:h($),rate:$.clockRate};$.channels>1&&(J.encoding=$.channels),this._mediaObject.rtp.push(J);const X={payload:$.payloadType,config:""};for(const ee of Object.keys($.parameters))X.config&&(X.config+=";"),X.config+=`${ee}=${$.parameters[ee]}`;X.config&&this._mediaObject.fmtp.push(X);for(const ee of $.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:$.payloadType,type:ee.type,subtype:ee.parameter})}this._mediaObject.payloads=y.codecs.map($=>$.payloadType).join(" "),this._mediaObject.ext=[];for(const $ of y.headerExtensions)this._mediaObject.ext.push({uri:$.uri,value:$.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const U=y.encodings[0],q=U.ssrc,V=U.rtx&&U.rtx.ssrc?U.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],y.rtcp.cname&&this._mediaObject.ssrcs.push({id:q,attribute:"cname",value:y.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:q,attribute:"msid",value:`${f||"-"} ${w}`}),V&&(y.rtcp.cname&&this._mediaObject.ssrcs.push({id:V,attribute:"cname",value:y.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:V,attribute:"msid",value:`${f||"-"} ${w}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${q} ${V}`}));break}case"application":{F?(this._mediaObject.payloads=R.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:R.port,maxMessageSize:R.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=R.port,this._mediaObject.maxMessageSize=R.maxMessageSize);break}}}setDtlsRole(v){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:v,streamId:D,trackId:E}){const R=v.encodings[0],b=R.ssrc,H=R.rtx&&R.rtx.ssrc?R.rtx.ssrc:void 0,j=this._mediaObject.payloads.split(" ");for(const k of v.codecs){if(j.includes(String(k.payloadType)))continue;const y={payload:k.payloadType,codec:h(k),rate:k.clockRate};k.channels>1&&(y.encoding=k.channels),this._mediaObject.rtp.push(y);const f={payload:k.payloadType,config:""};for(const w of Object.keys(k.parameters))f.config&&(f.config+=";"),f.config+=`${w}=${k.parameters[w]}`;f.config&&this._mediaObject.fmtp.push(f);for(const w of k.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:k.payloadType,type:w.type,subtype:w.parameter})}this._mediaObject.payloads+=` ${v.codecs.filter(k=>!this._mediaObject.payloads.includes(k.payloadType)).map(k=>k.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),v.rtcp.cname&&this._mediaObject.ssrcs.push({id:b,attribute:"cname",value:v.rtcp.cname}),this._mediaObject.ssrcs.push({id:b,attribute:"msid",value:`${D||"-"} ${E}`}),H&&(v.rtcp.cname&&this._mediaObject.ssrcs.push({id:H,attribute:"cname",value:v.rtcp.cname}),this._mediaObject.ssrcs.push({id:H,attribute:"msid",value:`${D||"-"} ${E}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${b} ${H}`}))}planBStopReceiving({offerRtpParameters:v}){const D=v.encodings[0],E=D.ssrc,R=D.rtx&&D.rtx.ssrc?D.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(b=>b.id!==E&&b.id!==R),R&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(b=>b.ssrcs!==`${E} ${R}`))}};e.OfferMediaSection=C;function h(v){const E=new RegExp("^(audio|video)/(.+)","i").exec(v.mimeType);if(!E)throw new TypeError("invalid codec.mimeType");return E[2]}}}),Ri=fe({"../../node_modules/mediasoup-client/lib/handlers/sdp/RemoteSdp.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(h,v,D,E){E===void 0&&(E=D);var R=Object.getOwnPropertyDescriptor(v,D);(!R||("get"in R?!v.__esModule:R.writable||R.configurable))&&(R={enumerable:!0,get:function(){return v[D]}}),Object.defineProperty(h,E,R)}:function(h,v,D,E){E===void 0&&(E=D),h[E]=v[D]}),r=e&&e.__setModuleDefault||(Object.create?function(h,v){Object.defineProperty(h,"default",{enumerable:!0,value:v})}:function(h,v){h.default=v}),s=e&&e.__importStar||function(h){if(h&&h.__esModule)return h;var v={};if(h!=null)for(var D in h)D!=="default"&&Object.prototype.hasOwnProperty.call(h,D)&&i(v,h,D);return r(v,h),v};Object.defineProperty(e,"__esModule",{value:!0}),e.RemoteSdp=void 0;var o=s(Ft()),l=St(),d=Ah(),m=new l.Logger("RemoteSdp"),C=class{constructor({iceParameters:h,iceCandidates:v,dtlsParameters:D,sctpParameters:E,plainRtpParameters:R,planB:b=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=h,this._iceCandidates=v,this._dtlsParameters=D,this._sctpParameters=E,this._plainRtpParameters=R,this._planB=b,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},h&&h.iceLite&&(this._sdpObject.icelite="ice-lite"),D){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const H=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:D.fingerprints[H-1].algorithm,hash:D.fingerprints[H-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}R&&(this._sdpObject.origin.address=R.ip,this._sdpObject.origin.ipVer=R.ipVersion)}updateIceParameters(h){m.debug("updateIceParameters() [iceParameters:%o]",h),this._iceParameters=h,this._sdpObject.icelite=h.iceLite?"ice-lite":void 0;for(const v of this._mediaSections)v.setIceParameters(h)}updateDtlsRole(h){m.debug("updateDtlsRole() [role:%s]",h),this._dtlsParameters.role=h;for(const v of this._mediaSections)v.setDtlsRole(h)}getNextMediaSectionIdx(){for(let h=0;h<this._mediaSections.length;++h){const v=this._mediaSections[h];if(v.closed)return{idx:h,reuseMid:v.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:h,reuseMid:v,offerRtpParameters:D,answerRtpParameters:E,codecOptions:R,extmapAllowMixed:b=!1}){const H=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:h,offerRtpParameters:D,answerRtpParameters:E,codecOptions:R,extmapAllowMixed:b});v?this._replaceMediaSection(H,v):this._midToIndex.has(H.mid)?this._replaceMediaSection(H):this._addMediaSection(H)}receive({mid:h,kind:v,offerRtpParameters:D,streamId:E,trackId:R}){const b=this._midToIndex.get(h);let H;if(b!==void 0&&(H=this._mediaSections[b]),H)H.planBReceive({offerRtpParameters:D,streamId:E,trackId:R}),this._replaceMediaSection(H);else{H=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:h,kind:v,offerRtpParameters:D,streamId:E,trackId:R});const j=this._mediaSections.find(k=>k.closed);j?this._replaceMediaSection(H,j.mid):this._addMediaSection(H)}}pauseMediaSection(h){this._findMediaSection(h).pause()}resumeSendingMediaSection(h){this._findMediaSection(h).resume()}resumeReceivingMediaSection(h){this._findMediaSection(h).resume()}disableMediaSection(h){this._findMediaSection(h).disable()}closeMediaSection(h){const v=this._findMediaSection(h);return h===this._firstMid?(m.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",h),this.disableMediaSection(h),!1):(v.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(h,v){const D=this._findMediaSection(h);D.muxSimulcastStreams(v),this._replaceMediaSection(D)}planBStopReceiving({mid:h,offerRtpParameters:v}){const D=this._findMediaSection(h);D.planBStopReceiving({offerRtpParameters:v}),this._replaceMediaSection(D)}sendSctpAssociation({offerMediaObject:h}){const v=new d.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:h});this._addMediaSection(v)}receiveSctpAssociation({oldDataChannelSpec:h=!1}={}){const v=new d.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:h});this._addMediaSection(v)}getSdp(){return this._sdpObject.origin.sessionVersion++,o.write(this._sdpObject)}_addMediaSection(h){this._firstMid||(this._firstMid=h.mid),this._mediaSections.push(h),this._midToIndex.set(h.mid,this._mediaSections.length-1),this._sdpObject.media.push(h.getObject()),this._regenerateBundleMids()}_replaceMediaSection(h,v){if(typeof v=="string"){const D=this._midToIndex.get(v);if(D===void 0)throw new Error(`no media section found for reuseMid '${v}'`);const E=this._mediaSections[D];this._mediaSections[D]=h,this._midToIndex.delete(E.mid),this._midToIndex.set(h.mid,D),this._sdpObject.media[D]=h.getObject(),this._regenerateBundleMids()}else{const D=this._midToIndex.get(h.mid);if(D===void 0)throw new Error(`no media section found with mid '${h.mid}'`);this._mediaSections[D]=h,this._sdpObject.media[D]=h.getObject()}}_findMediaSection(h){const v=this._midToIndex.get(h);if(v===void 0)throw new Error(`no media section found with mid '${h}'`);return this._mediaSections[v]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(h=>!h.closed).map(h=>h.mid).join(" "))}};e.RemoteSdp=C}}),rr=fe({"../../node_modules/mediasoup-client/lib/scalabilityModes.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.parse=void 0;var i=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function r(s){const o=i.exec(s||"");return o?{spatialLayers:Number(o[1]),temporalLayers:Number(o[2])}:{spatialLayers:1,temporalLayers:1}}e.parse=r}}),Fh=fe({"../../node_modules/mediasoup-client/lib/handlers/Chrome111.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(k,y,f,w){w===void 0&&(w=f);var F=Object.getOwnPropertyDescriptor(y,f);(!F||("get"in F?!y.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return y[f]}}),Object.defineProperty(k,w,F)}:function(k,y,f,w){w===void 0&&(w=f),k[w]=y[f]}),r=e&&e.__setModuleDefault||(Object.create?function(k,y){Object.defineProperty(k,"default",{enumerable:!0,value:y})}:function(k,y){k.default=y}),s=e&&e.__importStar||function(k){if(k&&k.__esModule)return k;var y={};if(k!=null)for(var f in k)f!=="default"&&Object.prototype.hasOwnProperty.call(k,f)&&i(y,k,f);return r(y,k),y};Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome111=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(vr()),v=s(An()),D=li(),E=Ri(),R=rr(),b=new l.Logger("Chrome111"),H={OS:1024,MIS:1024},j=class Fo extends D.HandlerInterface{static createFactory(){return()=>new Fo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){b.debug("getNativeRtpCapabilities()");const y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{y.addTransceiver("audio"),y.addTransceiver("video");const f=yield y.createOffer();try{y.close()}catch{}const w=o.parse(f.sdp),F=C.extractRtpCapabilities({sdpObject:w});return v.addNackSuppportForOpus(F),F}catch(f){try{y.close()}catch{}throw f}})}getNativeSctpCapabilities(){return M(this,null,function*(){return b.debug("getNativeSctpCapabilities()"),{numStreams:H}})}run({direction:y,iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U,iceServers:q,iceTransportPolicy:V,additionalSettings:$,proprietaryConstraints:J,extendedRtpCapabilities:X}){b.debug("run()"),this._direction=y,this._remoteSdp=new E.RemoteSdp({iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",X),video:m.getSendingRtpParameters("video",X)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",X),video:m.getSendingRemoteRtpParameters("video",X)},F.role&&F.role!=="auto"&&(this._forcedLocalDtlsRole=F.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:q||[],iceTransportPolicy:V||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},$),J),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}updateIceServers(y){return M(this,null,function*(){b.debug("updateIceServers()");const f=this._pc.getConfiguration();f.iceServers=y,this._pc.setConfiguration(f)})}restartIce(y){return M(this,null,function*(){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const f=yield this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",f),yield this._pc.setLocalDescription(f);const w={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(y){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U}){var q;if(this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),w&&w.length>1){w.forEach((he,be)=>{he.rid=`r${be}`});let ke=1,Y=1;for(const he of w){const be=he.scalabilityMode?(0,R.parse)(he.scalabilityMode).temporalLayers:3;be>Y&&(Y=be)}for(const he of w)he.rid=`r${ke++}`,he.scalabilityMode=`L1T${Y}`}const V=d.clone(this._sendingRtpParametersByKind[f.kind],{});V.codecs=m.reduceCodecs(V.codecs,U);const $=d.clone(this._sendingRemoteRtpParametersByKind[f.kind],{});$.codecs=m.reduceCodecs($.codecs,U);const J=this._remoteSdp.getNextMediaSectionIdx(),X=this._pc.addTransceiver(f,{direction:"sendonly",streams:[this._sendStream],sendEncodings:w}),ee=yield this._pc.createOffer();let re=o.parse(ee.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:re})),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee);const ne=X.mid;V.mid=ne,re=o.parse(this._pc.localDescription.sdp);const Ce=re.media[J.idx];if(V.rtcp.cname=C.getCname({offerMediaObject:Ce}),!w)V.encodings=h.getRtpEncodings({offerMediaObject:Ce});else if(w.length===1){const ke=h.getRtpEncodings({offerMediaObject:Ce});Object.assign(ke[0],w[0]),V.encodings=ke}else V.encodings=w;this._remoteSdp.send({offerMediaObject:Ce,reuseMid:J.reuseMid,offerRtpParameters:V,answerRtpParameters:$,codecOptions:F,extmapAllowMixed:!0});const Re={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Re),yield this._pc.setRemoteDescription(Re),this._mapMidTransceiver.set(ne,X),{localId:ne,rtpParameters:V,rtpSender:X.sender}})}stopSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");if(f.sender.replaceTrack(null),this._pc.removeTrack(f.sender),this._remoteSdp.closeMediaSection(f.mid))try{f.stop()}catch{}const F=yield this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U),this._mapMidTransceiver.delete(y)})}pauseSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="inactive",this._remoteSdp.pauseMediaSection(y);const w=yield this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}resumeSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="sendonly";const w=yield this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}replaceTrack(y,f){return M(this,null,function*(){this.assertSendDirection(),f?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,f.id):b.debug("replaceTrack() [localId:%s, no track]",y);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(f)})}setMaxSpatialLayer(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{$<=f?V.active=!0:V.active=!1}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}setRtpEncodingParameters(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{F.encodings[$]=ue(ue({},V),f)}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}getSenderStats(y){return M(this,null,function*(){this.assertSendDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.sender.getStats()})}sendDataChannel(y){return M(this,arguments,function*({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q}){var V;this.assertSendDirection();const $={negotiated:!0,id:this._nextSendSctpStreamId,ordered:f,maxPacketLifeTime:w,maxRetransmits:F,protocol:q};b.debug("sendDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(U,$);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%H.MIS,!this._hasDataChannelMediaSection){const ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne=re.media.find(Re=>Re.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(V=this._forcedLocalDtlsRole)!==null&&V!==void 0?V:"client",localSdpObject:re})),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee),this._remoteSdp.sendSctpAssociation({offerMediaObject:ne});const Ce={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Ce),yield this._pc.setRemoteDescription(Ce),this._hasDataChannelMediaSection=!0}const X={streamId:$.id,ordered:$.ordered,maxPacketLifeTime:$.maxPacketLifeTime,maxRetransmits:$.maxRetransmits};return{dataChannel:J,sctpStreamParameters:X}})}receive(y){return M(this,null,function*(){var f;this.assertRecvDirection();const w=[],F=new Map;for(const $ of y){const{trackId:J,kind:X,rtpParameters:ee,streamId:re}=$;b.debug("receive() [trackId:%s, kind:%s]",J,X);const ne=ee.mid||String(this._mapMidTransceiver.size);F.set(J,ne),this._remoteSdp.receive({mid:ne,kind:X,offerRtpParameters:ee,streamId:re||ee.rtcp.cname,trackId:J})}const U={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",U),yield this._pc.setRemoteDescription(U);let q=yield this._pc.createAnswer();const V=o.parse(q.sdp);for(const $ of y){const{trackId:J,rtpParameters:X}=$,ee=F.get(J),re=V.media.find(ne=>String(ne.mid)===ee);C.applyCodecParameters({offerRtpParameters:X,answerMediaObject:re})}q={type:"answer",sdp:o.write(V)},this._transportReady||(yield this.setupTransport({localDtlsRole:(f=this._forcedLocalDtlsRole)!==null&&f!==void 0?f:"client",localSdpObject:V})),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",q),yield this._pc.setLocalDescription(q);for(const $ of y){const{trackId:J}=$,X=F.get(J),ee=this._pc.getTransceivers().find(re=>re.mid===X);if(ee)this._mapMidTransceiver.set(X,ee),w.push({localId:X,track:ee.receiver.track,rtpReceiver:ee.receiver});else throw new Error("new RTCRtpTransceiver not found")}return w})}stopReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("stopReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(U.mid)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const F of y)this._mapMidTransceiver.delete(F)})}pauseReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("pauseReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="inactive",this._remoteSdp.pauseMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("resumeReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(y){return M(this,null,function*(){this.assertRecvDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.receiver.getStats()})}receiveDataChannel(y){return M(this,arguments,function*({sctpStreamParameters:f,label:w,protocol:F}){var U;this.assertRecvDirection();const{streamId:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J}=f,X={negotiated:!0,id:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J,protocol:F};b.debug("receiveDataChannel() [options:%o]",X);const ee=this._pc.createDataChannel(w,X);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const re={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",re),yield this._pc.setRemoteDescription(re);const ne=yield this._pc.createAnswer();if(!this._transportReady){const Ce=o.parse(ne.sdp);yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:Ce})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setLocalDescription(ne),this._hasDataChannelMediaSection=!0}return{dataChannel:ee}})}setupTransport(y){return M(this,arguments,function*({localDtlsRole:f,localSdpObject:w}){w||(w=o.parse(this._pc.localDescription.sdp));const F=C.extractDtlsParameters({sdpObject:w});F.role=f,this._remoteSdp.updateDtlsRole(f==="client"?"server":"client"),yield new Promise((U,q)=>{this.safeEmit("@connect",{dtlsParameters:F},U,q)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome111=j}}),kh=fe({"../../node_modules/mediasoup-client/lib/handlers/Chrome74.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(k,y,f,w){w===void 0&&(w=f);var F=Object.getOwnPropertyDescriptor(y,f);(!F||("get"in F?!y.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return y[f]}}),Object.defineProperty(k,w,F)}:function(k,y,f,w){w===void 0&&(w=f),k[w]=y[f]}),r=e&&e.__setModuleDefault||(Object.create?function(k,y){Object.defineProperty(k,"default",{enumerable:!0,value:y})}:function(k,y){k.default=y}),s=e&&e.__importStar||function(k){if(k&&k.__esModule)return k;var y={};if(k!=null)for(var f in k)f!=="default"&&Object.prototype.hasOwnProperty.call(k,f)&&i(y,k,f);return r(y,k),y};Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome74=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(vr()),v=s(An()),D=li(),E=Ri(),R=rr(),b=new l.Logger("Chrome74"),H={OS:1024,MIS:1024},j=class ko extends D.HandlerInterface{static createFactory(){return()=>new ko}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){b.debug("getNativeRtpCapabilities()");const y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{y.addTransceiver("audio"),y.addTransceiver("video");const f=yield y.createOffer();try{y.close()}catch{}const w=o.parse(f.sdp),F=C.extractRtpCapabilities({sdpObject:w});return v.addNackSuppportForOpus(F),F}catch(f){try{y.close()}catch{}throw f}})}getNativeSctpCapabilities(){return M(this,null,function*(){return b.debug("getNativeSctpCapabilities()"),{numStreams:H}})}run({direction:y,iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U,iceServers:q,iceTransportPolicy:V,additionalSettings:$,proprietaryConstraints:J,extendedRtpCapabilities:X}){b.debug("run()"),this._direction=y,this._remoteSdp=new E.RemoteSdp({iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",X),video:m.getSendingRtpParameters("video",X)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",X),video:m.getSendingRemoteRtpParameters("video",X)},F.role&&F.role!=="auto"&&(this._forcedLocalDtlsRole=F.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:q||[],iceTransportPolicy:V||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},$),J),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}))}updateIceServers(y){return M(this,null,function*(){b.debug("updateIceServers()");const f=this._pc.getConfiguration();f.iceServers=y,this._pc.setConfiguration(f)})}restartIce(y){return M(this,null,function*(){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const f=yield this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",f),yield this._pc.setLocalDescription(f);const w={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(y){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U}){var q;this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),w&&w.length>1&&w.forEach((he,be)=>{he.rid=`r${be}`});const V=d.clone(this._sendingRtpParametersByKind[f.kind],{});V.codecs=m.reduceCodecs(V.codecs,U);const $=d.clone(this._sendingRemoteRtpParametersByKind[f.kind],{});$.codecs=m.reduceCodecs($.codecs,U);const J=this._remoteSdp.getNextMediaSectionIdx(),X=this._pc.addTransceiver(f,{direction:"sendonly",streams:[this._sendStream],sendEncodings:w});let ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne;this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:re}));let Ce=!1;const Re=(0,R.parse)((w||[{}])[0].scalabilityMode);w&&w.length===1&&Re.spatialLayers>1&&V.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),Ce=!0,re=o.parse(ee.sdp),ne=re.media[J.idx],h.addLegacySimulcast({offerMediaObject:ne,numStreams:Re.spatialLayers}),ee={type:"offer",sdp:o.write(re)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee);const ke=X.mid;if(V.mid=ke,re=o.parse(this._pc.localDescription.sdp),ne=re.media[J.idx],V.rtcp.cname=C.getCname({offerMediaObject:ne}),!w)V.encodings=h.getRtpEncodings({offerMediaObject:ne});else if(w.length===1){let he=h.getRtpEncodings({offerMediaObject:ne});Object.assign(he[0],w[0]),Ce&&(he=[he[0]]),V.encodings=he}else V.encodings=w;if(V.encodings.length>1&&(V.codecs[0].mimeType.toLowerCase()==="video/vp8"||V.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const he of V.encodings)he.scalabilityMode?he.scalabilityMode=`L1T${Re.temporalLayers}`:he.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ne,reuseMid:J.reuseMid,offerRtpParameters:V,answerRtpParameters:$,codecOptions:F,extmapAllowMixed:!0});const Y={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Y),yield this._pc.setRemoteDescription(Y),this._mapMidTransceiver.set(ke,X),{localId:ke,rtpParameters:V,rtpSender:X.sender}})}stopSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");if(f.sender.replaceTrack(null),this._pc.removeTrack(f.sender),this._remoteSdp.closeMediaSection(f.mid))try{f.stop()}catch{}const F=yield this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U),this._mapMidTransceiver.delete(y)})}pauseSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="inactive",this._remoteSdp.pauseMediaSection(y);const w=yield this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}resumeSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="sendonly";const w=yield this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}replaceTrack(y,f){return M(this,null,function*(){this.assertSendDirection(),f?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,f.id):b.debug("replaceTrack() [localId:%s, no track]",y);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(f)})}setMaxSpatialLayer(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{$<=f?V.active=!0:V.active=!1}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}setRtpEncodingParameters(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{F.encodings[$]=ue(ue({},V),f)}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}getSenderStats(y){return M(this,null,function*(){this.assertSendDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.sender.getStats()})}sendDataChannel(y){return M(this,arguments,function*({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q}){var V;this.assertSendDirection();const $={negotiated:!0,id:this._nextSendSctpStreamId,ordered:f,maxPacketLifeTime:w,maxRetransmits:F,protocol:q};b.debug("sendDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(U,$);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%H.MIS,!this._hasDataChannelMediaSection){const ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne=re.media.find(Re=>Re.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(V=this._forcedLocalDtlsRole)!==null&&V!==void 0?V:"client",localSdpObject:re})),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee),this._remoteSdp.sendSctpAssociation({offerMediaObject:ne});const Ce={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Ce),yield this._pc.setRemoteDescription(Ce),this._hasDataChannelMediaSection=!0}const X={streamId:$.id,ordered:$.ordered,maxPacketLifeTime:$.maxPacketLifeTime,maxRetransmits:$.maxRetransmits};return{dataChannel:J,sctpStreamParameters:X}})}receive(y){return M(this,null,function*(){var f;this.assertRecvDirection();const w=[],F=new Map;for(const $ of y){const{trackId:J,kind:X,rtpParameters:ee,streamId:re}=$;b.debug("receive() [trackId:%s, kind:%s]",J,X);const ne=ee.mid||String(this._mapMidTransceiver.size);F.set(J,ne),this._remoteSdp.receive({mid:ne,kind:X,offerRtpParameters:ee,streamId:re||ee.rtcp.cname,trackId:J})}const U={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",U),yield this._pc.setRemoteDescription(U);let q=yield this._pc.createAnswer();const V=o.parse(q.sdp);for(const $ of y){const{trackId:J,rtpParameters:X}=$,ee=F.get(J),re=V.media.find(ne=>String(ne.mid)===ee);C.applyCodecParameters({offerRtpParameters:X,answerMediaObject:re})}q={type:"answer",sdp:o.write(V)},this._transportReady||(yield this.setupTransport({localDtlsRole:(f=this._forcedLocalDtlsRole)!==null&&f!==void 0?f:"client",localSdpObject:V})),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",q),yield this._pc.setLocalDescription(q);for(const $ of y){const{trackId:J}=$,X=F.get(J),ee=this._pc.getTransceivers().find(re=>re.mid===X);if(ee)this._mapMidTransceiver.set(X,ee),w.push({localId:X,track:ee.receiver.track,rtpReceiver:ee.receiver});else throw new Error("new RTCRtpTransceiver not found")}return w})}stopReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("stopReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(U.mid)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const F of y)this._mapMidTransceiver.delete(F)})}pauseReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("pauseReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="inactive",this._remoteSdp.pauseMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("resumeReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(y){return M(this,null,function*(){this.assertRecvDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.receiver.getStats()})}receiveDataChannel(y){return M(this,arguments,function*({sctpStreamParameters:f,label:w,protocol:F}){var U;this.assertRecvDirection();const{streamId:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J}=f,X={negotiated:!0,id:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J,protocol:F};b.debug("receiveDataChannel() [options:%o]",X);const ee=this._pc.createDataChannel(w,X);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const re={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",re),yield this._pc.setRemoteDescription(re);const ne=yield this._pc.createAnswer();if(!this._transportReady){const Ce=o.parse(ne.sdp);yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:Ce})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setLocalDescription(ne),this._hasDataChannelMediaSection=!0}return{dataChannel:ee}})}setupTransport(y){return M(this,arguments,function*({localDtlsRole:f,localSdpObject:w}){w||(w=o.parse(this._pc.localDescription.sdp));const F=C.extractDtlsParameters({sdpObject:w});F.role=f,this._remoteSdp.updateDtlsRole(f==="client"?"server":"client"),yield new Promise((U,q)=>{this.safeEmit("@connect",{dtlsParameters:F},U,q)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome74=j}}),Oh=fe({"../../node_modules/mediasoup-client/lib/handlers/Chrome70.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(j,k,y,f){f===void 0&&(f=y);var w=Object.getOwnPropertyDescriptor(k,y);(!w||("get"in w?!k.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return k[y]}}),Object.defineProperty(j,f,w)}:function(j,k,y,f){f===void 0&&(f=y),j[f]=k[y]}),r=e&&e.__setModuleDefault||(Object.create?function(j,k){Object.defineProperty(j,"default",{enumerable:!0,value:k})}:function(j,k){j.default=k}),s=e&&e.__importStar||function(j){if(j&&j.__esModule)return j;var k={};if(j!=null)for(var y in j)y!=="default"&&Object.prototype.hasOwnProperty.call(j,y)&&i(k,j,y);return r(k,j),k};Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome70=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(vr()),v=li(),D=Ri(),E=rr(),R=new l.Logger("Chrome70"),b={OS:1024,MIS:1024},H=class Oo extends v.HandlerInterface{static createFactory(){return()=>new Oo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){R.debug("getNativeRtpCapabilities()");const k=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{k.addTransceiver("audio"),k.addTransceiver("video");const y=yield k.createOffer();try{k.close()}catch{}const f=o.parse(y.sdp);return C.extractRtpCapabilities({sdpObject:f})}catch(y){try{k.close()}catch{}throw y}})}getNativeSctpCapabilities(){return M(this,null,function*(){return R.debug("getNativeSctpCapabilities()"),{numStreams:b}})}run({direction:k,iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F,iceServers:U,iceTransportPolicy:q,additionalSettings:V,proprietaryConstraints:$,extendedRtpCapabilities:J}){R.debug("run()"),this._direction=k,this._remoteSdp=new D.RemoteSdp({iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",J),video:m.getSendingRtpParameters("video",J)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",J),video:m.getSendingRemoteRtpParameters("video",J)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:U||[],iceTransportPolicy:q||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},V),$),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(k){return M(this,null,function*(){R.debug("updateIceServers()");const y=this._pc.getConfiguration();y.iceServers=k,this._pc.setConfiguration(y)})}restartIce(k){return M(this,null,function*(){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(k),!!this._transportReady)if(this._direction==="send"){const y=yield this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",y),yield this._pc.setLocalDescription(y);const f={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f)}else{const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(k){return M(this,arguments,function*({track:y,encodings:f,codecOptions:w,codec:F}){var U;this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",y.kind,y.id);const q=d.clone(this._sendingRtpParametersByKind[y.kind],{});q.codecs=m.reduceCodecs(q.codecs,F);const V=d.clone(this._sendingRemoteRtpParametersByKind[y.kind],{});V.codecs=m.reduceCodecs(V.codecs,F);const $=this._remoteSdp.getNextMediaSectionIdx(),J=this._pc.addTransceiver(y,{direction:"sendonly",streams:[this._sendStream]});let X=yield this._pc.createOffer(),ee=o.parse(X.sdp),re;this._transportReady||(yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:ee})),f&&f.length>1&&(R.debug("send() | enabling legacy simulcast"),ee=o.parse(X.sdp),re=ee.media[$.idx],h.addLegacySimulcast({offerMediaObject:re,numStreams:f.length}),X={type:"offer",sdp:o.write(ee)});let ne=!1;const Ce=(0,E.parse)((f||[{}])[0].scalabilityMode);if(f&&f.length===1&&Ce.spatialLayers>1&&q.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(R.debug("send() | enabling legacy simulcast for VP9 SVC"),ne=!0,ee=o.parse(X.sdp),re=ee.media[$.idx],h.addLegacySimulcast({offerMediaObject:re,numStreams:Ce.spatialLayers}),X={type:"offer",sdp:o.write(ee)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X),f){R.debug("send() | applying given encodings");const Y=J.sender.getParameters();for(let he=0;he<(Y.encodings||[]).length;++he){const be=Y.encodings[he],me=f[he];if(!me)break;Y.encodings[he]=Object.assign(be,me)}yield J.sender.setParameters(Y)}const Re=J.mid;if(q.mid=Re,ee=o.parse(this._pc.localDescription.sdp),re=ee.media[$.idx],q.rtcp.cname=C.getCname({offerMediaObject:re}),q.encodings=h.getRtpEncodings({offerMediaObject:re}),f)for(let Y=0;Y<q.encodings.length;++Y)f[Y]&&Object.assign(q.encodings[Y],f[Y]);if(ne&&(q.encodings=[q.encodings[0]]),q.encodings.length>1&&(q.codecs[0].mimeType.toLowerCase()==="video/vp8"||q.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Y of q.encodings)Y.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:re,reuseMid:$.reuseMid,offerRtpParameters:q,answerRtpParameters:V,codecOptions:w});const ke={type:"answer",sdp:this._remoteSdp.getSdp()};return R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ke),yield this._pc.setRemoteDescription(ke),this._mapMidTransceiver.set(Re,J),{localId:Re,rtpParameters:q,rtpSender:J.sender}})}stopSending(k){return M(this,null,function*(){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",k);const y=this._mapMidTransceiver.get(k);if(!y)throw new Error("associated RTCRtpTransceiver not found");if(y.sender.replaceTrack(null),this._pc.removeTrack(y.sender),this._remoteSdp.closeMediaSection(y.mid))try{y.stop()}catch{}const w=yield this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F),this._mapMidTransceiver.delete(k)})}pauseSending(k){return M(this,null,function*(){})}resumeSending(k){return M(this,null,function*(){})}replaceTrack(k,y){return M(this,null,function*(){this.assertSendDirection(),y?R.debug("replaceTrack() [localId:%s, track.id:%s]",k,y.id):R.debug("replaceTrack() [localId:%s, no track]",k);const f=this._mapMidTransceiver.get(k);if(!f)throw new Error("associated RTCRtpTransceiver not found");yield f.sender.replaceTrack(y)})}setMaxSpatialLayer(k,y){return M(this,null,function*(){this.assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",k,y);const f=this._mapMidTransceiver.get(k);if(!f)throw new Error("associated RTCRtpTransceiver not found");const w=f.sender.getParameters();w.encodings.forEach((q,V)=>{V<=y?q.active=!0:q.active=!1}),yield f.sender.setParameters(w),this._remoteSdp.muxMediaSectionSimulcast(k,w.encodings);const F=yield this._pc.createOffer();R.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U)})}setRtpEncodingParameters(k,y){return M(this,null,function*(){this.assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",k,y);const f=this._mapMidTransceiver.get(k);if(!f)throw new Error("associated RTCRtpTransceiver not found");const w=f.sender.getParameters();w.encodings.forEach((q,V)=>{w.encodings[V]=ue(ue({},q),y)}),yield f.sender.setParameters(w),this._remoteSdp.muxMediaSectionSimulcast(k,w.encodings);const F=yield this._pc.createOffer();R.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U)})}getSenderStats(k){return M(this,null,function*(){this.assertSendDirection();const y=this._mapMidTransceiver.get(k);if(!y)throw new Error("associated RTCRtpTransceiver not found");return y.sender.getStats()})}sendDataChannel(k){return M(this,arguments,function*({ordered:y,maxPacketLifeTime:f,maxRetransmits:w,label:F,protocol:U}){var q;this.assertSendDirection();const V={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:f,maxRetransmitTime:f,maxRetransmits:w,protocol:U};R.debug("sendDataChannel() [options:%o]",V);const $=this._pc.createDataChannel(F,V);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const X=yield this._pc.createOffer(),ee=o.parse(X.sdp),re=ee.media.find(Ce=>Ce.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:ee})),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X),this._remoteSdp.sendSctpAssociation({offerMediaObject:re});const ne={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setRemoteDescription(ne),this._hasDataChannelMediaSection=!0}const J={streamId:V.id,ordered:V.ordered,maxPacketLifeTime:V.maxPacketLifeTime,maxRetransmits:V.maxRetransmits};return{dataChannel:$,sctpStreamParameters:J}})}receive(k){return M(this,null,function*(){var y;this.assertRecvDirection();const f=[],w=new Map;for(const V of k){const{trackId:$,kind:J,rtpParameters:X,streamId:ee}=V;R.debug("receive() [trackId:%s, kind:%s]",$,J);const re=X.mid||String(this._mapMidTransceiver.size);w.set($,re),this._remoteSdp.receive({mid:re,kind:J,offerRtpParameters:X,streamId:ee||X.rtcp.cname,trackId:$})}const F={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",F),yield this._pc.setRemoteDescription(F);let U=yield this._pc.createAnswer();const q=o.parse(U.sdp);for(const V of k){const{trackId:$,rtpParameters:J}=V,X=w.get($),ee=q.media.find(re=>String(re.mid)===X);C.applyCodecParameters({offerRtpParameters:J,answerMediaObject:ee})}U={type:"answer",sdp:o.write(q)},this._transportReady||(yield this.setupTransport({localDtlsRole:(y=this._forcedLocalDtlsRole)!==null&&y!==void 0?y:"client",localSdpObject:q})),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",U),yield this._pc.setLocalDescription(U);for(const V of k){const{trackId:$}=V,J=w.get($),X=this._pc.getTransceivers().find(ee=>ee.mid===J);if(!X)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(J,X),f.push({localId:J,track:X.receiver.track,rtpReceiver:X.receiver})}return f})}stopReceiving(k){return M(this,null,function*(){this.assertRecvDirection();for(const w of k){R.debug("stopReceiving() [localId:%s]",w);const F=this._mapMidTransceiver.get(w);if(!F)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(F.mid)}const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f);for(const w of k)this._mapMidTransceiver.delete(w)})}pauseReceiving(k){return M(this,null,function*(){})}resumeReceiving(k){return M(this,null,function*(){})}getReceiverStats(k){return M(this,null,function*(){this.assertRecvDirection();const y=this._mapMidTransceiver.get(k);if(!y)throw new Error("associated RTCRtpTransceiver not found");return y.receiver.getStats()})}receiveDataChannel(k){return M(this,arguments,function*({sctpStreamParameters:y,label:f,protocol:w}){var F;this.assertRecvDirection();const{streamId:U,ordered:q,maxPacketLifeTime:V,maxRetransmits:$}=y,J={negotiated:!0,id:U,ordered:q,maxPacketLifeTime:V,maxRetransmitTime:V,maxRetransmits:$,protocol:w};R.debug("receiveDataChannel() [options:%o]",J);const X=this._pc.createDataChannel(f,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ee={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=yield this._pc.createAnswer();if(!this._transportReady){const ne=o.parse(re.sdp);yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!==null&&F!==void 0?F:"client",localSdpObject:ne})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setLocalDescription(re),this._hasDataChannelMediaSection=!0}return{dataChannel:X}})}setupTransport(k){return M(this,arguments,function*({localDtlsRole:y,localSdpObject:f}){f||(f=o.parse(this._pc.localDescription.sdp));const w=C.extractDtlsParameters({sdpObject:f});w.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),yield new Promise((F,U)=>{this.safeEmit("@connect",{dtlsParameters:w},F,U)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome70=H}}),Fn=fe({"../../node_modules/mediasoup-client/lib/handlers/sdp/planBUtils.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0}),e.addLegacySimulcast=e.getRtpEncodings=void 0;function i({offerMediaObject:s,track:o}){const l=new Set;for(const C of s.ssrcs||[]){if(C.attribute!=="msid")continue;if(C.value.split(" ")[1]===o.id){const v=C.id;l.add(v)}}if(l.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${o.id}]`);const d=new Map;for(const C of s.ssrcGroups||[]){if(C.semantics!=="FID")continue;let[h,v]=C.ssrcs.split(/\s+/);h=Number(h),v=Number(v),l.has(h)&&(l.delete(h),l.delete(v),d.set(h,v))}for(const C of l)d.set(C,null);const m=[];for(const[C,h]of d){const v={ssrc:C};h&&(v.rtx={ssrc:h}),m.push(v)}return m}e.getRtpEncodings=i;function r({offerMediaObject:s,track:o,numStreams:l}){if(l<=1)throw new TypeError("numStreams must be greater than 1");let d,m,C;if(!(s.ssrcs||[]).find(b=>b.attribute!=="msid"?!1:b.value.split(" ")[1]===o.id?(d=b.id,C=b.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${o.id}]`);(s.ssrcGroups||[]).some(b=>{if(b.semantics!=="FID")return!1;const H=b.ssrcs.split(/\s+/);return Number(H[0])===d?(m=Number(H[1]),!0):!1});const v=s.ssrcs.find(b=>b.attribute==="cname"&&b.id===d);if(!v)throw new Error(`a=ssrc line with cname information not found [track.id:${o.id}]`);const D=v.value,E=[],R=[];for(let b=0;b<l;++b)E.push(d+b),m&&R.push(m+b);s.ssrcGroups=s.ssrcGroups||[],s.ssrcs=s.ssrcs||[],s.ssrcGroups.push({semantics:"SIM",ssrcs:E.join(" ")});for(let b=0;b<E.length;++b){const H=E[b];s.ssrcs.push({id:H,attribute:"cname",value:D}),s.ssrcs.push({id:H,attribute:"msid",value:`${C} ${o.id}`})}for(let b=0;b<R.length;++b){const H=E[b],j=R[b];s.ssrcs.push({id:j,attribute:"cname",value:D}),s.ssrcs.push({id:j,attribute:"msid",value:`${C} ${o.id}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${H} ${j}`})}}e.addLegacySimulcast=r}}),Mh=fe({"../../node_modules/mediasoup-client/lib/handlers/Chrome67.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(H,j,k,y){y===void 0&&(y=k);var f=Object.getOwnPropertyDescriptor(j,k);(!f||("get"in f?!j.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return j[k]}}),Object.defineProperty(H,y,f)}:function(H,j,k,y){y===void 0&&(y=k),H[y]=j[k]}),r=e&&e.__setModuleDefault||(Object.create?function(H,j){Object.defineProperty(H,"default",{enumerable:!0,value:j})}:function(H,j){H.default=j}),s=e&&e.__importStar||function(H){if(H&&H.__esModule)return H;var j={};if(H!=null)for(var k in H)k!=="default"&&Object.prototype.hasOwnProperty.call(H,k)&&i(j,H,k);return r(j,H),j};Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome67=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(Fn()),v=li(),D=Ri(),E=new l.Logger("Chrome67"),R={OS:1024,MIS:1024},b=class Mo extends v.HandlerInterface{static createFactory(){return()=>new Mo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(E.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){E.debug("getNativeRtpCapabilities()");const j=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const k=yield j.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{j.close()}catch{}const y=o.parse(k.sdp);return C.extractRtpCapabilities({sdpObject:y})}catch(k){try{j.close()}catch{}throw k}})}getNativeSctpCapabilities(){return M(this,null,function*(){return E.debug("getNativeSctpCapabilities()"),{numStreams:R}})}run({direction:j,iceParameters:k,iceCandidates:y,dtlsParameters:f,sctpParameters:w,iceServers:F,iceTransportPolicy:U,additionalSettings:q,proprietaryConstraints:V,extendedRtpCapabilities:$}){E.debug("run()"),this._direction=j,this._remoteSdp=new D.RemoteSdp({iceParameters:k,iceCandidates:y,dtlsParameters:f,sctpParameters:w,planB:!0}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",$),video:m.getSendingRtpParameters("video",$)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",$),video:m.getSendingRemoteRtpParameters("video",$)},f.role&&f.role!=="auto"&&(this._forcedLocalDtlsRole=f.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:F||[],iceTransportPolicy:U||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},q),V),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(E.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(j){return M(this,null,function*(){E.debug("updateIceServers()");const k=this._pc.getConfiguration();k.iceServers=j,this._pc.setConfiguration(k)})}restartIce(j){return M(this,null,function*(){if(E.debug("restartIce()"),this._remoteSdp.updateIceParameters(j),!!this._transportReady)if(this._direction==="send"){const k=yield this._pc.createOffer({iceRestart:!0});E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const y={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),yield this._pc.setRemoteDescription(y)}else{const k={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",k),yield this._pc.setRemoteDescription(k);const y=yield this._pc.createAnswer();E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),yield this._pc.setLocalDescription(y)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(j){return M(this,arguments,function*({track:k,encodings:y,codecOptions:f,codec:w}){var F;this.assertSendDirection(),E.debug("send() [kind:%s, track.id:%s]",k.kind,k.id),w&&E.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(k),this._pc.addTrack(k,this._sendStream);let U=yield this._pc.createOffer(),q=o.parse(U.sdp),V;const $=d.clone(this._sendingRtpParametersByKind[k.kind],{});$.codecs=m.reduceCodecs($.codecs);const J=d.clone(this._sendingRemoteRtpParametersByKind[k.kind],{});if(J.codecs=m.reduceCodecs(J.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!==null&&F!==void 0?F:"client",localSdpObject:q})),k.kind==="video"&&y&&y.length>1&&(E.debug("send() | enabling simulcast"),q=o.parse(U.sdp),V=q.media.find(ne=>ne.type==="video"),h.addLegacySimulcast({offerMediaObject:V,track:k,numStreams:y.length}),U={type:"offer",sdp:o.write(q)}),E.debug("send() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U),q=o.parse(this._pc.localDescription.sdp),V=q.media.find(ne=>ne.type===k.kind),$.rtcp.cname=C.getCname({offerMediaObject:V}),$.encodings=h.getRtpEncodings({offerMediaObject:V,track:k}),y)for(let ne=0;ne<$.encodings.length;++ne)y[ne]&&Object.assign($.encodings[ne],y[ne]);if($.encodings.length>1&&$.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const ne of $.encodings)ne.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:V,offerRtpParameters:$,answerRtpParameters:J,codecOptions:f});const X={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X);const ee=String(this._nextSendLocalId);this._nextSendLocalId++;const re=this._pc.getSenders().find(ne=>ne.track===k);return this._mapSendLocalIdRtpSender.set(ee,re),{localId:ee,rtpParameters:$,rtpSender:re}})}stopSending(j){return M(this,null,function*(){this.assertSendDirection(),E.debug("stopSending() [localId:%s]",j);const k=this._mapSendLocalIdRtpSender.get(j);if(!k)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(k),k.track&&this._sendStream.removeTrack(k.track),this._mapSendLocalIdRtpSender.delete(j);const y=yield this._pc.createOffer();E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y);try{yield this._pc.setLocalDescription(y)}catch(w){if(this._sendStream.getTracks().length===0){E.warn("stopSending() | ignoring expected error due no sending tracks: %s",w.toString());return}throw w}if(this._pc.signalingState==="stable")return;const f={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f)})}pauseSending(j){return M(this,null,function*(){})}resumeSending(j){return M(this,null,function*(){})}replaceTrack(j,k){return M(this,null,function*(){this.assertSendDirection(),k?E.debug("replaceTrack() [localId:%s, track.id:%s]",j,k.id):E.debug("replaceTrack() [localId:%s, no track]",j);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.track;yield y.replaceTrack(k),f&&this._sendStream.removeTrack(f),k&&this._sendStream.addTrack(k)})}setMaxSpatialLayer(j,k){return M(this,null,function*(){this.assertSendDirection(),E.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",j,k);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.getParameters();f.encodings.forEach((w,F)=>{F<=k?w.active=!0:w.active=!1}),yield y.setParameters(f)})}setRtpEncodingParameters(j,k){return M(this,null,function*(){this.assertSendDirection(),E.debug("setRtpEncodingParameters() [localId:%s, params:%o]",j,k);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.getParameters();f.encodings.forEach((w,F)=>{f.encodings[F]=ue(ue({},w),k)}),yield y.setParameters(f)})}getSenderStats(j){return M(this,null,function*(){this.assertSendDirection();const k=this._mapSendLocalIdRtpSender.get(j);if(!k)throw new Error("associated RTCRtpSender not found");return k.getStats()})}sendDataChannel(j){return M(this,arguments,function*({ordered:k,maxPacketLifeTime:y,maxRetransmits:f,label:w,protocol:F}){var U;this.assertSendDirection();const q={negotiated:!0,id:this._nextSendSctpStreamId,ordered:k,maxPacketLifeTime:y,maxRetransmitTime:y,maxRetransmits:f,protocol:F};E.debug("sendDataChannel() [options:%o]",q);const V=this._pc.createDataChannel(w,q);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const J=yield this._pc.createOffer(),X=o.parse(J.sdp),ee=X.media.find(ne=>ne.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:X})),E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",J),yield this._pc.setLocalDescription(J),this._remoteSdp.sendSctpAssociation({offerMediaObject:ee});const re={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setRemoteDescription(re),this._hasDataChannelMediaSection=!0}const $={streamId:q.id,ordered:q.ordered,maxPacketLifeTime:q.maxPacketLifeTime,maxRetransmits:q.maxRetransmits};return{dataChannel:V,sctpStreamParameters:$}})}receive(j){return M(this,null,function*(){var k;this.assertRecvDirection();const y=[];for(const U of j){const{trackId:q,kind:V,rtpParameters:$,streamId:J}=U;E.debug("receive() [trackId:%s, kind:%s]",q,V);const X=V;this._remoteSdp.receive({mid:X,kind:V,offerRtpParameters:$,streamId:J||$.rtcp.cname,trackId:q})}const f={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);let w=yield this._pc.createAnswer();const F=o.parse(w.sdp);for(const U of j){const{kind:q,rtpParameters:V}=U,$=q,J=F.media.find(X=>String(X.mid)===$);C.applyCodecParameters({offerRtpParameters:V,answerMediaObject:J})}w={type:"answer",sdp:o.write(F)},this._transportReady||(yield this.setupTransport({localDtlsRole:(k=this._forcedLocalDtlsRole)!==null&&k!==void 0?k:"client",localSdpObject:F})),E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const U of j){const{kind:q,trackId:V,rtpParameters:$}=U,J=V,X=q,ee=this._pc.getReceivers().find(re=>re.track&&re.track.id===J);if(!ee)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(J,{mid:X,rtpParameters:$,rtpReceiver:ee}),y.push({localId:J,track:ee.track,rtpReceiver:ee})}return y})}stopReceiving(j){return M(this,null,function*(){this.assertRecvDirection();for(const f of j){E.debug("stopReceiving() [localId:%s]",f);const{mid:w,rtpParameters:F}=this._mapRecvLocalIdInfo.get(f)||{};this._mapRecvLocalIdInfo.delete(f),this._remoteSdp.planBStopReceiving({mid:w,offerRtpParameters:F})}const k={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",k),yield this._pc.setRemoteDescription(k);const y=yield this._pc.createAnswer();E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),yield this._pc.setLocalDescription(y)})}pauseReceiving(j){return M(this,null,function*(){})}resumeReceiving(j){return M(this,null,function*(){})}getReceiverStats(j){return M(this,null,function*(){this.assertRecvDirection();const{rtpReceiver:k}=this._mapRecvLocalIdInfo.get(j)||{};if(!k)throw new Error("associated RTCRtpReceiver not found");return k.getStats()})}receiveDataChannel(j){return M(this,arguments,function*({sctpStreamParameters:k,label:y,protocol:f}){var w;this.assertRecvDirection();const{streamId:F,ordered:U,maxPacketLifeTime:q,maxRetransmits:V}=k,$={negotiated:!0,id:F,ordered:U,maxPacketLifeTime:q,maxRetransmitTime:q,maxRetransmits:V,protocol:f};E.debug("receiveDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(y,$);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const X={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ee=yield this._pc.createAnswer();if(!this._transportReady){const re=o.parse(ee.sdp);yield this.setupTransport({localDtlsRole:(w=this._forcedLocalDtlsRole)!==null&&w!==void 0?w:"client",localSdpObject:re})}E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ee),yield this._pc.setLocalDescription(ee),this._hasDataChannelMediaSection=!0}return{dataChannel:J}})}setupTransport(j){return M(this,arguments,function*({localDtlsRole:k,localSdpObject:y}){y||(y=o.parse(this._pc.localDescription.sdp));const f=C.extractDtlsParameters({sdpObject:y});f.role=k,this._remoteSdp.updateDtlsRole(k==="client"?"server":"client"),yield new Promise((w,F)=>{this.safeEmit("@connect",{dtlsParameters:f},w,F)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome67=b}}),Nh=fe({"../../node_modules/mediasoup-client/lib/handlers/Chrome55.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(j,k,y,f){f===void 0&&(f=y);var w=Object.getOwnPropertyDescriptor(k,y);(!w||("get"in w?!k.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return k[y]}}),Object.defineProperty(j,f,w)}:function(j,k,y,f){f===void 0&&(f=y),j[f]=k[y]}),r=e&&e.__setModuleDefault||(Object.create?function(j,k){Object.defineProperty(j,"default",{enumerable:!0,value:k})}:function(j,k){j.default=k}),s=e&&e.__importStar||function(j){if(j&&j.__esModule)return j;var k={};if(j!=null)for(var y in j)y!=="default"&&Object.prototype.hasOwnProperty.call(j,y)&&i(k,j,y);return r(k,j),k};Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome55=void 0;var o=s(Ft()),l=St(),d=Ei(),m=s(kt()),C=s(Zt()),h=s(Pi()),v=s(Fn()),D=li(),E=Ri(),R=new l.Logger("Chrome55"),b={OS:1024,MIS:1024},H=class No extends D.HandlerInterface{static createFactory(){return()=>new No}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){R.debug("getNativeRtpCapabilities()");const k=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const y=yield k.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{k.close()}catch{}const f=o.parse(y.sdp);return h.extractRtpCapabilities({sdpObject:f})}catch(y){try{k.close()}catch{}throw y}})}getNativeSctpCapabilities(){return M(this,null,function*(){return R.debug("getNativeSctpCapabilities()"),{numStreams:b}})}run({direction:k,iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F,iceServers:U,iceTransportPolicy:q,additionalSettings:V,proprietaryConstraints:$,extendedRtpCapabilities:J}){R.debug("run()"),this._direction=k,this._remoteSdp=new E.RemoteSdp({iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F,planB:!0}),this._sendingRtpParametersByKind={audio:C.getSendingRtpParameters("audio",J),video:C.getSendingRtpParameters("video",J)},this._sendingRemoteRtpParametersByKind={audio:C.getSendingRemoteRtpParameters("audio",J),video:C.getSendingRemoteRtpParameters("video",J)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:U||[],iceTransportPolicy:q||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},V),$),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(k){return M(this,null,function*(){R.debug("updateIceServers()");const y=this._pc.getConfiguration();y.iceServers=k,this._pc.setConfiguration(y)})}restartIce(k){return M(this,null,function*(){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(k),!!this._transportReady)if(this._direction==="send"){const y=yield this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",y),yield this._pc.setLocalDescription(y);const f={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f)}else{const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(k){return M(this,arguments,function*({track:y,encodings:f,codecOptions:w,codec:F}){var U;this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",y.kind,y.id),F&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(y),this._pc.addStream(this._sendStream);let q=yield this._pc.createOffer(),V=o.parse(q.sdp),$;const J=m.clone(this._sendingRtpParametersByKind[y.kind],{});J.codecs=C.reduceCodecs(J.codecs);const X=m.clone(this._sendingRemoteRtpParametersByKind[y.kind],{});if(X.codecs=C.reduceCodecs(X.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:V})),y.kind==="video"&&f&&f.length>1&&(R.debug("send() | enabling simulcast"),V=o.parse(q.sdp),$=V.media.find(ne=>ne.type==="video"),v.addLegacySimulcast({offerMediaObject:$,track:y,numStreams:f.length}),q={type:"offer",sdp:o.write(V)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",q),yield this._pc.setLocalDescription(q),V=o.parse(this._pc.localDescription.sdp),$=V.media.find(ne=>ne.type===y.kind),J.rtcp.cname=h.getCname({offerMediaObject:$}),J.encodings=v.getRtpEncodings({offerMediaObject:$,track:y}),f)for(let ne=0;ne<J.encodings.length;++ne)f[ne]&&Object.assign(J.encodings[ne],f[ne]);if(J.encodings.length>1&&J.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const ne of J.encodings)ne.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:$,offerRtpParameters:J,answerRtpParameters:X,codecOptions:w});const ee={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(re,y),{localId:re,rtpParameters:J}})}stopSending(k){return M(this,null,function*(){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",k);const y=this._mapSendLocalIdTrack.get(k);if(!y)throw new Error("track not found");this._mapSendLocalIdTrack.delete(k),this._sendStream.removeTrack(y),this._pc.addStream(this._sendStream);const f=yield this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",f);try{yield this._pc.setLocalDescription(f)}catch(F){if(this._sendStream.getTracks().length===0){R.warn("stopSending() | ignoring expected error due no sending tracks: %s",F.toString());return}throw F}if(this._pc.signalingState==="stable")return;const w={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)})}pauseSending(k){return M(this,null,function*(){})}resumeSending(k){return M(this,null,function*(){})}replaceTrack(k,y){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}setMaxSpatialLayer(k,y){return M(this,null,function*(){throw new d.UnsupportedError(" not implemented")})}setRtpEncodingParameters(k,y){return M(this,null,function*(){throw new d.UnsupportedError("not supported")})}getSenderStats(k){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}sendDataChannel(k){return M(this,arguments,function*({ordered:y,maxPacketLifeTime:f,maxRetransmits:w,label:F,protocol:U}){var q;this.assertSendDirection();const V={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:f,maxRetransmitTime:f,maxRetransmits:w,protocol:U};R.debug("sendDataChannel() [options:%o]",V);const $=this._pc.createDataChannel(F,V);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const X=yield this._pc.createOffer(),ee=o.parse(X.sdp),re=ee.media.find(Ce=>Ce.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:ee})),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X),this._remoteSdp.sendSctpAssociation({offerMediaObject:re});const ne={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setRemoteDescription(ne),this._hasDataChannelMediaSection=!0}const J={streamId:V.id,ordered:V.ordered,maxPacketLifeTime:V.maxPacketLifeTime,maxRetransmits:V.maxRetransmits};return{dataChannel:$,sctpStreamParameters:J}})}receive(k){return M(this,null,function*(){var y;this.assertRecvDirection();const f=[];for(const q of k){const{trackId:V,kind:$,rtpParameters:J,streamId:X}=q;R.debug("receive() [trackId:%s, kind:%s]",V,$);const ee=$;this._remoteSdp.receive({mid:ee,kind:$,offerRtpParameters:J,streamId:X||J.rtcp.cname,trackId:V})}const w={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",w),yield this._pc.setRemoteDescription(w);let F=yield this._pc.createAnswer();const U=o.parse(F.sdp);for(const q of k){const{kind:V,rtpParameters:$}=q,J=V,X=U.media.find(ee=>String(ee.mid)===J);h.applyCodecParameters({offerRtpParameters:$,answerMediaObject:X})}F={type:"answer",sdp:o.write(U)},this._transportReady||(yield this.setupTransport({localDtlsRole:(y=this._forcedLocalDtlsRole)!==null&&y!==void 0?y:"client",localSdpObject:U})),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",F),yield this._pc.setLocalDescription(F);for(const q of k){const{kind:V,trackId:$,rtpParameters:J}=q,X=V,ee=$,re=q.streamId||J.rtcp.cname,Ce=this._pc.getRemoteStreams().find(Re=>Re.id===re).getTrackById(ee);if(!Ce)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(ee,{mid:X,rtpParameters:J}),f.push({localId:ee,track:Ce})}return f})}stopReceiving(k){return M(this,null,function*(){this.assertRecvDirection();for(const w of k){R.debug("stopReceiving() [localId:%s]",w);const{mid:F,rtpParameters:U}=this._mapRecvLocalIdInfo.get(w)||{};this._mapRecvLocalIdInfo.delete(w),this._remoteSdp.planBStopReceiving({mid:F,offerRtpParameters:U})}const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f)})}pauseReceiving(k){return M(this,null,function*(){})}resumeReceiving(k){return M(this,null,function*(){})}getReceiverStats(k){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}receiveDataChannel(k){return M(this,arguments,function*({sctpStreamParameters:y,label:f,protocol:w}){var F;this.assertRecvDirection();const{streamId:U,ordered:q,maxPacketLifeTime:V,maxRetransmits:$}=y,J={negotiated:!0,id:U,ordered:q,maxPacketLifeTime:V,maxRetransmitTime:V,maxRetransmits:$,protocol:w};R.debug("receiveDataChannel() [options:%o]",J);const X=this._pc.createDataChannel(f,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const ee={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=yield this._pc.createAnswer();if(!this._transportReady){const ne=o.parse(re.sdp);yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!==null&&F!==void 0?F:"client",localSdpObject:ne})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setLocalDescription(re),this._hasDataChannelMediaSection=!0}return{dataChannel:X}})}setupTransport(k){return M(this,arguments,function*({localDtlsRole:y,localSdpObject:f}){f||(f=o.parse(this._pc.localDescription.sdp));const w=h.extractDtlsParameters({sdpObject:f});w.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),yield new Promise((F,U)=>{this.safeEmit("@connect",{dtlsParameters:w},F,U)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome55=H}}),Lh=fe({"../../node_modules/mediasoup-client/lib/handlers/Firefox60.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(k,y,f,w){w===void 0&&(w=f);var F=Object.getOwnPropertyDescriptor(y,f);(!F||("get"in F?!y.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return y[f]}}),Object.defineProperty(k,w,F)}:function(k,y,f,w){w===void 0&&(w=f),k[w]=y[f]}),r=e&&e.__setModuleDefault||(Object.create?function(k,y){Object.defineProperty(k,"default",{enumerable:!0,value:y})}:function(k,y){k.default=y}),s=e&&e.__importStar||function(k){if(k&&k.__esModule)return k;var y={};if(k!=null)for(var f in k)f!=="default"&&Object.prototype.hasOwnProperty.call(k,f)&&i(y,k,f);return r(y,k),y};Object.defineProperty(e,"__esModule",{value:!0}),e.Firefox60=void 0;var o=s(Ft()),l=St(),d=Ei(),m=s(kt()),C=s(Zt()),h=s(Pi()),v=s(vr()),D=li(),E=Ri(),R=rr(),b=new l.Logger("Firefox60"),H={OS:16,MIS:2048},j=class Lo extends D.HandlerInterface{static createFactory(){return()=>new Lo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){b.debug("getNativeRtpCapabilities()");const y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),f=document.createElement("canvas");f.getContext("2d");const F=f.captureStream().getVideoTracks()[0];try{y.addTransceiver("audio",{direction:"sendrecv"});const U=y.addTransceiver(F,{direction:"sendrecv"}),q=U.sender.getParameters(),V=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];q.encodings=V,yield U.sender.setParameters(q);const $=yield y.createOffer();try{f.remove()}catch{}try{F.stop()}catch{}try{y.close()}catch{}const J=o.parse($.sdp);return h.extractRtpCapabilities({sdpObject:J})}catch(U){try{f.remove()}catch{}try{F.stop()}catch{}try{y.close()}catch{}throw U}})}getNativeSctpCapabilities(){return M(this,null,function*(){return b.debug("getNativeSctpCapabilities()"),{numStreams:H}})}run({direction:y,iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U,iceServers:q,iceTransportPolicy:V,additionalSettings:$,proprietaryConstraints:J,extendedRtpCapabilities:X}){b.debug("run()"),this._direction=y,this._remoteSdp=new E.RemoteSdp({iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U}),this._sendingRtpParametersByKind={audio:C.getSendingRtpParameters("audio",X),video:C.getSendingRtpParameters("video",X)},this._sendingRemoteRtpParametersByKind={audio:C.getSendingRemoteRtpParameters("audio",X),video:C.getSendingRemoteRtpParameters("video",X)},this._pc=new RTCPeerConnection(ue({iceServers:q||[],iceTransportPolicy:V||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},$),J),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(y){return M(this,null,function*(){throw new d.UnsupportedError("not supported")})}restartIce(y){return M(this,null,function*(){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const f=yield this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",f),yield this._pc.setLocalDescription(f);const w={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(y){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),w&&(w=m.clone(w,[]),w.length>1&&(w.forEach((Re,ke)=>{Re.rid=`r${ke}`}),w.reverse()));const q=m.clone(this._sendingRtpParametersByKind[f.kind],{});q.codecs=C.reduceCodecs(q.codecs,U);const V=m.clone(this._sendingRemoteRtpParametersByKind[f.kind],{});V.codecs=C.reduceCodecs(V.codecs,U);const $=this._pc.addTransceiver(f,{direction:"sendonly",streams:[this._sendStream]});if(w){const Re=$.sender.getParameters();Re.encodings=w,yield $.sender.setParameters(Re)}const J=yield this._pc.createOffer();let X=o.parse(J.sdp);this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:X}));const ee=(0,R.parse)((w||[{}])[0].scalabilityMode);b.debug("send() | calling pc.setLocalDescription() [offer:%o]",J),yield this._pc.setLocalDescription(J);const re=$.mid;q.mid=re,X=o.parse(this._pc.localDescription.sdp);const ne=X.media[X.media.length-1];if(q.rtcp.cname=h.getCname({offerMediaObject:ne}),!w)q.encodings=v.getRtpEncodings({offerMediaObject:ne});else if(w.length===1){const Re=v.getRtpEncodings({offerMediaObject:ne});Object.assign(Re[0],w[0]),q.encodings=Re}else q.encodings=w.reverse();if(q.encodings.length>1&&(q.codecs[0].mimeType.toLowerCase()==="video/vp8"||q.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Re of q.encodings)Re.scalabilityMode?Re.scalabilityMode=`L1T${ee.temporalLayers}`:Re.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ne,offerRtpParameters:q,answerRtpParameters:V,codecOptions:F,extmapAllowMixed:!0});const Ce={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Ce),yield this._pc.setRemoteDescription(Ce),this._mapMidTransceiver.set(re,$),{localId:re,rtpParameters:q,rtpSender:$.sender}})}stopSending(y){return M(this,null,function*(){b.debug("stopSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated transceiver not found");f.sender.replaceTrack(null),this._pc.removeTrack(f.sender),this._remoteSdp.disableMediaSection(f.mid);const w=yield this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F),this._mapMidTransceiver.delete(y)})}pauseSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="inactive",this._remoteSdp.pauseMediaSection(y);const w=yield this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}resumeSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const w=yield this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}replaceTrack(y,f){return M(this,null,function*(){this.assertSendDirection(),f?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,f.id):b.debug("replaceTrack() [localId:%s, no track]",y);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(f)})}setMaxSpatialLayer(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated transceiver not found");const F=w.sender.getParameters();f=F.encodings.length-1-f,F.encodings.forEach((V,$)=>{$>=f?V.active=!0:V.active=!1}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}setRtpEncodingParameters(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{F.encodings[$]=ue(ue({},V),f)}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}getSenderStats(y){return M(this,null,function*(){this.assertSendDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.sender.getStats()})}sendDataChannel(y){return M(this,arguments,function*({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q}){this.assertSendDirection();const V={negotiated:!0,id:this._nextSendSctpStreamId,ordered:f,maxPacketLifeTime:w,maxRetransmits:F,protocol:q};b.debug("sendDataChannel() [options:%o]",V);const $=this._pc.createDataChannel(U,V);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%H.MIS,!this._hasDataChannelMediaSection){const X=yield this._pc.createOffer(),ee=o.parse(X.sdp),re=ee.media.find(Ce=>Ce.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:ee})),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X),this._remoteSdp.sendSctpAssociation({offerMediaObject:re});const ne={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setRemoteDescription(ne),this._hasDataChannelMediaSection=!0}const J={streamId:V.id,ordered:V.ordered,maxPacketLifeTime:V.maxPacketLifeTime,maxRetransmits:V.maxRetransmits};return{dataChannel:$,sctpStreamParameters:J}})}receive(y){return M(this,null,function*(){this.assertRecvDirection();const f=[],w=new Map;for(const V of y){const{trackId:$,kind:J,rtpParameters:X,streamId:ee}=V;b.debug("receive() [trackId:%s, kind:%s]",$,J);const re=X.mid||String(this._mapMidTransceiver.size);w.set($,re),this._remoteSdp.receive({mid:re,kind:J,offerRtpParameters:X,streamId:ee||X.rtcp.cname,trackId:$})}const F={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",F),yield this._pc.setRemoteDescription(F);let U=yield this._pc.createAnswer();const q=o.parse(U.sdp);for(const V of y){const{trackId:$,rtpParameters:J}=V,X=w.get($),ee=q.media.find(re=>String(re.mid)===X);h.applyCodecParameters({offerRtpParameters:J,answerMediaObject:ee}),U={type:"answer",sdp:o.write(q)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:q})),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",U),yield this._pc.setLocalDescription(U);for(const V of y){const{trackId:$}=V,J=w.get($),X=this._pc.getTransceivers().find(ee=>ee.mid===J);if(!X)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(J,X),f.push({localId:J,track:X.receiver.track,rtpReceiver:X.receiver})}return f})}stopReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("stopReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(U.mid)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const F of y)this._mapMidTransceiver.delete(F)})}pauseReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("pauseReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="inactive",this._remoteSdp.pauseMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("resumeReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(y){return M(this,null,function*(){this.assertRecvDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.receiver.getStats()})}receiveDataChannel(y){return M(this,arguments,function*({sctpStreamParameters:f,label:w,protocol:F}){this.assertRecvDirection();const{streamId:U,ordered:q,maxPacketLifeTime:V,maxRetransmits:$}=f,J={negotiated:!0,id:U,ordered:q,maxPacketLifeTime:V,maxRetransmits:$,protocol:F};b.debug("receiveDataChannel() [options:%o]",J);const X=this._pc.createDataChannel(w,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ee={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=yield this._pc.createAnswer();if(!this._transportReady){const ne=o.parse(re.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:ne})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setLocalDescription(re),this._hasDataChannelMediaSection=!0}return{dataChannel:X}})}setupTransport(y){return M(this,arguments,function*({localDtlsRole:f,localSdpObject:w}){w||(w=o.parse(this._pc.localDescription.sdp));const F=h.extractDtlsParameters({sdpObject:w});F.role=f,this._remoteSdp.updateDtlsRole(f==="client"?"server":"client"),yield new Promise((U,q)=>{this.safeEmit("@connect",{dtlsParameters:F},U,q)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Firefox60=j}}),jh=fe({"../../node_modules/mediasoup-client/lib/handlers/Safari12.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(k,y,f,w){w===void 0&&(w=f);var F=Object.getOwnPropertyDescriptor(y,f);(!F||("get"in F?!y.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return y[f]}}),Object.defineProperty(k,w,F)}:function(k,y,f,w){w===void 0&&(w=f),k[w]=y[f]}),r=e&&e.__setModuleDefault||(Object.create?function(k,y){Object.defineProperty(k,"default",{enumerable:!0,value:y})}:function(k,y){k.default=y}),s=e&&e.__importStar||function(k){if(k&&k.__esModule)return k;var y={};if(k!=null)for(var f in k)f!=="default"&&Object.prototype.hasOwnProperty.call(k,f)&&i(y,k,f);return r(y,k),y};Object.defineProperty(e,"__esModule",{value:!0}),e.Safari12=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(vr()),v=s(An()),D=li(),E=Ri(),R=rr(),b=new l.Logger("Safari12"),H={OS:1024,MIS:1024},j=class jo extends D.HandlerInterface{static createFactory(){return()=>new jo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){b.debug("getNativeRtpCapabilities()");const y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{y.addTransceiver("audio"),y.addTransceiver("video");const f=yield y.createOffer();try{y.close()}catch{}const w=o.parse(f.sdp),F=C.extractRtpCapabilities({sdpObject:w});return v.addNackSuppportForOpus(F),F}catch(f){try{y.close()}catch{}throw f}})}getNativeSctpCapabilities(){return M(this,null,function*(){return b.debug("getNativeSctpCapabilities()"),{numStreams:H}})}run({direction:y,iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U,iceServers:q,iceTransportPolicy:V,additionalSettings:$,proprietaryConstraints:J,extendedRtpCapabilities:X}){b.debug("run()"),this._direction=y,this._remoteSdp=new E.RemoteSdp({iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",X),video:m.getSendingRtpParameters("video",X)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",X),video:m.getSendingRemoteRtpParameters("video",X)},F.role&&F.role!=="auto"&&(this._forcedLocalDtlsRole=F.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:q||[],iceTransportPolicy:V||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},$),J),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(y){return M(this,null,function*(){b.debug("updateIceServers()");const f=this._pc.getConfiguration();f.iceServers=y,this._pc.setConfiguration(f)})}restartIce(y){return M(this,null,function*(){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const f=yield this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",f),yield this._pc.setLocalDescription(f);const w={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(y){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U}){var q;this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",f.kind,f.id);const V=d.clone(this._sendingRtpParametersByKind[f.kind],{});V.codecs=m.reduceCodecs(V.codecs,U);const $=d.clone(this._sendingRemoteRtpParametersByKind[f.kind],{});$.codecs=m.reduceCodecs($.codecs,U);const J=this._remoteSdp.getNextMediaSectionIdx(),X=this._pc.addTransceiver(f,{direction:"sendonly",streams:[this._sendStream]});let ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne;this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:re}));const Ce=(0,R.parse)((w||[{}])[0].scalabilityMode);w&&w.length>1&&(b.debug("send() | enabling legacy simulcast"),re=o.parse(ee.sdp),ne=re.media[J.idx],h.addLegacySimulcast({offerMediaObject:ne,numStreams:w.length}),ee={type:"offer",sdp:o.write(re)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee);const Re=X.mid;if(V.mid=Re,re=o.parse(this._pc.localDescription.sdp),ne=re.media[J.idx],V.rtcp.cname=C.getCname({offerMediaObject:ne}),V.encodings=h.getRtpEncodings({offerMediaObject:ne}),w)for(let Y=0;Y<V.encodings.length;++Y)w[Y]&&Object.assign(V.encodings[Y],w[Y]);if(V.encodings.length>1&&(V.codecs[0].mimeType.toLowerCase()==="video/vp8"||V.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Y of V.encodings)Y.scalabilityMode?Y.scalabilityMode=`L1T${Ce.temporalLayers}`:Y.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ne,reuseMid:J.reuseMid,offerRtpParameters:V,answerRtpParameters:$,codecOptions:F});const ke={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ke),yield this._pc.setRemoteDescription(ke),this._mapMidTransceiver.set(Re,X),{localId:Re,rtpParameters:V,rtpSender:X.sender}})}stopSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");if(f.sender.replaceTrack(null),this._pc.removeTrack(f.sender),this._remoteSdp.closeMediaSection(f.mid))try{f.stop()}catch{}const F=yield this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U),this._mapMidTransceiver.delete(y)})}pauseSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="inactive",this._remoteSdp.pauseMediaSection(y);const w=yield this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}resumeSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(y);const w=yield this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}replaceTrack(y,f){return M(this,null,function*(){this.assertSendDirection(),f?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,f.id):b.debug("replaceTrack() [localId:%s, no track]",y);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(f)})}setMaxSpatialLayer(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{$<=f?V.active=!0:V.active=!1}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}setRtpEncodingParameters(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{F.encodings[$]=ue(ue({},V),f)}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}getSenderStats(y){return M(this,null,function*(){this.assertSendDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.sender.getStats()})}sendDataChannel(y){return M(this,arguments,function*({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q}){var V;this.assertSendDirection();const $={negotiated:!0,id:this._nextSendSctpStreamId,ordered:f,maxPacketLifeTime:w,maxRetransmits:F,protocol:q};b.debug("sendDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(U,$);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%H.MIS,!this._hasDataChannelMediaSection){const ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne=re.media.find(Re=>Re.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(V=this._forcedLocalDtlsRole)!==null&&V!==void 0?V:"client",localSdpObject:re})),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee),this._remoteSdp.sendSctpAssociation({offerMediaObject:ne});const Ce={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Ce),yield this._pc.setRemoteDescription(Ce),this._hasDataChannelMediaSection=!0}const X={streamId:$.id,ordered:$.ordered,maxPacketLifeTime:$.maxPacketLifeTime,maxRetransmits:$.maxRetransmits};return{dataChannel:J,sctpStreamParameters:X}})}receive(y){return M(this,null,function*(){var f;this.assertRecvDirection();const w=[],F=new Map;for(const $ of y){const{trackId:J,kind:X,rtpParameters:ee,streamId:re}=$;b.debug("receive() [trackId:%s, kind:%s]",J,X);const ne=ee.mid||String(this._mapMidTransceiver.size);F.set(J,ne),this._remoteSdp.receive({mid:ne,kind:X,offerRtpParameters:ee,streamId:re||ee.rtcp.cname,trackId:J})}const U={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",U),yield this._pc.setRemoteDescription(U);let q=yield this._pc.createAnswer();const V=o.parse(q.sdp);for(const $ of y){const{trackId:J,rtpParameters:X}=$,ee=F.get(J),re=V.media.find(ne=>String(ne.mid)===ee);C.applyCodecParameters({offerRtpParameters:X,answerMediaObject:re})}q={type:"answer",sdp:o.write(V)},this._transportReady||(yield this.setupTransport({localDtlsRole:(f=this._forcedLocalDtlsRole)!==null&&f!==void 0?f:"client",localSdpObject:V})),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",q),yield this._pc.setLocalDescription(q);for(const $ of y){const{trackId:J}=$,X=F.get(J),ee=this._pc.getTransceivers().find(re=>re.mid===X);if(!ee)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(X,ee),w.push({localId:X,track:ee.receiver.track,rtpReceiver:ee.receiver})}return w})}stopReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("stopReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(U.mid)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const F of y)this._mapMidTransceiver.delete(F)})}pauseReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("pauseReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="inactive",this._remoteSdp.pauseMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("resumeReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(y){return M(this,null,function*(){this.assertRecvDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.receiver.getStats()})}receiveDataChannel(y){return M(this,arguments,function*({sctpStreamParameters:f,label:w,protocol:F}){var U;this.assertRecvDirection();const{streamId:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J}=f,X={negotiated:!0,id:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J,protocol:F};b.debug("receiveDataChannel() [options:%o]",X);const ee=this._pc.createDataChannel(w,X);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const re={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",re),yield this._pc.setRemoteDescription(re);const ne=yield this._pc.createAnswer();if(!this._transportReady){const Ce=o.parse(ne.sdp);yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:Ce})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setLocalDescription(ne),this._hasDataChannelMediaSection=!0}return{dataChannel:ee}})}setupTransport(y){return M(this,arguments,function*({localDtlsRole:f,localSdpObject:w}){w||(w=o.parse(this._pc.localDescription.sdp));const F=C.extractDtlsParameters({sdpObject:w});F.role=f,this._remoteSdp.updateDtlsRole(f==="client"?"server":"client"),yield new Promise((U,q)=>{this.safeEmit("@connect",{dtlsParameters:F},U,q)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Safari12=j}}),Bh=fe({"../../node_modules/mediasoup-client/lib/handlers/Safari11.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(H,j,k,y){y===void 0&&(y=k);var f=Object.getOwnPropertyDescriptor(j,k);(!f||("get"in f?!j.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return j[k]}}),Object.defineProperty(H,y,f)}:function(H,j,k,y){y===void 0&&(y=k),H[y]=j[k]}),r=e&&e.__setModuleDefault||(Object.create?function(H,j){Object.defineProperty(H,"default",{enumerable:!0,value:j})}:function(H,j){H.default=j}),s=e&&e.__importStar||function(H){if(H&&H.__esModule)return H;var j={};if(H!=null)for(var k in H)k!=="default"&&Object.prototype.hasOwnProperty.call(H,k)&&i(j,H,k);return r(j,H),j};Object.defineProperty(e,"__esModule",{value:!0}),e.Safari11=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(Fn()),v=li(),D=Ri(),E=new l.Logger("Safari11"),R={OS:1024,MIS:1024},b=class Bo extends v.HandlerInterface{static createFactory(){return()=>new Bo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(E.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){E.debug("getNativeRtpCapabilities()");const j=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const k=yield j.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{j.close()}catch{}const y=o.parse(k.sdp);return C.extractRtpCapabilities({sdpObject:y})}catch(k){try{j.close()}catch{}throw k}})}getNativeSctpCapabilities(){return M(this,null,function*(){return E.debug("getNativeSctpCapabilities()"),{numStreams:R}})}run({direction:j,iceParameters:k,iceCandidates:y,dtlsParameters:f,sctpParameters:w,iceServers:F,iceTransportPolicy:U,additionalSettings:q,proprietaryConstraints:V,extendedRtpCapabilities:$}){E.debug("run()"),this._direction=j,this._remoteSdp=new D.RemoteSdp({iceParameters:k,iceCandidates:y,dtlsParameters:f,sctpParameters:w,planB:!0}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",$),video:m.getSendingRtpParameters("video",$)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",$),video:m.getSendingRemoteRtpParameters("video",$)},f.role&&f.role!=="auto"&&(this._forcedLocalDtlsRole=f.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:F||[],iceTransportPolicy:U||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},q),V),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(E.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(j){return M(this,null,function*(){E.debug("updateIceServers()");const k=this._pc.getConfiguration();k.iceServers=j,this._pc.setConfiguration(k)})}restartIce(j){return M(this,null,function*(){if(E.debug("restartIce()"),this._remoteSdp.updateIceParameters(j),!!this._transportReady)if(this._direction==="send"){const k=yield this._pc.createOffer({iceRestart:!0});E.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const y={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),yield this._pc.setRemoteDescription(y)}else{const k={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",k),yield this._pc.setRemoteDescription(k);const y=yield this._pc.createAnswer();E.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),yield this._pc.setLocalDescription(y)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(j){return M(this,arguments,function*({track:k,encodings:y,codecOptions:f,codec:w}){var F;this.assertSendDirection(),E.debug("send() [kind:%s, track.id:%s]",k.kind,k.id),w&&E.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(k),this._pc.addTrack(k,this._sendStream);let U=yield this._pc.createOffer(),q=o.parse(U.sdp),V;const $=d.clone(this._sendingRtpParametersByKind[k.kind],{});$.codecs=m.reduceCodecs($.codecs);const J=d.clone(this._sendingRemoteRtpParametersByKind[k.kind],{});if(J.codecs=m.reduceCodecs(J.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!==null&&F!==void 0?F:"client",localSdpObject:q})),k.kind==="video"&&y&&y.length>1&&(E.debug("send() | enabling simulcast"),q=o.parse(U.sdp),V=q.media.find(ne=>ne.type==="video"),h.addLegacySimulcast({offerMediaObject:V,track:k,numStreams:y.length}),U={type:"offer",sdp:o.write(q)}),E.debug("send() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U),q=o.parse(this._pc.localDescription.sdp),V=q.media.find(ne=>ne.type===k.kind),$.rtcp.cname=C.getCname({offerMediaObject:V}),$.encodings=h.getRtpEncodings({offerMediaObject:V,track:k}),y)for(let ne=0;ne<$.encodings.length;++ne)y[ne]&&Object.assign($.encodings[ne],y[ne]);if($.encodings.length>1&&$.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const ne of $.encodings)ne.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:V,offerRtpParameters:$,answerRtpParameters:J,codecOptions:f});const X={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("send() | calling pc.setRemoteDescription() [answer:%o]",X),yield this._pc.setRemoteDescription(X);const ee=String(this._nextSendLocalId);this._nextSendLocalId++;const re=this._pc.getSenders().find(ne=>ne.track===k);return this._mapSendLocalIdRtpSender.set(ee,re),{localId:ee,rtpParameters:$,rtpSender:re}})}stopSending(j){return M(this,null,function*(){this.assertSendDirection();const k=this._mapSendLocalIdRtpSender.get(j);if(!k)throw new Error("associated RTCRtpSender not found");k.track&&this._sendStream.removeTrack(k.track),this._mapSendLocalIdRtpSender.delete(j);const y=yield this._pc.createOffer();E.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y);try{yield this._pc.setLocalDescription(y)}catch(w){if(this._sendStream.getTracks().length===0){E.warn("stopSending() | ignoring expected error due no sending tracks: %s",w.toString());return}throw w}if(this._pc.signalingState==="stable")return;const f={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f)})}pauseSending(j){return M(this,null,function*(){})}resumeSending(j){return M(this,null,function*(){})}replaceTrack(j,k){return M(this,null,function*(){this.assertSendDirection(),k?E.debug("replaceTrack() [localId:%s, track.id:%s]",j,k.id):E.debug("replaceTrack() [localId:%s, no track]",j);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.track;yield y.replaceTrack(k),f&&this._sendStream.removeTrack(f),k&&this._sendStream.addTrack(k)})}setMaxSpatialLayer(j,k){return M(this,null,function*(){this.assertSendDirection(),E.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",j,k);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.getParameters();f.encodings.forEach((w,F)=>{F<=k?w.active=!0:w.active=!1}),yield y.setParameters(f)})}setRtpEncodingParameters(j,k){return M(this,null,function*(){this.assertSendDirection(),E.debug("setRtpEncodingParameters() [localId:%s, params:%o]",j,k);const y=this._mapSendLocalIdRtpSender.get(j);if(!y)throw new Error("associated RTCRtpSender not found");const f=y.getParameters();f.encodings.forEach((w,F)=>{f.encodings[F]=ue(ue({},w),k)}),yield y.setParameters(f)})}getSenderStats(j){return M(this,null,function*(){this.assertSendDirection();const k=this._mapSendLocalIdRtpSender.get(j);if(!k)throw new Error("associated RTCRtpSender not found");return k.getStats()})}sendDataChannel(j){return M(this,arguments,function*({ordered:k,maxPacketLifeTime:y,maxRetransmits:f,label:w,protocol:F}){var U;this.assertSendDirection();const q={negotiated:!0,id:this._nextSendSctpStreamId,ordered:k,maxPacketLifeTime:y,maxRetransmits:f,protocol:F};E.debug("sendDataChannel() [options:%o]",q);const V=this._pc.createDataChannel(w,q);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%R.MIS,!this._hasDataChannelMediaSection){const J=yield this._pc.createOffer(),X=o.parse(J.sdp),ee=X.media.find(ne=>ne.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:X})),E.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",J),yield this._pc.setLocalDescription(J),this._remoteSdp.sendSctpAssociation({offerMediaObject:ee});const re={type:"answer",sdp:this._remoteSdp.getSdp()};E.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setRemoteDescription(re),this._hasDataChannelMediaSection=!0}const $={streamId:q.id,ordered:q.ordered,maxPacketLifeTime:q.maxPacketLifeTime,maxRetransmits:q.maxRetransmits};return{dataChannel:V,sctpStreamParameters:$}})}receive(j){return M(this,null,function*(){var k;this.assertRecvDirection();const y=[];for(const U of j){const{trackId:q,kind:V,rtpParameters:$,streamId:J}=U;E.debug("receive() [trackId:%s, kind:%s]",q,V);const X=V;this._remoteSdp.receive({mid:X,kind:V,offerRtpParameters:$,streamId:J||$.rtcp.cname,trackId:q})}const f={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);let w=yield this._pc.createAnswer();const F=o.parse(w.sdp);for(const U of j){const{kind:q,rtpParameters:V}=U,$=q,J=F.media.find(X=>String(X.mid)===$);C.applyCodecParameters({offerRtpParameters:V,answerMediaObject:J})}w={type:"answer",sdp:o.write(F)},this._transportReady||(yield this.setupTransport({localDtlsRole:(k=this._forcedLocalDtlsRole)!==null&&k!==void 0?k:"client",localSdpObject:F})),E.debug("receive() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const U of j){const{kind:q,trackId:V,rtpParameters:$}=U,J=q,X=V,ee=this._pc.getReceivers().find(re=>re.track&&re.track.id===X);if(!ee)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(X,{mid:J,rtpParameters:$,rtpReceiver:ee}),y.push({localId:X,track:ee.track,rtpReceiver:ee})}return y})}stopReceiving(j){return M(this,null,function*(){this.assertRecvDirection();for(const f of j){E.debug("stopReceiving() [localId:%s]",f);const{mid:w,rtpParameters:F}=this._mapRecvLocalIdInfo.get(f)||{};this._mapRecvLocalIdInfo.delete(f),this._remoteSdp.planBStopReceiving({mid:w,offerRtpParameters:F})}const k={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",k),yield this._pc.setRemoteDescription(k);const y=yield this._pc.createAnswer();E.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),yield this._pc.setLocalDescription(y)})}getReceiverStats(j){return M(this,null,function*(){this.assertRecvDirection();const{rtpReceiver:k}=this._mapRecvLocalIdInfo.get(j)||{};if(!k)throw new Error("associated RTCRtpReceiver not found");return k.getStats()})}pauseReceiving(j){return M(this,null,function*(){})}resumeReceiving(j){return M(this,null,function*(){})}receiveDataChannel(j){return M(this,arguments,function*({sctpStreamParameters:k,label:y,protocol:f}){var w;this.assertRecvDirection();const{streamId:F,ordered:U,maxPacketLifeTime:q,maxRetransmits:V}=k,$={negotiated:!0,id:F,ordered:U,maxPacketLifeTime:q,maxRetransmits:V,protocol:f};E.debug("receiveDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(y,$);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const X={type:"offer",sdp:this._remoteSdp.getSdp()};E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",X),yield this._pc.setRemoteDescription(X);const ee=yield this._pc.createAnswer();if(!this._transportReady){const re=o.parse(ee.sdp);yield this.setupTransport({localDtlsRole:(w=this._forcedLocalDtlsRole)!==null&&w!==void 0?w:"client",localSdpObject:re})}E.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ee),yield this._pc.setLocalDescription(ee),this._hasDataChannelMediaSection=!0}return{dataChannel:J}})}setupTransport(j){return M(this,arguments,function*({localDtlsRole:k,localSdpObject:y}){y||(y=o.parse(this._pc.localDescription.sdp));const f=C.extractDtlsParameters({sdpObject:y});f.role=k,this._remoteSdp.updateDtlsRole(k==="client"?"server":"client"),yield new Promise((w,F)=>{this.safeEmit("@connect",{dtlsParameters:f},w,F)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Safari11=b}}),Hh=fe({"../../node_modules/mediasoup-client/lib/handlers/ortc/edgeUtils.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(m,C,h,v){v===void 0&&(v=h);var D=Object.getOwnPropertyDescriptor(C,h);(!D||("get"in D?!C.__esModule:D.writable||D.configurable))&&(D={enumerable:!0,get:function(){return C[h]}}),Object.defineProperty(m,v,D)}:function(m,C,h,v){v===void 0&&(v=h),m[v]=C[h]}),r=e&&e.__setModuleDefault||(Object.create?function(m,C){Object.defineProperty(m,"default",{enumerable:!0,value:C})}:function(m,C){m.default=C}),s=e&&e.__importStar||function(m){if(m&&m.__esModule)return m;var C={};if(m!=null)for(var h in m)h!=="default"&&Object.prototype.hasOwnProperty.call(m,h)&&i(C,m,h);return r(C,m),C};Object.defineProperty(e,"__esModule",{value:!0}),e.mangleRtpParameters=e.getCapabilities=void 0;var o=s(kt());function l(){const m=RTCRtpReceiver.getCapabilities(),C=o.clone(m,{});for(const h of C.codecs){if(h.channels=h.numChannels,delete h.numChannels,h.mimeType=h.mimeType||`${h.kind}/${h.name}`,h.parameters){const v=h.parameters;v.apt&&(v.apt=Number(v.apt)),v["packetization-mode"]&&(v["packetization-mode"]=Number(v["packetization-mode"]))}for(const v of h.rtcpFeedback||[])v.parameter||(v.parameter="")}return C}e.getCapabilities=l;function d(m){const C=o.clone(m,{});C.mid&&(C.muxId=C.mid,delete C.mid);for(const h of C.codecs)h.channels&&(h.numChannels=h.channels,delete h.channels),h.mimeType&&!h.name&&(h.name=h.mimeType.split("/")[1]),delete h.mimeType;return C}e.mangleRtpParameters=d}}),Uh=fe({"../../node_modules/mediasoup-client/lib/handlers/Edge11.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(E,R,b,H){H===void 0&&(H=b);var j=Object.getOwnPropertyDescriptor(R,b);(!j||("get"in j?!R.__esModule:j.writable||j.configurable))&&(j={enumerable:!0,get:function(){return R[b]}}),Object.defineProperty(E,H,j)}:function(E,R,b,H){H===void 0&&(H=b),E[H]=R[b]}),r=e&&e.__setModuleDefault||(Object.create?function(E,R){Object.defineProperty(E,"default",{enumerable:!0,value:R})}:function(E,R){E.default=R}),s=e&&e.__importStar||function(E){if(E&&E.__esModule)return E;var R={};if(E!=null)for(var b in E)b!=="default"&&Object.prototype.hasOwnProperty.call(E,b)&&i(R,E,b);return r(R,E),R};Object.defineProperty(e,"__esModule",{value:!0}),e.Edge11=void 0;var o=St(),l=Ei(),d=s(kt()),m=s(Zt()),C=s(Hh()),h=li(),v=new o.Logger("Edge11"),D=class Ho extends h.HandlerInterface{static createFactory(){return()=>new Ho}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){v.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const R of this._rtpSenders.values())try{R.stop()}catch{}for(const R of this._rtpReceivers.values())try{R.stop()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){return v.debug("getNativeRtpCapabilities()"),C.getCapabilities()})}getNativeSctpCapabilities(){return M(this,null,function*(){return v.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}})}run({direction:R,iceParameters:b,iceCandidates:H,dtlsParameters:j,sctpParameters:k,iceServers:y,iceTransportPolicy:f,additionalSettings:w,proprietaryConstraints:F,extendedRtpCapabilities:U}){v.debug("run()"),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",U),video:m.getSendingRtpParameters("video",U)},this._remoteIceParameters=b,this._remoteIceCandidates=H,this._remoteDtlsParameters=j,this._cname=`CNAME-${d.generateRandomNumber()}`,this.setIceGatherer({iceServers:y,iceTransportPolicy:f}),this.setIceTransport(),this.setDtlsTransport()}updateIceServers(R){return M(this,null,function*(){throw new l.UnsupportedError("not supported")})}restartIce(R){return M(this,null,function*(){if(v.debug("restartIce()"),this._remoteIceParameters=R,!!this._transportReady){v.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,R,"controlling");for(const b of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(b);this._iceTransport.addRemoteCandidate({})}})}getTransportStats(){return M(this,null,function*(){return this._iceTransport.getStats()})}send(R){return M(this,arguments,function*({track:b,encodings:H,codecOptions:j,codec:k}){v.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),v.debug("send() | calling new RTCRtpSender()");const y=new RTCRtpSender(b,this._dtlsTransport),f=d.clone(this._sendingRtpParametersByKind[b.kind],{});f.codecs=m.reduceCodecs(f.codecs,k);const w=f.codecs.some(q=>/.+\/rtx$/i.test(q.mimeType));H||(H=[{}]);for(const q of H)q.ssrc=d.generateRandomNumber(),w&&(q.rtx={ssrc:d.generateRandomNumber()});f.encodings=H,f.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const F=C.mangleRtpParameters(f);v.debug("send() | calling rtpSender.send() [params:%o]",F),yield y.send(F);const U=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(U,y),{localId:U,rtpParameters:f,rtpSender:y}})}stopSending(R){return M(this,null,function*(){v.debug("stopSending() [localId:%s]",R);const b=this._rtpSenders.get(R);if(!b)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(R);try{v.debug("stopSending() | calling rtpSender.stop()"),b.stop()}catch(H){throw v.warn("stopSending() | rtpSender.stop() failed:%o",H),H}})}pauseSending(R){return M(this,null,function*(){})}resumeSending(R){return M(this,null,function*(){})}replaceTrack(R,b){return M(this,null,function*(){b?v.debug("replaceTrack() [localId:%s, track.id:%s]",R,b.id):v.debug("replaceTrack() [localId:%s, no track]",R);const H=this._rtpSenders.get(R);if(!H)throw new Error("RTCRtpSender not found");H.setTrack(b)})}setMaxSpatialLayer(R,b){return M(this,null,function*(){v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",R,b);const H=this._rtpSenders.get(R);if(!H)throw new Error("RTCRtpSender not found");const j=H.getParameters();j.encodings.forEach((k,y)=>{y<=b?k.active=!0:k.active=!1}),yield H.setParameters(j)})}setRtpEncodingParameters(R,b){return M(this,null,function*(){v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",R,b);const H=this._rtpSenders.get(R);if(!H)throw new Error("RTCRtpSender not found");const j=H.getParameters();j.encodings.forEach((k,y)=>{j.encodings[y]=ue(ue({},k),b)}),yield H.setParameters(j)})}getSenderStats(R){return M(this,null,function*(){const b=this._rtpSenders.get(R);if(!b)throw new Error("RTCRtpSender not found");return b.getStats()})}sendDataChannel(R){return M(this,null,function*(){throw new l.UnsupportedError("not implemented")})}receive(R){return M(this,null,function*(){const b=[];for(const H of R){const{trackId:j,kind:k}=H;v.debug("receive() [trackId:%s, kind:%s]",j,k)}this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));for(const H of R){const{trackId:j,kind:k,rtpParameters:y}=H;v.debug("receive() | calling new RTCRtpReceiver()");const f=new RTCRtpReceiver(this._dtlsTransport,k);f.addEventListener("error",U=>{v.error('rtpReceiver "error" event [event:%o]',U)});const w=C.mangleRtpParameters(y);v.debug("receive() | calling rtpReceiver.receive() [params:%o]",w),yield f.receive(w);const F=j;this._rtpReceivers.set(F,f),b.push({localId:F,track:f.track,rtpReceiver:f})}return b})}stopReceiving(R){return M(this,null,function*(){for(const b of R){v.debug("stopReceiving() [localId:%s]",b);const H=this._rtpReceivers.get(b);if(!H)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(b);try{v.debug("stopReceiving() | calling rtpReceiver.stop()"),H.stop()}catch(j){v.warn("stopReceiving() | rtpReceiver.stop() failed:%o",j)}}})}pauseReceiving(R){return M(this,null,function*(){})}resumeReceiving(R){return M(this,null,function*(){})}getReceiverStats(R){return M(this,null,function*(){const b=this._rtpReceivers.get(R);if(!b)throw new Error("RTCRtpReceiver not found");return b.getStats()})}receiveDataChannel(R){return M(this,null,function*(){throw new l.UnsupportedError("not implemented")})}setIceGatherer({iceServers:R,iceTransportPolicy:b}){const H=new RTCIceGatherer({iceServers:R||[],gatherPolicy:b||"all"});H.addEventListener("error",j=>{v.error('iceGatherer "error" event [event:%o]',j)});try{H.gather()}catch(j){v.debug("setIceGatherer() | iceGatherer.gather() failed: %s",j.toString())}this._iceGatherer=H}setIceTransport(){const R=new RTCIceTransport(this._iceGatherer);R.addEventListener("statechange",()=>{switch(R.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),R.addEventListener("icestatechange",()=>{switch(R.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}}),R.addEventListener("candidatepairchange",b=>{v.debug('iceTransport "candidatepairchange" event [pair:%o]',b.pair)}),this._iceTransport=R}setDtlsTransport(){const R=new RTCDtlsTransport(this._iceTransport);R.addEventListener("statechange",()=>{v.debug('dtlsTransport "statechange" event [state:%s]',R.state)}),R.addEventListener("dtlsstatechange",()=>{v.debug('dtlsTransport "dtlsstatechange" event [state:%s]',R.state),R.state==="closed"&&this.emit("@connectionstatechange","closed")}),R.addEventListener("error",b=>{v.error('dtlsTransport "error" event [event:%o]',b)}),this._dtlsTransport=R}setupTransport(R){return M(this,arguments,function*({localDtlsRole:b}){v.debug("setupTransport()");const H=this._dtlsTransport.getLocalParameters();H.role=b,yield new Promise((j,k)=>{this.safeEmit("@connect",{dtlsParameters:H},j,k)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const j of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(j);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(j=>j.algorithm==="sha-256"||j.algorithm==="sha-384"||j.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0})}};e.Edge11=D}}),qh=fe({"../../node_modules/mediasoup-client/lib/handlers/ReactNativeUnifiedPlan.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(k,y,f,w){w===void 0&&(w=f);var F=Object.getOwnPropertyDescriptor(y,f);(!F||("get"in F?!y.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return y[f]}}),Object.defineProperty(k,w,F)}:function(k,y,f,w){w===void 0&&(w=f),k[w]=y[f]}),r=e&&e.__setModuleDefault||(Object.create?function(k,y){Object.defineProperty(k,"default",{enumerable:!0,value:y})}:function(k,y){k.default=y}),s=e&&e.__importStar||function(k){if(k&&k.__esModule)return k;var y={};if(k!=null)for(var f in k)f!=="default"&&Object.prototype.hasOwnProperty.call(k,f)&&i(y,k,f);return r(y,k),y};Object.defineProperty(e,"__esModule",{value:!0}),e.ReactNativeUnifiedPlan=void 0;var o=s(Ft()),l=St(),d=s(kt()),m=s(Zt()),C=s(Pi()),h=s(vr()),v=s(An()),D=li(),E=Ri(),R=rr(),b=new l.Logger("ReactNativeUnifiedPlan"),H={OS:1024,MIS:1024},j=class Uo extends D.HandlerInterface{static createFactory(){return()=>new Uo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(b.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){b.debug("getNativeRtpCapabilities()");const y=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{y.addTransceiver("audio"),y.addTransceiver("video");const f=yield y.createOffer();try{y.close()}catch{}const w=o.parse(f.sdp),F=C.extractRtpCapabilities({sdpObject:w});return v.addNackSuppportForOpus(F),F}catch(f){try{y.close()}catch{}throw f}})}getNativeSctpCapabilities(){return M(this,null,function*(){return b.debug("getNativeSctpCapabilities()"),{numStreams:H}})}run({direction:y,iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U,iceServers:q,iceTransportPolicy:V,additionalSettings:$,proprietaryConstraints:J,extendedRtpCapabilities:X}){b.debug("run()"),this._direction=y,this._remoteSdp=new E.RemoteSdp({iceParameters:f,iceCandidates:w,dtlsParameters:F,sctpParameters:U}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",X),video:m.getSendingRtpParameters("video",X)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",X),video:m.getSendingRemoteRtpParameters("video",X)},F.role&&F.role!=="auto"&&(this._forcedLocalDtlsRole=F.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:q||[],iceTransportPolicy:V||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},$),J),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(y){return M(this,null,function*(){b.debug("updateIceServers()");const f=this._pc.getConfiguration();f.iceServers=y,this._pc.setConfiguration(f)})}restartIce(y){return M(this,null,function*(){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(y),!!this._transportReady)if(this._direction==="send"){const f=yield this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",f),yield this._pc.setLocalDescription(f);const w={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)}else{const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(y){return M(this,arguments,function*({track:f,encodings:w,codecOptions:F,codec:U}){var q;this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",f.kind,f.id),w&&w.length>1&&w.forEach((he,be)=>{he.rid=`r${be}`});const V=d.clone(this._sendingRtpParametersByKind[f.kind],{});V.codecs=m.reduceCodecs(V.codecs,U);const $=d.clone(this._sendingRemoteRtpParametersByKind[f.kind],{});$.codecs=m.reduceCodecs($.codecs,U);const J=this._remoteSdp.getNextMediaSectionIdx(),X=this._pc.addTransceiver(f,{direction:"sendonly",streams:[this._sendStream],sendEncodings:w});let ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne;this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:re}));let Ce=!1;const Re=(0,R.parse)((w||[{}])[0].scalabilityMode);w&&w.length===1&&Re.spatialLayers>1&&V.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),Ce=!0,re=o.parse(ee.sdp),ne=re.media[J.idx],h.addLegacySimulcast({offerMediaObject:ne,numStreams:Re.spatialLayers}),ee={type:"offer",sdp:o.write(re)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee);const ke=X.mid;if(V.mid=ke,re=o.parse(this._pc.localDescription.sdp),ne=re.media[J.idx],V.rtcp.cname=C.getCname({offerMediaObject:ne}),!w)V.encodings=h.getRtpEncodings({offerMediaObject:ne});else if(w.length===1){let he=h.getRtpEncodings({offerMediaObject:ne});Object.assign(he[0],w[0]),Ce&&(he=[he[0]]),V.encodings=he}else V.encodings=w;if(V.encodings.length>1&&(V.codecs[0].mimeType.toLowerCase()==="video/vp8"||V.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const he of V.encodings)he.scalabilityMode?he.scalabilityMode=`L1T${Re.temporalLayers}`:he.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ne,reuseMid:J.reuseMid,offerRtpParameters:V,answerRtpParameters:$,codecOptions:F,extmapAllowMixed:!0});const Y={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Y),yield this._pc.setRemoteDescription(Y),this._mapMidTransceiver.set(ke,X),{localId:ke,rtpParameters:V,rtpSender:X.sender}})}stopSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");if(f.sender.replaceTrack(null),this._pc.removeTrack(f.sender),this._remoteSdp.closeMediaSection(f.mid))try{f.stop()}catch{}const F=yield this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",F),yield this._pc.setLocalDescription(F);const U={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",U),yield this._pc.setRemoteDescription(U),this._mapMidTransceiver.delete(y)})}pauseSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="inactive",this._remoteSdp.pauseMediaSection(y);const w=yield this._pc.createOffer();b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}resumeSending(y){return M(this,null,function*(){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",y);const f=this._mapMidTransceiver.get(y);if(this._remoteSdp.resumeSendingMediaSection(y),!f)throw new Error("associated RTCRtpTransceiver not found");f.direction="sendonly";const w=yield this._pc.createOffer();b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",w),yield this._pc.setLocalDescription(w);const F={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",F),yield this._pc.setRemoteDescription(F)})}replaceTrack(y,f){return M(this,null,function*(){this.assertSendDirection(),f?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,f.id):b.debug("replaceTrack() [localId:%s, no track]",y);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");yield w.sender.replaceTrack(f)})}setMaxSpatialLayer(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{$<=f?V.active=!0:V.active=!1}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}setRtpEncodingParameters(y,f){return M(this,null,function*(){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,f);const w=this._mapMidTransceiver.get(y);if(!w)throw new Error("associated RTCRtpTransceiver not found");const F=w.sender.getParameters();F.encodings.forEach((V,$)=>{F.encodings[$]=ue(ue({},V),f)}),yield w.sender.setParameters(F),this._remoteSdp.muxMediaSectionSimulcast(y,F.encodings);const U=yield this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const q={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",q),yield this._pc.setRemoteDescription(q)})}getSenderStats(y){return M(this,null,function*(){this.assertSendDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.sender.getStats()})}sendDataChannel(y){return M(this,arguments,function*({ordered:f,maxPacketLifeTime:w,maxRetransmits:F,label:U,protocol:q}){var V;this.assertSendDirection();const $={negotiated:!0,id:this._nextSendSctpStreamId,ordered:f,maxPacketLifeTime:w,maxRetransmits:F,protocol:q};b.debug("sendDataChannel() [options:%o]",$);const J=this._pc.createDataChannel(U,$);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%H.MIS,!this._hasDataChannelMediaSection){const ee=yield this._pc.createOffer(),re=o.parse(ee.sdp),ne=re.media.find(Re=>Re.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(V=this._forcedLocalDtlsRole)!==null&&V!==void 0?V:"client",localSdpObject:re})),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",ee),yield this._pc.setLocalDescription(ee),this._remoteSdp.sendSctpAssociation({offerMediaObject:ne});const Ce={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Ce),yield this._pc.setRemoteDescription(Ce),this._hasDataChannelMediaSection=!0}const X={streamId:$.id,ordered:$.ordered,maxPacketLifeTime:$.maxPacketLifeTime,maxRetransmits:$.maxRetransmits};return{dataChannel:J,sctpStreamParameters:X}})}receive(y){return M(this,null,function*(){var f;this.assertRecvDirection();const w=[],F=new Map;for(const $ of y){const{trackId:J,kind:X,rtpParameters:ee,streamId:re}=$;b.debug("receive() [trackId:%s, kind:%s]",J,X);const ne=ee.mid||String(this._mapMidTransceiver.size);F.set(J,ne),this._remoteSdp.receive({mid:ne,kind:X,offerRtpParameters:ee,streamId:re||ee.rtcp.cname,trackId:J})}const U={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",U),yield this._pc.setRemoteDescription(U);let q=yield this._pc.createAnswer();const V=o.parse(q.sdp);for(const $ of y){const{trackId:J,rtpParameters:X}=$,ee=F.get(J),re=V.media.find(ne=>String(ne.mid)===ee);C.applyCodecParameters({offerRtpParameters:X,answerMediaObject:re})}q={type:"answer",sdp:o.write(V)},this._transportReady||(yield this.setupTransport({localDtlsRole:(f=this._forcedLocalDtlsRole)!==null&&f!==void 0?f:"client",localSdpObject:V})),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",q),yield this._pc.setLocalDescription(q);for(const $ of y){const{trackId:J}=$,X=F.get(J),ee=this._pc.getTransceivers().find(re=>re.mid===X);if(ee)this._mapMidTransceiver.set(X,ee),w.push({localId:X,track:ee.receiver.track,rtpReceiver:ee.receiver});else throw new Error("new RTCRtpTransceiver not found")}return w})}stopReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("stopReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(U.mid)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w);for(const F of y)this._mapMidTransceiver.delete(F)})}pauseReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("pauseReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="inactive",this._remoteSdp.pauseMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}resumeReceiving(y){return M(this,null,function*(){this.assertRecvDirection();for(const F of y){b.debug("resumeReceiving() [localId:%s]",F);const U=this._mapMidTransceiver.get(F);if(!U)throw new Error("associated RTCRtpTransceiver not found");U.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(F)}const f={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",f),yield this._pc.setRemoteDescription(f);const w=yield this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",w),yield this._pc.setLocalDescription(w)})}getReceiverStats(y){return M(this,null,function*(){this.assertRecvDirection();const f=this._mapMidTransceiver.get(y);if(!f)throw new Error("associated RTCRtpTransceiver not found");return f.receiver.getStats()})}receiveDataChannel(y){return M(this,arguments,function*({sctpStreamParameters:f,label:w,protocol:F}){var U;this.assertRecvDirection();const{streamId:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J}=f,X={negotiated:!0,id:q,ordered:V,maxPacketLifeTime:$,maxRetransmits:J,protocol:F};b.debug("receiveDataChannel() [options:%o]",X);const ee=this._pc.createDataChannel(w,X);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const re={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",re),yield this._pc.setRemoteDescription(re);const ne=yield this._pc.createAnswer();if(!this._transportReady){const Ce=o.parse(ne.sdp);yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:Ce})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setLocalDescription(ne),this._hasDataChannelMediaSection=!0}return{dataChannel:ee}})}setupTransport(y){return M(this,arguments,function*({localDtlsRole:f,localSdpObject:w}){w||(w=o.parse(this._pc.localDescription.sdp));const F=C.extractDtlsParameters({sdpObject:w});F.role=f,this._remoteSdp.updateDtlsRole(f==="client"?"server":"client"),yield new Promise((U,q)=>{this.safeEmit("@connect",{dtlsParameters:F},U,q)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.ReactNativeUnifiedPlan=j}}),Vh=fe({"../../node_modules/mediasoup-client/lib/handlers/ReactNative.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(j,k,y,f){f===void 0&&(f=y);var w=Object.getOwnPropertyDescriptor(k,y);(!w||("get"in w?!k.__esModule:w.writable||w.configurable))&&(w={enumerable:!0,get:function(){return k[y]}}),Object.defineProperty(j,f,w)}:function(j,k,y,f){f===void 0&&(f=y),j[f]=k[y]}),r=e&&e.__setModuleDefault||(Object.create?function(j,k){Object.defineProperty(j,"default",{enumerable:!0,value:k})}:function(j,k){j.default=k}),s=e&&e.__importStar||function(j){if(j&&j.__esModule)return j;var k={};if(j!=null)for(var y in j)y!=="default"&&Object.prototype.hasOwnProperty.call(j,y)&&i(k,j,y);return r(k,j),k};Object.defineProperty(e,"__esModule",{value:!0}),e.ReactNative=void 0;var o=s(Ft()),l=St(),d=Ei(),m=s(kt()),C=s(Zt()),h=s(Pi()),v=s(Fn()),D=li(),E=Ri(),R=new l.Logger("ReactNative"),b={OS:1024,MIS:1024},H=class qo extends D.HandlerInterface{static createFactory(){return()=>new qo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(R.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}getNativeRtpCapabilities(){return M(this,null,function*(){R.debug("getNativeRtpCapabilities()");const k=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const y=yield k.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{k.close()}catch{}const f=o.parse(y.sdp);return h.extractRtpCapabilities({sdpObject:f})}catch(y){try{k.close()}catch{}throw y}})}getNativeSctpCapabilities(){return M(this,null,function*(){return R.debug("getNativeSctpCapabilities()"),{numStreams:b}})}run({direction:k,iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F,iceServers:U,iceTransportPolicy:q,additionalSettings:V,proprietaryConstraints:$,extendedRtpCapabilities:J}){R.debug("run()"),this._direction=k,this._remoteSdp=new E.RemoteSdp({iceParameters:y,iceCandidates:f,dtlsParameters:w,sctpParameters:F,planB:!0}),this._sendingRtpParametersByKind={audio:C.getSendingRtpParameters("audio",J),video:C.getSendingRtpParameters("video",J)},this._sendingRemoteRtpParametersByKind={audio:C.getSendingRemoteRtpParameters("audio",J),video:C.getSendingRemoteRtpParameters("video",J)},w.role&&w.role!=="auto"&&(this._forcedLocalDtlsRole=w.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ue({iceServers:U||[],iceTransportPolicy:q||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},V),$),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed");break}})}updateIceServers(k){return M(this,null,function*(){R.debug("updateIceServers()");const y=this._pc.getConfiguration();y.iceServers=k,this._pc.setConfiguration(y)})}restartIce(k){return M(this,null,function*(){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(k),!!this._transportReady)if(this._direction==="send"){const y=yield this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",y),yield this._pc.setLocalDescription(y);const f={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",f),yield this._pc.setRemoteDescription(f)}else{const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f)}})}getTransportStats(){return M(this,null,function*(){return this._pc.getStats()})}send(k){return M(this,arguments,function*({track:y,encodings:f,codecOptions:w,codec:F}){var U;this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",y.kind,y.id),F&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(y),this._pc.addStream(this._sendStream);let q=yield this._pc.createOffer(),V=o.parse(q.sdp),$;const J=m.clone(this._sendingRtpParametersByKind[y.kind],{});J.codecs=C.reduceCodecs(J.codecs);const X=m.clone(this._sendingRemoteRtpParametersByKind[y.kind],{});if(X.codecs=C.reduceCodecs(X.codecs),this._transportReady||(yield this.setupTransport({localDtlsRole:(U=this._forcedLocalDtlsRole)!==null&&U!==void 0?U:"client",localSdpObject:V})),y.kind==="video"&&f&&f.length>1&&(R.debug("send() | enabling simulcast"),V=o.parse(q.sdp),$=V.media.find(ne=>ne.type==="video"),v.addLegacySimulcast({offerMediaObject:$,track:y,numStreams:f.length}),q={type:"offer",sdp:o.write(V)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",q),yield this._pc.setLocalDescription(q),V=o.parse(this._pc.localDescription.sdp),$=V.media.find(ne=>ne.type===y.kind),J.rtcp.cname=h.getCname({offerMediaObject:$}),J.encodings=v.getRtpEncodings({offerMediaObject:$,track:y}),f)for(let ne=0;ne<J.encodings.length;++ne)f[ne]&&Object.assign(J.encodings[ne],f[ne]);if(J.encodings.length>1&&(J.codecs[0].mimeType.toLowerCase()==="video/vp8"||J.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ne of J.encodings)ne.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:$,offerRtpParameters:J,answerRtpParameters:X,codecOptions:w});const ee={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(re,y),{localId:re,rtpParameters:J}})}stopSending(k){return M(this,null,function*(){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",k);const y=this._mapSendLocalIdTrack.get(k);if(!y)throw new Error("track not found");this._mapSendLocalIdTrack.delete(k),this._sendStream.removeTrack(y),this._pc.addStream(this._sendStream);const f=yield this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",f);try{yield this._pc.setLocalDescription(f)}catch(F){if(this._sendStream.getTracks().length===0){R.warn("stopSending() | ignoring expected error due no sending tracks: %s",F.toString());return}throw F}if(this._pc.signalingState==="stable")return;const w={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",w),yield this._pc.setRemoteDescription(w)})}pauseSending(k){return M(this,null,function*(){})}resumeSending(k){return M(this,null,function*(){})}replaceTrack(k,y){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}setMaxSpatialLayer(k,y){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}setRtpEncodingParameters(k,y){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}getSenderStats(k){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}sendDataChannel(k){return M(this,arguments,function*({ordered:y,maxPacketLifeTime:f,maxRetransmits:w,label:F,protocol:U}){var q;this.assertSendDirection();const V={negotiated:!0,id:this._nextSendSctpStreamId,ordered:y,maxPacketLifeTime:f,maxRetransmitTime:f,maxRetransmits:w,protocol:U};R.debug("sendDataChannel() [options:%o]",V);const $=this._pc.createDataChannel(F,V);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const X=yield this._pc.createOffer(),ee=o.parse(X.sdp),re=ee.media.find(Ce=>Ce.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(q=this._forcedLocalDtlsRole)!==null&&q!==void 0?q:"client",localSdpObject:ee})),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",X),yield this._pc.setLocalDescription(X),this._remoteSdp.sendSctpAssociation({offerMediaObject:re});const ne={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setRemoteDescription(ne),this._hasDataChannelMediaSection=!0}const J={streamId:V.id,ordered:V.ordered,maxPacketLifeTime:V.maxPacketLifeTime,maxRetransmits:V.maxRetransmits};return{dataChannel:$,sctpStreamParameters:J}})}receive(k){return M(this,null,function*(){var y;this.assertRecvDirection();const f=[],w=new Map;for(const V of k){const{trackId:$,kind:J,rtpParameters:X}=V;R.debug("receive() [trackId:%s, kind:%s]",$,J);const ee=J;let re=V.streamId||X.rtcp.cname;R.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),re+=`-hack-${m.generateRandomNumber()}`,w.set($,re),this._remoteSdp.receive({mid:ee,kind:J,offerRtpParameters:X,streamId:re,trackId:$})}const F={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",F),yield this._pc.setRemoteDescription(F);let U=yield this._pc.createAnswer();const q=o.parse(U.sdp);for(const V of k){const{kind:$,rtpParameters:J}=V,X=$,ee=q.media.find(re=>String(re.mid)===X);h.applyCodecParameters({offerRtpParameters:J,answerMediaObject:ee})}U={type:"answer",sdp:o.write(q)},this._transportReady||(yield this.setupTransport({localDtlsRole:(y=this._forcedLocalDtlsRole)!==null&&y!==void 0?y:"client",localSdpObject:q})),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",U),yield this._pc.setLocalDescription(U);for(const V of k){const{kind:$,trackId:J,rtpParameters:X}=V,ee=J,re=$,ne=w.get(J),Re=this._pc.getRemoteStreams().find(ke=>ke.id===ne).getTrackById(ee);if(!Re)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(ee,{mid:re,rtpParameters:X}),f.push({localId:ee,track:Re})}return f})}stopReceiving(k){return M(this,null,function*(){this.assertRecvDirection();for(const w of k){R.debug("stopReceiving() [localId:%s]",w);const{mid:F,rtpParameters:U}=this._mapRecvLocalIdInfo.get(w)||{};this._mapRecvLocalIdInfo.delete(w),this._remoteSdp.planBStopReceiving({mid:F,offerRtpParameters:U})}const y={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",y),yield this._pc.setRemoteDescription(y);const f=yield this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",f),yield this._pc.setLocalDescription(f)})}pauseReceiving(k){return M(this,null,function*(){})}resumeReceiving(k){return M(this,null,function*(){})}getReceiverStats(k){return M(this,null,function*(){throw new d.UnsupportedError("not implemented")})}receiveDataChannel(k){return M(this,arguments,function*({sctpStreamParameters:y,label:f,protocol:w}){var F;this.assertRecvDirection();const{streamId:U,ordered:q,maxPacketLifeTime:V,maxRetransmits:$}=y,J={negotiated:!0,id:U,ordered:q,maxPacketLifeTime:V,maxRetransmitTime:V,maxRetransmits:$,protocol:w};R.debug("receiveDataChannel() [options:%o]",J);const X=this._pc.createDataChannel(f,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const ee={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ee),yield this._pc.setRemoteDescription(ee);const re=yield this._pc.createAnswer();if(!this._transportReady){const ne=o.parse(re.sdp);yield this.setupTransport({localDtlsRole:(F=this._forcedLocalDtlsRole)!==null&&F!==void 0?F:"client",localSdpObject:ne})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",re),yield this._pc.setLocalDescription(re),this._hasDataChannelMediaSection=!0}return{dataChannel:X}})}setupTransport(k){return M(this,arguments,function*({localDtlsRole:y,localSdpObject:f}){f||(f=o.parse(this._pc.localDescription.sdp));const w=h.extractDtlsParameters({sdpObject:f});w.role=y,this._remoteSdp.updateDtlsRole(y==="client"?"server":"client"),yield new Promise((F,U)=>{this.safeEmit("@connect",{dtlsParameters:w},F,U)}),this._transportReady=!0})}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.ReactNative=H}}),Vo=fe({"../../node_modules/mediasoup-client/lib/Device.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(J,X,ee,re){re===void 0&&(re=ee);var ne=Object.getOwnPropertyDescriptor(X,ee);(!ne||("get"in ne?!X.__esModule:ne.writable||ne.configurable))&&(ne={enumerable:!0,get:function(){return X[ee]}}),Object.defineProperty(J,re,ne)}:function(J,X,ee,re){re===void 0&&(re=ee),J[re]=X[ee]}),r=e&&e.__setModuleDefault||(Object.create?function(J,X){Object.defineProperty(J,"default",{enumerable:!0,value:X})}:function(J,X){J.default=X}),s=e&&e.__importStar||function(J){if(J&&J.__esModule)return J;var X={};if(J!=null)for(var ee in J)ee!=="default"&&Object.prototype.hasOwnProperty.call(J,ee)&&i(X,J,ee);return r(X,J),X},o=e&&e.__importDefault||function(J){return J&&J.__esModule?J:{default:J}};Object.defineProperty(e,"__esModule",{value:!0}),e.Device=e.detectDevice=void 0;var l=o(co()),d=St(),m=ir(),C=Ei(),h=s(kt()),v=s(Zt()),D=Ao(),E=Fh(),R=kh(),b=Oh(),H=Mh(),j=Nh(),k=Lh(),y=jh(),f=Bh(),w=Uh(),F=qh(),U=Vh(),q=new d.Logger("Device");function V(){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(typeof RTCPeerConnection>"u"){q.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(q.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(q.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const J=navigator.userAgent,X=l.default.getParser(J),ee=X.getEngine();if(X.satisfies({chrome:">=111",chromium:">=111","microsoft edge":">=111"}))return"Chrome111";if(X.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"}))return"Chrome74";if(X.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(X.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(X.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(X.satisfies({firefox:">=60"}))return"Firefox60";if(X.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}}))return"Safari12";if(X.satisfies({safari:">=12.0"})&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(X.satisfies({safari:">=11"}))return"Safari11";if(X.satisfies({"microsoft edge":">=11"})&&X.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(ee.name&&ee.name.toLowerCase()==="blink"){const re=J.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(re){const ne=Number(re[1]);return ne>=111?"Chrome111":ne>=74?"Chrome74":ne>=70?"Chrome70":ne>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{q.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",X.getBrowserName(),X.getBrowserVersion());return}}else{q.warn("this._detectDevice() | unknown device");return}}e.detectDevice=V;var $=class{constructor({handlerName:J,handlerFactory:X,Handler:ee}={}){if(this._loaded=!1,this._observer=new m.EnhancedEventEmitter,q.debug("constructor()"),ee)if(q.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof ee=="string")J=ee;else throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");if(J&&X)throw new TypeError("just one of handlerName or handlerInterface can be given");if(X)this._handlerFactory=X;else{if(J)q.debug("constructor() | handler given: %s",J);else if(J=V(),J)q.debug("constructor() | detected handler: %s",J);else throw new C.UnsupportedError("device not supported");switch(J){case"Chrome111":this._handlerFactory=E.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=R.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=b.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=H.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=j.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=k.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=y.Safari12.createFactory();break;case"Safari11":this._handlerFactory=f.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=F.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=U.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${J}"`)}}const re=this._handlerFactory();this._handlerName=re.name,re.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new C.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new C.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(J){return M(this,arguments,function*({routerRtpCapabilities:X}){q.debug("load() [routerRtpCapabilities:%o]",X),X=h.clone(X,void 0);let ee;try{if(this._loaded)throw new C.InvalidStateError("already loaded");v.validateRtpCapabilities(X),ee=this._handlerFactory();const re=yield ee.getNativeRtpCapabilities();q.debug("load() | got native RTP capabilities:%o",re),v.validateRtpCapabilities(re),this._extendedRtpCapabilities=v.getExtendedRtpCapabilities(re,X),q.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=v.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=v.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=v.getRecvRtpCapabilities(this._extendedRtpCapabilities),v.validateRtpCapabilities(this._recvRtpCapabilities),q.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=yield ee.getNativeSctpCapabilities(),q.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),v.validateSctpCapabilities(this._sctpCapabilities),q.debug("load() succeeded"),this._loaded=!0,ee.close()}catch(re){throw ee&&ee.close(),re}})}canProduce(J){if(this._loaded){if(J!=="audio"&&J!=="video")throw new TypeError(`invalid kind "${J}"`)}else throw new C.InvalidStateError("not loaded");return this._canProduceByKind[J]}createSendTransport({id:J,iceParameters:X,iceCandidates:ee,dtlsParameters:re,sctpParameters:ne,iceServers:Ce,iceTransportPolicy:Re,additionalSettings:ke,proprietaryConstraints:Y,appData:he}){return q.debug("createSendTransport()"),this.createTransport({direction:"send",id:J,iceParameters:X,iceCandidates:ee,dtlsParameters:re,sctpParameters:ne,iceServers:Ce,iceTransportPolicy:Re,additionalSettings:ke,proprietaryConstraints:Y,appData:he})}createRecvTransport({id:J,iceParameters:X,iceCandidates:ee,dtlsParameters:re,sctpParameters:ne,iceServers:Ce,iceTransportPolicy:Re,additionalSettings:ke,proprietaryConstraints:Y,appData:he}){return q.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:J,iceParameters:X,iceCandidates:ee,dtlsParameters:re,sctpParameters:ne,iceServers:Ce,iceTransportPolicy:Re,additionalSettings:ke,proprietaryConstraints:Y,appData:he})}createTransport({direction:J,id:X,iceParameters:ee,iceCandidates:re,dtlsParameters:ne,sctpParameters:Ce,iceServers:Re,iceTransportPolicy:ke,additionalSettings:Y,proprietaryConstraints:he,appData:be}){if(this._loaded){if(typeof X!="string")throw new TypeError("missing id");if(typeof ee!="object")throw new TypeError("missing iceParameters");if(Array.isArray(re)){if(typeof ne!="object")throw new TypeError("missing dtlsParameters");if(Ce&&typeof Ce!="object")throw new TypeError("wrong sctpParameters");if(be&&typeof be!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new C.InvalidStateError("not loaded");const me=new D.Transport({direction:J,id:X,iceParameters:ee,iceCandidates:re,dtlsParameters:ne,sctpParameters:Ce,iceServers:Re,iceTransportPolicy:ke,additionalSettings:Y,proprietaryConstraints:he,appData:be,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",me),me}};e.Device=$}}),Kh=fe({"../../node_modules/mediasoup-client/lib/RtpParameters.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0})}}),zh=fe({"../../node_modules/mediasoup-client/lib/SctpParameters.js"(e){Z(),Object.defineProperty(e,"__esModule",{value:!0})}}),Wh=fe({"../../node_modules/mediasoup-client/lib/types.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(s,o,l,d){d===void 0&&(d=l);var m=Object.getOwnPropertyDescriptor(o,l);(!m||("get"in m?!o.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return o[l]}}),Object.defineProperty(s,d,m)}:function(s,o,l,d){d===void 0&&(d=l),s[d]=o[l]}),r=e&&e.__exportStar||function(s,o){for(var l in s)l!=="default"&&!Object.prototype.hasOwnProperty.call(o,l)&&i(o,s,l)};Object.defineProperty(e,"__esModule",{value:!0}),r(Vo(),e),r(Ao(),e),r(Ro(),e),r(To(),e),r(Io(),e),r(Do(),e),r(Kh(),e),r(zh(),e),r(li(),e),r(Ei(),e)}}),$h=fe({"../../node_modules/mediasoup-client/lib/index.js"(e){Z();var i=e&&e.__createBinding||(Object.create?function(h,v,D,E){E===void 0&&(E=D);var R=Object.getOwnPropertyDescriptor(v,D);(!R||("get"in R?!v.__esModule:R.writable||R.configurable))&&(R={enumerable:!0,get:function(){return v[D]}}),Object.defineProperty(h,E,R)}:function(h,v,D,E){E===void 0&&(E=D),h[E]=v[D]}),r=e&&e.__setModuleDefault||(Object.create?function(h,v){Object.defineProperty(h,"default",{enumerable:!0,value:v})}:function(h,v){h.default=v}),s=e&&e.__importStar||function(h){if(h&&h.__esModule)return h;var v={};if(h!=null)for(var D in h)D!=="default"&&Object.prototype.hasOwnProperty.call(h,D)&&i(v,h,D);return r(v,h),v},o=e&&e.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.parseScalabilityMode=e.detectDevice=e.Device=e.version=e.types=void 0;var l=o(Dn());e.debug=l.default;var d=Vo();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return d.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return d.detectDevice}});var m=s(Wh());e.types=m,e.version="3.6.82";var C=rr();Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return C.parse}})}});Z();Z();Z();Z();Z();Z();Z();var ya=["disable","error","warn","info","debug"],jr=class kr{constructor(i){this.debug=(...r)=>(this._log("debug",...r),Date.now()),this.info=(...r)=>(this._log("info",...r),Date.now()),this.warn=(...r)=>{this._log("warn",...r)},this.error=(...r)=>{this._log("error",...r)},this.elapsed=(r,...s)=>{const o=Date.now()-r;this._log("info",`elapsed ms:${o}`,...s)},this.prefix=i}_log(i,...r){const s=ya.indexOf(i);if(ya.indexOf(kr.level)>=s){const l=new Date(Date.now()+324e5).toISOString()+"+JST";r=[this.prefix,...r].map(C=>{if(C instanceof Error)return C.toJSON?C.toJSON():{name:C.name,message:C.message,stack:C.stack};if(typeof C=="object")try{return JSON.parse(JSON.stringify(C))}catch{return"json error"}return C});let m=[l,i,...r];switch(kr.format==="string"&&(m=[l+" "+i+" "+JSON.stringify(r)]),i){case"debug":console.debug(...m);break;case"info":console.info(...m);break;case"warn":console.warn(...m);break;case"error":console.error(...m);break}kr.onLog({id:kr.id,timestamp:l,level:i,message:r})}}createBlock(i){return{warn:(...r)=>{this.warn(ue({},i),...r)},debug:(...r)=>{this.debug(ue({},i),...r)},info:(...r)=>{this.info(ue({},i),...r)},error:(...r)=>{this.error(ue({},i),...r)}}}};jr.level="error";jr.format="object";jr.onLog=()=>{};jr.id=Math.random().toString().slice(2,7);var Ie=jr,Gh=new Ie("packages/common/src/error.ts"),Ai=class extends Error{constructor(e,i=!0){if(super(e.info.detail),this.id=Math.random().toString().slice(2,10),Object.assign(this,e),this.name=this.info.name,i){const r=["SkyWayError",`name:${this.info.name}, detail:${this.info.detail}, solution:${this.info.solution}`];this.path&&r.push(this.path),this.error&&r.push(this.error),this.payload&&r.push(this.payload),r.push(this.id),Gh.warn(...r)}}toJSON(){return{id:this.id,info:this.info,path:this.path,payload:this.payload,error:this.error,stack:this.stack}}};Z();var Jh=new Ie("packages/common/src/event.ts"),De=class{constructor(e=()=>{}){this._onSetListener=e,this._stack=[],this._eventIndex=0,this.emit=i=>{for(const r of this._stack)try{r.execute(i)}catch(s){Jh.error("task throws error",s)}},this.removeAllListeners=()=>{this._stack=[]},this.pipe=i=>this.add(r=>i.emit(r)),this.add=i=>{const r=this._eventIndex;this._stack.push({execute:i,id:r}),this._eventIndex++;const s=()=>{this._stack=this._stack.filter(l=>l.id!==r&&l)},o=l=>{l.push(s)};return this._onSetListener(),{removeListener:s,disposer:o}},this.once=i=>{const r=this.add(s=>{r.removeListener(),i(s)});return r},this.asPromise=i=>new Promise((r,s)=>{const o=i&&setTimeout(()=>{s(new _a("Event asPromise timeout : "+i))},i);this.once(l=>{o&&clearTimeout(o),r(l)})}),this.watch=(i,r)=>new Promise((s,o)=>{const l=r&&setTimeout(()=>{o(new _a("Event watch timeout : "+r))},r),{removeListener:d}=this.add(m=>{i(m)&&(l&&clearTimeout(l),d(),s(m))})})}get length(){return this._stack.length}},Ti=class{constructor(){this.events=[]}make(){const e=new De;return this.events.push(e),e}dispose(){this.events.forEach(e=>e.removeAllListeners()),this.events=[]}},ei=class{constructor(){this._disposer=[]}push(e){this._disposer.push(e)}dispose(){this._disposer.forEach(e=>e()),this._disposer=[]}},_a=class extends Error{toJSON(){return{name:this.name,message:this.message,stack:this.stack}}};Z();Z();Z();Z();Z();function Ko(e,i){return function(){return e.apply(i,arguments)}}var{toString:Xh}=Object.prototype,{getPrototypeOf:Us}=Object,kn=(e=>i=>{const r=Xh.call(i);return e[r]||(e[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),yi=e=>(e=e.toLowerCase(),i=>kn(i)===e),On=e=>i=>typeof i===e,{isArray:br}=Array,Nr=On("undefined");function Qh(e){return e!==null&&!Nr(e)&&e.constructor!==null&&!Nr(e.constructor)&&Yt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}var zo=yi("ArrayBuffer");function Yh(e){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(e):i=e&&e.buffer&&zo(e.buffer),i}var Zh=On("string"),Yt=On("function"),Wo=On("number"),Mn=e=>e!==null&&typeof e=="object",ep=e=>e===!0||e===!1,hn=e=>{if(kn(e)!=="object")return!1;const i=Us(e);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},tp=yi("Date"),ip=yi("File"),rp=yi("Blob"),np=yi("FileList"),sp=e=>Mn(e)&&Yt(e.pipe),ap=e=>{let i;return e&&(typeof FormData=="function"&&e instanceof FormData||Yt(e.append)&&((i=kn(e))==="formdata"||i==="object"&&Yt(e.toString)&&e.toString()==="[object FormData]"))},op=yi("URLSearchParams"),[cp,lp,dp,up]=["ReadableStream","Request","Response","Headers"].map(yi),hp=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Br(e,i,{allOwnKeys:r=!1}={}){if(e===null||typeof e>"u")return;let s,o;if(typeof e!="object"&&(e=[e]),br(e))for(s=0,o=e.length;s<o;s++)i.call(null,e[s],s,e);else{const l=r?Object.getOwnPropertyNames(e):Object.keys(e),d=l.length;let m;for(s=0;s<d;s++)m=l[s],i.call(null,e[m],m,e)}}function $o(e,i){i=i.toLowerCase();const r=Object.keys(e);let s=r.length,o;for(;s-- >0;)if(o=r[s],i===o.toLowerCase())return o;return null}var Yi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Go=e=>!Nr(e)&&e!==Yi;function Cs(){const{caseless:e}=Go(this)&&this||{},i={},r=(s,o)=>{const l=e&&$o(i,o)||o;hn(i[l])&&hn(s)?i[l]=Cs(i[l],s):hn(s)?i[l]=Cs({},s):br(s)?i[l]=s.slice():i[l]=s};for(let s=0,o=arguments.length;s<o;s++)arguments[s]&&Br(arguments[s],r);return i}var pp=(e,i,r,{allOwnKeys:s}={})=>(Br(i,(o,l)=>{r&&Yt(o)?e[l]=Ko(o,r):e[l]=o},{allOwnKeys:s}),e),fp=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),mp=(e,i,r,s)=>{e.prototype=Object.create(i.prototype,s),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:i.prototype}),r&&Object.assign(e.prototype,r)},gp=(e,i,r,s)=>{let o,l,d;const m={};if(i=i||{},e==null)return i;do{for(o=Object.getOwnPropertyNames(e),l=o.length;l-- >0;)d=o[l],(!s||s(d,e,i))&&!m[d]&&(i[d]=e[d],m[d]=!0);e=r!==!1&&Us(e)}while(e&&(!r||r(e,i))&&e!==Object.prototype);return i},vp=(e,i,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=i.length;const s=e.indexOf(i,r);return s!==-1&&s===r},bp=e=>{if(!e)return null;if(br(e))return e;let i=e.length;if(!Wo(i))return null;const r=new Array(i);for(;i-- >0;)r[i]=e[i];return r},yp=(e=>i=>e&&i instanceof e)(typeof Uint8Array<"u"&&Us(Uint8Array)),_p=(e,i)=>{const s=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=s.next())&&!o.done;){const l=o.value;i.call(e,l[0],l[1])}},Sp=(e,i)=>{let r;const s=[];for(;(r=e.exec(i))!==null;)s.push(r);return s},wp=yi("HTMLFormElement"),Cp=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),Sa=(({hasOwnProperty:e})=>(i,r)=>e.call(i,r))(Object.prototype),xp=yi("RegExp"),Jo=(e,i)=>{const r=Object.getOwnPropertyDescriptors(e),s={};Br(r,(o,l)=>{let d;(d=i(o,l,e))!==!1&&(s[l]=d||o)}),Object.defineProperties(e,s)},Ep=e=>{Jo(e,(i,r)=>{if(Yt(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=e[r];if(Yt(s)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},Pp=(e,i)=>{const r={},s=o=>{o.forEach(l=>{r[l]=!0})};return br(e)?s(e):s(String(e).split(i)),r},Rp=()=>{},Tp=(e,i)=>e!=null&&Number.isFinite(e=+e)?e:i,os="abcdefghijklmnopqrstuvwxyz",wa="0123456789",Xo={DIGIT:wa,ALPHA:os,ALPHA_DIGIT:os+os.toUpperCase()+wa},Ip=(e=16,i=Xo.ALPHA_DIGIT)=>{let r="";const{length:s}=i;for(;e--;)r+=i[Math.random()*s|0];return r};function Dp(e){return!!(e&&Yt(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}var Ap=e=>{const i=new Array(10),r=(s,o)=>{if(Mn(s)){if(i.indexOf(s)>=0)return;if(!("toJSON"in s)){i[o]=s;const l=br(s)?[]:{};return Br(s,(d,m)=>{const C=r(d,o+1);!Nr(C)&&(l[m]=C)}),i[o]=void 0,l}}return s};return r(e,0)},Fp=yi("AsyncFunction"),kp=e=>e&&(Mn(e)||Yt(e))&&Yt(e.then)&&Yt(e.catch),Qo=((e,i)=>e?setImmediate:i?((r,s)=>(Yi.addEventListener("message",({source:o,data:l})=>{o===Yi&&l===r&&s.length&&s.shift()()},!1),o=>{s.push(o),Yi.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",Yt(Yi.postMessage)),Op=typeof queueMicrotask<"u"?queueMicrotask.bind(Yi):typeof hr<"u"&&hr.nextTick||Qo,ve={isArray:br,isArrayBuffer:zo,isBuffer:Qh,isFormData:ap,isArrayBufferView:Yh,isString:Zh,isNumber:Wo,isBoolean:ep,isObject:Mn,isPlainObject:hn,isReadableStream:cp,isRequest:lp,isResponse:dp,isHeaders:up,isUndefined:Nr,isDate:tp,isFile:ip,isBlob:rp,isRegExp:xp,isFunction:Yt,isStream:sp,isURLSearchParams:op,isTypedArray:yp,isFileList:np,forEach:Br,merge:Cs,extend:pp,trim:hp,stripBOM:fp,inherits:mp,toFlatObject:gp,kindOf:kn,kindOfTest:yi,endsWith:vp,toArray:bp,forEachEntry:_p,matchAll:Sp,isHTMLForm:wp,hasOwnProperty:Sa,hasOwnProp:Sa,reduceDescriptors:Jo,freezeMethods:Ep,toObjectSet:Pp,toCamelCase:Cp,noop:Rp,toFiniteNumber:Tp,findKey:$o,global:Yi,isContextDefined:Go,ALPHABET:Xo,generateString:Ip,isSpecCompliantForm:Dp,toJSONObject:Ap,isAsyncFn:Fp,isThenable:kp,setImmediate:Qo,asap:Op};Z();Z();Z();Z();Z();function fr(e,i,r,s,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",i&&(this.code=i),r&&(this.config=r),s&&(this.request=s),o&&(this.response=o,this.status=o.status?o.status:null)}ve.inherits(fr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ve.toJSONObject(this.config),code:this.code,status:this.status}}});var Yo=fr.prototype,Zo={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Zo[e]={value:e}});Object.defineProperties(fr,Zo);Object.defineProperty(Yo,"isAxiosError",{value:!0});fr.from=(e,i,r,s,o,l)=>{const d=Object.create(Yo);return ve.toFlatObject(e,d,function(C){return C!==Error.prototype},m=>m!=="isAxiosError"),fr.call(d,e.message,i,r,s,o),d.cause=e,d.name=e.name,l&&Object.assign(d,l),d};var Ve=fr;Z();var Mp=null;function xs(e){return ve.isPlainObject(e)||ve.isArray(e)}function ec(e){return ve.endsWith(e,"[]")?e.slice(0,-2):e}function Ca(e,i,r){return e?e.concat(i).map(function(o,l){return o=ec(o),!r&&l?"["+o+"]":o}).join(r?".":""):i}function Np(e){return ve.isArray(e)&&!e.some(xs)}var Lp=ve.toFlatObject(ve,{},null,function(i){return/^is[A-Z]/.test(i)});function jp(e,i,r){if(!ve.isObject(e))throw new TypeError("target must be an object");i=i||new FormData,r=ve.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(H,j){return!ve.isUndefined(j[H])});const s=r.metaTokens,o=r.visitor||v,l=r.dots,d=r.indexes,C=(r.Blob||typeof Blob<"u"&&Blob)&&ve.isSpecCompliantForm(i);if(!ve.isFunction(o))throw new TypeError("visitor must be a function");function h(b){if(b===null)return"";if(ve.isDate(b))return b.toISOString();if(!C&&ve.isBlob(b))throw new Ve("Blob is not supported. Use a Buffer instead.");return ve.isArrayBuffer(b)||ve.isTypedArray(b)?C&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function v(b,H,j){let k=b;if(b&&!j&&typeof b=="object"){if(ve.endsWith(H,"{}"))H=s?H:H.slice(0,-2),b=JSON.stringify(b);else if(ve.isArray(b)&&Np(b)||(ve.isFileList(b)||ve.endsWith(H,"[]"))&&(k=ve.toArray(b)))return H=ec(H),k.forEach(function(f,w){!(ve.isUndefined(f)||f===null)&&i.append(d===!0?Ca([H],w,l):d===null?H:H+"[]",h(f))}),!1}return xs(b)?!0:(i.append(Ca(j,H,l),h(b)),!1)}const D=[],E=Object.assign(Lp,{defaultVisitor:v,convertValue:h,isVisitable:xs});function R(b,H){if(!ve.isUndefined(b)){if(D.indexOf(b)!==-1)throw Error("Circular reference detected in "+H.join("."));D.push(b),ve.forEach(b,function(k,y){(!(ve.isUndefined(k)||k===null)&&o.call(i,k,ve.isString(y)?y.trim():y,H,E))===!0&&R(k,H?H.concat(y):[y])}),D.pop()}}if(!ve.isObject(e))throw new TypeError("data must be an object");return R(e),i}var Nn=jp;function xa(e){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return i[s]})}function tc(e,i){this._pairs=[],e&&Nn(e,this,i)}var ic=tc.prototype;ic.append=function(i,r){this._pairs.push([i,r])};ic.toString=function(i){const r=i?function(s){return i.call(this,s,xa)}:xa;return this._pairs.map(function(o){return r(o[0])+"="+r(o[1])},"").join("&")};var rc=tc;function Bp(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nc(e,i,r){if(!i)return e;const s=r&&r.encode||Bp,o=r&&r.serialize;let l;if(o?l=o(i,r):l=ve.isURLSearchParams(i)?i.toString():new rc(i,r).toString(s),l){const d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}Z();var Hp=class{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ve.forEach(this.handlers,function(r){r!==null&&e(r)})}},Ea=Hp;Z();Z();Z();Z();var sc={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};Z();Z();Z();Z();var Up=typeof URLSearchParams<"u"?URLSearchParams:rc;Z();var qp=typeof FormData<"u"?FormData:null;Z();var Vp=typeof Blob<"u"?Blob:null,Kp={isBrowser:!0,classes:{URLSearchParams:Up,FormData:qp,Blob:Vp},protocols:["http","https","file","blob","url","data"]},ac={};nu(ac,{hasBrowserEnv:()=>qs,hasStandardBrowserEnv:()=>zp,hasStandardBrowserWebWorkerEnv:()=>Wp,navigator:()=>Es,origin:()=>$p});Z();var qs=typeof window<"u"&&typeof document<"u",Es=typeof navigator=="object"&&navigator||void 0,zp=qs&&(!Es||["ReactNative","NativeScript","NS"].indexOf(Es.product)<0),Wp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",$p=qs&&window.location.href||"http://localhost",Wt=ue(ue({},ac),Kp);function Gp(e,i){return Nn(e,new Wt.classes.URLSearchParams,Object.assign({visitor:function(r,s,o,l){return Wt.isNode&&ve.isBuffer(r)?(this.append(s,r.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},i))}Z();function Jp(e){return ve.matchAll(/\w+|\[(\w*)]/g,e).map(i=>i[0]==="[]"?"":i[1]||i[0])}function Xp(e){const i={},r=Object.keys(e);let s;const o=r.length;let l;for(s=0;s<o;s++)l=r[s],i[l]=e[l];return i}function Qp(e){function i(r,s,o,l){let d=r[l++];if(d==="__proto__")return!0;const m=Number.isFinite(+d),C=l>=r.length;return d=!d&&ve.isArray(o)?o.length:d,C?(ve.hasOwnProp(o,d)?o[d]=[o[d],s]:o[d]=s,!m):((!o[d]||!ve.isObject(o[d]))&&(o[d]=[]),i(r,s,o[d],l)&&ve.isArray(o[d])&&(o[d]=Xp(o[d])),!m)}if(ve.isFormData(e)&&ve.isFunction(e.entries)){const r={};return ve.forEachEntry(e,(s,o)=>{i(Jp(s),o,r,0)}),r}return null}var oc=Qp;function Yp(e,i,r){if(ve.isString(e))try{return(i||JSON.parse)(e),ve.trim(e)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(e)}var Vs={transitional:sc,adapter:["xhr","http","fetch"],transformRequest:[function(i,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,l=ve.isObject(i);if(l&&ve.isHTMLForm(i)&&(i=new FormData(i)),ve.isFormData(i))return o?JSON.stringify(oc(i)):i;if(ve.isArrayBuffer(i)||ve.isBuffer(i)||ve.isStream(i)||ve.isFile(i)||ve.isBlob(i)||ve.isReadableStream(i))return i;if(ve.isArrayBufferView(i))return i.buffer;if(ve.isURLSearchParams(i))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let m;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Gp(i,this.formSerializer).toString();if((m=ve.isFileList(i))||s.indexOf("multipart/form-data")>-1){const C=this.env&&this.env.FormData;return Nn(m?{"files[]":i}:i,C&&new C,this.formSerializer)}}return l||o?(r.setContentType("application/json",!1),Yp(i)):i}],transformResponse:[function(i){const r=this.transitional||Vs.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ve.isResponse(i)||ve.isReadableStream(i))return i;if(i&&ve.isString(i)&&(s&&!this.responseType||o)){const d=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(i)}catch(m){if(d)throw m.name==="SyntaxError"?Ve.from(m,Ve.ERR_BAD_RESPONSE,this,null,this.response):m}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wt.classes.FormData,Blob:Wt.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ve.forEach(["delete","get","head","post","put","patch"],e=>{Vs.headers[e]={}});var Ks=Vs;Z();Z();var Zp=ve.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ef=e=>{const i={};let r,s,o;return e&&e.split(`
`).forEach(function(d){o=d.indexOf(":"),r=d.substring(0,o).trim().toLowerCase(),s=d.substring(o+1).trim(),!(!r||i[r]&&Zp[r])&&(r==="set-cookie"?i[r]?i[r].push(s):i[r]=[s]:i[r]=i[r]?i[r]+", "+s:s)}),i},Pa=Symbol("internals");function Rr(e){return e&&String(e).trim().toLowerCase()}function pn(e){return e===!1||e==null?e:ve.isArray(e)?e.map(pn):String(e)}function tf(e){const i=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=r.exec(e);)i[s[1]]=s[2];return i}var rf=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function cs(e,i,r,s,o){if(ve.isFunction(s))return s.call(this,i,r);if(o&&(i=r),!!ve.isString(i)){if(ve.isString(s))return i.indexOf(s)!==-1;if(ve.isRegExp(s))return s.test(i)}}function nf(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,r,s)=>r.toUpperCase()+s)}function sf(e,i){const r=ve.toCamelCase(" "+i);["get","set","has"].forEach(s=>{Object.defineProperty(e,s+r,{value:function(o,l,d){return this[s].call(this,i,o,l,d)},configurable:!0})})}var Ln=class{constructor(e){e&&this.set(e)}set(e,i,r){const s=this;function o(d,m,C){const h=Rr(m);if(!h)throw new Error("header name must be a non-empty string");const v=ve.findKey(s,h);(!v||s[v]===void 0||C===!0||C===void 0&&s[v]!==!1)&&(s[v||m]=pn(d))}const l=(d,m)=>ve.forEach(d,(C,h)=>o(C,h,m));if(ve.isPlainObject(e)||e instanceof this.constructor)l(e,i);else if(ve.isString(e)&&(e=e.trim())&&!rf(e))l(ef(e),i);else if(ve.isHeaders(e))for(const[d,m]of e.entries())o(m,d,r);else e!=null&&o(i,e,r);return this}get(e,i){if(e=Rr(e),e){const r=ve.findKey(this,e);if(r){const s=this[r];if(!i)return s;if(i===!0)return tf(s);if(ve.isFunction(i))return i.call(this,s,r);if(ve.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=Rr(e),e){const r=ve.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||cs(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let s=!1;function o(l){if(l=Rr(l),l){const d=ve.findKey(r,l);d&&(!i||cs(r,r[d],d,i))&&(delete r[d],s=!0)}}return ve.isArray(e)?e.forEach(o):o(e),s}clear(e){const i=Object.keys(this);let r=i.length,s=!1;for(;r--;){const o=i[r];(!e||cs(this,this[o],o,e,!0))&&(delete this[o],s=!0)}return s}normalize(e){const i=this,r={};return ve.forEach(this,(s,o)=>{const l=ve.findKey(r,o);if(l){i[l]=pn(s),delete i[o];return}const d=e?nf(o):String(o).trim();d!==o&&delete i[o],i[d]=pn(s),r[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return ve.forEach(this,(r,s)=>{r!=null&&r!==!1&&(i[s]=e&&ve.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Pa]=this[Pa]={accessors:{}}).accessors,s=this.prototype;function o(l){const d=Rr(l);r[d]||(sf(s,l),r[d]=!0)}return ve.isArray(e)?e.forEach(o):o(e),this}};Ln.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ve.reduceDescriptors(Ln.prototype,({value:e},i)=>{let r=i[0].toUpperCase()+i.slice(1);return{get:()=>e,set(s){this[r]=s}}});ve.freezeMethods(Ln);var bi=Ln;function ls(e,i){const r=this||Ks,s=i||r,o=bi.from(s.headers);let l=s.data;return ve.forEach(e,function(m){l=m.call(r,l,o.normalize(),i?i.status:void 0)}),o.normalize(),l}Z();function cc(e){return!!(e&&e.__CANCEL__)}Z();function lc(e,i,r){Ve.call(this,e??"canceled",Ve.ERR_CANCELED,i,r),this.name="CanceledError"}ve.inherits(lc,Ve,{__CANCEL__:!0});var Hr=lc;Z();Z();Z();function dc(e,i,r){const s=r.config.validateStatus;!r.status||!s||s(r.status)?e(r):i(new Ve("Request failed with status code "+r.status,[Ve.ERR_BAD_REQUEST,Ve.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}Z();function af(e){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return i&&i[1]||""}Z();Z();function of(e,i){e=e||10;const r=new Array(e),s=new Array(e);let o=0,l=0,d;return i=i!==void 0?i:1e3,function(C){const h=Date.now(),v=s[l];d||(d=h),r[o]=C,s[o]=h;let D=l,E=0;for(;D!==o;)E+=r[D++],D=D%e;if(o=(o+1)%e,o===l&&(l=(l+1)%e),h-d<i)return;const R=v&&h-v;return R?Math.round(E*1e3/R):void 0}}var cf=of;Z();function lf(e,i){let r=0,s=1e3/i,o,l;const d=(h,v=Date.now())=>{r=v,o=null,l&&(clearTimeout(l),l=null),e.apply(null,h)};return[(...h)=>{const v=Date.now(),D=v-r;D>=s?d(h,v):(o=h,l||(l=setTimeout(()=>{l=null,d(o)},s-D)))},()=>o&&d(o)]}var df=lf,bn=(e,i,r=3)=>{let s=0;const o=cf(50,250);return df(l=>{const d=l.loaded,m=l.lengthComputable?l.total:void 0,C=d-s,h=o(C),v=d<=m;s=d;const D={loaded:d,total:m,progress:m?d/m:void 0,bytes:C,rate:h||void 0,estimated:h&&m&&v?(m-d)/h:void 0,event:l,lengthComputable:m!=null,[i?"download":"upload"]:!0};e(D)},r)},Ra=(e,i)=>{const r=e!=null;return[s=>i[0]({lengthComputable:r,total:e,loaded:s}),i[1]]},Ta=e=>(...i)=>ve.asap(()=>e(...i));Z();Z();var uf=Wt.hasStandardBrowserEnv?function(){const i=Wt.navigator&&/(msie|trident)/i.test(Wt.navigator.userAgent),r=document.createElement("a");let s;function o(l){let d=l;return i&&(r.setAttribute("href",d),d=r.href),r.setAttribute("href",d),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return s=o(window.location.href),function(d){const m=ve.isString(d)?o(d):d;return m.protocol===s.protocol&&m.host===s.host}}():function(){return function(){return!0}}();Z();var hf=Wt.hasStandardBrowserEnv?{write(e,i,r,s,o,l){const d=[e+"="+encodeURIComponent(i)];ve.isNumber(r)&&d.push("expires="+new Date(r).toGMTString()),ve.isString(s)&&d.push("path="+s),ve.isString(o)&&d.push("domain="+o),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read(e){const i=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};Z();Z();function pf(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}Z();function ff(e,i){return i?e.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):e}function uc(e,i){return e&&!pf(i)?ff(e,i):i}Z();var Ia=e=>e instanceof bi?ue({},e):e;function tr(e,i){i=i||{};const r={};function s(h,v,D){return ve.isPlainObject(h)&&ve.isPlainObject(v)?ve.merge.call({caseless:D},h,v):ve.isPlainObject(v)?ve.merge({},v):ve.isArray(v)?v.slice():v}function o(h,v,D){if(ve.isUndefined(v)){if(!ve.isUndefined(h))return s(void 0,h,D)}else return s(h,v,D)}function l(h,v){if(!ve.isUndefined(v))return s(void 0,v)}function d(h,v){if(ve.isUndefined(v)){if(!ve.isUndefined(h))return s(void 0,h)}else return s(void 0,v)}function m(h,v,D){if(D in i)return s(h,v);if(D in e)return s(void 0,h)}const C={url:l,method:l,data:l,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:m,headers:(h,v)=>o(Ia(h),Ia(v),!0)};return ve.forEach(Object.keys(Object.assign({},e,i)),function(v){const D=C[v]||o,E=D(e[v],i[v],v);ve.isUndefined(E)&&D!==m||(r[v]=E)}),r}var hc=e=>{const i=tr({},e);let{data:r,withXSRFToken:s,xsrfHeaderName:o,xsrfCookieName:l,headers:d,auth:m}=i;i.headers=d=bi.from(d),i.url=nc(uc(i.baseURL,i.url),e.params,e.paramsSerializer),m&&d.set("Authorization","Basic "+btoa((m.username||"")+":"+(m.password?unescape(encodeURIComponent(m.password)):"")));let C;if(ve.isFormData(r)){if(Wt.hasStandardBrowserEnv||Wt.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if((C=d.getContentType())!==!1){const[h,...v]=C?C.split(";").map(D=>D.trim()).filter(Boolean):[];d.setContentType([h||"multipart/form-data",...v].join("; "))}}if(Wt.hasStandardBrowserEnv&&(s&&ve.isFunction(s)&&(s=s(i)),s||s!==!1&&uf(i.url))){const h=o&&l&&hf.read(l);h&&d.set(o,h)}return i},mf=typeof XMLHttpRequest<"u",gf=mf&&function(e){return new Promise(function(r,s){const o=hc(e);let l=o.data;const d=bi.from(o.headers).normalize();let{responseType:m,onUploadProgress:C,onDownloadProgress:h}=o,v,D,E,R,b;function H(){R&&R(),b&&b(),o.cancelToken&&o.cancelToken.unsubscribe(v),o.signal&&o.signal.removeEventListener("abort",v)}let j=new XMLHttpRequest;j.open(o.method.toUpperCase(),o.url,!0),j.timeout=o.timeout;function k(){if(!j)return;const f=bi.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders()),F={data:!m||m==="text"||m==="json"?j.responseText:j.response,status:j.status,statusText:j.statusText,headers:f,config:e,request:j};dc(function(q){r(q),H()},function(q){s(q),H()},F),j=null}"onloadend"in j?j.onloadend=k:j.onreadystatechange=function(){!j||j.readyState!==4||j.status===0&&!(j.responseURL&&j.responseURL.indexOf("file:")===0)||setTimeout(k)},j.onabort=function(){j&&(s(new Ve("Request aborted",Ve.ECONNABORTED,e,j)),j=null)},j.onerror=function(){s(new Ve("Network Error",Ve.ERR_NETWORK,e,j)),j=null},j.ontimeout=function(){let w=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const F=o.transitional||sc;o.timeoutErrorMessage&&(w=o.timeoutErrorMessage),s(new Ve(w,F.clarifyTimeoutError?Ve.ETIMEDOUT:Ve.ECONNABORTED,e,j)),j=null},l===void 0&&d.setContentType(null),"setRequestHeader"in j&&ve.forEach(d.toJSON(),function(w,F){j.setRequestHeader(F,w)}),ve.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),m&&m!=="json"&&(j.responseType=o.responseType),h&&([E,b]=bn(h,!0),j.addEventListener("progress",E)),C&&j.upload&&([D,R]=bn(C),j.upload.addEventListener("progress",D),j.upload.addEventListener("loadend",R)),(o.cancelToken||o.signal)&&(v=f=>{j&&(s(!f||f.type?new Hr(null,e,j):f),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(v),o.signal&&(o.signal.aborted?v():o.signal.addEventListener("abort",v)));const y=af(o.url);if(y&&Wt.protocols.indexOf(y)===-1){s(new Ve("Unsupported protocol "+y+":",Ve.ERR_BAD_REQUEST,e));return}j.send(l||null)})};Z();Z();var vf=(e,i)=>{const{length:r}=e=e?e.filter(Boolean):[];if(i||r){let s=new AbortController,o;const l=function(h){if(!o){o=!0,m();const v=h instanceof Error?h:this.reason;s.abort(v instanceof Ve?v:new Hr(v instanceof Error?v.message:v))}};let d=i&&setTimeout(()=>{d=null,l(new Ve(`timeout ${i} of ms exceeded`,Ve.ETIMEDOUT))},i);const m=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(l):h.removeEventListener("abort",l)}),e=null)};e.forEach(h=>h.addEventListener("abort",l));const{signal:C}=s;return C.unsubscribe=()=>ve.asap(m),C}},bf=vf;Z();var yf=function*(e,i){let r=e.byteLength;if(r<i){yield e;return}let s=0,o;for(;s<r;)o=s+i,yield e.slice(s,o),s=o},_f=function(e,i){return ao(this,null,function*(){try{for(var r=au(Sf(e)),s,o,l;s=!(o=yield new pr(r.next())).done;s=!1){const d=o.value;yield*oo(yf(d,i))}}catch(d){l=[d]}finally{try{s&&(o=r.return)&&(yield new pr(o.call(r)))}finally{if(l)throw l[0]}}})},Sf=function(e){return ao(this,null,function*(){if(e[Symbol.asyncIterator]){yield*oo(e);return}const i=e.getReader();try{for(;;){const{done:r,value:s}=yield new pr(i.read());if(r)break;yield s}}finally{yield new pr(i.cancel())}})},Da=(e,i,r,s)=>{const o=_f(e,i);let l=0,d,m=C=>{d||(d=!0,s&&s(C))};return new ReadableStream({pull(C){return M(this,null,function*(){try{const{done:h,value:v}=yield o.next();if(h){m(),C.close();return}let D=v.byteLength;if(r){let E=l+=D;r(E)}C.enqueue(new Uint8Array(v))}catch(h){throw m(h),h}})},cancel(C){return m(C),o.return()}},{highWaterMark:2})},jn=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",pc=jn&&typeof ReadableStream=="function",wf=jn&&(typeof TextEncoder=="function"?(e=>i=>e.encode(i))(new TextEncoder):e=>M(void 0,null,function*(){return new Uint8Array(yield new Response(e).arrayBuffer())})),fc=(e,...i)=>{try{return!!e(...i)}catch{return!1}},Cf=pc&&fc(()=>{let e=!1;const i=new Request(Wt.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!i}),Aa=64*1024,Ps=pc&&fc(()=>ve.isReadableStream(new Response("").body)),yn={stream:Ps&&(e=>e.body)};jn&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(i=>{!yn[i]&&(yn[i]=ve.isFunction(e[i])?r=>r[i]():(r,s)=>{throw new Ve(`Response type '${i}' is not supported`,Ve.ERR_NOT_SUPPORT,s)})})})(new Response);var xf=e=>M(void 0,null,function*(){if(e==null)return 0;if(ve.isBlob(e))return e.size;if(ve.isSpecCompliantForm(e))return(yield new Request(Wt.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(ve.isArrayBufferView(e)||ve.isArrayBuffer(e))return e.byteLength;if(ve.isURLSearchParams(e)&&(e=e+""),ve.isString(e))return(yield wf(e)).byteLength}),Ef=(e,i)=>M(void 0,null,function*(){const r=ve.toFiniteNumber(e.getContentLength());return r??xf(i)}),Pf=jn&&(e=>M(void 0,null,function*(){let{url:i,method:r,data:s,signal:o,cancelToken:l,timeout:d,onDownloadProgress:m,onUploadProgress:C,responseType:h,headers:v,withCredentials:D="same-origin",fetchOptions:E}=hc(e);h=h?(h+"").toLowerCase():"text";let R=bf([o,l&&l.toAbortSignal()],d),b;const H=R&&R.unsubscribe&&(()=>{R.unsubscribe()});let j;try{if(C&&Cf&&r!=="get"&&r!=="head"&&(j=yield Ef(v,s))!==0){let F=new Request(i,{method:"POST",body:s,duplex:"half"}),U;if(ve.isFormData(s)&&(U=F.headers.get("content-type"))&&v.setContentType(U),F.body){const[q,V]=Ra(j,bn(Ta(C)));s=Da(F.body,Aa,q,V)}}ve.isString(D)||(D=D?"include":"omit");const k="credentials"in Request.prototype;b=new Request(i,ge(ue({},E),{signal:R,method:r.toUpperCase(),headers:v.normalize().toJSON(),body:s,duplex:"half",credentials:k?D:void 0}));let y=yield fetch(b);const f=Ps&&(h==="stream"||h==="response");if(Ps&&(m||f&&H)){const F={};["status","statusText","headers"].forEach($=>{F[$]=y[$]});const U=ve.toFiniteNumber(y.headers.get("content-length")),[q,V]=m&&Ra(U,bn(Ta(m),!0))||[];y=new Response(Da(y.body,Aa,q,()=>{V&&V(),H&&H()}),F)}h=h||"text";let w=yield yn[ve.findKey(yn,h)||"text"](y,e);return!f&&H&&H(),yield new Promise((F,U)=>{dc(F,U,{data:w,headers:bi.from(y.headers),status:y.status,statusText:y.statusText,config:e,request:b})})}catch(k){throw H&&H(),k&&k.name==="TypeError"&&/fetch/i.test(k.message)?Object.assign(new Ve("Network Error",Ve.ERR_NETWORK,e,b),{cause:k.cause||k}):Ve.from(k,k&&k.code,e,b)}})),Rs={http:Mp,xhr:gf,fetch:Pf};ve.forEach(Rs,(e,i)=>{if(e){try{Object.defineProperty(e,"name",{value:i})}catch{}Object.defineProperty(e,"adapterName",{value:i})}});var Fa=e=>`- ${e}`,Rf=e=>ve.isFunction(e)||e===null||e===!1,mc={getAdapter:e=>{e=ve.isArray(e)?e:[e];const{length:i}=e;let r,s;const o={};for(let l=0;l<i;l++){r=e[l];let d;if(s=r,!Rf(r)&&(s=Rs[(d=String(r)).toLowerCase()],s===void 0))throw new Ve(`Unknown adapter '${d}'`);if(s)break;o[d||"#"+l]=s}if(!s){const l=Object.entries(o).map(([m,C])=>`adapter ${m} `+(C===!1?"is not supported by the environment":"is not available in the build"));let d=i?l.length>1?`since :
`+l.map(Fa).join(`
`):" "+Fa(l[0]):"as no adapter specified";throw new Ve("There is no suitable adapter to dispatch the request "+d,"ERR_NOT_SUPPORT")}return s},adapters:Rs};function ds(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Hr(null,e)}function ka(e){return ds(e),e.headers=bi.from(e.headers),e.data=ls.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),mc.getAdapter(e.adapter||Ks.adapter)(e).then(function(s){return ds(e),s.data=ls.call(e,e.transformResponse,s),s.headers=bi.from(s.headers),s},function(s){return cc(s)||(ds(e),s&&s.response&&(s.response.data=ls.call(e,e.transformResponse,s.response),s.response.headers=bi.from(s.response.headers))),Promise.reject(s)})}Z();Z();var gc="1.7.7",zs={};["object","boolean","number","function","string","symbol"].forEach((e,i)=>{zs[e]=function(s){return typeof s===e||"a"+(i<1?"n ":" ")+e}});var Oa={};zs.transitional=function(i,r,s){function o(l,d){return"[Axios v"+gc+"] Transitional option '"+l+"'"+d+(s?". "+s:"")}return(l,d,m)=>{if(i===!1)throw new Ve(o(d," has been removed"+(r?" in "+r:"")),Ve.ERR_DEPRECATED);return r&&!Oa[d]&&(Oa[d]=!0,console.warn(o(d," has been deprecated since v"+r+" and will be removed in the near future"))),i?i(l,d,m):!0}};function Tf(e,i,r){if(typeof e!="object")throw new Ve("options must be an object",Ve.ERR_BAD_OPTION_VALUE);const s=Object.keys(e);let o=s.length;for(;o-- >0;){const l=s[o],d=i[l];if(d){const m=e[l],C=m===void 0||d(m,l,e);if(C!==!0)throw new Ve("option "+l+" must be "+C,Ve.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Ve("Unknown option "+l,Ve.ERR_BAD_OPTION)}}var Ts={assertOptions:Tf,validators:zs},Ni=Ts.validators,_n=class{constructor(e){this.defaults=e,this.interceptors={request:new Ea,response:new Ea}}request(e,i){return M(this,null,function*(){try{return yield this._request(e,i)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const o=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}})}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=tr(this.defaults,i);const{transitional:r,paramsSerializer:s,headers:o}=i;r!==void 0&&Ts.assertOptions(r,{silentJSONParsing:Ni.transitional(Ni.boolean),forcedJSONParsing:Ni.transitional(Ni.boolean),clarifyTimeoutError:Ni.transitional(Ni.boolean)},!1),s!=null&&(ve.isFunction(s)?i.paramsSerializer={serialize:s}:Ts.assertOptions(s,{encode:Ni.function,serialize:Ni.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let l=o&&ve.merge(o.common,o[i.method]);o&&ve.forEach(["delete","get","head","post","put","patch","common"],R=>{delete o[R]}),i.headers=bi.concat(l,o);const d=[];let m=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(i)===!1||(m=m&&b.synchronous,d.unshift(b.fulfilled,b.rejected))});const C=[];this.interceptors.response.forEach(function(b){C.push(b.fulfilled,b.rejected)});let h,v=0,D;if(!m){const R=[ka.bind(this),void 0];for(R.unshift.apply(R,d),R.push.apply(R,C),D=R.length,h=Promise.resolve(i);v<D;)h=h.then(R[v++],R[v++]);return h}D=d.length;let E=i;for(v=0;v<D;){const R=d[v++],b=d[v++];try{E=R(E)}catch(H){b.call(this,H);break}}try{h=ka.call(this,E)}catch(R){return Promise.reject(R)}for(v=0,D=C.length;v<D;)h=h.then(C[v++],C[v++]);return h}getUri(e){e=tr(this.defaults,e);const i=uc(e.baseURL,e.url);return nc(i,e.params,e.paramsSerializer)}};ve.forEach(["delete","get","head","options"],function(i){_n.prototype[i]=function(r,s){return this.request(tr(s||{},{method:i,url:r,data:(s||{}).data}))}});ve.forEach(["post","put","patch"],function(i){function r(s){return function(l,d,m){return this.request(tr(m||{},{method:i,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:d}))}}_n.prototype[i]=r(),_n.prototype[i+"Form"]=r(!0)});var fn=_n;Z();var If=class vc{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(l){r=l});const s=this;this.promise.then(o=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](o);s._listeners=null}),this.promise.then=o=>{let l;const d=new Promise(m=>{s.subscribe(m),l=m}).then(o);return d.cancel=function(){s.unsubscribe(l)},d},i(function(l,d,m){s.reason||(s.reason=new Hr(l,d,m),r(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const r=this._listeners.indexOf(i);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const i=new AbortController,r=s=>{i.abort(s)};return this.subscribe(r),i.signal.unsubscribe=()=>this.unsubscribe(r),i.signal}static source(){let i;return{token:new vc(function(o){i=o}),cancel:i}}},Df=If;Z();function Af(e){return function(r){return e.apply(null,r)}}Z();function Ff(e){return ve.isObject(e)&&e.isAxiosError===!0}Z();var Is={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Is).forEach(([e,i])=>{Is[i]=e});var kf=Is;function bc(e){const i=new fn(e),r=Ko(fn.prototype.request,i);return ve.extend(r,fn.prototype,i,{allOwnKeys:!0}),ve.extend(r,i,null,{allOwnKeys:!0}),r.create=function(o){return bc(tr(e,o))},r}var bt=bc(Ks);bt.Axios=fn;bt.CanceledError=Hr;bt.CancelToken=Df;bt.isCancel=cc;bt.VERSION=gc;bt.toFormData=Nn;bt.AxiosError=Ve;bt.Cancel=bt.CanceledError;bt.all=function(i){return Promise.all(i)};bt.spread=Af;bt.isAxiosError=Ff;bt.mergeConfig=tr;bt.AxiosHeaders=bi;bt.formToJSON=e=>oc(ve.isHTMLForm(e)?new FormData(e):e);bt.getAdapter=mc.getAdapter;bt.HttpStatusCode=kf;bt.default=bt;var Tr=bt,pi=new Ie("packages/common/src/http.ts"),Ws=class{constructor(e){this.api=Tr.create({baseURL:e})}get(e,i){return M(this,null,function*(){const r=yield this.api.get(e,i).catch(s=>s);if(Tr.isAxiosError(r)){const s=ge(ue({},r.response),{message:r.message});if(i!=null&&i.retry){if(yield i.retry(s))return pi.warn("retry get",{url:e}),this.get(e,i);throw pi.warn("retry get failed",{url:e}),s}throw pi.warn("response error",{error:s}),s}else return r.data})}post(e,i,r){return M(this,null,function*(){var s,o,l;const d=yield this.api.post(e,i,r).catch(m=>m);if(Tr.isAxiosError(d)){const m={data:(s=d.response)==null?void 0:s.data,status:(o=d.response)==null?void 0:o.status,statusText:(l=d.response)==null?void 0:l.statusText,message:d.message};if(pi.warn("error received",m),r!=null&&r.retry){const C=yield r.retry(m);if(C)return pi.warn("retry post",e,{data:i,error:m,needRetry:C}),this.post(e,i,r);throw m}throw m}else return d.data})}put(e,i,r){return M(this,null,function*(){const s=yield this.api.put(e,i,r).catch(o=>o);if(Tr.isAxiosError(s)){const o=ge(ue({},s.response),{message:s.message});if(r!=null&&r.retry){if(yield r.retry(o))return pi.warn("retry put",{url:e,data:i}),this.put(e,i,r);throw pi.warn("retry put failed",{url:e,data:i}),o}throw pi.warn("response error",{error:o}),o}else return s.data})}delete(e,i){return M(this,null,function*(){const r=yield this.api.delete(e,i).catch(s=>s);if(Tr.isAxiosError(r)){const s=ge(ue({},r.response),{message:r.message});if(i!=null&&i.retry){if(yield i.retry(s))return pi.warn("retry delete",{url:e}),this.delete(e,i);throw pi.warn("retry delete failed",{url:e}),s}throw pi.warn("response error",{error:s}),s}else return r.data})}};Z();var Of=new Ie("packages/common/src/promise.ts"),Ui=class{constructor(){this.id=Math.random().toString().slice(2),this.queue=[],this.running=!1,this.push=e=>new Promise((i,r)=>{this.queue.push({promise:e,done:i,failed:r}),this.running||this.run().catch(s=>{Of.error("push",s)})})}run(){return M(this,null,function*(){const e=this.queue.shift();if(e){this.running=!0;try{const i=yield e.promise();e.done(i)}catch(i){e.failed(i)}yield this.run()}else this.running=!1})}};Z();var vi=class{constructor(e={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,e)}wait(){return M(this,null,function*(){if(this.exceeded)return!1;const e=this.timeout;return this.count++,yield new Promise(i=>setTimeout(i,e)),!0})}get timeout(){return Hi(this.count,2)*this.interval+Hi(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}},Mf=e=>JSON.parse(JSON.stringify(e));Z();var Pe={internal:{name:"internal",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},missingProperty:{name:"missingProperty",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidArgumentValue:{name:"invalidArgumentValue",detail:"引数の値が不正です",solution:"正しい値を引数に渡してください"},invalidContentType:{name:"invalidContentType",detail:"contentTypeが正しくありません",solution:"ContentTypeを確認してください"},localPersonNotJoinedChannel:{name:"localPersonNotJoinedChannel",detail:"操作しようとしたPersonがChannelに居ないので、操作できません The person who tried to operate is not in the channel, so the operation is not possible",solution:"Channelに居ないPersonを操作している可能性があるので確認してください Please check as you may be operating a person which is not in the channel"},alreadyLocalPersonExist:{name:"alreadyLocalPersonExist",detail:"ChannelにすでにLocalPersonが存在します。一つのChannelインスタンスにはLocalPersonが一つしかJoinできません",solution:"複数のLocalPersonを用意したい場合は個別にChannelインスタンスを用意してください。"},alreadySameNameMemberExist:{name:"alreadySameNameMemberExist",detail:"Channelにすでに同じNameのMemberが存在します",solution:"別のNameを使用してください"},alreadyPublishedStream:{name:"alreadyPublishedStream",detail:"すでにPublishしたStreamを再度Publishすることはできません You cannot re-publish a stream that has already been published",solution:"そのStreamをPublishしたPublicationをUnpublishするか、別の新しいStreamを作ってPublishしてください Unpublish the publication that published that stream, or create another new stream and publish it"},alreadySubscribedPublication:{name:"alreadySubscribedPublication",detail:"すでにSubscribeしたPublicationをSubscribeすることはできません",solution:"ありません"},invalidTrackKind:{name:"invalidTrackKind",detail:"Streamの種類とMediaStreamTrackの種類が一致しません",solution:"Streamの種類と同じMediaStreamTrackを利用してください"},cantMoveSameIdChannel:{name:"cantMoveSameIdChannel",detail:"moveChannelで同じidのChannelに移動することは出来ません",solution:"移動先のChannelが正しいか確かめてください"},alreadyChannelClosed:{name:"alreadyChannelClosed",detail:"ChannelがすでにCloseされています",solution:"ありません"},disabledDataStream:{name:"disabledDataStream",detail:"関連するPublicationがDisableなDataStreamには書き込みできません",solution:"関連するPublicationをEnableしてから書き込んでください"},publicationNotExist:{name:"publicationNotExist",detail:"channelに該当するPublicationが存在しません",solution:"publicationIdが正しいか確かめてください"},subscriptionNotExist:{name:"subscriptionNotExist",detail:"channelに該当するSubscriptionが存在しません",solution:"subscriptionIdが正しいか確かめてください"},unknownMemberType:{name:"unknownMemberType",detail:"対象のMemberのSubtypeのプラグインが登録されていません",solution:"対象のMemberのSubtypeのプラグイン(SfuBotなど)をSkyWayContextに登録してください"},streamNotExistInSubscription:{name:"streamNotExistInSubscription",detail:"SubscriptionにStreamがありません。RemoteMemberのSubscriptionのStreamにはアクセスできません",solution:"参照しているSubscriptionが目的のものか確かめてください。"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},dataStreamNotSupportEncoding:{name:"dataStreamNotSupportEncoding",detail:"dataStreamはEncode設定の変更に対応していません",solution:"ありません"},correspondingEncodeNotExistForId:{name:"correspondingEncodeNotExistForId",detail:"指定されたIDに対応するEncode設定が存在しません",solution:"正しいEncodingIDを指定してください"},updateIceParamsFailed:{name:"updateIceParamsFailed",detail:"iceParamsの更新に失敗しました",solution:"ありません"},invalidElement:{name:"invalidElement",detail:"渡されたHTML Elementが正しくありません",solution:"要求された正しいElementを渡してください"},connectRtcApiFailed:{name:"connectRtcApiFailed",detail:"RtcAPIへの接続に失敗しました",solution:"インターネットへの接続できているか、もしくはTokenのパラメータが正しいかを確かめてください"},rtcApiFatalError:{name:"rtcApiFatalError",detail:"RtcAPIの回復不能なエラーです。サーバー側の問題の可能性があります",solution:"インターネットへの接続が出来ているかを確かめてください"},invalidExpireTokenValue:{name:"invalidExpireTokenValue",detail:"tokenのExpire時刻が不正です",solution:"正しい時刻を指定してください"},invalidRemindExpireTokenValue:{name:"invalidRemindExpireTokenValue",detail:"tokenのExpireをリマインドする時間の値が不正です",solution:"正しい時間を指定してください"},invalidTokenAppId:{name:"invalidTokenAppId",detail:"tokenのappIdが正しくありません",solution:"正しいappIdを含むTokenを使用してください"},mediaDevicesNotFound:{name:"mediaDevicesNotFound",detail:"navigator.mediaDevicesがみつかりません",solution:"アプリケーションをhttps,localhost,127.0.0.1のいずれかの環境で動作させてください"},canNotUseReplaceStream:{name:"canNotUseReplaceStream",detail:"remoteのPublicationからreplaceStreamできません",solution:"対象のPublicationがLocalのものか確認してください"},canNotEnableRemotePublication:{name:"canNotEnableRemotePublication",detail:"remoteのPublicationをenableすることはできません",solution:"対象のPublicationがLocalのものか確認してください"}};Z();Z();Z();var Nf=$t(co());$t(Ft());var Lf=$t(lu()),jf=new Ie("packages/core/src/util.ts");function mr(e){const i=[];return e.forEach(r=>{i.push(r)}),i}function je(e){return M(this,arguments,function*({operationName:i,channel:r}){const s={operationName:i,appId:r.appId,channelId:r.id};if(r.localPerson){const o=r.localPerson,l=yield Promise.all(o.publications.map(m=>M(this,null,function*(){var C,h,v;const D={id:m.id,contentType:m.contentType,state:m.state,stats:{},connectionStats:{}};if(m.stream)for(const{memberId:E,stats:R}of yield m.stream._getStatsAll()){const b=R.find(H=>H.type.includes("local-candidate"));D.stats[E]={transportType:(C=b==null?void 0:b.protocol)!=null?C:"none",relayProtocol:(h=b==null?void 0:b.relayProtocol)!=null?h:"none",callType:(v=m.subscriptions.find(H=>H.subscriber.id===E))==null?void 0:v.subscriber.subtype,outbound:R.find(H=>H.type.includes("outbound-rtp")),localCandidate:b}}if(m.stream)for(const{memberId:E,connectionState:R}of m.stream._getConnectionStateAll())D.connectionStats[E]=R;return D})));s.publishing=l;const d=yield Promise.all(o.subscriptions.map(m=>M(this,null,function*(){const C={id:m.id,contentType:m.contentType,stats:{}};if(C.callType=m.publication.publisher.subtype,m.stream){const h=yield m.stream.getStats();C.stats=h.find(D=>D.type.includes("inbound-rtp"));const v=h.find(D=>D.type.includes("local-candidate"));C.transportType=v==null?void 0:v.protocol,C.relayProtocol=v==null?void 0:v.relayProtocol}return m.stream&&(C.connectionState=m.stream.getConnectionState()),C})));s.subscribing=d}return s})}function vt({member:e,detail:i,channel:r,operationName:s,payload:o}){const l={operationName:s,payload:o,detail:i};return e&&(l.appId=e.channel.appId,l.channelId=e.channel.id,l.memberId=e.id),r&&(l.appId=r.appId,l.channelId=r.id),l}function Se({operationName:e,context:i,info:r,error:s,path:o,payload:l,channel:d}){const m={operationName:e,payload:l};return d&&(m.appId=d.appId,m.channelId=d.id,d.localPerson&&(m.memberId=d.localPerson.id)),i&&(m.info=i.info,m.plugins=i.plugins.map(C=>C.subtype)),new Ai({error:s,info:r,payload:m,path:o})}var Ma=e=>M(void 0,[e],function*({stream:i,remoteMember:r,end:s,interval:o,timeout:l}){return new Promise((d,m)=>M(void 0,null,function*(){o??(o=100),l??(l=1e4);for(let C=0;;C+=o){if(C>=l){m(Se({operationName:"Peer.waitForStats",info:ge(ue({},Pe.timeout),{detail:"waitForStats timeout"}),path:jf.prefix}));break}const h=yield i._getStats(r);if(s(h)){d(h);break}yield new Promise(v=>setTimeout(v,o))}}))}),Bf=(e,i)=>{var r,s;return yc((s=(r=e.find(o=>o.payload===i))==null?void 0:r.config)!=null?s:"")},yc=e=>e.split(";").reduce((r,s)=>{const[o,l]=s.split("=");return o&&(r[o]=Number(l),o==="profile-level-id"&&(r[o]=l)),r},{}),_c=({isNotBrowser:e}={})=>{if(e)return e;const i=Nf.default.getParser(window.navigator.userAgent),r=i.getOSName(),s=i.getOSVersion(),o=i.getBrowserName(),l=i.getBrowserVersion();return{browserName:o,browserVersion:l,osName:r,osVersion:s}};function Na(){var e,i,r,s,o,l,d,m;if(typeof navigator=="object"&&navigator.product==="ReactNative")return typeof RTCPeerConnection>"u"?void 0:typeof RTCRtpTransceiver<"u"?"ReactNativeUnifiedPlan":"ReactNative";if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const C=navigator.userAgent,h=new Lf.UAParser(C),v=h.getBrowser(),D=(i=(e=v.name)==null?void 0:e.toLowerCase())!=null?i:"",E=parseInt((r=v.major)!=null?r:"0"),b=(o=(s=h.getEngine().name)==null?void 0:s.toLowerCase())!=null?o:"",H=h.getOS(),j=(d=(l=H.name)==null?void 0:l.toLowerCase())!=null?d:"",k=parseFloat((m=H.version)!=null?m:"0"),y=j==="ios",f=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(D),w=["firefox","mobile firefox","mobile focus"].includes(D),F=["safari","mobile safari"].includes(D),U=["edge"].includes(D);if((f||U)&&!y&&E>=111)return"Chrome111";if(f&&!y&&E>=74||U&&!y&&E>=88)return"Chrome74";if(f&&!y&&E>=70)return"Chrome70";if(f&&!y&&E>=67)return"Chrome67";if(f&&!y&&E>=55)return"Chrome55";if(w&&!y&&E>=60)return"Firefox60";if(w&&y&&k>=14.3)return"Safari12";if(F&&E>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(F&&E>=11)return"Safari11";if(U&&!y&&E>=11&&E<=18)return"Edge11";if(b==="webkit"&&y&&k>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(b==="blink"){const q=C.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(q){const V=Number(q[1]);return V>=111?"Chrome111":V>=74?"Chrome74":V>=70?"Chrome70":V>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else return}else return}var us=new Ie("packages/core/src/member/index.ts"),Bn=class{constructor(e){this._state="joined",this._events=new Ti,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.channel=e.channel,this.id=e.id,this.name=e.name,this._metadata=e.metadata,this.context=e.context}get metadata(){return this._metadata}get state(){return this._state}get publications(){return this.channel.publications.filter(e=>e.publisher.id===this.id)}get subscriptions(){return this.channel.subscriptions.filter(e=>e.subscriber.id===this.id)}toJSON(){return{id:this.id,name:this.name,type:this.type,subtype:this.subtype,metadata:this.metadata}}_left(){this._state="left",this.onLeft.emit(),this._events.dispose()}_metadataUpdated(e){this._metadata=e,this.onMetadataUpdated.emit(e)}updateMetadata(e){return M(this,null,function*(){yield this.channel._updateMemberMetadata(this.id,e)})}leave(){return M(this,null,function*(){const e=us.info("[start] leave",yield je({operationName:"localPerson.leave",channel:this.channel}));if(this.state==="left")throw Se({operationName:"localPerson.leave",info:Pe.localPersonNotJoinedChannel,path:us.prefix,context:this.context,channel:this.channel});yield this.channel.leave(this),us.elapsed(e,"[end] leave")})}};Z();Z();var sn=new Ie("packages/core/src/plugin/internal/unknown/connection.ts"),Hf=class{constructor(e,i){this.localPerson=e,this.remoteMember=i,this.type="unknown",this.onDisconnect=new De,this.onClose=new De,this.closed=!1}close(){this.closed=!0,this.onClose.emit()}startPublishing(e){return M(this,null,function*(){sn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:e})})}stopPublishing(e){return M(this,null,function*(){sn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:e})})}startSubscribing(e){return M(this,null,function*(){sn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:e})})}stopSubscribing(e){return M(this,null,function*(){sn.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:e})})}},Sc=class extends Bn{constructor(e){super(e),this.type="bot",this.side="remote",this._connections={},this.plugin=e.plugin,this.subtype=e.subtype}_getConnection(e){return this._connections[e]}_getOrCreateConnection(e){var i;return(i=this._getConnection(e.id))!=null?i:this._createConnection(e,this)}_createConnection(e,i){return new Hf(e,i)}_dispose(){}};Z();Z();Z();Z();Z();Z();var wc=new Ie("packages/core/src/media/stream/base.ts");function Cc(e,i){var r;if(((r=e??{})==null?void 0:r.srcObject)===void 0)throw Se({operationName:"attachElement",info:Pe.invalidElement,payload:{element:e},path:wc.prefix});if(e.srcObject){const s=e.srcObject,o=s.getTracks().find(d=>d.readyState==="ended");o&&s.removeTrack(o);const l=s.getTracks().find(d=>d.kind===i.kind);l&&s.removeTrack(l),s.addTrack(i)}else e.srcObject=new MediaStream([i])}function xc(e,i){var r;if(((r=e??{})==null?void 0:r.srcObject)===void 0)throw Se({operationName:"attachElement",info:Pe.invalidElement,payload:{element:e},path:wc.prefix});const s=e.srcObject;s.getTracks().length>0&&s.removeTrack(i),s.getTracks().length===0&&(e.srcObject=null)}Z();Z();Z();Z();var an,Uf=new Uint8Array(16);function qf(){if(!an&&(an=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!an))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return an(Uf)}Z();Z();Z();var Vf=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Kf(e){return typeof e=="string"&&Vf.test(e)}var Ec=Kf,Rt=[];for(on=0;on<256;++on)Rt.push((on+256).toString(16).substr(1));var on;function zf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(Rt[e[i+0]]+Rt[e[i+1]]+Rt[e[i+2]]+Rt[e[i+3]]+"-"+Rt[e[i+4]]+Rt[e[i+5]]+"-"+Rt[e[i+6]]+Rt[e[i+7]]+"-"+Rt[e[i+8]]+Rt[e[i+9]]+"-"+Rt[e[i+10]]+Rt[e[i+11]]+Rt[e[i+12]]+Rt[e[i+13]]+Rt[e[i+14]]+Rt[e[i+15]]).toLowerCase();if(!Ec(r))throw TypeError("Stringified UUID is invalid");return r}var Wf=zf;Z();function $f(e,i,r){e=e||{};var s=e.random||(e.rng||qf)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,i){r=r||0;for(var o=0;o<16;++o)i[r+o]=s[o];return i}return Wf(s)}var Ii=$f;Z();var Gf=$t(du());Z();function Ds(e){this.message=e}Ds.prototype=new Error,Ds.prototype.name="InvalidCharacterError";var La=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Ds("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,o=0,l=0,d="";s=i.charAt(l++);~s&&(r=o%4?64*r+s:s,o++%4)?d+=String.fromCharCode(255&r>>(-2*o&6)):0)s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return d};function Jf(e){var i=e.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(r){return decodeURIComponent(La(r).replace(/(.)/g,function(s,o){var l=o.charCodeAt(0).toString(16).toUpperCase();return l.length<2&&(l="0"+l),"%"+l}))}(i)}catch{return La(i)}}function Sn(e){this.message=e}function Xf(e,i){if(typeof e!="string")throw new Sn("Invalid token specified");var r=(i=i||{}).header===!0?0:1;try{return JSON.parse(Jf(e.split(".")[r]))}catch(s){throw new Sn("Invalid token specified: "+s.message)}}Sn.prototype=new Error,Sn.prototype.name="InvalidTokenError";var Qf=Xf,Yf=new Ie("packages/token/src/encoder.ts"),Lr=class Pc{constructor(i){Object.assign(this,i)}static Decode(i){try{const r=Qf(i),s=new Pc(r);return s.tokenString=i,s}catch(r){throw new Ai({path:Yf.prefix,info:Zf.invalidParameter,error:r})}}encode(i){const r={jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,version:this.version};return this.tokenString=Gf.default.KJUR.jws.JWS.sign("HS256",JSON.stringify({alg:"HS256",typ:"JWT"}),JSON.stringify(r),i),this.tokenString}toJSON(){return{jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,encoded:this.tokenString,version:this.version}}};Z();Z();Z();Z();var Zf={invalidParameter:{name:"invalidParameter",detail:"failed to decode token",solution:"Use the correct token according to the specification"}};Z();var Wg=()=>Math.floor(Date.now()/1e3),Ur=Ii,Rc=class{constructor(e){this.contentType=e,this.side="local",this.onConnectionStateChanged=new De,this._onConnectionStateChanged=new De,this.id=Ur(),this._label="",this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={},this._connectionState={},this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setLabel(e){this._label=e}_unpublished(){this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={}}_getTransport(e){var i,r;const s=typeof e=="string"?e:e.id;return(r=(i=this._getTransportCallbacks)[s])==null?void 0:r.call(i)}_setConnectionState(e,i){this._connectionState[e.id]!==i&&(this._connectionState[e.id]=i,this._onConnectionStateChanged.emit({remoteMember:e,state:i}))}getStats(e){return this._getStats(e)}_getStats(e){var i,r,s;const o=typeof e=="string"?e:e.id;return(s=(r=(i=this._getStatsCallbacks)[o])==null?void 0:r.call(i))!=null?s:[]}_getStatsAll(){return Promise.all(Object.entries(this._getStatsCallbacks).map(e=>M(this,[e],function*([i,r]){return{memberId:i,stats:yield r().catch(()=>[])}})))}getRTCPeerConnection(e){return this._getRTCPeerConnection(e)}_getRTCPeerConnection(e){var i;return(i=this._getTransport(e))==null?void 0:i.rtcPeerConnection}getConnectionState(e){return this._getConnectionState(e)}_getConnectionState(e){var i;const r=typeof e=="string"?e:e.id;return(i=this._connectionState[r])!=null?i:"new"}_getConnectionStateAll(){return Object.keys(this._getTransportCallbacks).map(e=>({memberId:e,connectionState:this._getConnectionState(e)}))}toJSON(){return{label:this._label,contentType:this.contentType,id:this.id,side:this.side}}},em=new Ie("packages/core/src/media/stream/local/media.ts"),$s=class extends Rc{constructor(e,i,r={}){super(i),this.onTrackUpdated=new De,this.onDestroyed=new De,this._disposer=new ei,this._trackConstraints={},this._replacingTrack=!1,this._onReplacingTrackDone=new De,this._onEnableChanged=new De,this._track=e,this._listenTrackEvent(),this._options=r,this._trackConstraints=ue({},r)}get trackConstraints(){return this._trackConstraints}toJSON(){const e=super.toJSON();return ge(ue({},e),{trackConstraints:this.trackConstraints,isEnabled:this.isEnabled,_options:this._options})}get track(){return this._track}attach(e){this._element=e,Cc(e,this._track)}detach(){this._element&&(xc(this._element,this._track),this._element=void 0)}_disable(e){this._options.stopTrackWhenDisabled?(this._trackConstraints=ue(ue({},this.trackConstraints),this.track.getConstraints()),this.track.stop()):this._oldTrack=this.track;const i=e==="video"?Ic:tm;i.enabled=!1,this._onEnableChanged.emit(i),this._updateTrack(i)}_updateTrack(e){this._track=e,this._element&&this.attach(this._element),this.onTrackUpdated.emit(e),this._listenTrackEvent()}_listenTrackEvent(){const e=()=>{em.info("onDestroyed",this.toJSON()),this.onDestroyed.emit()};this._track.addEventListener("ended",e),this._disposer.push(()=>this._track.removeEventListener("ended",e))}release(){this._disposer.dispose(),this._track.stop()}},Tc=new RTCPeerConnection,tm=Tc.addTransceiver("audio").receiver.track,Ic=Tc.addTransceiver("video").receiver.track,hs=new Ie("packages/core/src/media/stream/local/audio.ts"),ps=class extends $s{constructor(e,i={}){if(super(e,"audio",i),this.contentType="audio",this._isEnabled=!0,this._promiseQueue=new Ui,e.kind!=="audio")throw Se({operationName:"LocalAudioStream.constructor",path:hs.prefix,info:Pe.invalidTrackKind,payload:{track:e}})}setEnabled(e){return M(this,null,function*(){yield this._promiseQueue.push(()=>M(this,null,function*(){if(this._isEnabled===!0&&e===!1)this._isEnabled=e,this._disable("audio"),hs.debug("stopped");else if(this._isEnabled===!1&&e===!0){if(this._isEnabled=e,this._options.stopTrackWhenDisabled){const i=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableMic();this._updateTrack(i),this._onEnableChanged.emit(i)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));hs.debug("resumed")}}))})}get isEnabled(){return this._isEnabled}enableMic(){return M(this,null,function*(){const[e]=(yield navigator.mediaDevices.getUserMedia({audio:this.trackConstraints})).getAudioTracks();return e})}enableDisplay(){return M(this,null,function*(){const[e]=(yield navigator.mediaDevices.getDisplayMedia({audio:this.trackConstraints})).getAudioTracks();return e})}};Z();var im=new Ie("packages/core/src/media/stream/local/customVideo.ts"),rm=class extends $s{constructor(e={}){super(Ic,"video",e),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new Ui,this._stream=null}setStream(e){return M(this,null,function*(){if(this._stream)throw new Error("ProcessedStream is already exists");this._stream=e,this._updateTrack(e.track)})}setEnabled(e){return M(this,null,function*(){yield this._promiseQueue.push(()=>M(this,null,function*(){var i;yield(i=this._stream)==null?void 0:i.setEnabled(e)}))})}updateTrack(e){return M(this,null,function*(){this._updateTrack(e),this._onEnableChanged.emit(e)})}get isEnabled(){return this._isEnabled}release(){var e;(e=this._stream)==null||e.dispose().catch(()=>{im.error("release failed")})}};Z();var cn=new Ie("packages/core/src/media/stream/local/video.ts"),fs=class extends $s{constructor(e,i={}){if(super(e,"video",i),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new Ui,e.kind!=="video")throw Se({operationName:"LocalVideoStream.constructor",path:cn.prefix,info:Pe.invalidTrackKind,payload:{track:e}});cn.debug("LocalVideoStream spawned",this.toJSON())}setEnabled(e){return M(this,null,function*(){yield this._promiseQueue.push(()=>M(this,null,function*(){if(this._isEnabled===!0&&e===!1)this._isEnabled=e,this._disable("video"),cn.debug("stopped",this.toJSON());else if(this._isEnabled===!1&&e===!0){if(this._isEnabled=e,this._options.stopTrackWhenDisabled){const i=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableCamera();this._updateTrack(i),this._onEnableChanged.emit(i)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));cn.debug("resumed",this.toJSON())}}))})}get isEnabled(){return this._isEnabled}enableCamera(){return M(this,null,function*(){const[e]=(yield navigator.mediaDevices.getUserMedia({video:this.trackConstraints})).getVideoTracks();return e})}enableDisplay(){return M(this,null,function*(){const[e]=(yield navigator.mediaDevices.getDisplayMedia({video:this.trackConstraints})).getVideoTracks();return e})}},nm=new Ie("packages/core/src/media/stream/local/data.ts"),Gs=class extends Rc{constructor(e={}){super("data"),this.options=e,this.contentType="data",this._onWriteData=new De,this._isEnabled=!0,this._setLabel("LocalDataStream")}get isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}write(e){if(!this._isEnabled)throw Se({operationName:"LocalDataStream.write",path:nm.prefix,info:Pe.disabledDataStream});!ArrayBuffer.isView(e)&&typeof e!="string"&&(e=As+JSON.stringify(e)),this._onWriteData.emit(e)}},As="skyway_object:";Z();function sm(e,{publisherId:i,stream:r,origin:s,metadata:o,codecCapabilities:l,encodings:d,contentType:m,id:C,isEnabled:h}){const v=e._getPublication(C);if(v)return v;m=m.toLowerCase();const D=s?e._getPublication(s):void 0;return D&&d.length===0&&(d=D.encodings),new Dc({id:C,channel:e,publisher:e._getMember(i),contentType:m,metadata:o,origin:D,stream:r,codecCapabilities:l??[],encodings:d,isEnabled:h})}var dt=new Ie("packages/core/src/publication/index.ts"),Dc=class{constructor(e){this._codecCapabilities=[],this._encodings=[],this._state="enabled",this._events=new Ti,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new De,this._onEncodingsChanged=this._events.make(),this._onReplaceStream=this._events.make(),this._onEnabled=this._events.make(),this.streamEventDisposer=new ei,this.cancel=()=>new Promise((o,l)=>{let d=!1;this._channel._unpublish(this.id).catch(m=>{d=!0,l(m)}),this._setStream(void 0),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>o()).catch(m=>{d||l(m)})}),this.updateMetadata=o=>new Promise((l,d)=>M(this,null,function*(){const m=dt.info("[start] updateMetadata",yield je({operationName:"Publication.updateMetadata",channel:this._channel}),this);let C=!1;this._channel._updatePublicationMetadata(this.id,o).catch(h=>{C=!0,d(h)}),this.onMetadataUpdated.watch(h=>h.metadata===o,this._context.config.rtcApi.timeout).then(()=>M(this,null,function*(){l(),dt.elapsed(m,"[end] updateMetadata",yield je({operationName:"Publication.updateMetadata",channel:this._channel}),this)})).catch(h=>{if(!C)throw Se({operationName:"PublicationImpl.updateMetadata",info:ge(ue({},Pe.timeout),{detail:"publication onMetadataUpdated"}),path:dt.prefix,context:this._context,channel:this._channel,error:h})})})),this.disable=()=>new Promise((o,l)=>M(this,null,function*(){const d=dt.info("[start] disable",yield je({operationName:"Publication.disable",channel:this._channel}),this);yield this._disableStream();let m=!1;this._channel._disablePublication(this.id).catch(C=>{m=!0,l(C)}),this.onDisabled.asPromise(this._context.config.rtcApi.timeout).then(()=>M(this,null,function*(){o(),dt.elapsed(d,"[end] disable",yield je({operationName:"Publication.disable",channel:this._channel}),this)})).catch(C=>{m||l(C)})})),this.enable=()=>new Promise((o,l)=>M(this,null,function*(){if(this.stream==null){l(Se({operationName:"Publication.enable",context:this._context,info:Pe.canNotEnableRemotePublication,path:dt.prefix}));return}const d=dt.info("[start] enable",yield je({operationName:"Publication.enable",channel:this._channel}),this);let m=!1;this._channel._enablePublication(this.id).catch(C=>{m=!0,l(C)}),this._onEnabled.asPromise(this._context.config.rtcApi.timeout).then(()=>M(this,null,function*(){yield this._enableStream(),this.onEnabled.emit(),this.onStateChanged.emit(),dt.elapsed(d,"[end] enable",yield je({operationName:"Publication.enable",channel:this._channel}),this),o()})).catch(C=>{m||l(C)})}));var i,r,s;this.id=e.id,this._channel=e.channel,this._context=this._channel._context,this.publisher=e.publisher,this.contentType=e.contentType,this._metadata=e.metadata,this.origin=e.origin,this.setCodecCapabilities((i=e.codecCapabilities)!=null?i:[]),this.setEncodings(Fs((r=e.encodings)!=null?r:[])),this._state=e.isEnabled?"enabled":"disabled",e.stream&&this._setStream(e.stream),this._analytics=(s=this._channel.localPerson)==null?void 0:s._analytics,dt.debug("publication spawned",this.toJSON())}get codecCapabilities(){return this._codecCapabilities}setCodecCapabilities(e){this._codecCapabilities=e}get encodings(){return this._encodings}setEncodings(e){this._encodings=e}get stream(){return this._stream}_setStream(e){this._stream=e,e?e._onConnectionStateChanged.add(i=>{dt.debug("onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit(i)}).disposer(this.streamEventDisposer):this.streamEventDisposer.dispose()}get metadata(){return this._metadata}get state(){return this._state}get deviceName(){if(!(this.stream instanceof Gs))return this.stream.track.label}get subscriptions(){return this._channel.subscriptions.filter(e=>e.publication.id===this.id)}_updateMetadata(e){this._metadata=e,this.onMetadataUpdated.emit({metadata:e})}_disable(){return M(this,null,function*(){yield this._disableStream(),this.onDisabled.emit(),this.onStateChanged.emit()})}_enable(){this.stream?this._onEnabled.emit():(this._state="enabled",this.onEnabled.emit(),this.onStateChanged.emit())}_unpublished(){this._state="canceled",this.stream&&this.stream._unpublished(),this.onCanceled.emit(),this.onStateChanged.emit(),this._dispose()}_subscribed(e){this.onSubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit()}_unsubscribed(e){this.onUnsubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit()}updateEncodings(e){dt.info("updateEncodings",{encodings:e},this),this.setEncodings(Fs(Ac(e))),this._onEncodingsChanged.emit(e),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:this.id,encodings:this.encodings,updatedAt:Date.now()})}_disableStream(){return M(this,null,function*(){this.state!=="disabled"&&(this._state="disabled",this.stream&&(this.stream.contentType==="data"?this.stream.setIsEnabled(!1):yield this.stream.setEnabled(!1).catch(e=>{dt.warn(vt({channel:this._channel,operationName:"Publication._disableStream",payload:e,detail:"setEnabled failed"}))}),je({operationName:"Publication._disableStream",channel:this._channel}).then(e=>dt.info("publication _disableStream",e,{publication:this})).catch(()=>{})))})}_enableStream(){return M(this,null,function*(){this.state!=="enabled"&&(this._state="enabled",this.stream&&(je({operationName:"Publication._enableStream",channel:this._channel}).then(e=>dt.info("publication _enableStream",e,{publication:this})).catch(()=>{}),this.stream.contentType==="data"?this.stream.setIsEnabled(!0):yield this.stream.setEnabled(!0).catch(e=>{dt.warn(vt({channel:this._channel,operationName:"Publication._disableStream",payload:e,detail:"setEnabled failed"}))})))})}replaceStream(e,i={}){var r;if(dt.info("replaceStream",{stream:e,options:i},this),!this.stream)throw Se({operationName:"PublicationImpl.replaceStream",context:this._context,info:Pe.canNotUseReplaceStream,path:dt.prefix});if(e.contentType!==this.contentType)throw Se({operationName:"PublicationImpl.replaceStream",context:this._context,info:Pe.invalidContentType,path:dt.prefix});((r=i.releaseOldStream)==null||r)&&this.stream.release(),je({operationName:"PublicationImpl.replaceStream",channel:this._channel}).then(o=>dt.debug(o,{old:this.stream,new:e})).catch(o=>o),e.setEnabled(this.stream.isEnabled).catch(o=>{dt.error("replaceStream stream.setEnabled",o,this.toJSON())});const s=this._stream;this._setStream(e),this._onReplaceStream.emit({newStream:e,oldStream:s}),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendMediaDeviceReport({publicationId:this.id,mediaDeviceName:this.deviceName,mediaDeviceTrigger:"replaceStream",updatedAt:Date.now()})}getStats(e){if(!this.stream)throw Se({operationName:"PublicationImpl.getStats",context:this._context,info:Pe.streamNotExistInSubscription,path:dt.prefix});return this.stream._getStats(e)}getRTCPeerConnection(e){if(!this.stream)throw Se({operationName:"PublicationImpl.getRTCPeerConnection",context:this._context,info:Pe.streamNotExistInSubscription,path:dt.prefix});return this.stream._getRTCPeerConnection(e)}getConnectionState(e){if(!this.stream)throw Se({operationName:"PublicationImpl.getConnectionState",context:this._context,info:Pe.streamNotExistInSubscription,path:dt.prefix});return this.stream._getConnectionState(e)}toJSON(){var e;return{id:this.id,channelId:this._channel.id,publisherId:this.publisher.id,origin:(e=this.origin)==null?void 0:e.id,contentType:this.contentType,metadata:this.metadata,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state,stream:this.stream}}_dispose(){this._events.dispose()}},Fs=e=>e.map((i,r)=>{var s;return ge(ue({},i),{id:(s=i.id)!=null?s:r.toString()})}),Ac=e=>{const[i]=e;return i.maxBitrate?e.sort((r,s)=>r.maxBitrate-s.maxBitrate):i.scaleResolutionDownBy?e.sort((r,s)=>s.scaleResolutionDownBy-r.scaleResolutionDownBy):i.maxFramerate?e.sort((r,s)=>r.maxFramerate-s.maxFramerate):e};Z();function am(e){return e==null?!1:e.side==="remote"}Z();Z();var ja=new Ie("packages/core/src/dataPlane/agent/publishing.ts"),om=class{constructor(e){this._localPerson=e,this.context=this._localPerson.context}startPublishing(e){return M(this,null,function*(){if(this.context.config.internal.disableDPlane){yield new Promise(o=>setTimeout(o,500));return}const i=e.publication,r=e.subscriber;i.stream||(yield this._localPerson.onStreamPublished.watch(o=>o.publication.id===i.id,this.context.config.rtcApi.timeout).catch(o=>{throw Se({operationName:"PublishingAgent.startPublishing",context:this.context,channel:this._localPerson.channel,info:ge(ue({},Pe.timeout),{detail:"PublishingAgent onStreamPublished"}),path:ja.prefix,payload:{publication:i},error:o})}));const s=r._getOrCreateConnection(this._localPerson);s.startPublishing&&(yield s.startPublishing(i,e.id))})}stopPublishing(e,i){return M(this,null,function*(){const r=i._getConnection(this._localPerson.id);r!=null&&r.stopPublishing&&r.stopPublishing(e).catch(s=>{ja.error("stopPublishing failed",s)})})}};Z();var cm=class{constructor(e){this._localPerson=e,this._disposers={},this._context=this._localPerson.context}startSubscribing(e){return M(this,null,function*(){if(this._context.config.internal.disableDPlane){yield new Promise(s=>setTimeout(s,500));return}const r=e.publication.publisher._getOrCreateConnection(this._localPerson);if(r.startSubscribing){yield r.startSubscribing(e);const{removeListener:s}=e._onChangeEncoding.add(()=>M(this,null,function*(){var o;yield(o=r.changePreferredEncoding)==null?void 0:o.call(r,e)}));this._disposers[e.id]=s}})}stopSubscribing(e){return M(this,null,function*(){var i,r;const o=e.publication.publisher._getConnection(this._localPerson.id);o!=null&&o.stopSubscribing&&(yield o.stopSubscribing(e),(r=(i=this._disposers)[e.id])==null||r.call(i))})}};Z();var Ba=class{constructor(e){this._impl=e,this._events=new Ti,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberStateChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this.apply(e)}get keepaliveIntervalSec(){return this._impl.keepaliveIntervalSec}get keepaliveIntervalGapSec(){return this._impl.keepaliveIntervalGapSec}get disableSignaling(){return this._impl.disableSignaling}get disableAnalytics(){return this._impl.disableAnalytics}get type(){return this._impl.type}get subtype(){return this._impl.subtype}get side(){return this._impl.side}get id(){return this._impl.id}get name(){return this._impl.name}get channel(){return this._impl.channel}get metadata(){return this._impl.metadata}get state(){return this._impl.state}get publications(){return this._impl.publications}get subscriptions(){return this._impl.subscriptions}apply(e){this._impl=e,e.onLeft.pipe(this.onLeft),e.onMetadataUpdated.pipe(this.onMetadataUpdated),e.onStreamPublished.pipe(this.onStreamPublished),e.onStreamUnpublished.pipe(this.onStreamUnpublished),e.onPublicationListChanged.pipe(this.onPublicationListChanged),e.onPublicationSubscribed.pipe(this.onPublicationSubscribed),e.onPublicationUnsubscribed.pipe(this.onPublicationUnsubscribed),e.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged),e.onFatalError.pipe(this.onFatalError)}subscribe(e,i){return this._impl.subscribe(e,i)}unsubscribe(e){return this._impl.unsubscribe(e)}publish(e,i={}){return this._impl.publish(e,i)}unpublish(e){return this._impl.unpublish(e)}updateMetadata(e){return this._impl.updateMetadata(e)}leave(){return M(this,null,function*(){yield this._impl.leave()})}dispose(){this._impl.dispose()}};Z();Z();var lm=24*60*60;Z();Z();Z();Z();var ur=class{constructor(e,i){this.id=Ii(),this.type=e,this.payload=i}toJSON(){return{id:this.id,type:this.type,payload:this.payload}}};Z();function dm(e){return!(typeof e!="object"||e===null||Array.isArray(e))}function um(e){if(!e||typeof e!="object"||!e.statsRequest||typeof e.statsRequest!="object"||!e.statsRequest.intervalSec||typeof e.statsRequest.intervalSec!="number"||!e.statsRequest.types||!Array.isArray(e.statsRequest.types))return!1;for(const i of e.statsRequest.types){if(!i.type||typeof i.type!="string"||!i.properties||!dm(i.properties))return!1;for(const r of Object.keys(i.properties))if(!("normalization"in i.properties[r])||typeof i.properties[r].normalization!="boolean"||!i.properties[r].outputKey||typeof i.properties[r].outputKey!="string")return!1}return!0}var hm=["invalidPayload","unexpected"];function Ha(e){return!(!e||typeof e!="object"||typeof e.eventId!="string"||typeof e.ok!="boolean"||typeof e.reason<"u"&&(typeof e.reason!="string"||!hm.includes(e.reason)))}Z();var ms=$t(Ls());Z();var Ji=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=e=>{this._listeners.forEach(i=>i(e))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=e=>{const i=this._listenerIndex;return this._listeners.set(i,e),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(i)}}},this.addOneTimeListener=e=>{const i=this.addListener(r=>{i.removeListener(),e(r)});return i},this.asPromise=e=>new Promise((i,r)=>{let s=()=>{};const o=e&&setTimeout(()=>{r("Event asPromise timeout"),s()},e);s=this.addOneTimeListener(d=>{o&&clearTimeout(o),i(d)}).removeListener})}},pm=["Open","Acknowledge"],fm=e=>(Hi(2,e)+Math.random())*1e3,mm=class{constructor({channelId:e,channelName:i,memberId:r,memberName:s,sessionEndpoint:o,token:l,logger:d,sdkVersion:m}){this._isOpen=!1,this._isClosed=!1,this._reconnectCount=0,this.connectionState="connecting",this.onConnectionStateChanged=new Ji,this.onOpened=new Ji,this.onTokenExpired=new Ji,this.onEventReceived=new Ji,this.onConnectionFailed=new Ji,this._resendClientEvents=[],this._sessionEndpoint=o,this._channelId=e,this._channelName=i,this._memberId=r,this._memberName=s,this._token=l,this._logger=d,this._sdkVersion=m,this._connect()}_setConnectionState(e){this.connectionState!==e&&(this._logger.debug(`connectionState changed : ${e}`),this.connectionState=e,this.onConnectionStateChanged.emit(e))}_connect(){let e;try{const i=`SkyWayAuthToken!${this._token}`,r={channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,sdkPlatform:"js",sdkVersion:this._sdkVersion},s=Object.entries(r).filter(([l,d])=>d!==void 0).map(l=>l.join("=")).join("&"),o=`${this._sessionEndpoint}?${s}`;e=new ms.default(o,i),this._logger.debug(`Connecting to analytics-logging-server: ${this._sessionEndpoint}`),e.onerror=l=>{this._logger.error("WebSocket error occurred",l.error),e.close(4202)}}catch(i){const r=i instanceof Error?i:new Error;this._logger.error("Failed to create WebSocket instance",r),this.reconnect();return}e.onopen=()=>{this._logger.debug("Connected to analytics-logging-server")},e.onclose=i=>{const r="Close event fired: "+JSON.stringify({code:i.code,reason:i.reason,type:i.type});if(4100<=i.code&&i.code<=4199?this._logger.error(r,new Error):this._logger.debug(r),i.code!==1e3&&!(4e3<=i.code&&i.code<=4199)){i.code===4200?this.onTokenExpired.emit():this.reconnect();return}i.code!==4e3&&(this._logger.debug("Closed the connection to analytics-logging-server"),this.onConnectionFailed.emit(),this.close())},e.onmessage=i=>{this._messageHandler(i.data)},this._ws=e}updateAuthToken(e){this._token=e}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=5)this.onConnectionFailed.emit(),this.close(),this._logger.error("Failed to reconnect for five times",new Error);else{this._setConnectionState("reconnecting");const e=fm(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},e)}}close(){this._isClosed=!0,this.destroy()}destroy(){this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(e){return M(this,null,function*(){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==ms.default.OPEN){this._logger.debug("Try to reconnect because connection is lost"),this.resendAfterReconnect(e);return}const i=JSON.stringify(e.toJSON());this._ws.send(i,r=>{if(r){this._logger.debug(`Try to reconnect because failed to send: ${r.message}`),this.resendAfterReconnect(e);return}})})}resendAfterReconnect(e){this._resendClientEvents.some(r=>r.id===e.id)||this._resendClientEvents.push(e),this.connectionState!=="reconnecting"&&this.reconnect()}pushResendClientEventsQueue(e){this._resendClientEvents.push(e)}isClosed(){return this._isClosed}_messageHandler(e){if(typeof e!="string"){this._logger.error("Received invalid message: not string",new Error);return}let i;try{i=JSON.parse(e)}catch(r){const s=r instanceof Error?r:new Error;this._logger.error("Received invalid message: parse error",s);return}if(!gm(i)){this._logger.error(`Received invalid message: ${JSON.stringify(i)}`,new Error);return}if(i.type==="Open"){if(!um(i.payload)){this._logger.error(`Received invalid message: ${JSON.stringify(i.payload)}`,new Error);return}if(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this._resendClientEvents.length>0){for(const r of this._resendClientEvents){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==ms.default.OPEN){this._logger.error(`Failed to resend event because connection lost after reconnect: ${r}`,new Error);continue}const s=JSON.stringify(r.toJSON());this._ws.send(s,o=>{if(o){this._logger.error(`Failed to resend event: ${r}`,o);return}this._logger.debug(`Succeed to resend ClientEvent: ${r}`)})}this._logger.debug("Process of resending ClientEvents is completed"),this._resendClientEvents=[]}this.onOpened.emit(i.payload)}else this._logger.debug(`Received the event: ${i.type}, payload: ${JSON.stringify(i.payload)}`),this.onEventReceived.emit(i)}};function gm(e){return!(!e||typeof e!="object"||typeof e.type!="string"||!pm.includes(e.type)||typeof e.id!="string"||e.payload&&typeof e.payload!="object")}Z();var vm=class{constructor(e={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,e)}wait(){return M(this,null,function*(){if(this.exceeded)return!1;const e=this.timeout;return this.count++,yield new Promise(i=>setTimeout(i,e)),!0})}get timeout(){return Hi(this.count,2)*this.interval+Hi(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}stop(){this.count=this.times}},Ua="analytics-logging.skyway.ntt.com",bm="v1",ym=5,_m=class{constructor({token:e,channelId:i,channelName:r,memberId:s,memberName:o,sdkVersion:l},d){this.onConnectionStateChanged=new Ji,this.onConnectionFailed=new Ji,this._isClosed=!1,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._mediaDeviceVersion=new Map,this._encodingsVersion=new Map,this._preferredEncodingVersion=new Map,this._previousSubscriptionStats=new Map,this._statsRequest={intervalSec:5,types:[]},this._token=e,this._newToken=void 0,this._channelId=i,this._channelName=r,this._memberId=s,this._memberName=o,this._sdkVersion=l;const m={analyticsLoggingServerDomain:Ua,secure:!0,logger:{debug:(C,...h)=>{console.debug(C,...h)},warn:(C,...h)=>{console.warn(C,...h)},error:C=>{console.error(C)}}};this._options=Object.assign({},m,d??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var e,i;return(i=(e=this._socket)==null?void 0:e.connectionState)!=null?i:"closed"}connect(){return M(this,null,function*(){const e=this._options.secure?"wss":"ws",i=this._options.analyticsLoggingServerDomain||Ua;this._socket=new mm({sessionEndpoint:`${e}://${i}/${bm}/client/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger,sdkVersion:this._sdkVersion}),this._socket.onEventReceived.addListener(s=>{try{this._eventReceivedHandler(s)}catch(o){this._logger.error("in _eventReceivedHandler",o)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit(),this._cleanupAnalyticsClientMaps()}),this._socket.onConnectionStateChanged.addListener(s=>{var o;s==="closed"&&!this.isClosed()&&((o=this._socket)!=null&&o.isClosed())&&(this._isClosed=!0,this.dispose()),this.onConnectionStateChanged.emit(s)}),this._socket.onTokenExpired.addListener(()=>{this._reconnectWithNewSkyWayAuthToken()});const r=yield this._socket.onOpened.asPromise();if(r!==void 0){this._statsRequest=r.statsRequest;return}else{this._logger.error("First time connection payload is undefined",new Error),this.onConnectionFailed.emit();return}})}dispose(){this._disconnect(),this._cleanupAnalyticsClientMaps()}setNewSkyWayAuthToken(e){this._socket!==void 0&&(this._newToken=e,this._logger.debug("setNewSkyWayAuthToken is success"))}cleanupOnUnpublished(e){this._mediaDeviceVersion.delete(e),this._encodingsVersion.delete(e)}cleanupOnUnsubscribed(e){this._preferredEncodingVersion.delete(e),this._previousSubscriptionStats.delete(e)}_disconnect(){var e;(e=this._socket)==null||e.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}sendMediaDeviceReport(e){return M(this,null,function*(){let i=this._mediaDeviceVersion.get(e.publicationId);i===void 0?i=0:i++,this._mediaDeviceVersion.set(e.publicationId,i);const r={publicationId:e.publicationId,mediaDeviceName:e.mediaDeviceName,mediaDeviceVersion:i,mediaDeviceTrigger:e.mediaDeviceTrigger,updatedAt:e.updatedAt},s=new ur("MediaDeviceReport",r);yield this._sendClientEvent(s).catch(o=>{this._logger.warn("_sendClientEvent in sendMediaDeviceReport is failed",o)})})}sendBindingRtcPeerConnectionToSubscription(e){return M(this,null,function*(){const i=new ur("BindingRtcPeerConnectionToSubscription",e);yield this._sendClientEvent(i).catch(r=>{this._logger.warn("_sendClientEvent in sendBindingRtcPeerConnectionToSubscription is failed",r)})})}filterStatsReport(e){const i=Array.from(e.values()).find(l=>l.type==="transport"&&l.dtlsState==="connected"),r=[];if(i){const l=Array.from(e.values()).find(d=>d.type==="candidate-pair"&&d.nominated&&d.id===(i==null?void 0:i.selectedCandidatePairId));r.push(l.id,l.localCandidateId,l.remoteCandidateId,l.transportId)}else{const l=Array.from(e.values()).find(d=>d.type==="candidate-pair"&&d.nominated&&d.selected);r.push(l.id,l.localCandidateId,l.remoteCandidateId,l.transportId)}const s=new Map,o=["candidate-pair","local-candidate","remote-candidate","transport"];for(const[l,d]of e.entries())o.includes(d.type)?r.includes(d.id)&&s.set(l,d):s.set(l,d);return s}bundleStatsReportByStatsType(e){const i={};for(const r of e.values())i[r.type]=r;return i}sendSubscriptionStatsReport(e,i){return M(this,null,function*(){var r;const s=this._previousSubscriptionStats.get(i.subscriptionId);if(this._previousSubscriptionStats.set(i.subscriptionId,{stats:e,createdAt:i.createdAt}),s===void 0)return;const o=this.filterStatsReport(s.stats),l=this.bundleStatsReportByStatsType(o),d=s.createdAt,m=(i.createdAt-d)/1e3;if(m<=0)throw new Error("duration must be greater than 0. also sendSubscriptionStatsReport was duplicated.");const C=i.contentType==="data",h=this._statsRequest.types.filter(H=>C&&["local-candidate","candidate-pair","data-channel"].includes(H.type)||!C&&H.type!=="data-channel").map(H=>{switch(H.type){case"data-channel":if(i.role==="sender"){const j=H.properties,k=as(j,["bytesReceived"]);return{type:H.type,properties:k}}else{const j=H.properties,k=as(j,["bytesSent"]);return{type:H.type,properties:k}}case"candidate-pair":if(C){const j=H.properties,k=as(j,["availableOutgoingBitrate"]);return{type:H.type,properties:k}}else return H;default:return H}}),v=this.filterStatsReport(e),D=this.bundleStatsReportByStatsType(v),E={};for(const{type:H,properties:j}of h)for(const[k,{normalization:y,outputKey:f}]of Object.entries(j)){const w=D[H];if(!(w===void 0||w[k]===void 0))if(y){const F=(r=l[H])==null?void 0:r[k];if(F===void 0){this._logger.warn(`${H} in previous statsReport is undefined`);continue}const U=(Number(w[k])-Number(F))/m;E[H]=ge(ue({},E[H]),{[f]:String(U)})}else E[H]=ge(ue({},E[H]),{[f]:String(w[k])})}const R={subscriptionId:i.subscriptionId,stats:E,role:i.role,createdAt:i.createdAt},b=new ur("SubscriptionStatsReport",R);yield this._sendClientEvent(b).catch(H=>{this._logger.warn("_sendClientEvent in sendSubscriptionStatsReport is failed",H)})})}sendRtcPeerConnectionEventReport(e){return M(this,null,function*(){const i=new ur("RtcPeerConnectionEventReport",e);yield this._sendClientEvent(i).catch(r=>{this._logger.warn("_sendClientEvent in sendRtcPeerConnectionEventReport is failed",r)})})}sendPublicationUpdateEncodingsReport(e){return M(this,null,function*(){let i=this._encodingsVersion.get(e.publicationId);i===void 0?i=0:i++,this._encodingsVersion.set(e.publicationId,i);const r={publicationId:e.publicationId,encodings:e.encodings,encodingsVersion:i,updatedAt:e.updatedAt},s=new ur("PublicationUpdateEncodingsReport",r);yield this._sendClientEvent(s).catch(o=>{this._logger.warn("_sendClientEvent in sendPublicationUpdateEncodingsReport is failed",o)})})}sendSubscriptionUpdatePreferredEncodingReport(e){return M(this,null,function*(){let i=this._preferredEncodingVersion.get(e.subscriptionId);i===void 0?i=0:i++,this._preferredEncodingVersion.set(e.subscriptionId,i);const r={subscriptionId:e.subscriptionId,preferredEncodingIndex:e.preferredEncodingIndex,preferredEncodingVersion:i,updatedAt:e.updatedAt},s=new ur("SubscriptionUpdatePreferredEncodingReport",r);yield this._sendClientEvent(s).catch(o=>{this._logger.warn("_sendClientEvent in sendSubscriptionUpdatePreferredEncodingReport is failed",o)})})}_sendClientEvent(e){return M(this,null,function*(){return new Promise((i,r)=>M(this,null,function*(){if(this._socket===void 0||this._socket.connectionState==="closed"){r(new Error("websocket is not connected"));return}if(this._socket.connectionState==="connecting"){this._socket.pushResendClientEventsQueue(e),this._setAcknowledgeCallback(e.id,o=>M(this,null,function*(){o.ok?(this._acknowledgeCallbacks.delete(e.id),i()):(this._acknowledgeCallbacks.delete(e.id),r(o))})),this._logger.debug(`pushResendClientEventsQueue and setAcknowledgeCallback. clientEvent.id: ${e.id}`),r(new Error("websocket is connecting now"));return}const s=new vm({times:6,interval:500,jitter:100});for(;!s.exceeded;){const o=setTimeout(()=>M(this,null,function*(){if(this._socket===void 0){this._acknowledgeCallbacks.delete(e.id),r(new Error("Socket closed when trying to resend"));return}else this._socket.resendAfterReconnect(e);r(new Error("Timeout to send data"))}),ym*1e3);this._logger.debug(`send clientEvent, ${JSON.stringify(e)}`),this._socket.send(e).catch(d=>{this._acknowledgeCallbacks.delete(e.id),clearTimeout(o),r(d)});const l=yield this._waitForAcknowledge(e.id).catch(d=>d);if(clearTimeout(o),Ha(l))if(l.reason==="unexpected")yield s.wait();else{r(l);return}else{i();return}}r(new Error("unexpected has occurred at server"))}))})}_waitForAcknowledge(e){return M(this,null,function*(){return new Promise((i,r)=>{this._setAcknowledgeCallback(e,s=>M(this,null,function*(){s.ok?(this._acknowledgeCallbacks.delete(e),i()):(this._acknowledgeCallbacks.delete(e),r(s))}))})})}_reconnectWithNewSkyWayAuthToken(){return M(this,null,function*(){this._disconnect(),this._newToken!==void 0?(this._token=this._newToken,this._newToken=void 0,yield this.connect()):this._logger.warn("new token is not set. so not reconnect.")})}_eventReceivedHandler(e){switch(e.type){case"Acknowledge":this._acknowledgeHandler(e.payload);break;case"Open":break;default:e.type,this._logger.warn(`Unknown event: ${e.type}`)}}_acknowledgeHandler(e){if(!Ha(e))throw new Error("Invalid payload");const{eventId:i}=e;if(!this._acknowledgeCallbacks.has(i))throw new Error(`acknowledge event has unknown eventId: ${i}`);const r=this._acknowledgeCallbacks.get(i);r&&(this._acknowledgeCallbacks.delete(i),r(e))}_setAcknowledgeCallback(e,i){this._acknowledgeCallbacks.set(e,i)}_cleanupAnalyticsClientMaps(){this._mediaDeviceVersion.clear(),this._encodingsVersion.clear(),this._preferredEncodingVersion.clear(),this._previousSubscriptionStats.clear()}getIntervalSec(){return this._statsRequest.intervalSec}isConnectionEstablished(){return!(!this._socket||this._socket.connectionState==="connecting"||this._socket.connectionState==="closed")}isClosed(){return this._isClosed}};Z();Z();Z();Z();Z();Z();Z();var Sm="rtc-api.skyway.ntt.com",Wi=2e4,wm=8;Z();var At={timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},connectionDisconnected:{name:"connectionDisconnected",detail:"",solution:""},websocketConnectionFailure:{name:"connectionFailure",detail:"サーバへの接続に失敗しました",solution:"ネットワーク接続状況を確認してください"},rpcResponseError:{name:"rpcResponseError",detail:"",solution:"",error:{}},onClosedWhileRequesting:{name:"onClosedWhileRequesting",detail:"request中にクライアントが終了されました",solution:"リクエストの完了を確認してからクライアントを終了させてください"},failedToConnectRtcAPI:{name:"failedToConnectRtcAPI",detail:"rtc-api serverへの接続に失敗しました",solution:"インターネット接続状況とTokenの内容が正しいかを確かめてください"},failedToUpdateMemberTTL:{name:"failedToUpdateMemberTTL",detail:"updateMemberTTLを再試行しましたが、失敗しました",solution:"インターネット接続状況を確認してください"}};Z();var Cm=$t(Ls());Z();function zt({operationName:e,info:i,error:r,path:s,payload:o,channelId:l,appId:d,memberId:m}){return new Ai({error:r,info:i,payload:{payload:o,operationName:e,channelId:l,appId:d,memberId:m},path:s})}function gi({appId:e,detail:i,channelId:r,operationName:s,payload:o,memberId:l}){return{operationName:s,payload:o,detail:i,appId:e,channelId:r,memberId:l}}var gt=new Ie("packages/rtc-rpc-api-client/src/rpc.ts"),xm=class{constructor(){this._id=Ii(),this.closed=!1,this.negotiated=!1,this._reconnecting=!1,this._pendingRequests=[],this._events=new Ti,this._onMessage=this._events.make(),this.onNotify=this._events.make(),this.onFatalError=this._events.make(),this.onDisconnected=this._events.make(),this.onClosed=this._events.make(),this._send=e=>new Promise((i,r)=>M(this,null,function*(){if(yield new Promise(s=>setTimeout(s,0)),this._ws.readyState!==this._ws.OPEN){r(zt({operationName:"RPC._send",info:ge(ue({},At.internalError),{detail:"wrong state"}),path:gt.prefix,payload:{request:e,wsReadyState:qa[this._ws.readyState]}}));return}this._ws.send(JSON.stringify(e),s=>{if(s)throw r(zt({operationName:"RPC._send",info:ge(ue({},At.internalError),{detail:"failed to send rpc message"}),path:gt.prefix,error:s}))}),i()}))}set reconnecting(e){this._reconnecting=e}get reconnecting(){return this._reconnecting}connect(e){return M(this,arguments,function*({domain:i,token:r,secure:s}){const o=r;this._ws=new Cm.default(`${s?"wss":"ws"}://${i}/ws`,o),this._ws.onmessage=d=>{this._onMessage.emit(JSON.parse(d.data))},this._ws.onclose=()=>M(this,null,function*(){gt.debug("websocket closed",{id:this._id}),this.onDisconnected.emit()}),this._onMessage.add(d=>{Em(d)&&this.onNotify.emit(d)});const l=yield new Promise((d,m)=>{const C=setTimeout(()=>{m(zt({operationName:"RPC.connect",info:ge(ue({},At.timeout),{detail:"ws.open"}),path:gt.prefix}))},5e3);this._ws.onerror=h=>{m(zt({operationName:"RPC.connect",info:At.websocketConnectionFailure,path:gt.prefix,error:h}))},this._ws.onopen=()=>{clearTimeout(C),d()}}).catch(d=>d);if(l)throw l;this.negotiated=!0})}close(){this.closed||(this.closed=!0,gt.debug("closed"),this._ws.close(),this.onClosed.emit(),this._events.dispose())}resolvePendingRequests(){gt.debug("resolve pendingRequests",[...this._pendingRequests]),this._pendingRequests.forEach(e=>M(this,null,function*(){yield this._send(e)})),this._pendingRequests=[]}request(e,i){return M(this,null,function*(){if(this.closed)throw zt({operationName:"RPC.request",info:ge(ue({},At.internalError),{detail:"rpc closed"}),path:gt.prefix,payload:{method:e,params:i,id:this._id}});let r=!1;try{const s=gs(e,i),o=()=>M(this,null,function*(){return yield this._onMessage.watch(m=>m.id===s.id,Wi).catch(()=>{if(!r)throw zt({operationName:"RPC.request",info:ge(ue({},At.timeout),{detail:"rpc request timeout"}),path:gt.prefix,payload:{rpcTimeout:Wi,method:e,params:i,wsReadyState:qa[this._ws.readyState],id:this._id}})})}),l=()=>M(this,null,function*(){gt.warn("[start] reconnecting. pending request",gi({operationName:"RPC.request",detail:"[start] reconnecting. pending request",payload:{request:s,id:this._id}})),this._pendingRequests.push(s);const m=yield Promise.race([o(),this.onFatalError.asPromise(Wi+100).then(C=>{throw r||gt.error("[failed] reconnecting. pending request",zt({operationName:"RPC.request",info:ge(ue({},At.internalError),{detail:"onFatalError while request"}),path:gt.prefix}),C),C})]);return r=!0,gt.warn("[end] reconnecting. pending request",gi({operationName:"RPC.request",detail:"[end] reconnecting. pending request",payload:{request:s,id:this._id}})),m});let d;if(this._reconnecting?d=yield l():(this._send(s).catch(m=>{gt.error("send error",m)}),d=yield Promise.race([o(),M(this,null,function*(){if(yield this.onDisconnected.asPromise(Wi+100),r)return{};try{const m=yield l();return gt.warn(gi({operationName:"request.pendingRequest",detail:"success to handle disconnected"})),m}catch(m){throw zt({operationName:"RPC.request",info:At.connectionDisconnected,path:gt.prefix,error:m})}}),this.onFatalError.asPromise(Wi+100).then(m=>{if(r)return{};throw zt({operationName:"RPC.request",info:ge(ue({},At.internalError),{detail:"onFatalError while requesting"}),path:gt.prefix,error:m})}),this.onClosed.asPromise(Wi+100).then(()=>{if(r)return{};throw zt({operationName:"RPC.request",info:At.onClosedWhileRequesting,path:gt.prefix,payload:{method:e,params:i}})})]),r=!0),d.error)throw gt.warn("[failed] request ",{message:d,method:e,params:i}),zt({operationName:"RPC.request",info:ge(ue({},At.rpcResponseError),{detail:e,error:d.error}),payload:{message:d,method:e,params:i},path:gt.prefix});return d.result}catch(s){throw r=!0,s}})}notify(e,i){return M(this,null,function*(){const r=gs(e,i,!0);yield this._send(r)})}batch(e){return M(this,null,function*(){const i=e.map(({method:s,params:o})=>gs(s,o));return this._send(i).catch(s=>{throw s}),yield Promise.all(i.map(s=>M(this,[s],function*({id:o}){return yield this._onMessage.watch(d=>d.id===o,Wi)})))})}},gs=(e,i,r)=>{if(r)return{jsonrpc:"2.0",method:e,params:i};const s=Ii();return{jsonrpc:"2.0",method:e,params:i,id:s}},Em=e=>{const i=e;return!!(i.method&&i.id==null)},qa=["CONNECTING","OPEN","CLOSING","CLOSED"],ft=new Ie("packages/rtc-rpc-api-client/src/client.ts"),Va,Ka,Pm=class{constructor(e){this.config=e,this.closed=!1,this._domain=(Va=this.config.domain)!=null?Va:Sm,this._secure=(Ka=this.config.secure)!=null?Ka:!0,this._token=this.config.token,this._rpc=new xm,this._subscribingChannelEvents=new Set,this._subscribingChannelVersions={},this._httpClient=new Ws(`http${this.config.secure?"s":""}://${this.config.domain}`),this._reconnectCount=0,this._reconnectLimit=wm,this._events=new Ti,this.onEvent=this._events.make(),this.onFatalError=this._events.make(),this.onClose=this._events.make(),this.onReconnected=this._events.make();var i,r,s,o;Ie.level=(r=(i=e.log)==null?void 0:i.level)!=null?r:Ie.level,Ie.format=(o=(s=e.log)==null?void 0:s.format)!=null?o:Ie.format,ft.debug("RtcRpcApiClient spawned",e),this._rpc.onNotify.add(l=>{if(l.method==="channelEventNotification"){const d=l.params;this._subscribingChannelVersions[d.data.channel.id]=d.data.channel.version,this.onEvent.emit({channelId:d.data.channel.id,event:d})}}),this._rpc.onDisconnected.add(()=>M(this,null,function*(){this._rpc.negotiated&&!this._rpc.closed&&!this._rpc.reconnecting&&(yield this._reconnect())})),this._rpc.onFatalError.once(l=>{ft.error("fatal error",l),this.onFatalError.emit(l),this.close()})}get token(){return this._token}_reconnect(){return M(this,null,function*(){if(this._reconnectCount>=this._reconnectLimit){this._rpc.onFatalError.emit(zt({operationName:"RtcRpcApiClient._reconnect",info:{name:"failed to reconnect",detail:"_reconnectLimit exceeded",solution:""},path:ft.prefix})),this.close();return}this._rpc.reconnecting=!0,ft.warn("[start] reconnect",gi({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect start",payload:{reconnectCount:this._reconnectCount,limit:this._reconnectLimit}})),this._reconnectCount++;const e=Hi(this._reconnectCount,2)*100+Hi(this._reconnectCount,2)*100*Math.random();yield new Promise(i=>setTimeout(i,e));try{yield this.connect().catch(i=>{throw ft.warn("[failed] reconnect rtc api",gi({operationName:"RtcRpcApiClient._reconnect",detail:"connect rpc failed",payload:{reconnectCount:this._reconnectCount}}),i),i}),this._rpc.reconnecting=!1,this._reconnectCount=0,this._rpc.resolvePendingRequests(),yield Promise.all([...this._subscribingChannelEvents].map(i=>M(this,null,function*(){const[r,s]=i.split(":"),o=this._subscribingChannelVersions[s];yield this.subscribeChannelEvents({appId:r,channelId:s,offset:o})}))).catch(i=>{throw ft.warn("subscribeChannelEvents failed",gi({operationName:"RtcRpcApiClient._reconnect",detail:"subscribeChannelEvents failed",payload:{reconnectCount:this._reconnectCount}}),i),i}),ft.warn("[end] reconnect",gi({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect finished",payload:{reconnectCount:this._reconnectCount}})),this.onReconnected.emit()}catch(i){ft.warn("[failed] reconnect",gi({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect failed",payload:{reconnectCount:this._reconnectCount}}),i),yield this._reconnect()}})}updateToken(e){return M(this,null,function*(){ft.debug("token update",{token:e}),this._token=e,yield this._updateAuthToken()})}close(){this.closed||(this.closed=!0,ft.debug("closed"),this._rpc.close(),this.onClose.emit(),this._events.dispose())}health(){return M(this,null,function*(){return yield this._httpClient.get("/health")})}connect(){return M(this,null,function*(){ft.debug("connect to rtc api rpc",this._domain),yield this._rpc.connect({domain:this._domain,token:this.token,secure:this._secure}).catch(e=>{throw zt({operationName:"RtcRpcApiClient.connect",info:At.failedToConnectRtcAPI,error:e,path:ft.prefix})})})}_channelSubscribed(e,i){this._subscribingChannelEvents.add(e+":"+i),ft.debug("_channelSubscribed",{appId:e,channelId:i,_subscribingChannelEvents:[...this._subscribingChannelEvents]})}_isSubscribingChannel(e,i){return this._subscribingChannelEvents.has(e+":"+i)}createChannel(e){return M(this,arguments,function*({name:i,metadata:r,appId:s}){const{channel:o}=yield this._rpc.request("createChannel",{name:i,metadata:r,appId:s,authToken:this.token});return this._channelSubscribed(s,o.id),o})}findOrCreateChannel(e){return M(this,arguments,function*({name:i,metadata:r,appId:s}){const{channel:o}=yield this._rpc.request("findOrCreateChannel",{name:i,metadata:r,appId:s,authToken:this.token});return this._channelSubscribed(s,o.id),o})}getChannel(e){return M(this,arguments,function*({appId:i,id:r}){const s=yield this._rpc.request("getChannel",{id:r,appId:i,authToken:this.token});return this._isSubscribingChannel(i,r)||(this._channelSubscribed(i,r),yield this.subscribeChannelEvents({appId:i,channelId:r,offset:s.channel.version})),s.channel})}getChannelByName(e){return M(this,arguments,function*({name:i,appId:r}){const s=yield this._rpc.request("getChannelByName",{name:i,appId:r,authToken:this.token}),o=s.channel.id;return this._isSubscribingChannel(r,o)||(this._channelSubscribed(r,o),yield this.subscribeChannelEvents({appId:r,channelId:o,offset:s.channel.version})),s.channel})}deleteChannel(e){return M(this,arguments,function*({id:i,appId:r}){yield this._rpc.request("deleteChannel",{id:i,appId:r,authToken:this.token})})}updateChannelMetadata(e){return M(this,arguments,function*({id:i,metadata:r,appId:s}){yield this._rpc.request("updateChannelMetadata",{id:i,metadata:r,appId:s,authToken:this.token})})}addMember(e){return M(this,arguments,function*({channelId:i,name:r,metadata:s,subscribeChannelEvents:o,appId:l,ttlSec:d,subtype:m,type:C}){return yield this._rpc.request("addMember",{channelId:i,name:r,metadata:s,subscribeChannelEvents:o,appId:l,ttlSec:d&&parseInt(d.toString()),authToken:this.token,subtype:m,type:C})})}updateMemberTtl(e){return M(this,arguments,function*(i,r=new vi({times:8})){const{appId:s,channelId:o,memberId:l,ttlSec:d}=i;try{yield this._rpc.request("updateMemberTtl",{appId:s,channelId:o,memberId:l,ttlSec:d&&parseInt(d.toString()),authToken:this.token})}catch(m){if(!r.exceeded)ft.warn("retry updateMemberTtl",gi({operationName:"RtcRpcApiClient.updateMemberTtl",detail:"retry updateMemberTtl",appId:s,channelId:o,memberId:l,payload:{backoff:r.count}}),m),yield r.wait(),yield this.updateMemberTtl(i,r);else throw new Ai({path:ft.prefix,info:At.failedToUpdateMemberTTL,error:m})}})}updateMemberMetadata(e){return M(this,arguments,function*({channelId:i,memberId:r,metadata:s,appId:o}){yield this._rpc.request("updateMemberMetadata",{channelId:i,memberId:r,metadata:s,appId:o,authToken:this.token})})}leaveChannel(e){return M(this,arguments,function*({channelId:i,id:r,appId:s}){yield this._rpc.request("removeMember",{channelId:i,id:r,appId:s,authToken:this.token})})}publishStream(e){return M(this,arguments,function*({appId:i,channelId:r,publisherId:s,contentType:o,metadata:l,origin:d,codecCapabilities:m,encodings:C,isEnabled:h}){return{publicationId:(yield this._rpc.request("publishStream",{channelId:r,publisherId:s,contentType:o[0].toUpperCase()+o.slice(1),metadata:l,origin:d,codecCapabilities:m,encodings:C==null?void 0:C.map(D=>({id:D.id})),isEnabled:h,appId:i,authToken:this.token})).id}})}disablePublication(e){return M(this,arguments,function*({channelId:i,publicationId:r,appId:s}){yield this._rpc.request("disablePublication",{channelId:i,appId:s,publicationId:r,authToken:this.token})})}enablePublication(e){return M(this,arguments,function*({channelId:i,publicationId:r,appId:s}){yield this._rpc.request("enablePublication",{channelId:i,appId:s,publicationId:r,authToken:this.token})})}updatePublicationMetadata(e){return M(this,arguments,function*({channelId:i,publicationId:r,appId:s,metadata:o}){yield this._rpc.request("updatePublicationMetadata",{channelId:i,publicationId:r,metadata:o,appId:s,authToken:this.token})})}unpublishStream(e){return M(this,arguments,function*({channelId:i,publicationId:r,appId:s}){yield this._rpc.request("unpublishStream",{channelId:i,publicationId:r,appId:s,authToken:this.token})})}subscribeStream(e){return M(this,arguments,function*({channelId:i,subscriberId:r,publicationId:s,appId:o}){return{subscriptionId:(yield this._rpc.request("subscribeStream",{channelId:i,subscriberId:r,publicationId:s,appId:o,authToken:this.token})).id}})}unsubscribeStream(e){return M(this,arguments,function*({channelId:i,subscriptionId:r,appId:s}){yield this._rpc.request("unsubscribeStream",{channelId:i,subscriptionId:r,appId:s,authToken:this.token})})}getServerUnixtime(e){return M(this,arguments,function*(i,r=new vi({times:8})){const{appId:s}=i;try{return(yield this._rpc.request("getServerUnixtime",{appId:s,authToken:this.token})).unixtime}catch(o){if(r.exceeded)throw o;return ft.warn(gi({operationName:"RtcRpcApiClient.getServerUnixtime",detail:"retry getServerUnixtime",appId:s,payload:{backoff:r.count}}),o),yield r.wait(),this.getServerUnixtime(i,r)}})}_updateAuthToken(){return M(this,null,function*(){yield this._rpc.request("updateAuthToken",{authToken:this.token})})}subscribeChannelEvents(e){return M(this,arguments,function*({appId:i,channelId:r,offset:s}){try{ft.debug("[start] subscribeChannelEvents",{offset:s}),yield this._rpc.request("subscribeChannelEvents",{appId:i,authToken:this.token,channelId:r,offset:s}),ft.debug("[end] subscribeChannelEvents",{offset:s})}catch(o){if(o instanceof Ai&&o.info.name===At.connectionDisconnected.name)ft.warn("reconnect happened while subscribeChannelEvents. retry",gi({operationName:"RtcRpcApiClient.subscribeChannelEvents",detail:"reconnect happened while subscribeChannelEvents. retry",appId:i,channelId:r,payload:{offset:s}}),o),yield this.subscribeChannelEvents({appId:i,channelId:r,offset:s});else throw ft.error("[failed] subscribeChannelEvents",zt({operationName:"RtcRpcApiClient.subscribeChannelEvents",info:ge(ue({},At.internalError),{detail:"subscribeChannelEvents failed"}),path:ft.prefix,error:o,payload:{offset:s},appId:i,channelId:r})),o}})}};Z();Z();var Rm=$t(uo()),Tm=class{constructor(e={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.log={level:"error",format:"object"},Object.assign(this,(0,Rm.default)(this,e))}};Z();Z();var Ae=ge(ue({},At),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストのパラメーターが正しくありません",solution:"API仕様を確認し正しい値を入力してください"},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています Token permissions are insufficient",solution:"Tokenに必要な権限を加えてください Add the necessary permissions to the Token"},publicationNestedTooMuch:{name:"publicationNestedTooMuch",detail:"originが設定されているPublicationをPublicationのoriginに指定することは出来ません It is not possible to specify the origin of a publication for which Origin has been set",solution:"仕様上の制約なので解決法はありません There is no solution because it is a specification limitation"},channelNotFound:{name:"channelNotFound",detail:"参照しようとしたchannelは存在しません The channel you tried to reference does not exist.",solution:"channelIdやchannelNameが正しいか確かめてください Make sure that the Channel id and channel name are correct."},memberNotFound:{name:"memberNotFound",detail:"参照しようとしたMemberは存在しません The member you tried to reference does not exist.",solution:"memberIdやmemberNameが正しいか確かめてください Make sure that the member id and member name is correct."},publicationNotFound:{name:"publicationNotFound",detail:"参照しようとしたPublicationは存在しません The Publication you tried to reference does not exist.",solution:"publicationIdが正しいか確かめてください Make sure that the publication id is correct."},subscriptionNotFound:{name:"subscriptionNotFound",detail:"参照しようとしたSubscriptionは存在しません The Subscription you tried to reference does not exist.",solution:"subscriptionIdが正しいか確かめてください Make sure that the subscription id is correct."},operationConflicted:{name:"operationConflicted",detail:"与えられた名前のチャネルは、今までの競合する要求によって、すでに作成されています The channel with the given name has already been created by a conflicting request up to now",solution:"別の名前を使ってchannelを作成してください"},channelNameDuplicated:{name:"channelNameDuplicated",detail:"その名前のChannelはすでに存在します A channel with that name already exists",solution:"別の名前を使ってchannelを作成してください"},memberNameDuplicated:{name:"memberNameDuplicated",detail:"その名前のMemberはすでに存在します A member with that name already exists",solution:"別の名前を使ってmemberを作成してください"},subscriptionAlreadyExists:{name:"subscriptionAlreadyExists",detail:"PublicationはすでにSubscribeされています",solution:"publicationIdが正しいか確かめてください"},rateLimitExceeded:{name:"rateLimitExceeded",detail:"リソースを規定仕様以上に消費しています",solution:"リソースの消費量を減らしてください"},authTokenExpired:{name:"authTokenExpired",detail:"AuthTokenが期限切れです",solution:"適切なExpを設定したAuthTokenを使用してください"},serverBusy:{name:"serverBusy",detail:"サービス側の問題です",solution:"しばらく時間を置いて再試行してください"}});Z();function za({appId:e,detail:i,channelId:r,operationName:s,payload:o}){return{operationName:s,payload:o,detail:i,appId:e,channelId:r}}function Fe({operationName:e,info:i,error:r,path:s,channelId:o,appId:l,payload:d}){return new Ai({error:r,info:i,payload:{payload:d,operationName:e,channelId:o,appId:l},path:s})}var Le=new Ie("packages/rtc-api-client/src/infrastructure/api.ts"),Im=class{constructor(e){this._client=e,this.closed=!1,this.onClose=new De,this.onFatalError=new De,this._token=Lr.Decode(this._client.token),e.onClose.once(()=>{this.close()}),e.onFatalError.add(i=>{this.onFatalError.emit(i)})}connect(){return M(this,null,function*(){yield this._client.connect()})}updateAuthToken(e){return M(this,null,function*(){this._token=Lr.Decode(e),yield this._client.updateToken(e)})}close(){this.closed||(this.closed=!0,Le.debug("closed"),this._client.close(),this.onClose.emit(),this.onClose.removeAllListeners())}_commonError(e,i,r){switch(i){case-32602:return Fe({operationName:e,info:Ae.invalidRequestParameter,path:Le.prefix,error:r});case-32603:return Fe({operationName:e,info:Ae.internalError,path:Le.prefix,error:r});case 403:case 4030:return Fe({operationName:e,info:Ae.insufficientPermissions,path:Le.prefix,error:r})}}createChannel(e,i){return M(this,null,function*(){const{id:r}=yield this._client.createChannel({appId:e,name:i.name,metadata:i.metadata}).catch(o=>{var l,d,m;const{info:C}=o,h=this._commonError("RtcApiImpl.createChannel",(d=(l=C==null?void 0:C.error)==null?void 0:l.code)!=null?d:-1,o);if(h)throw h;switch((m=C==null?void 0:C.error)==null?void 0:m.code){case 404:throw Fe({operationName:"RtcApiImpl.createChannel",path:Le.prefix,info:Ae.channelNotFound,error:o});case 409:throw Fe({operationName:"RtcApiImpl.createChannel",path:Le.prefix,info:Ae.channelNameDuplicated,error:o});default:throw Fe({operationName:"RtcApiImpl.createChannel",path:Le.prefix,info:Ae.internalError,error:o})}});return yield this.getChannel(e,{id:r})})}getChannel(e,i){return M(this,arguments,function*(r,{name:s,id:o}){if(o)return yield this._client.getChannel({appId:r,id:o}).catch(l=>{var d,m,C;const{info:h}=l,v=this._commonError("RtcApiImpl.getChannel",(m=(d=h==null?void 0:h.error)==null?void 0:d.code)!=null?m:-1,l);if(v)throw v;switch((C=h==null?void 0:h.error)==null?void 0:C.code){case 404:throw Fe({operationName:"RtcApiImpl.getChannel",path:Le.prefix,info:Ae.channelNotFound,error:l});default:throw Fe({operationName:"RtcApiImpl.getChannel",path:Le.prefix,info:Ae.internalError,error:l})}});if(s)return yield this._client.getChannelByName({appId:r,name:s}).catch(l=>{var d,m,C;const{info:h}=l,v=this._commonError("RtcApiImpl.getChannel",(m=(d=h==null?void 0:h.error)==null?void 0:d.code)!=null?m:-1,l);if(v)throw v;switch((C=h==null?void 0:h.error)==null?void 0:C.code){case 404:throw Fe({operationName:"getChannel",path:Le.prefix,info:Ae.channelNotFound,error:l});default:throw Fe({operationName:"getChannel",path:Le.prefix,info:Ae.internalError,error:l})}});throw Fe({operationName:"RtcApiImpl.createChannel",path:Le.prefix,info:Ae.invalidRequestParameter})})}findOrCreateChannel(e,i){return M(this,null,function*(){return this._client.findOrCreateChannel(ge(ue({},i),{appId:e})).catch(r=>{var s,o,l,d;const{info:m}=r,C=this._commonError("RtcApiImpl.findOrCreateChannel",(o=(s=m==null?void 0:m.error)==null?void 0:s.code)!=null?o:-1,r);if(C)throw C;if(i.name&&((l=m==null?void 0:m.error)==null?void 0:l.code)===409)return this.getChannel(e,{name:i.name});switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.findOrCreateChannel",path:Le.prefix,info:Ae.channelNotFound,error:r});case 409:throw Fe({operationName:"RtcApiImpl.findOrCreateChannel",path:Le.prefix,info:Ae.channelNameDuplicated,error:r});default:throw Fe({operationName:"RtcApiImpl.findOrCreateChannel",path:Le.prefix,info:Ae.internalError,error:r})}})})}deleteChannel(e,i){return M(this,null,function*(){yield this._client.deleteChannel({appId:e,id:i}).catch(r=>{var s,o,l;const{info:d}=r,m=this._commonError("RtcApiImpl.deleteChannel",(o=(s=d==null?void 0:d.error)==null?void 0:s.code)!=null?o:-1,r);if(m)throw m;switch((l=d==null?void 0:d.error)==null?void 0:l.code){case 404:throw Fe({operationName:"RtcApiImpl.deleteChannel",path:Le.prefix,info:Ae.channelNotFound,error:r});default:throw Fe({operationName:"RtcApiImpl.deleteChannel",path:Le.prefix,info:Ae.internalError,error:r})}})})}updateChannelMetadata(e,i,r){return M(this,null,function*(){yield this._client.updateChannelMetadata({appId:e,id:i,metadata:r}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.updateChannelMetadata",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.updateChannelMetadata",path:Le.prefix,info:Ae.channelNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.updateChannelMetadata",path:Le.prefix,info:Ae.internalError,error:s})}})})}join(e,i,r){return M(this,null,function*(){const{memberId:s}=yield this._client.addMember({appId:e,channelId:i,name:r.name,metadata:r.metadata,ttlSec:r.ttlSec,type:r.type,subtype:r.subtype}).catch(l=>{var d,m,C;const{info:h}=l,v=this._commonError("RtcApiImpl.addMember",(m=(d=h==null?void 0:h.error)==null?void 0:d.code)!=null?m:-1,l);if(v)throw v;switch((C=h==null?void 0:h.error)==null?void 0:C.code){case 404:throw Fe({operationName:"RtcApiImpl.addMember",path:Le.prefix,info:Ae.channelNotFound,error:l});case 409:throw Fe({operationName:"RtcApiImpl.addMember",path:Le.prefix,info:Ae.memberNameDuplicated,error:l});default:throw Fe({operationName:"RtcApiImpl.addMember",path:Le.prefix,info:Ae.internalError,error:l})}});return{id:s,name:r.name,type:r.type,subtype:r.subtype,metadata:r.metadata}})}updateMemberTtl(e,i,r,s){return M(this,null,function*(){yield this._client.updateMemberTtl({appId:e,channelId:i,memberId:r,ttlSec:s}).catch(o=>{var l,d,m;const{info:C}=o,h=this._commonError("RtcApiImpl.updateMemberTtl",(d=(l=C==null?void 0:C.error)==null?void 0:l.code)!=null?d:-1,o);if(h)throw h;switch((m=C==null?void 0:C.error)==null?void 0:m.code){case 404:throw Fe({operationName:"RtcApiImpl.updateMemberTtl",path:Le.prefix,info:Ae.memberNotFound,error:o});default:throw Fe({operationName:"RtcApiImpl.updateMemberTtl",path:Le.prefix,info:Ae.internalError,error:o})}})})}getServerUnixtime(e){return M(this,null,function*(){return yield this._client.getServerUnixtime({appId:e}).catch(i=>{var r,s;const{info:o}=i,l=this._commonError("RtcApiImpl.getServerUnixtime",(s=(r=o==null?void 0:o.error)==null?void 0:r.code)!=null?s:-1,i);throw l||Fe({operationName:"RtcApiImpl.getServerUnixtime",path:Le.prefix,info:Ae.internalError,error:i})})})}updateMemberMetadata(e,i,r,s){return M(this,null,function*(){yield this._client.updateMemberMetadata({appId:e,channelId:i,memberId:r,metadata:s}).catch(o=>{var l,d,m;const{info:C}=o,h=this._commonError("RtcApiImpl.updateMemberMetadata",(d=(l=C==null?void 0:C.error)==null?void 0:l.code)!=null?d:-1,o);if(h)throw h;switch((m=C==null?void 0:C.error)==null?void 0:m.code){case 404:throw Fe({operationName:"RtcApiImpl.updateMemberMetadata",path:Le.prefix,info:Ae.memberNotFound,error:o});default:throw Fe({operationName:"RtcApiImpl.updateMemberMetadata",path:Le.prefix,info:Ae.internalError,error:o})}})})}leave(e,i,r){return M(this,null,function*(){yield this._client.leaveChannel({channelId:i,id:r,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.leaveChannel",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.leaveChannel",path:Le.prefix,info:Ae.memberNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.leaveChannel",path:Le.prefix,info:Ae.internalError,error:s})}})})}publish(e,i){return M(this,null,function*(){const{publicationId:r}=yield this._client.publishStream({channelId:i.channel,publisherId:i.publisher,contentType:i.contentType,metadata:i.metadata,origin:i.origin,codecCapabilities:i.codecCapabilities,encodings:i.encodings,isEnabled:i.isEnabled,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.publish",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){default:throw Fe({operationName:"RtcApiImpl.publish",path:Le.prefix,info:Ae.internalError,error:s})}});return r})}updatePublicationMetadata(e,i,r,s){return M(this,null,function*(){yield this._client.updatePublicationMetadata({channelId:i,publicationId:r,metadata:s,appId:e}).catch(o=>{var l,d,m;const{info:C}=o,h=this._commonError("RtcApiImpl.updatePublicationMetadata",(d=(l=C==null?void 0:C.error)==null?void 0:l.code)!=null?d:-1,o);if(h)throw h;switch((m=C==null?void 0:C.error)==null?void 0:m.code){case 404:throw Fe({operationName:"RtcApiImpl.updatePublicationMetadata",path:Le.prefix,info:Ae.publicationNotFound,error:o});default:throw Fe({operationName:"RtcApiImpl.updatePublicationMetadata",path:Le.prefix,info:Ae.internalError,error:o})}})})}disablePublication(e,i,r){return M(this,null,function*(){yield this._client.disablePublication({channelId:i,publicationId:r,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.disablePublication",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.disablePublication",path:Le.prefix,info:Ae.publicationNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.disablePublication",path:Le.prefix,info:Ae.internalError,error:s})}})})}enablePublication(e,i,r){return M(this,null,function*(){yield this._client.enablePublication({channelId:i,publicationId:r,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.enablePublication",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.enablePublication",path:Le.prefix,info:Ae.publicationNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.enablePublication",path:Le.prefix,info:Ae.internalError,error:s})}})})}unpublish(e,i,r){return M(this,null,function*(){yield this._client.unpublishStream({channelId:i,publicationId:r,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.unpublishStream",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.unpublishStream",path:Le.prefix,info:Ae.publicationNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.unpublishStream",path:Le.prefix,info:Ae.internalError,error:s})}})})}subscribe(e,i){return M(this,null,function*(){const{subscriptionId:r}=yield this._client.subscribeStream({channelId:i.channel.id,subscriberId:i.subscriber.id,publicationId:i.publication.id,appId:e}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.subscribeStream",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.subscribeStream",path:Le.prefix,info:Ae.publicationNotFound,error:s});case 409:throw Fe({operationName:"RtcApiImpl.subscribeStream",path:Le.prefix,info:Ae.subscriptionAlreadyExists,error:s});default:throw Fe({operationName:"RtcApiImpl.subscribeStream",path:Le.prefix,info:Ae.internalError,error:s})}});return r})}unsubscribe(e,i,r){return M(this,null,function*(){yield this._client.unsubscribeStream({appId:e,channelId:i,subscriptionId:r}).catch(s=>{var o,l,d;const{info:m}=s,C=this._commonError("RtcApiImpl.unsubscribeStream",(l=(o=m==null?void 0:m.error)==null?void 0:o.code)!=null?l:-1,s);if(C)throw C;switch((d=m==null?void 0:m.error)==null?void 0:d.code){case 404:throw Fe({operationName:"RtcApiImpl.unsubscribeStream",path:Le.prefix,info:Ae.publicationNotFound,error:s});default:throw Fe({operationName:"RtcApiImpl.unsubscribeStream",path:Le.prefix,info:Ae.internalError,error:s})}})})}};Z();var Xi=new Ie("packages/rtc-api-client/src/infrastructure/eventObserver.ts"),Dm=class{constructor(e,i,r,s){this.onEvent=new De,this._disposer=[];const o=new Am(r.version,l=>M(this,null,function*(){yield i.subscribeChannelEvents({appId:e,channelId:r.id,offset:l}),yield new Promise(d=>setTimeout(d,s.eventSubscribeTimeout)),o.packetLostHappened&&Xi.error(Fe({operationName:"EventObserverImpl.eventJitterBuffer",info:ge(ue({},Ae.internalError),{detail:"failed to resolve event lost"}),channelId:r.id,appId:e,path:Xi.prefix}))}));this._disposer=[i.onEvent.add(l=>M(this,[l],function*({channelId:d,event:m}){d===r.id&&o.push({event:m,version:m.data.channel.version})})).removeListener,o.onEvent.add(l=>{this.onEvent.emit(l)}).removeListener]}dispose(){this._disposer.forEach(e=>e()),this.onEvent.removeAllListeners()}},Am=class{constructor(e,i,r=1e3){this.presentVersion=e,this.onPacketLost=i,this.packetLifetime=r,this.onEvent=new De,this.eventBuffer={},this.packetLostHappened=!1}get expectNextVersion(){return this.presentVersion+1}push(e){const i=e.version;if(i<this.expectNextVersion){Xi.debug("duplicate event",ge(ue({},e),{presentVersion:this.presentVersion}));return}if(i>this.expectNextVersion){Xi.debug("maybe miss order event received",ge(ue({},e),{presentVersion:this.presentVersion})),this.eventBuffer[i]=e,this.handlePacketLifetime();return}this.packetLostHappened&&(Xi.warn("event packetLost resolved",za({operationName:"EventJitterBuffer.push",detail:"event packetLost resolved",payload:{eventFrame:e}})),this.packetLostHappened=!1),this.eventBuffer[i]=e,this.resolveEvents()}handlePacketLifetime(){const[e]=Object.keys(this.eventBuffer).sort().map(i=>this.eventBuffer[Number(i)]);this.packetLifeTimer==null&&e&&(Xi.debug("set event packetLost timer",ge(ue({},e),{presentVersion:this.presentVersion})),this.packetLifeTimer=setTimeout(()=>M(this,null,function*(){if(this.presentVersion<e.version){if(Xi.warn("event packetLost",za({operationName:"EventJitterBuffer.handlePacketLifetime",detail:"eventPacket lost",payload:{oldestBufferedEvent:e,eventBufferLength:Object.keys(this.eventBuffer).length,presentVersion:this.presentVersion}})),this.packetLostHappened)return;this.packetLostHappened=!0,yield this.onPacketLost(this.expectNextVersion)}this.packetLifeTimer=void 0,this.handlePacketLifetime()}),this.packetLifetime))}resolveEvents(){const e=[];for(let i=this.expectNextVersion;;i++){const r=this.eventBuffer[i];if(r)e.push(r),delete this.eventBuffer[i];else break}e.length>0&&(this.presentVersion=e.slice(-1)[0].version,e.forEach(i=>{this.onEvent.emit(i.event)}))}},fi=new Ie("packages/rtc-api-client/src/client.ts"),Fm=class Fc{constructor(i,r,s,o){this.appId=i,this.config=r,this.apiClient=s,this._eventObserverFactory=o,this.closed=!1,this.onFatalError=new De,this.apiClient.onFatalError.pipe(this.onFatalError)}static Create(i){return M(this,null,function*(){const r=new Tm(i);r.log&&(Ie.level=r.log.level,Ie.format=r.log.format),fi.debug("RtcApiClient spawned",r);const s=new Pm(ge(ue({},r.rtcApi),{token:i.token,log:r.log})),o=new Im(s);yield o.connect();const l=(d,m)=>new Dm(d,s,m,r.rtcApi);return new Fc(i.appId,r,o,l)})}updateAuthToken(i){return M(this,null,function*(){yield this.apiClient.updateAuthToken(i)})}getServerUnixtimeInMs(){return M(this,null,function*(){return this.apiClient.getServerUnixtime(this.appId)})}getServerUnixtimeInSec(){return M(this,null,function*(){return Math.floor((yield this.getServerUnixtimeInMs())/1e3)})}createChannel(){return M(this,arguments,function*(i={}){fi.debug("[start] apiClient.createChannel",{init:i});const r=yield this.apiClient.createChannel(this.appId,i).catch(o=>{throw fi.debug("[failed] apiClient.createChannel",{init:i,e:o}),o});return fi.debug("[end] apiClient.createChannel",{init:i,channelDto:r}),vs(this.appId,this._eventObserverFactory(this.appId,r),this.apiClient,r,this.config)})}findChannel(i){return M(this,null,function*(){fi.debug("[start] apiClient.getChannel",{query:i});const r=yield this.apiClient.getChannel(this.appId,i).catch(o=>{throw fi.debug("[failed] apiClient.getChannel",{query:i,e:o}),o}),s=vs(this.appId,this._eventObserverFactory(this.appId,r),this.apiClient,r,this.config);return fi.debug("[end] apiClient.getChannel",{channelId:s.id}),s})}findOrCreateChannel(i){return M(this,null,function*(){fi.debug("[start] apiClient.findOrCreateChannel",{query:i});const r=yield this.apiClient.findOrCreateChannel(this.appId,i).catch(o=>{throw fi.debug("[failed] apiClient.findOrCreateChannel",{query:i,e:o}),o});return fi.debug("[end] apiClient.findOrCreateChannel",{query:i}),vs(this.appId,this._eventObserverFactory(this.appId,r),this.apiClient,r,this.config)})}deleteChannel(i){return this.apiClient.deleteChannel(this.appId,i)}close(){this.closed||(this.closed=!0,fi.debug("closed",{appid:this.appId}),this.apiClient.close())}};Z();Z();var km={};Z();var Je=new Ie("packages/rtc-api-client/src/domain/channel.ts"),Om=class{constructor(e,{id:i,name:r,members:s,metadata:o,publications:l,subscriptions:d,version:m},C,h,v){this.appId=e,this.eventObserver=C,this.apiClient=h,this.config=v,this.disposed=!1,this._events=new Ti,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.updateChannelMetadata=D=>new Promise((E,R)=>{let b=!1;this.apiClient.updateChannelMetadata(this.appId,this.id,D).catch(H=>{b=!0,R(H)}),this.onMetadataUpdated.watch(H=>H.channel.metadata===D).then(()=>E()).catch(H=>{b||R(Fe({operationName:"ChannelImpl.updateChannelMetadata",info:ge(ue({},Ae.timeout),{detail:"onMetadataUpdated"}),path:Je.prefix,error:H,appId:this.appId,channelId:this.id}))})}),this.leave=(D,E)=>new Promise((R,b)=>{let H=!1;this.apiClient.leave(this.appId,D,E).catch(j=>{H=!0,b(j)}),this.onMemberLeft.watch(j=>j.member.id===E,this.config.rtcApi.timeout).then(()=>R()).catch(j=>{H||b(Fe({operationName:"ChannelImpl.leave",info:ge(ue({},Ae.timeout),{detail:"onMemberLeft"}),path:Je.prefix,error:j,appId:this.appId,channelId:this.id}))})}),this.updateMemberMetadata=(D,E)=>new Promise((R,b)=>{let H=!1;this.apiClient.updateMemberMetadata(this.appId,this.id,D,E).catch(j=>{H=!0,b(j)}),this.onMemberMetadataUpdated.watch(j=>j.member.id===D&&j.member.metadata===E).then(()=>R()).catch(j=>{H||b(Fe({operationName:"ChannelImpl.updateMemberMetadata",info:ge(ue({},Ae.timeout),{detail:"onMemberMetadataUpdated"}),path:Je.prefix,error:j,appId:this.appId,channelId:this.id}))})}),this.unpublish=D=>new Promise((E,R)=>{let b=!1;this.apiClient.unpublish(this.appId,this.id,D).catch(H=>{b=!0,R(H)}),this.onStreamUnpublished.watch(H=>H.publication.id===D).then(()=>E()).catch(H=>{b||R(Fe({operationName:"ChannelImpl.unpublish",info:ge(ue({},Ae.timeout),{detail:"onStreamUnpublished"}),path:Je.prefix,error:H,payload:{publicationId:D},appId:this.appId,channelId:this.id}))})}),this.updatePublicationMetadata=(D,E)=>new Promise((R,b)=>{let H=!1;this.apiClient.updatePublicationMetadata(this.appId,this.id,D,E).catch(j=>{H=!0,b(j)}),this.onPublicationMetadataUpdated.watch(j=>j.publication.id===D&&j.publication.metadata===E).then(()=>R()).catch(j=>{H||b(Fe({operationName:"ChannelImpl.updatePublicationMetadata",info:ge(ue({},Ae.timeout),{detail:"onPublicationMetadataUpdated"}),path:Je.prefix,error:j,payload:{publicationId:D},appId:this.appId,channelId:this.id}))})}),this.disablePublication=D=>new Promise((E,R)=>{let b=!1;this.apiClient.disablePublication(this.appId,this.id,D).catch(H=>{b=!0,R(H)}),this.onPublicationDisabled.watch(H=>H.publication.id===D).then(()=>E()).catch(H=>{b||R(Fe({operationName:"ChannelImpl.disablePublication",info:ge(ue({},Ae.timeout),{detail:"onPublicationDisabled"}),path:Je.prefix,error:H,payload:{publicationId:D},appId:this.appId,channelId:this.id}))})}),this.enablePublication=D=>new Promise((E,R)=>{let b=!1;this.apiClient.enablePublication(this.appId,this.id,D).catch(H=>{b=!0,R(H)}),this.onPublicationEnabled.watch(H=>H.publication.id===D).then(()=>E()).catch(H=>{b||R(Fe({operationName:"ChannelImpl.enablePublication",info:ge(ue({},Ae.timeout),{detail:"onPublicationEnabled"}),path:Je.prefix,error:H,payload:{publicationId:D},appId:this.appId,channelId:this.id}))})}),this.unsubscribe=D=>new Promise((E,R)=>{let b=!1;this.apiClient.unsubscribe(this.appId,this.id,D).catch(H=>{b=!0,R(H)}),this.onPublicationUnsubscribed.watch(H=>H.subscription.id===D).then(()=>E()).catch(H=>{b||R(Fe({operationName:"ChannelImpl.unsubscribe",info:ge(ue({},Ae.timeout),{detail:"onPublicationUnsubscribed"}),path:Je.prefix,error:H,payload:{subscriptionId:D},appId:this.appId,channelId:this.id}))})}),this.id=i,this.name=r,this.metadata=o,this.members=s,this.publications=l,this.subscriptions=d,this.version=m,C.onEvent.add(D=>{Je.debug("received event: ",D),this.version=D.data.channel.version;try{switch(D.type){case"ChannelDeleted":this._channelClosed();break;case"ChannelMetadataUpdated":this._channelMetadataUpdated(D.data);break;case"MemberAdded":this._memberJoined(D.data);break;case"MemberRemoved":this._memberLeft(D.data);break;case"MemberMetadataUpdated":this._memberMetadataUpdated(D.data);break;case"StreamPublished":this._streamPublished(D.data);break;case"StreamUnpublished":this._streamUnpublished(D.data);break;case"PublicationMetadataUpdated":this._publicationMetadataUpdated(D.data);break;case"PublicationDisabled":this._publicationDisabled(D.data);break;case"PublicationEnabled":this._publicationEnabled(D.data);break;case"StreamSubscribed":this._streamSubscribed(D.data);break;case"StreamUnsubscribed":this._streamUnsubscribed(D.data);break}}catch(E){Je.error(E)}}),h.onClose.once(()=>{this.dispose()})}getMember(e){return this.members.find(i=>i.id===e)}addMember(e){const i=this.getMember(e.id);return i||(this.members.push(e),e)}deleteMember(e){this.members=this.members.filter(i=>i.id!==e)}getPublication(e){return this.publications.find(i=>i.id===e)}addPublication(e){var i,r;const s=this.getPublication(e.id);if(s)return s;const o=ge(ue({},e),{channelId:this.id,codecCapabilities:(i=e.codecCapabilities)!=null?i:[],encodings:(r=e.encodings)!=null?r:[]});return this.publications.push(o),o}deletePublication(e){this.publications=this.publications.filter(i=>i.id!==e)}getSubscription(e){return this.subscriptions.find(i=>i.id===e)}addSubscription(e){const i=this.getSubscription(e.id);if(i)return i;const r=this.getPublication(e.publicationId),s=ge(ue({},e),{channelId:this.id,publisherId:r.publisherId,contentType:r.contentType});return this.subscriptions.push(s),s}deleteSubscription(e){this.subscriptions=this.subscriptions.filter(i=>i.id!==e)}_channelClosed(){this.onClosed.emit({})}_channelMetadataUpdated(e){this.metadata=e.channel.metadata,this.onMetadataUpdated.emit(e)}_memberJoined(e){this.addMember(e.member),this.onMemberJoined.emit(e),this.onMemberListChanged.emit({})}_memberLeft(e){const i=this.getMember(e.member.id);if(!i)throw Fe({operationName:"ChannelImpl._memberLeft",info:Ae.memberNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deleteMember(i.id),this.onMemberLeft.emit({member:i}),this.onMemberListChanged.emit({})}_memberMetadataUpdated(e){const i=this.getMember(e.member.id);if(!i)throw Fe({operationName:"ChannelImpl._memberMetadataUpdated",info:Ae.memberNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});i.metadata=e.member.metadata,this.onMemberMetadataUpdated.emit(e)}_streamPublished(e){const i=this.addPublication(e.publication),r=ge(ue({},e),{publication:i});this.onStreamPublished.emit(r),this.onPublicationListChanged.emit({})}_streamUnpublished(e){const i=this.getPublication(e.publication.id);if(!i)throw Fe({operationName:"ChannelImpl._streamUnpublished",info:Ae.publicationNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deletePublication(i.id);const r=ge(ue({},e),{publication:i});this.onStreamUnpublished.emit(r),this.onPublicationListChanged.emit({})}_publicationMetadataUpdated(e){const i=this.getPublication(e.publication.id);if(!i)throw Fe({operationName:"ChannelImpl._publicationMetadataUpdated",info:Ae.publicationNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});i.metadata=e.publication.metadata;const r=ge(ue({},e),{publication:i});this.onPublicationMetadataUpdated.emit(r)}_publicationDisabled(e){const i=this.getPublication(e.publication.id);if(!i)throw Fe({operationName:"ChannelImpl._publicationDisabled",info:Ae.publicationNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});i.isEnabled=e.publication.isEnabled;const r={publication:i};this.onPublicationDisabled.emit(r)}_publicationEnabled(e){const i=this.getPublication(e.publication.id);if(!i)throw Fe({operationName:"ChannelImpl._publicationEnabled",info:Ae.publicationNotFound,path:Je.prefix,payload:{event:km},appId:this.appId,channelId:this.id});i.isEnabled=e.publication.isEnabled;const r={publication:i};this.onPublicationEnabled.emit(r)}_streamSubscribed(e){const i=this.addSubscription(e.subscription),r=ge(ue({},e),{subscription:i});this.onPublicationSubscribed.emit(r),this.onSubscriptionListChanged.emit({})}_streamUnsubscribed(e){const i=this.getSubscription(e.subscription.id);if(!i)throw Fe({operationName:"ChannelImpl._streamUnsubscribed",info:Ae.subscriptionNotFound,path:Je.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deleteSubscription(i.id);const r=ge(ue({},e),{subscription:i});this.onPublicationUnsubscribed.emit(r),this.onSubscriptionListChanged.emit({})}joinChannel(e){return M(this,null,function*(){var i;e.type&&(e.type=e.type[0].toUpperCase()+e.type.slice(1)),e.subtype&&(e.subtype=e.subtype[0].toUpperCase()+e.subtype.slice(1)),Je.debug("[start] joinChannel",{memberInit:e});const r=yield this.apiClient.join(this.appId,this.id,ue({},e)),s=(i=this.getMember(r.id))!=null?i:(yield this.onMemberJoined.watch(o=>o.member.id===r.id,this.config.rtcApi.timeout).catch(o=>{throw Fe({operationName:"ChannelImpl.joinChannel",info:ge(ue({},Ae.timeout),{detail:"onMemberJoined"}),path:Je.prefix,error:o,appId:this.appId,channelId:this.id})})).member;return Je.debug("[end] joinChannel",{member:s}),s})}updateMemberTtl(e,i){return this.apiClient.updateMemberTtl(this.appId,this.id,e,i)}publish(e){return M(this,null,function*(){var i,r,s;const o=Je.debug("[start] apiClient.publish",{init:e}),l=this.id,d=yield this.apiClient.publish(this.appId,ge(ue({},e),{channel:l})),m={id:d,channelId:l,publisherId:e.publisher,origin:e.origin,contentType:e.contentType,metadata:e.metadata,codecCapabilities:(i=e.codecCapabilities)!=null?i:[],encodings:(r=e.encodings)!=null?r:[],isEnabled:(s=e.isEnabled)!=null?s:!0};Je.elapsed(o,"[ongoing] apiClient.publish",{publicationDto:m});const C=this.getPublication(d);if(C)return C;const{publication:h}=yield this.onStreamPublished.watch(v=>v.publication.id===d,this.config.rtcApi.timeout).catch(v=>{throw Fe({operationName:"ChannelImpl.publish",info:ge(ue({},Ae.timeout),{detail:"onStreamPublished"}),path:Je.prefix,error:v,payload:{publicationDto:m},appId:this.appId,channelId:this.id})});return Je.elapsed(o,"[end] apiClient.publish",{publicationDto:m}),h})}subscribe(e){return M(this,null,function*(){const i=Je.debug("[start] apiClient.subscribe",{init:e}),r=yield this.apiClient.subscribe(this.appId,ge(ue({},e),{channel:this})),s={id:r,publicationId:e.publication.id,channelId:this.id,publisherId:e.publication.publisherId,subscriberId:e.subscriber.id,contentType:e.publication.contentType};Je.elapsed(i,"[ongoing] apiClient.subscribe",{subscriptionDto:s});const o=this.getSubscription(r);if(o)return Je.elapsed(i,"[end] apiClient.subscribe",{subscriptionDto:s}),o;const{subscription:l}=yield this.onPublicationSubscribed.watch(d=>d.subscription.id===r,this.config.rtcApi.timeout).catch(d=>{throw Je.elapsed(i,"[fail] apiClient.subscribe",d),Fe({operationName:"ChannelImpl.subscribe",info:ge(ue({},Ae.timeout),{detail:"onPublicationSubscribed"}),path:Je.prefix,error:d,payload:{subscriptionDto:s}})});return Je.elapsed(i,"[end] apiClient.subscribe",{subscriptionDto:s}),l})}close(){return this.apiClient.deleteChannel(this.appId,this.id)}dispose(){this.disposed||(this.disposed=!0,Je.debug("disposed",{id:this.id}),this.eventObserver.dispose(),this._events.dispose())}};function vs(e,i,r,s,o){return new Om(e,s,i,r,o)}Z();var Mm=$t(uo()),Nm=class{constructor(e={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.iceParamServer={domain:"ice-params.skyway.ntt.com",version:1,secure:!0},this.signalingService={domain:"signaling.skyway.ntt.com",secure:!0},this.analyticsService={domain:"analytics-logging.skyway.ntt.com",secure:!0},this.rtcConfig={timeout:3e4,turnPolicy:"enable",turnProtocol:"all",encodedInsertableStreams:!1,iceDisconnectBufferTimeout:5e3},this.token={updateReminderSec:30},this.log={level:"error",format:"string"},this.internal={disableDPlane:!1},this.member={keepaliveIntervalGapSec:30,keepaliveIntervalSec:30},Object.assign(this,(0,Mm.default)(this,e))}};Z();Z();var Js=class{constructor(){this._onContextAttached=new De}_attachContext(e){this._context=e,this._onContextAttached.emit(e)}};Z();var Lm=new Ie("packages/core/src/plugin/internal/person/connection/messageBuffer.ts"),jm=class{constructor(e){this.signaling=e,this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set,this._disposer=new ei,this.signaling.onMessage.add(i=>{const r=i.src.id+i.src.name;this._excludeConnectionIndicateBuffering.has(r)||(this._indicateMessageBuffer[r]||(this._indicateMessageBuffer[r]=[]),this._indicateMessageBuffer[r].push(i))}).disposer(this._disposer)}resolveMessagingBuffer({id:e,name:i}){const r=e+i,s=this._indicateMessageBuffer[r];(s==null?void 0:s.length)>0&&(Lm.debug("resolveMessagingBuffer",{length:s.length}),s.forEach(o=>{this.signaling.onMessage.emit(o)}),delete this._indicateMessageBuffer[r]),this._excludeConnectionIndicateBuffering.add(r)}close(){this._disposer.dispose(),this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set}};Z();Z();Z();var Ir=$t(Ft());Z();Z();Z();Z();var kc=class{constructor(e,i){this.id=e,this.contentType=i,this.side="remote",this.onConnectionStateChanged=new De,this._onConnectionStateChanged=new De,this._connectionState="new",this._getTransport=()=>{},this.getStats=()=>this._getStats(),this._getStats=()=>M(this,null,function*(){return[]}),this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setConnectionState(e){this._connectionState!==e&&(this._connectionState=e,this._onConnectionStateChanged.emit(e))}getRTCPeerConnection(){return this._getRTCPeerConnection()}_getRTCPeerConnection(){var e;return(e=this._getTransport())==null?void 0:e.rtcPeerConnection}getConnectionState(){return this._getConnectionState()}_getConnectionState(){return this._connectionState}toJSON(){return{contentType:this.contentType,id:this.id,codec:this.codec,side:this.side}}},Oc=class extends kc{constructor(e,i,r){super(e,i),this.id=e,this.contentType=i,this.track=r}get isEnabled(){return this.track.enabled}setIsEnabled(e){this.track.enabled=e}attach(e){this._element=e,Cc(e,this.track)}detach(){this._element&&(xc(this._element,this.track),this._element=void 0)}},Bm=class extends Oc{constructor(e,i){super(e,"audio",i),this.track=i,this.contentType="audio"}};Z();var Hm=class extends kc{constructor(e,i){super(e,"data"),this._datachannel=i,this._isEnabled=!0,this.contentType="data",this.onData=new De,i.onmessage=({data:r})=>{this.isEnabled&&(typeof r=="string"&&r.includes(As)&&(r=JSON.parse(r.slice(As.length))),this.onData.emit(r))}}get isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}};Z();var Um=class extends Oc{constructor(e,i){super(e,"video",i),this.track=i,this.contentType="video"}},qm=new Ie("packages/core/src/media/stream/remote/factory.ts"),ks=(e,i,r)=>{if(i instanceof RTCDataChannel){const s=new Hm(e,i);return s.codec=r,s}else if(i.kind==="audio"){const s=new Bm(e,i);return s.codec=r,s}else if(i.kind==="video"){const s=new Um(e,i);return s.codec=r,s}throw Se({operationName:"createRemoteStream",path:qm.prefix,info:ge(ue({},Pe.invalidArgumentValue),{detail:"invalid stream type"})})};Z();var Vm=new Ie("packages/core/src/plugin/internal/person/util.ts"),Mr=(e,i)=>M(void 0,null,function*(){const r=Vm.createBlock({label:"setEncodingParams"}),s=e.getParameters();r.debug("getParameters",{params:s,newEncodings:i}),s.encodings==null&&(s.encodings=[]),s.encodings=i.map((o,l)=>ue(ue({},s.encodings[l]||{}),o)),yield e.setParameters(s)}),Mc=()=>Na()==="Safari12"||Na()==="Safari11";function Km(e){switch(e){case"closed":case"disconnected":case"failed":return"disconnected";case"connected":return"connected";case"connecting":return"connecting";case"new":return"new";case"reconnecting":return"reconnecting"}}var zm=e=>{const i=[];return e.forEach(r=>{i.push(JSON.parse(JSON.stringify(r)))}),i};Z();var Nc=class Lc{constructor(i,r){this.publicationId=i,this.streamId=r}static fromLabel(i){const{p:r,s}=JSON.parse(i);return new Lc(r,s)}toLabel(){return JSON.stringify({p:this.publicationId,s:this.streamId})}};Z();var mi=new Ie("packages/core/src/plugin/internal/person/connection/peer.ts"),jc=class{constructor(e,i,r,s,o,l,d){this._context=e,this._iceManager=i,this.signaling=r,this.analytics=s,this.localPerson=o,this.endpoint=l,this.role=d,this._pendingCandidates=[],this.pc=new RTCPeerConnection(ge(ue({},this._context.config.rtcConfig),{iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,iceServers:this._iceManager.iceServers})),this.onSignalingStateChanged=new De,this.onPeerConnectionStateChanged=new De,this.onDisconnect=new De,this.connected=!1,this.disconnected=!1,this.rtcPeerConnectionId=Ur(),this._onICECandidate=h=>M(this,null,function*(){if(h.candidate==null||h.candidate===""||this.pc.connectionState==="closed")return;const v={kind:"iceCandidateMessage",payload:{candidate:h.candidate,role:this.role}};mi.debug("[start] send candidate",{message:v,localPerson:this.localPerson}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidate",data:{candidate:JSON.stringify(h.candidate)},createdAt:Date.now()});try{yield this.signaling.send(this.endpoint,v),mi.debug("[end] send candidate",{message:v,localPerson:this.localPerson})}catch(D){mi.warn("[failed] send candidate",vt({operationName:"Peer._onICECandidate",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{message:v}}),D)}}),this._onICECandidateError=h=>M(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidateError",data:{event:JSON.stringify(h)},createdAt:Date.now()})}),this._onIceGatheringStateChange=h=>M(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const v=this.pc.iceGatheringState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceGatheringStateChange",data:{event:v},createdAt:Date.now()})}}),this._onConnectionStateChange=()=>M(this,null,function*(){const h=this.pc.connectionState;switch(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"connectionStateChange",data:{connectionState:h},createdAt:Date.now()}),h){case"connected":this.connected=!0,this._pendingCandidates=[];break}this.onPeerConnectionStateChanged.emit(this.pc.connectionState)}),this._onIceConnectionStateChange=()=>M(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const h=this.pc.iceConnectionState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceConnectionStateChange",data:{iceConnectionState:h},createdAt:Date.now()})}}),this._onSignalingStateChange=()=>M(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const h=this.pc.signalingState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"signalingStateChange",data:{signalingState:h},createdAt:Date.now()})}}),this.waitForSignalingState=(h,v=1e4)=>M(this,null,function*(){this.pc.signalingState!==h&&(yield this.onSignalingStateChanged.watch(()=>this.pc.signalingState===h,v).catch(D=>{throw Se({operationName:"Peer.waitForSignalingState",info:ge(ue({},Pe.timeout),{detail:"waitForSignalingState timeout"}),path:mi.prefix,context:this._context,channel:this.localPerson.channel,error:D})}))}),this.waitForConnectionState=(h,v=1e4)=>M(this,null,function*(){h!==this.pc.connectionState&&(yield this.onPeerConnectionStateChanged.watch(()=>h===this.pc.connectionState,v).catch(D=>{throw Se({operationName:"Peer.waitForConnectionState",info:ge(ue({},Pe.timeout),{detail:"waitForConnectionState timeout"}),path:mi.prefix,context:this._context,channel:this.localPerson.channel,error:D})}))}),this.waitForStats=h=>M(this,[h],function*({track:v,cb:D,interval:E,timeout:R,logging:b}){E??(E=100),R??(R=1e4);for(let H=0;;H+=E){if(H>=R)throw Se({operationName:"Peer.waitForStats",info:ge(ue({},Pe.timeout),{detail:"waitForStats timeout"}),path:mi.prefix,context:this._context,channel:this.localPerson.channel});const j=yield this.pc.getStats(v),k=zm(j);if(b&&mi.debug("Peer.waitForStats",k),D(k))break;yield new Promise(y=>setTimeout(y,E))}});var m;mi.debug("peerConfig",this.pc.getConfiguration()),this.setPeerConnectionListener();const C=(m=this.pc)==null?void 0:m.peerIdentity;C&&C.catch(h=>{mi.debug("firefox peerIdentity",h)})}setPeerConnectionListener(){this.pc.onicecandidate=this._onICECandidate,this.pc.onicecandidateerror=this._onICECandidateError,this.pc.onicegatheringstatechange=this._onIceGatheringStateChange,this.pc.onconnectionstatechange=this._onConnectionStateChange,this.pc.oniceconnectionstatechange=this._onIceConnectionStateChange,this.pc.onsignalingstatechange=()=>{this._onSignalingStateChange(),this.onSignalingStateChanged.emit(this.pc.signalingState)}}unSetPeerConnectionListener(){this.pc.onicecandidate=null,this.pc.onicecandidateerror=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null}handleCandidate(e){return M(this,null,function*(){this._pendingCandidates.push(e),this.pc.remoteDescription&&(yield this.resolveCandidates())})}resolveCandidates(){return M(this,null,function*(){const e=[...this._pendingCandidates];this._pendingCandidates=[],mi.debug("addIceCandidates",e),yield Promise.all(e.map(i=>{this.pc.signalingState!=="closed"&&this.pc.addIceCandidate(i).catch(r=>{mi.warn("[failed] add ice candidate",vt({operationName:"Peer.resolveCandidates",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{endpointId:this.endpoint.id}}),r)})}))})}},Li=new Ie("packages/core/src/plugin/internal/person/connection/receiver.ts"),Wm=class extends jc{constructor(e,i,r,s,o,l){super(e,i,r,s,o,l,"receiver"),this.id=Ii(),this.onConnectionStateChanged=new De,this.onStreamAdded=new De,this.onError=new De,this._connectionState="new",this._publicationInfo={},this.streams={},this._subscriptions={},this._promiseQueue=new Ui,this._disposer=new ei,this._log=Li.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._log.debug("spawned"),this.signaling.onMessage.add(d=>M(this,[d],function*({src:m,data:C}){if(!(m.id===l.id&&m.name===l.name))return;const h=C;switch(h.kind){case"senderProduceMessage":this._promiseQueue.push(()=>this._handleSenderProduce(h.payload)).catch(v=>this._log.error("handle senderProduceMessage failed",v,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderUnproduceMessage":this._promiseQueue.push(()=>this._handleSenderUnproduce(h.payload)).catch(v=>this._log.error("handle handleSenderUnproduce",v,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderRestartIceMessage":this._promiseQueue.push(()=>this._handleSenderRestartIce(h.payload)).catch(v=>this._log.error("_handleSenderRestartIce",v,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"iceCandidateMessage":{const{role:v,candidate:D}=h.payload;v==="sender"&&(yield this.handleCandidate(D))}break}})).disposer(this._disposer),this.pc.ontrack=d=>M(this,[d],function*({track:m,transceiver:C}){if(!C.mid)throw Se({operationName:"Receiver.pc.ontrack",info:ge(ue({},Pe.missingProperty),{detail:"mid missing"}),path:Li.prefix,context:this._context,channel:this.localPerson.channel});const h=Object.values(this._publicationInfo).find(R=>{var b;return R.mid===((b=C.mid)==null?void 0:b.toString())});if(!h){const R=Se({operationName:"Receiver.pc.ontrack",info:ge(ue({},Pe.notFound),{detail:"publicationInfo not found"}),path:Li.prefix,context:this._context,channel:o.channel,payload:{endpointId:this.endpoint.id,publicationInfo:this._publicationInfo,mid:C.mid}});this.onError.emit(R),this._log.error(R);return}const v=Ir.parse(this.pc.remoteDescription.sdp),D=this._getCodecFromSdp(v,C,m.kind),E=ks(h.streamId,m,D);E.codec=D,this._setupTransportAccessForStream(E),this.streams[h.publicationId]=E,this._log.debug("MediaStreamTrack added",h,m,D),this.onStreamAdded.emit({publicationId:h.publicationId,stream:E})}),this.pc.ondatachannel=d=>M(this,[d],function*({channel:m}){const{publicationId:C,streamId:h}=Nc.fromLabel(m.label),v={mimeType:"datachannel"},D=ks(h,m,v);this._setupTransportAccessForStream(D),this.streams[C]=D,this._log.debug("DataChannel added",C,m,v),this.onStreamAdded.emit({publicationId:C,stream:D})}),this.onPeerConnectionStateChanged.add(d=>{switch(d){case"connecting":case"connected":this._setConnectionState(d);break;case"failed":case"closed":this._setConnectionState("disconnected");break}}).disposer(this._disposer)}_setConnectionState(e){this._connectionState!==e&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,e),this._connectionState=e,this.onConnectionStateChanged.emit(e))}_setupTransportAccessForStream(e){e._getTransport=()=>({rtcPeerConnection:this.pc,connectionState:Km(this.pc.connectionState)}),e._getStats=()=>M(this,null,function*(){if(e.contentType==="data"){const s=yield this.pc.getStats();return mr(s)}const i=yield this.pc.getStats(e.track);return mr(i)}),this._disposer.push(()=>{e._getTransport=()=>{}}),this.onConnectionStateChanged.add(i=>{e._setConnectionState(i),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:i},createdAt:Date.now()})}).disposer(this._disposer)}_getCodecFromSdp(e,i,r){const s=e.media.find(v=>{var D,E;return((D=v.mid)==null?void 0:D.toString())===((E=i.mid)==null?void 0:E.toString())});if(!s)throw Se({operationName:"Receiver._getCodecFromSdp",info:ge(ue({},Pe.notFound),{detail:"m-line not exist"}),path:Li.prefix,context:this._context,channel:this.localPerson.channel});const o=s.payloads.split(" ")[0],l=s.rtp.find(v=>v.payload.toString()===o),d=`${r}/${l.codec}`.toLowerCase();let m={};const C=s.fmtp.find(v=>v.payload.toString()===o);return C!=null&&C.config&&(m=yc(C.config)),{mimeType:d,parameters:m}}get hasMedia(){const e=Object.values(this.streams).length;return this._log.debug("hasMedia",{count:e}),e>0}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}add(e){this._subscriptions[e.id]=e}remove(e){const i=this._subscriptions[e];if(!i)return;delete this._subscriptions[i.id];const r=i.publication.id;this.streams[r]&&delete this.streams[r]}_validateRemoteOffer(e){const i=Ir.parse(e);this._log.debug("_validateRemoteOffer",{sdpObject:i});for(const r of i.media){if(r.direction==="inactive")continue;if(!Object.values(this._publicationInfo).find(o=>{var l;return((l=r.mid)==null?void 0:l.toString())===o.mid})){const o=Se({operationName:"Receiver._validateRemoteOffer",info:ge(ue({},Pe.notFound),{detail:"mismatch between sdp and state"}),path:Li.prefix,context:this._context,channel:this.localPerson.channel,payload:{sdpMedia:i.media,sdpMediaLine:r,info:this._publicationInfo}});throw this.onError.emit(o),o}}}get isWrongSignalingState(){return this.pc.signalingState==="have-local-offer"&&this.pc.remoteDescription||this.pc.signalingState==="have-remote-offer"}_handleSenderProduce(e){return M(this,arguments,function*({sdp:i,publicationId:r,info:s}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("_handleSenderProduce wait for be stable",vt({operationName:"Receiver._handleSenderProduce",channel:this.localPerson.channel,detail:"_handleSenderProduce wait for be stable",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderProduce({sdp:i,publicationId:r,info:s});return}throw Se({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:ge(ue({},Pe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Li.prefix})}this._log.debug("_handleSenderProduce",{info:s,publicationId:r,publicationInfo:Object.values(this._publicationInfo)}),this._publicationInfo[s.publicationId]=s,this._validateRemoteOffer(i.sdp),yield this.sendAnswer(i),yield this.resolveCandidates()}})}_handleSenderUnproduce(e){return M(this,arguments,function*({sdp:i,publicationId:r}){if(this.pc.signalingState==="closed"){this._log.warn("signalingState closed",vt({channel:this.localPerson.channel,detail:"signalingState closed",operationName:"Receiver._handleSenderUnproduce"}));return}if(this._log.debug("<handleSenderUnproduce> start",{sdp:i,publicationId:r}),this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",vt({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderUnproduce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderUnproduce({sdp:i,publicationId:r});return}throw Se({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:ge(ue({},Pe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Li.prefix})}delete this._publicationInfo[r],yield this.sendAnswer(i),yield this.resolveCandidates(),this._log.debug("<handleSenderUnproduce> end",{publicationId:r})})}_handleSenderRestartIce(e){return M(this,arguments,function*({sdp:i}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",vt({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderRestartIce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderRestartIce({sdp:i});return}throw Se({operationName:"Receiver._handleSenderRestartIce",context:this._context,channel:this.localPerson.channel,info:ge(ue({},Pe.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Li.prefix})}this._setConnectionState("reconnecting"),yield this.sendAnswer(i),yield this.resolveCandidates(),this.pc.connectionState==="connected"&&this._setConnectionState("connected")}})}sendAnswer(e){return M(this,null,function*(){this._log.debug("[receiver] start: sendAnswer"),yield this.pc.setRemoteDescription(e);const i=yield this.pc.createAnswer();this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"answer",data:{answer:JSON.stringify(i)},createdAt:Date.now()});const r=Ir.parse(this.pc.remoteDescription.sdp),s=Ir.parse(i.sdp);r.media.forEach((d,m)=>{const C=s.media[m];C.fmtp=Mf(C.fmtp).map(h=>{const v=d.fmtp.find(D=>D.payload===h.payload);return v||h})});const o=Ir.write(s);yield this.pc.setLocalDescription({type:"answer",sdp:o});const l={kind:"receiverAnswerMessage",payload:{sdp:this.pc.localDescription}};yield this.signaling.send(this.endpoint,l).catch(d=>this._log.error("failed to send answer",d,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id})),this._log.debug("[receiver] end: sendAnswer")})}get subscriptions(){return this._subscriptions}};Z();var $m=$t(wo()),Wa=$t(Ft()),jt=new Ie("packages/core/src/plugin/internal/person/connection/sender.ts"),Gm=class extends jc{constructor(e,i,r,s,o,l){super(e,i,r,s,o,l,"sender"),this.id=Ii(),this.onConnectionStateChanged=new De,this.publications={},this.transceivers={},this.datachannels={},this._pendingPublications=[],this._isNegotiating=!1,this.promiseQueue=new Ui,this._disposer=new ei,this._ms=new MediaStream,this._backoffIceRestarted=new vi({times:8,interval:100,jitter:100}),this._connectionState="new",this._log=jt.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._unsubscribeStreamEnableChange={},this._cleanupStreamCallbacks={},this.restartIce=()=>M(this,null,function*(){if(this._backoffIceRestarted.exceeded){this._log.error(Se({operationName:"Sender.restartIce",context:this._context,channel:this.localPerson.channel,info:ge(ue({},Pe.internal),{detail:"restartIce limit exceeded"}),path:jt.prefix})),this._setConnectionState("disconnected");return}this._log.warn("[start] restartIce",vt({operationName:"Sender.restartIce",detail:"start restartIce",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}));const d=()=>{if(this.endpoint.state==="left")return this._log.warn("endpointMemberLeft",vt({operationName:"restartIce",detail:"endpointMemberLeft",channel:this.localPerson.channel,payload:{endpointId:this.endpoint.id}})),this._setConnectionState("disconnected"),!0;if(this.pc.connectionState==="connected")return this._log.warn("[end] restartIce",vt({operationName:"restartIce",detail:"reconnected",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),this._backoffIceRestarted.reset(),this._setConnectionState("connected"),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestarted.wait(),d())return;let m=yield this._iceManager.updateIceParams().catch(v=>v);if(m){this._log.warn("[failed] restartIce",vt({operationName:"restartIce",detail:"update IceParams failed",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),m),yield this.restartIce();return}if(this.pc.setConfiguration&&(this.pc.setConfiguration(ge(ue({},this.pc.getConfiguration()),{iceServers:this._iceManager.iceServers})),this._log.debug("<restartIce> setConfiguration",{iceServers:this._iceManager.iceServers})),d())return;if(this.signaling.connectionState!=="connected"){if(this._log.warn("<restartIce> reconnect signaling service",vt({operationName:"restartIce",detail:"reconnect signaling service",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),m=yield this.signaling.onConnectionStateChanged.watch(v=>v==="connected",1e4).catch(v=>v).then(()=>{}),m instanceof Ai){yield this.restartIce();return}if(d())return}const C=yield this.pc.createOffer({iceRestart:!0});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(C)},createdAt:Date.now()}),yield this.pc.setLocalDescription(C);const h={kind:"senderRestartIceMessage",payload:{sdp:this.pc.localDescription}};if(m=yield this.signaling.send(this.endpoint,h,1e4).catch(v=>v),m){this._log.warn("<restartIce> [failed]",vt({operationName:"restartIce",detail:"timeout send signaling message",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),m),yield this.restartIce();return}m=yield this.waitForConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(v=>v),!(!m&&d())&&(yield this.restartIce())}),this._log.debug("spawned"),this.signaling.onMessage.add(d=>M(this,[d],function*({src:m,data:C}){if(!(m.id===l.id&&m.name===l.name))return;const h=C;switch(h.kind){case"receiverAnswerMessage":this.promiseQueue.push(()=>this._handleReceiverAnswer(h.payload)).catch(v=>this._log.error("handle receiverAnswerMessage",{localPersonId:this.localPerson.id,endpointId:this.endpoint.id,err:v}));break;case"iceCandidateMessage":{const{role:v,candidate:D}=h.payload;v==="receiver"&&(yield this.handleCandidate(D))}break}})).disposer(this._disposer),this.onPeerConnectionStateChanged.add(d=>M(this,null,function*(){try{switch(jt.debug("onPeerConnectionStateChanged",{state:d}),d){case"disconnected":case"failed":(yield this.waitForConnectionState("connected",e.config.rtcConfig.iceDisconnectBufferTimeout).catch(C=>C))&&this._connectionState!=="reconnecting"&&(yield this.restartIce());break;case"connecting":case"connected":this._setConnectionState(d);break;case"closed":this._setConnectionState("disconnected");break}}catch(m){jt.error("onPeerConnectionStateChanged",m,this.id)}})).disposer(this._disposer)}_setConnectionState(e){this._connectionState!==e&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,e),this._connectionState=e,this.onConnectionStateChanged.emit(e))}get hasMedia(){const e=Object.keys(this.publications).length;return this._log.debug("hasMedia",{count:e}),e>0}_getMid(e,i){if(e.contentType==="data"){const r=i.media.find(s=>s.type==="application");if((r==null?void 0:r.mid)==null)throw Se({operationName:"Sender._getMid",info:ge(ue({},Pe.missingProperty),{detail:"datachannel mid undefined"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel});return r.mid.toString()}else{const s=this.transceivers[e.id].mid;if(s==null)throw Se({operationName:"Sender._getMid",info:ge(ue({},Pe.missingProperty),{detail:"media mid undefined"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel});return s.toString()}}_listenStreamEnableChange(e,i){this._unsubscribeStreamEnableChange[i]&&this._unsubscribeStreamEnableChange[i]();const{removeListener:r}=e._onEnableChanged.add(s=>M(this,null,function*(){yield this._replaceTrack(i,s).catch(o=>{jt.warn(vt({member:this.localPerson,detail:"_replaceTrack failed",operationName:"Sender._listenStreamEnableChange",payload:o}))})}));this._unsubscribeStreamEnableChange[i]=r}add(e){return M(this,null,function*(){var i,r;if(this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(e),this._log.debug("<add> isNegotiating",{publication:e,isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState,pendingPublications:this._pendingPublications.length});return}this._isNegotiating=!0,this._log.debug("<add> add publication",{publication:e}),this.publications[e.id]=e;const s=e.stream;if(!s)throw Se({operationName:"Sender.add",info:ge(ue({},Pe.missingProperty),{detail:"<add> stream not found"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel});if(this._cleanupStreamCallbacks[s.id]=this._setupTransportAccessForStream(s),s.contentType==="data"){const C=this.pc.createDataChannel(new Nc(e.id,s.id).toLabel(),s.options);s._onWriteData.add(h=>{C.readyState==="open"&&C.send(h)}).disposer(this._disposer),this.datachannels[e.id]=C}else{e._onReplaceStream.add(h=>M(this,[h],function*({newStream:v,oldStream:D}){v._replacingTrack=!0,this._listenStreamEnableChange(v,e.id),this._cleanupStreamCallbacks[D.id]&&this._cleanupStreamCallbacks[D.id](),this._cleanupStreamCallbacks[v.id]=this._setupTransportAccessForStream(v),yield this._replaceTrack(e.id,v.track),v._replacingTrack=!1,v._onReplacingTrackDone.emit()})).disposer(this._disposer),this._listenStreamEnableChange(s,e.id);const C=this.pc.addTransceiver(s.track,{direction:"sendonly",streams:[this._ms]});e._onEncodingsChanged.add(h=>M(this,null,function*(){yield Mr(C.sender,h).catch(v=>{this._log.error("_onEncodingsChanged failed",v)})})).disposer(this._disposer),this.transceivers[e.id]=C}const o=yield this.pc.createOffer().catch(C=>{throw Se({operationName:"Sender.add",info:ge(ue({},Pe.internal),{detail:"can't create offer"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel,error:C})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(o)},createdAt:Date.now()}),yield this.pc.setLocalDescription(o);const l=Wa.parse(this.pc.localDescription.sdp);this._log.debug("<add> create offer base",l);const d=this._getMid(e,l);if(e.contentType!=="data"){Jm((i=e.codecCapabilities)!=null?i:[],d,l);const C=Wa.write(l);if(yield this.pc.setLocalDescription({type:"offer",sdp:C}),this._log.debug("<add> create offer",this.pc.localDescription),((r=e.encodings)==null?void 0:r.length)>0)if(Mc())this._safariSetupEncoding(e);else{const h=this.transceivers[e.id];yield Mr(h.sender,[e.encodings[0]])}}const m={kind:"senderProduceMessage",payload:{sdp:this.pc.localDescription,publicationId:e.id,info:{publicationId:e.id,streamId:s.id,mid:d}}};this._log.debug("[start] send message",m),yield this.signaling.send(this.endpoint,m).catch(C=>{throw this._log.error("[failed] send message :",C,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),C}),this._log.debug("[end] send message",m)})}_setupTransportAccessForStream(e){e._getTransportCallbacks[this.endpoint.id]=()=>({rtcPeerConnection:this.pc,connectionState:this._connectionState}),e._getStatsCallbacks[this.endpoint.id]=()=>M(this,null,function*(){if(e.contentType==="data"){const o=yield this.pc.getStats();return mr(o)}e._replacingTrack&&(yield e._onReplacingTrackDone.asPromise(200));const r=yield this.pc.getStats(e.track);return mr(r)});const i=()=>{delete e._getTransportCallbacks[this.endpoint.id],delete e._getStatsCallbacks[this.endpoint.id]};return this._disposer.push(()=>{i()}),this.onConnectionStateChanged.add(r=>{e._setConnectionState(this.endpoint,r),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:r},createdAt:Date.now()})}).disposer(this._disposer),i}remove(e){return M(this,null,function*(){const i=this.publications[e];if(!i){this._log.warn("<remove> publication not found",vt({operationName:"Sender.remove",detail:"publication already removed",channel:this.localPerson.channel,payload:{publicationId:e}}));return}if(delete this.publications[e],this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(e),this._log.debug("<remove> isNegotiating",{publicationId:e,_isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState});return}this._isNegotiating=!0,this._log.debug("<remove> [start]",{publicationId:e});const r=i.stream;if(!r)throw Se({operationName:"Sender.remove",info:ge(ue({},Pe.missingProperty),{detail:"<remove> publication not have stream"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel,payload:{publication:i}});r.contentType==="data"?(this.datachannels[e].close(),delete this.datachannels[e]):(this.transceivers[e].stop(),delete this.transceivers[e]);const s=yield this.pc.createOffer().catch(l=>{throw Se({operationName:"Sender.remove",info:ge(ue({},Pe.internal),{detail:"<remove> can't create offer"}),path:jt.prefix,context:this._context,channel:this.localPerson.channel,error:l})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(s)},createdAt:Date.now()}),yield this.pc.setLocalDescription(s);const o={kind:"senderUnproduceMessage",payload:{sdp:this.pc.localDescription,publicationId:e}};this._log.debug("<remove> send message",{message:o}),yield this.signaling.send(this.endpoint,o).catch(l=>{throw this._log.error("<remove> in remote error :",l,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),l}),this._log.debug("<remove> [end]",{publicationId:e})})}_replaceTrack(e,i){return M(this,null,function*(){const r=this.transceivers[e];if(!r){this._log.warn("can't replace track, transceiver not found",vt({operationName:"Sender._replaceTrack",detail:"transceiver already removed",channel:this.localPerson.channel,payload:{publicationId:e}}));return}yield r.sender.replaceTrack(i).catch(s=>{throw Se({operationName:"Sender._replaceTrack",context:this._context,info:Pe.internal,error:s,path:jt.prefix,channel:this.localPerson.channel})})})}_handleReceiverAnswer(e){return M(this,arguments,function*({sdp:i}){this.pc.signalingState!=="closed"&&(this._log.debug("<handleReceiverAnswer> [start]"),yield this.pc.setRemoteDescription(new RTCSessionDescription(i)).catch(r=>{const s=Se({operationName:"Sender._handleReceiverAnswer",context:this._context,info:ge(ue({},Pe.internal),{detail:"failed to setRemoteDescription"}),path:jt.prefix,payload:{sdp:i},channel:this.localPerson.channel,error:r});throw this._log.error(s),s}),this._log.debug("<handleReceiverAnswer> sRD"),yield this.resolveCandidates(),this._log.debug("<handleReceiverAnswer> resolveCandidates"),yield this.waitForSignalingState("stable"),this._log.debug("<handleReceiverAnswer> waitForSignalingState"),this._isNegotiating=!1,yield this._resolvePendingSender(),this._log.debug("<handleReceiverAnswer> _resolvePendingSender",this._pendingPublications.length),this._log.debug("<handleReceiverAnswer> [end]"))})}_safariSetupEncoding(e){const i=this.transceivers[e.id],r=e.stream;this.waitForStats({track:r.track,cb:s=>{const o=s.find(l=>l.id.includes("RTCOutboundRTP")||l.type.includes("outbound-rtp"));return(o==null?void 0:o.keyFramesEncoded)>0},interval:10,timeout:this._context.config.rtcConfig.timeout}).then(()=>{jt.debug("safari wait for stats resolved, setEncodingParams"),Mr(i.sender,[e.encodings[0]]).catch(s=>{this._log.error("setEncodingParams failed",s)})}).catch(s=>{this._log.error("waitForStats",s)})}_resolvePendingSender(){return M(this,null,function*(){const e=this._pendingPublications.shift();e&&(this._log.debug("resolve pending sender",{publication:e}),typeof e=="string"?yield this.remove(e):yield this.add(e))})}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),Object.values(this._unsubscribeStreamEnableChange).forEach(e=>e()),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}};function Jm(e,i,r){var s,o;const l=r.media.find(h=>{var v;return((v=h.mid)==null?void 0:v.toString())===i});if(!l)throw Se({operationName:"applyCodecCapabilities",info:ge(ue({},Pe.notFound),{detail:"media not found"}),path:jt.prefix});e.forEach(h=>{var v;if(h.parameters)for(const[D,E]of Object.entries((v=h.parameters)!=null?v:{})){if(E===!1||!h.parameters[D])return;D==="usedtx"&&E&&(h.parameters[D]=1)}});const d=(h,v,D)=>{var E;const R=v.map(j=>ge(ue({},j),{parameters:Bf(D,j.payload)})),b=$a(h.mimeType);return b&&(E=R.find(j=>{var k,y;return j.codec.toLowerCase()!==b.toLowerCase()?!1:Object.keys((k=h.parameters)!=null?k:{}).length===0||Xm(h.mimeType)==="audio"?!0:(0,$m.default)(j.parameters,(y=h.parameters)!=null?y:{})}))!=null?E:void 0},m=e.map(h=>d(h,l.rtp,l.fmtp)).filter(h=>h!=null),C=[...m,...l.rtp.filter(h=>!m.find(v=>v.payload===h.payload))];for(const h of l.fmtp){const v=h.payload,D=C.find(b=>b.payload===v);if(D){const b=e.find(H=>d(H,[D],l.fmtp));b&&b.parameters&&Object.keys(b.parameters).length>0&&(h.config="",Object.entries(b.parameters).forEach(([H,j])=>{j===!1||h.config.includes(H)||(h.config.length>0?h.config+=`;${H}=${j}`:h.config=`${H}=${j}`)}))}const E=C.find(b=>b.codec.toLowerCase()==="opus"),R=(o=(s=e.find(b=>$a(b.mimeType).toLowerCase()==="opus"))==null?void 0:s.parameters)==null?void 0:o.usedtx;E&&R!==!1&&h.payload===E.payload&&!h.config.includes("usedtx")&&(h.config.length>0?h.config+=";usedtx=1":h.config="usedtx=1")}l.payloads=C.map(h=>h.payload.toString()).join(" ")}var $a=e=>e.split("/")[1],Xm=e=>e.split("/")[0],ln=new Ie("packages/core/src/plugin/internal/person/connection/index.ts"),Qm=class{constructor(e,i,r,s,o,l,d){this._iceManager=e,this._signaling=i,this._analytics=r,this._context=s,this.channelId=o,this.localPerson=l,this.remoteMember=d,this.id=Ii(),this.type="p2p",this.onDisconnect=new De,this.onClose=new De,this.closed=!1,this.disconnected=!1,this._log=ln.createBlock({id:this.id,localPersonId:this.localPerson.id}),this._pubsubQueue=new Ui,this.sendSubscriptionStatsReportTimers=new Map,this._waitingSendSubscriptionStatsReportsFromPublish=new Map,this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.sender=new Gm(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.receiver=new Wm(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.sender.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this.receiver.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this._analytics&&this._analytics.onConnectionStateChanged.add(m=>{if(m==="connected"){if(this._waitingSendSubscriptionStatsReportsFromPublish.size>0){for(const[C,h]of this._waitingSendSubscriptionStatsReportsFromPublish){const v=this.sender.publications[h];v&&this.startSendSubscriptionStatsReportTimer(v,C)}this._waitingSendSubscriptionStatsReportsFromPublish.clear()}if(this._waitingSendSubscriptionStatsReportsFromSubscribe.length>0){for(const C of this._waitingSendSubscriptionStatsReportsFromSubscribe){const h=this.receiver.subscriptions[C];h&&this.startSendSubscriptionStatsReportTimer(h,C)}this._waitingSendSubscriptionStatsReportsFromSubscribe=[]}}})}startPublishing(e,i){return M(this,null,function*(){yield this._pubsubQueue.push(()=>M(this,null,function*(){this._log.debug("startPublishing",{publication:e}),yield this.sender.add(e)})),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:i,role:"sender",rtcPeerConnectionId:this.sender.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(e,i):this._waitingSendSubscriptionStatsReportsFromPublish.set(i,e.id))})}stopPublishing(e){return M(this,null,function*(){yield this._pubsubQueue.push(()=>M(this,null,function*(){this._log.debug("<stopPublishing> start",{publication:e}),this.sender.remove(e.id).then(()=>{this._log.debug("<stopPublishing> removed",{publication:e})}).catch(r=>{this._log.error("<stopPublishing> remove failed",r,{publication:e})}),this._closeIfNeeded(),this._log.debug("<stopPublishing> end",{publication:e})}));const i=this.sendSubscriptionStatsReportTimers.get(e.id);i&&(clearInterval(i),this.sendSubscriptionStatsReportTimers.delete(e.id))})}startSubscribing(e){return M(this,null,function*(){yield this._pubsubQueue.push(()=>M(this,null,function*(){this._log.debug("startSubscribing",{subscription:e}),this.receiver.add(e);const i=e.publication.id;let r=this.receiver.streams[i];r||(yield this.receiver.onStreamAdded.watch(s=>s.publicationId===i,this._context.config.rtcConfig.timeout).catch(()=>{throw Se({operationName:"P2PConnection.startSubscribing",info:ge(ue({},Pe.timeout),{detail:"onStreamAdded"}),path:ln.prefix,context:this._context,channel:this.localPerson.channel,payload:{subscription:e}})}),r=this.receiver.streams[i]),r.setIsEnabled(e.publication.state==="enabled"),e.codec=r.codec,e._setStream(r),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:e.id,role:"receiver",rtcPeerConnectionId:this.receiver.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(e,e.id):this._waitingSendSubscriptionStatsReportsFromSubscribe.push(e.id))}))})}stopSubscribing(e){return M(this,null,function*(){yield this._pubsubQueue.push(()=>M(this,null,function*(){this._log.debug("stopSubscribing",{subscription:e}),this.receiver.remove(e.id),this._closeIfNeeded()}));const i=this.sendSubscriptionStatsReportTimers.get(e.id);i&&(clearInterval(i),this.sendSubscriptionStatsReportTimers.delete(e.id))})}_closeIfNeeded(){this.sender.hasMedia||this.receiver.hasMedia||this.close({reason:"no media"})}getStats(e){return M(this,null,function*(){const i=e.stream;if(!i)throw Se({operationName:"P2PConnection.getStats",info:ge(ue({},Pe.invalidArgumentValue),{detail:"Subscription or Publication must has stream"}),path:ln.prefix,context:this._context,channel:this.localPerson.channel});return i.side==="local"?i.contentType==="data"?this.sender.pc.getStats():this.sender.pc.getStats(i.track):i.contentType==="data"?this.receiver.pc.getStats():this.receiver.pc.getStats(i.track)})}close({reason:e}={}){this.closed||(this.closed=!0,this._log.debug("closed",{endpointId:this.remoteMember.id,reason:e,sender:this.sender.id,receiver:this.receiver.id,id:this.id}),this.sender.close(),this.receiver.close(),this.onClose.emit())}startSendSubscriptionStatsReportTimer(e,i){if(this._analytics){const r=e instanceof Dc?"sender":"receiver",s=this._analytics.client.getIntervalSec();this.sendSubscriptionStatsReportTimers.set(e.id,setInterval(()=>M(this,null,function*(){if(!this._analytics)throw Se({operationName:"P2PConnection.sendSubscriptionStatsReportTimer",info:ge(ue({},Pe.missingProperty),{detail:"AnalyticsSession not exist"}),path:ln.prefix,context:this._context,channel:this.localPerson.channel});if(this._analytics.isClosed()){const l=this.sendSubscriptionStatsReportTimers.get(e.id);l&&(clearInterval(l),this.sendSubscriptionStatsReportTimers.delete(e.id));return}const o=yield this.getStats(e);o&&this._analytics.client.sendSubscriptionStatsReport(o,{subscriptionId:i,role:r,contentType:e.contentType,createdAt:Date.now()})}),s*1e3))}}},Dr=new Ie("packages/core/src/plugin/internal/person/member.ts"),mn=class extends Bn{constructor(e){super(e),this.args=e,this.type="person",this.subtype="person",this.side="remote",this._connections={},this._context=this.args.channel._context,this._disposer=new ei,this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.subscribe=i=>new Promise((r,s)=>{let o=!1;this.channel._subscribe(this.id,i).catch(l=>{o=!0,s(l)}),this.onPublicationSubscribed.watch(({subscription:l})=>l.publication.id===i,this._context.config.rtcApi.timeout).then(({subscription:l})=>{r({subscription:l})}).catch(()=>{o||s(Se({operationName:"RemotePersonImpl.subscribe",info:ge(ue({},Pe.timeout),{detail:"onPublicationSubscribed"}),path:Dr.prefix,context:this._context,channel:this.channel}))})}),this.plugin=e.plugin,this.channel.onPublicationUnsubscribed.add(({subscription:i})=>{i.subscriber.id===this.id&&(this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onPublicationSubscribed.add(({subscription:i})=>{i.subscriber.id===this.id&&(this.onPublicationSubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onStreamPublished.add(({publication:i})=>{i.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.channel.onStreamUnpublished.add(({publication:i})=>{i.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.onLeft.once(()=>{Dr.debug("RemotePerson left: ",this.toJSON()),Object.values(this._connections).forEach(i=>{i.close({reason:"remote person left"})}),this._connections={}})}_getConnection(e){return this._connections[e]}_getOrCreateConnection(e){var i;return(i=this._getConnection(e.id))!=null?i:this._createConnection(this.channel,e,this)}_createConnection(e,i,r){if(i.side!=="local")throw Se({operationName:"RemotePersonImpl._createConnection",info:ge(ue({},Pe.invalidArgumentValue),{detail:"wrong localPerson type"}),path:Dr.prefix,context:this._context,channel:this.channel});if(!i._signaling)throw Se({operationName:"RemotePersonImpl._createConnection",info:ge(ue({},Pe.missingProperty),{detail:"signalingSession not exist"}),path:Dr.prefix,context:this._context,channel:this.channel});const s=new Qm(i.iceManager,i._signaling,i._analytics,this._context,e.id,i,r);return this.plugin._messageBuffers[i.id].resolveMessagingBuffer(r),s.onClose.once(()=>{Dr.debug("connection closed",this.toJSON(),{connectionId:s.id}),delete this._connections[i.id]}),this._connections[i.id]=s,s}unsubscribe(e){return M(this,null,function*(){yield this.channel._unsubscribe(e)})}_dispose(){this._disposer.dispose()}},Ym=class extends Js{constructor(){super(...arguments),this.subtype="person",this._messageBuffers={},this._whenCreateLocalPerson=e=>M(this,null,function*(){e._signaling&&(this._messageBuffers[e.id]=new jm(e._signaling))}),this._whenDisposeLocalPerson=e=>M(this,null,function*(){const i=this._messageBuffers[e.id];i&&(i.close(),delete this._messageBuffers[e.id])}),this._createRemoteMember=(e,i)=>new mn(ge(ue({},this._context),{context:this._context,channel:e,metadata:i.metadata,id:i.id,name:i.name,plugin:this}))}},Zm=e=>{const i=new Ym;return e.registerPlugin(i),i};Z();var eg=class extends Js{constructor(){super(...arguments),this.subtype="unknown",this._createRemoteMember=(e,i)=>new Sc(ge(ue({},this._context),{context:this._context,channel:e,metadata:i.metadata,id:i.id,name:i.name,plugin:this,subtype:i.subtype}))}};Z();var tg="1.9.2",Qt=new Ie("packages/core/src/context.ts"),Bc=class Hc{constructor(i,r,s,o){this.config=r,this.authToken=s,this.info=o,this.disposed=!1,this.plugins=[],this._unknownPlugin=new eg,this._reminderSec=this.config.token.updateReminderSec,this._events=new Ti,this.onTokenUpdateReminder=this._events.make(),this.onTokenExpired=this._events.make(),this.onFatalError=this._events.make(),this._onTokenUpdated=this._events.make(),this._onDisposed=this._events.make(),this._authTokenString=s.tokenString,this.appId=this.authToken.scope.app.id,Zm(this),this._api=i,this._api.onFatalError.once(l=>{Qt.error("onFatalError",{appId:this.appId,error:l}),this.onFatalError.emit(Se({operationName:"SkyWayContext._api.onFatalError",context:this,info:Pe.rtcApiFatalError,error:l,path:Qt.prefix})),this.dispose()})}static Create(i){return M(this,arguments,function*(r,s={}){const o=new Nm(s);Ie.level=o.log.level,Ie.format=o.log.format;const l=Lr.Decode(r),{osName:d,osVersion:m,browserName:C,browserVersion:h}=_c(),v={sdkName:"core",sdkVersion:this.version,osName:d,osVersion:m,browserName:C,browserVersion:h},D={rapi:o.rtcApi.domain,signaling:o.signalingService.domain,ice:o.iceParamServer.domain};Qt.info("core sdk spawned",{operationName:"SkyWayContext.Create",runtime:v,endpoint:D,config:o,token:l});try{const E=yield Fm.Create({appId:l.scope.app.id,token:r,log:o.log,rtcApi:o.rtcApi}),R=new Hc(E,o,l,{endpoint:D,runtime:v});return yield R._setTokenExpireTimer(),R}catch(E){throw Se({operationName:"SkyWayContext.Create",info:Pe.connectRtcApiFailed,error:E,path:Qt.prefix})}})}get authTokenString(){return this._authTokenString}_setTokenExpireTimer(){return M(this,null,function*(){const i=yield this._api.getServerUnixtimeInSec(),r=this.authToken.exp-i;if(r<0)throw Se({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Pe.invalidExpireTokenValue,path:Qt.prefix,payload:{exp:this.authToken.exp,now:i}});this.tokenUpdateReminderTimer&&clearTimeout(this.tokenUpdateReminderTimer);const s=r-this._reminderSec;if(s<0)throw Se({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Pe.invalidRemindExpireTokenValue,path:Qt.prefix,payload:{expiresInSec:r,reminderSec:this._reminderSec}});Qt.debug("_setTokenExpireTimer",{expiresInSec:r,tokenExpireReminderTimeSec:s}),this.tokenUpdateReminderTimer=setTimeout(()=>{Qt.debug("tokenUpdateReminder",{appid:this.appId}),this.onTokenUpdateReminder.emit()},s*1e3),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenExpiredTimer=setTimeout(()=>{Qt.debug("tokenExpired",{appid:this.appId}),this.onTokenExpired.emit()},r*1e3)})}updateAuthToken(i){return M(this,null,function*(){const r=Lr.Decode(i);if(Qt.info({operationName:"SkyWayContext.updateAuthToken"},{oldToken:this.authToken,newToken:r}),r.scope.app.id!==this.appId)throw Se({operationName:"SkyWayContext.updateAuthToken",context:this,info:Pe.invalidTokenAppId,path:Qt.prefix,payload:{invalid:this.authToken.scope.app.id,expect:this.appId}});this._authTokenString=i,this.authToken=r,this._onTokenUpdated.emit(i),yield this._setTokenExpireTimer(),yield this._api.updateAuthToken(i)})}registerPlugin(i){this.plugins.find(r=>r.subtype===i.subtype)||(i._attachContext(this),this.plugins.push(i))}_createRemoteMember(i,r){const s=i._getMember(r.id);if(s)return s;Qt.debug("createRemoteMember",{memberDto:r}),r.type=r.type.toLowerCase(),r.subtype=r.subtype.toLowerCase();let o=this.plugins.find(d=>d.subtype===r.subtype);return o||(o=this._unknownPlugin),o._createRemoteMember(i,r)}dispose(){this.disposed||(this.disposed=!0,Qt.debug("disposed",{appid:this.appId}),clearTimeout(this.tokenUpdateReminderTimer),this._onDisposed.emit(),this._events.dispose(),this._api.close())}};Bc.version=tg;var ig=Bc,oi=new Ie("packages/core/src/external/analytics.ts");function rg(e,i,r){return M(this,null,function*(){const{analyticsService:s}=e.config,o=new _m({token:e.authTokenString,channelId:i.id,channelName:i.name,memberId:r.id,memberName:r.name,sdkVersion:ig.version},{logger:{error:(d,m)=>M(this,null,function*(){oi.error(`AnalyticsClient error: ${d}`,Se({operationName:"AnalyticsClient.logger",context:e,info:ge(ue({},Pe.internal),{detail:"AnalyticsClient error"}),error:m,path:oi.prefix,channel:i}))}),debug:(d,...m)=>{oi.debug("[analytics]:",d,...m)},warn:(d,...m)=>{oi.warn("[analytics]:",d,...m)}},analyticsLoggingServerDomain:s.domain,secure:s.secure}),l=new ng(o,e);return l.connectWithTimeout().catch(d=>{l.close(),oi.error(`AnalyticsClient error: ${d.message}`,Se({operationName:"AnalyticsClient.logger",context:e,info:ge(ue({},Pe.internal),{detail:"AnalyticsClient error"}),error:d,path:oi.prefix,channel:i})),l.onConnectionFailed.emit({})}),l})}var ng=class{constructor(e,i){this.client=e,this.context=i,this.onConnectionFailed=new De,this.onConnectionStateChanged=new De,this.onMessage=new De,this._isClosed=!1,this._listen(),i._onTokenUpdated.add(r=>{this.client.setNewSkyWayAuthToken(r)})}_listen(){this.client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this.client.onConnectionStateChanged.addListener(e=>{e==="closed"&&!this.isClosed()&&this.client.isClosed()&&this.close(),this.onConnectionStateChanged.emit(e)})}get connectionState(){return this.client.connectionState}_connect(){return M(this,null,function*(){oi.debug("[start] connect analyticsService"),yield this.client.connect().then(()=>{oi.debug("[end] connect analyticsService")}).catch(e=>{this.close(),oi.debug("[end] failed connect analyticsService: also unreachable to server"),oi.error(`AnalyticsClient error: ${e.message}`,Se({operationName:"AnalyticsClient.logger",info:ge(ue({},Pe.internal),{detail:"AnalyticsClient error"}),error:e,path:oi.prefix})),this.onConnectionFailed.emit({})})})}connectWithTimeout(){return M(this,null,function*(){let e;const i=new Promise((r,s)=>{e=setTimeout(()=>{oi.debug("[end] failed connect analyticsService: no initial response from the server"),s(new Error("failed connect analyticsService"))},3e4)});return Promise.race([this._connect(),i]).finally(()=>{clearTimeout(e)})})}close(){this._isClosed=!0,this.onConnectionFailed.removeAllListeners(),this.onConnectionStateChanged.removeAllListeners(),this.onMessage.removeAllListeners()}isClosed(){return this._isClosed}};Z();var Ga=new Ie("packages/core/src/external/ice.ts"),sg=class{constructor(e){this.args=e,this.domain=this.args.domain,this.version=this.args.version,this.secure=this.args.secure,this.memberId=this.args.memberId,this.channelId=this.args.channelId,this.ttl=this.args.ttl,this.context=this.args.context,this._stunServers=[],this._turnServers=[],this._endpoint=`http${this.secure?"s":""}://${this.domain}/v${this.version}`,this.http=new Ws(this._endpoint)}updateIceParams(){return M(this,null,function*(){const e={memberId:this.memberId,channelId:this.channelId,ttl:this.ttl};Ga.debug("[start] fetch iceParams");const i=new vi({times:6,interval:500,jitter:100}),{turn:r,stun:s}=yield this.http.post("/ice-params",e,{headers:{authorization:`Bearer ${this.context.authTokenString}`},retry:()=>i.wait()});r&&(this._turnServers=[{credential:r.credential,urls:`turn:${r.domain}:${r.port}?transport=tcp`,username:r.username},{credential:r.credential,urls:`turn:${r.domain}:${r.port}?transport=udp`,username:r.username},{credential:r.credential,urls:`turns:${r.domain}:${r.port}?transport=tcp`,username:r.username}]),this._stunServers=[{urls:`stun:${s.domain}:${s.port}`}],Ga.debug("[end] fetch iceParams",{turn:r,stun:s})})}get iceServers(){let e=[...this._stunServers];const i=this._turnServers.filter(r=>{const s=r.urls;switch(this.context.config.rtcConfig.turnProtocol){case"all":return!0;case"udp":return s.endsWith("udp");case"tcp":return!s.startsWith("turns")&&s.endsWith("tcp");case"tls":return s.startsWith("turns")}});return this.context.config.rtcConfig.turnPolicy!=="disable"&&(e=[...e,...i]),e}};Z();Z();Z();Z();var ag=20480,dn=class{constructor(e,i={}){if(this.event=e,this.payload=i,this.eventId=Ii(),this.data=JSON.stringify({event:this.event,eventId:this.eventId,payload:this.payload}),this.data.length>ag)throw new Error("payload size exceeds the upper limit")}};Z();var og=["rateLimitExceeded","targetNotFound","payloadLengthExceeded","invalidPayload","unknown","parameterError","permissionError"];function Ja(e){return!(!e||typeof e!="object"||!Uc(e.src)||!e.data||typeof e.data!="object")}function cg(e){return!(!e||typeof e!="object"||typeof e.eventId!="string"||typeof e.ok!="boolean"||typeof e.reason<"u"&&(typeof e.reason!="string"||!og.includes(e.reason)))}function Uc(e){return!(e===void 0||Array.isArray(e)||typeof e!="object"||typeof e.id!="string"||typeof e.name<"u"&&typeof e.name!="string")}Z();var Xa=$t(Ls());Z();var Zi=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=e=>{this._listeners.forEach(i=>i(e))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=e=>{const i=this._listenerIndex;return this._listeners.set(i,e),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(i)}}},this.addOneTimeListener=e=>{const i=this.addListener(r=>{i.removeListener(),e(r)});return i},this.asPromise=e=>new Promise((i,r)=>{let s=()=>{};const o=e&&setTimeout(()=>{r("Event asPromise timeout"),s()},e);s=this.addOneTimeListener(d=>{o&&clearTimeout(o),i(d)}).removeListener})}};Z();var lg="1.0.4",dg=["open","sendRequestSignalingMessage","sendResponseSignalingMessage","acknowledge"],ug=e=>(Hi(2,e)+Math.random())*1e3,hg=class{constructor({channelId:e,channelName:i,memberId:r,memberName:s,sessionEndpoint:o,token:l,logger:d}){this._isOpen=!1,this._isDestroyed=!1,this._reconnectCount=0,this.connectionState="closed",this.onConnectionStateChanged=new Zi,this.onOpened=new Zi,this.onEventReceived=new Zi,this.onConnectionFailed=new Zi,this._sessionEndpoint=o,this._channelId=e,this._channelName=i,this._memberId=r,this._memberName=s,this._token=l,this._logger=d,this._connect()}_setConnectionState(e){this._logger.debug(`connectionState changed : ${e}`),this.connectionState=e,this.onConnectionStateChanged.emit(e)}_connect(){let e;try{const i=`SkyWayAuthToken!${this._token}`,r={channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,platform:"javascript",version:lg},s=Object.entries(r).filter(([l,d])=>d!==void 0).map(l=>l.join("=")).join("&"),o=`${this._sessionEndpoint}?${s}`;e=new Xa.default(o,i),this._logger.debug(`Connecting to signaling-server: ${this._sessionEndpoint}`),e.onerror=l=>{this._logger.error("WebSocket error occurred",l.error),e.close(4202)}}catch(i){const r=i instanceof Error?i:new Error;this._logger.error("Failed to create WebSocket instance",r),this.reconnect();return}e.onopen=()=>{this._logger.debug("Connected to signaling-server")},e.onclose=i=>{const r="Close event fired: "+JSON.stringify({code:i.code,reason:i.reason,type:i.type});if(4100<=i.code&&i.code<=4199?this._logger.error(r,new Error):this._logger.debug(r),i.code!==1e3&&!(4e3<=i.code&&i.code<=4199)){this.reconnect();return}i.code!==4e3&&(this._logger.debug("Closed the connection to signaling-server"),this.onConnectionFailed.emit(),this.destroy())},e.onmessage=i=>{this._messageHandler(i.data)},this._ws=e}updateAuthToken(e){this._token=e}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=8)this.onConnectionFailed.emit(),this.destroy(),this._logger.error("Failed to reconnect for eight times",new Error);else{this._setConnectionState("reconnecting");const e=ug(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},e)}}destroy(){this._isDestroyed=!0,this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(e){return new Promise((i,r)=>{const s=()=>{this.onOpened.addOneTimeListener(()=>{this.send(e).then(()=>{i()}).catch(o=>{r(o)})}),this.onConnectionFailed.addOneTimeListener(()=>{r(new Error("Connection failed"))})};if(this._isDestroyed){r(new Error("The socket is already destroyed"));return}if(this._ws===void 0||!this._isOpen){this._logger.debug("Retry send the client event when connected because WebSocket is undefined or isOpen = false"),s();return}this._logger.debug(`Send the event: ${e.data}`),this._ws.send(e.data,o=>{if(o){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==Xa.default.OPEN){this._logger.debug("Retry send the client event when connected because WebSocket.send failed"),s();return}r(o)}else i()})})}_messageHandler(e){if(typeof e!="string"){this._logger.error("Received invalid message: not string",new Error);return}let i;try{i=JSON.parse(e)}catch(r){const s=r instanceof Error?r:new Error;this._logger.error("Received invalid message: parse error",s);return}if(!pg(i)){this._logger.error(`Received invalid message: ${i}`,new Error);return}i.event==="open"?(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this.onOpened.emit()):(this._logger.debug(`Received the event: ${i.event}, payload: ${JSON.stringify(i.payload)}`),this.onEventReceived.emit(i))}};function pg(e){return!(!e||typeof e!="object"||typeof e.event!="string"||!dg.includes(e.event)||typeof e.eventId!="string"||e.payload&&typeof e.payload!="object")}var Qa="signaling.skyway.ntt.com",fg="v1",mg=class{constructor({token:e,channelId:i,channelName:r,memberId:s,memberName:o},l){this.onConnectionStateChanged=new Zi,this.onConnectionFailed=new Zi,this.onRequested=new Zi,this._connectivityCheckTimers=new Map,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._token=e,this._channelId=i,this._channelName=r,this._memberId=s,this._memberName=o;const d={connectivityCheckIntervalSec:30,signalingServerDomain:Qa,secure:!0,logger:{debug:m=>{console.debug(m)},error:m=>{console.error(m)}}};this._options=Object.assign({},d,l??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var e,i;return(i=(e=this._socket)==null?void 0:e.connectionState)!=null?i:"closed"}connect(){return M(this,null,function*(){const e=this._options.secure?"wss":"ws",i=this._options.signalingServerDomain||Qa;this._socket=new hg({sessionEndpoint:`${e}://${i}/${fg}/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger}),this._socket.onEventReceived.addListener(r=>{try{this._eventReceivedHandler(r)}catch(s){this._logger.error("in _eventReceivedHandler",s)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit()}),this._socket.onConnectionStateChanged.addListener(r=>{this.onConnectionStateChanged.emit(r)}),yield this._socket.onOpened.asPromise(15*1e3),this._startConnectivityCheck()})}disconnect(){var e;this._stopConnectivityCheck(),(e=this._socket)==null||e.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}_startConnectivityCheck(){if(this._connectivityCheckInterval){this._logger.debug("connectivity check timer is already set");return}this._connectivityCheckInterval=setInterval(()=>{var e;const i=new dn("checkConnectivity");(e=this._socket)==null||e.send(i).catch(()=>{this._acknowledgeCallbacks.delete(i.eventId)}),this._connectivityCheckTimers.set(i.eventId,setTimeout(()=>{var r;this._acknowledgeCallbacks.delete(i.eventId),(r=this._socket)==null||r.reconnect(),this._logger.debug("connectivity check timer is expired")},5*1e3)),this._setAcknowledgeCallback(i.eventId,r=>{var s;const o=this._connectivityCheckTimers.get(i.eventId);o&&(clearTimeout(o),this._connectivityCheckTimers.delete(i.eventId)),r.ok||((s=this._socket)==null||s.reconnect(),this._logger.debug("connectivity check response from server was not ok"))})},this._options.connectivityCheckIntervalSec*1e3),this._logger.debug("Started connectivity check timer")}_stopConnectivityCheck(){if(!this._connectivityCheckInterval){this._logger.debug("connectivity check timer is not set");return}clearInterval(this._connectivityCheckInterval),this._connectivityCheckInterval=void 0,this._logger.debug("Stopped connectivity check timer");for(const[e,i]of this._connectivityCheckTimers)clearTimeout(i);this._connectivityCheckTimers.clear()}request(e,i,r=10){return gg(e),Ya(i),new Promise((s,o)=>{if(this._socket===void 0){o(new Error("websocket is not connected"));return}const l={dst:e,data:i},d=new dn("sendRequestSignalingMessage",l),m=setTimeout(()=>{this._acknowledgeCallbacks.delete(d.eventId),o(new Error("request timeout"))},r*1e3);this._setResponseCallback(d.eventId,C=>{clearTimeout(m),s(C)}),this._setAcknowledgeCallback(d.eventId,C=>{C.ok||(clearTimeout(m),o(C))}),this._socket.send(d).catch(C=>{this._acknowledgeCallbacks.delete(d.eventId),clearTimeout(m),o(C)})})}_response(e,i,r,s){return new Promise((o,l)=>{if(Ya(r),this._socket===void 0){l(new Error("websocket is not connected"));return}const d={dst:e,requestEventId:i,data:r},m=new dn("sendResponseSignalingMessage",d),C=setTimeout(()=>{this._acknowledgeCallbacks.delete(m.eventId),l(new Error("response timeout"))},s*1e3);this._setAcknowledgeCallback(m.eventId,h=>{clearTimeout(C),h.ok?o():l(h)}),this._socket.send(m).catch(h=>{this._acknowledgeCallbacks.delete(m.eventId),clearTimeout(C),l(h)})})}updateSkyWayAuthToken(e,i=10){return new Promise((r,s)=>{if(this._socket===void 0){s(new Error("websocket is not connected"));return}const o={token:e},l=new dn("updateSkyWayAuthToken",o),d=setTimeout(()=>{this._acknowledgeCallbacks.delete(l.eventId),s(new Error("updateSkyWayAuthToken timeout"))},i*1e3);this._setAcknowledgeCallback(l.eventId,m=>{if(clearTimeout(d),m.ok){if(this._socket===void 0){s(new Error("websocket is not connected"));return}this._socket.updateAuthToken(e),r()}else s(m)}),this._socket.send(l).catch(m=>{this._acknowledgeCallbacks.delete(l.eventId),clearTimeout(d),s(m)})})}_eventReceivedHandler(e){switch(e.event){case"acknowledge":this._acknowledgeHandler(e.payload);break;case"sendRequestSignalingMessage":this._eventMessageRequestHandler(e.payload);break;case"sendResponseSignalingMessage":this._eventMessageResponseHandler(e.payload);break;case"open":break;default:e.event,this._logger.debug(`Unknown event: ${e.event}`)}}_acknowledgeHandler(e){if(!cg(e))throw new Error("Invalid payload");const{eventId:i}=e;if(!this._acknowledgeCallbacks.has(i))throw new Error(`acknowledge event has unknown eventId: ${i}`);const r=this._acknowledgeCallbacks.get(i);r&&(this._acknowledgeCallbacks.delete(i),r(e))}_eventMessageRequestHandler(e){if(!Ja(e))throw new Error("Invalid payload");if(!e.requestEventId)throw new Error("Invalid payload");const i=e.src,r=e.requestEventId,s=(o,l=10)=>M(this,null,function*(){yield this._response(i,r,o,l)});this.onRequested.emit({data:e.data,reply:s,requestEventId:e.requestEventId,src:e.src})}_eventMessageResponseHandler(e){if(!Ja(e))throw new Error("Invalid payload");if(!e.requestEventId||!this._responseCallbacks.has(e.requestEventId))throw new Error(`received response has unknown eventId: ${e.requestEventId}`);const i=this._responseCallbacks.get(e.requestEventId);i&&(this._responseCallbacks.delete(e.requestEventId),i(e.data))}_setResponseCallback(e,i){this._responseCallbacks.set(e,i)}_setAcknowledgeCallback(e,i){this._acknowledgeCallbacks.set(e,i)}};function Ya(e){if(!e||typeof e!="object")throw new Error("the type of data must be object")}function gg(e){if(!Uc(e))throw new Error("the type of target must be {id: string, name: string}");if(!Ec(e.id))throw new Error("the type of target.id must be uuid format")}Z();var ai=new Ie("packages/core/src/external/signaling.ts");function vg(e,i,r){return M(this,null,function*(){const{signalingService:s}=e.config,o=new mg({token:e.authTokenString,channelId:i.id,channelName:i.name,memberId:r.id,memberName:r.name},{logger:{error:d=>M(this,null,function*(){ai.error("SignalingClient error",Se({operationName:"SignalingClient.logger",context:e,info:ge(ue({},Pe.internal),{detail:"signalingClient error"}),error:d,path:ai.prefix,channel:i}))}),debug:d=>{}},signalingServerDomain:s.domain,secure:s.secure}),l=new bg(o,e);return yield l.connect(),l})}var bg=class{constructor(e,i){this._client=e,this.context=i,this.onConnectionFailed=new De,this.onConnectionStateChanged=new De,this.onMessage=new De,this.closed=!1,this._chunkedMessageBuffer={},this._backoffUpdateSkyWayAuthToken=new vi({times:8,interval:100,jitter:100}),this._disposer=new ei,this._listen(),i._onTokenUpdated.add(r=>M(this,null,function*(){yield this._updateSkyWayAuthToken(r)})).disposer(this._disposer)}updateClient(e){this._client=e,this._listen()}_listen(){this._client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this._client.onConnectionStateChanged.addListener(e=>{ai.debug("signalingClient onConnectionStateChanged",e),this.onConnectionStateChanged.emit(e)}),this._client.onRequested.addListener(e=>M(this,[e],function*({data:i,src:r,reply:s}){var o;const l=i,{chunk:d,length:m,offset:C,id:h,type:v}=l;if(v===bs){if(m===0)this.onMessage.emit({src:r,data:JSON.parse(d)});else if(this._chunkedMessageBuffer[h]=[...(o=this._chunkedMessageBuffer[h])!=null?o:[],l.chunk],m===C){const D=this._chunkedMessageBuffer[h].join("");delete this._chunkedMessageBuffer[h],this.onMessage.emit({src:r,data:JSON.parse(D)})}yield s({}).catch(D=>{this.closed||ai.warn("failed to reply",vt({operationName:"SignalingSession.reply",detail:"SignalingClient failed to reply"}),D)})}}))}_updateSkyWayAuthToken(e){return M(this,null,function*(){if(this._backoffUpdateSkyWayAuthToken.exceeded){ai.error("[failed] updateSkyWayAuthToken");return}yield this._backoffUpdateSkyWayAuthToken.wait(),ai.debug("[start] updateSkyWayAuthToken",{count:this._backoffUpdateSkyWayAuthToken.count});const i=yield this._client.updateSkyWayAuthToken(e).catch(r=>r);if(i){ai.warn("[retry] updateSkyWayAuthToken",vt({operationName:"SignalingSession._updateSkyWayAuthToken",detail:"[retry] updateSkyWayAuthToken"}),i),yield this._updateSkyWayAuthToken(e);return}ai.debug("[end] updateSkyWayAuthToken"),this._backoffUpdateSkyWayAuthToken.reset()})}get connectionState(){return this._client.connectionState}connect(){return M(this,null,function*(){ai.debug("[start] connect signalingService"),yield this._client.connect().catch(e=>{throw Se({operationName:"signalingSession.connect",path:ai.prefix,info:ge(ue({},Pe.internal),{detail:"signalingClient failed to connect Server"}),context:this.context,error:e})}),ai.debug("[end] connect signalingService")})}close(){this.closed=!0,this._disposer.dispose(),this._client.disconnect()}send(e,i,r=1e4){return M(this,null,function*(){var s;try{const o=JSON.stringify(i),l=Ur();if(o.length>20480){const d=(s=o.match(/.{1,20480}/g))!=null?s:[];let m=0;for(const C of d){const h={type:bs,length:d.length-1,offset:m++,chunk:C,id:l};yield this._client.request(e,h,r/1e3)}}else{const d={type:bs,length:0,offset:0,chunk:o,id:l};yield this._client.request(e,d,r/1e3)}}catch(o){if(this.closed||e.state!=="joined")return;throw Se({operationName:"SignalingSession.send",context:this.context,info:ge(ue({},Pe.internal),{detail:"signalingClient"}),error:o,path:ai.prefix,payload:{target:e,data:i}})}})}},bs="signalingMessage",Za=new Ie("packages/core/src/member/person/local/factory.ts");function yg(e,i,r){return M(this,arguments,function*(s,o,l,{keepaliveIntervalSec:d,keepaliveIntervalGapSec:m,disableSignaling:C,disableAnalytics:h}={}){var v,D;Za.debug("createLocalPerson",{channel:o,memberDto:l,keepaliveIntervalSec:d,keepaliveIntervalGapSec:m});const{iceParamServer:E}=s.config,R=C===!0?void 0:yield vg(s,o,l),H=(v=Lr.Decode(s.authTokenString).scope.app.analytics)!=null?v:!1,j=h===!0||!H?void 0:yield rg(s,o,l),k=new sg(ge(ue({},E),{memberId:l.id,channelId:o.id,ttl:lm,context:s}));yield k.updateIceParams().catch(f=>{throw Se({operationName:"createLocalPerson",context:s,channel:o,info:ge(ue({},Pe.internal),{detail:"updateIceParams failed"}),path:Za.prefix,error:f})});const y=yield _g.Create({iceManager:k,channel:o,signaling:R,analytics:j,metadata:l.metadata,name:l.name,id:l.id,keepaliveIntervalSec:d,keepaliveIntervalGapSec:m,context:s});for(const f of s.plugins)yield(D=f._whenCreateLocalPerson)==null?void 0:D.call(f,y),y._onDisposed.once(()=>M(this,null,function*(){var w;yield(w=f._whenDisposeLocalPerson)==null?void 0:w.call(f,y)}));return y})}var Ne=new Ie("packages/core/src/member/localPerson/index.ts"),_g=class qc extends Bn{constructor(i){super(i),this.args=i,this.type="person",this.subtype="person",this.side="local",this.keepaliveIntervalSec=this.args.keepaliveIntervalSec,this.keepaliveIntervalGapSec=this.args.keepaliveIntervalGapSec,this.disableSignaling=this.args.disableSignaling,this.disableAnalytics=this.args.disableAnalytics,this.config=this.context.config,this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this._onStreamSubscribeFailed=this._events.make(),this._onDisposed=this._events.make(),this._disposer=new ei,this._subscribing={},this._requestQueue=new Ui,this.iceManager=this.args.iceManager,this._disposed=!1,this._publishingAgent=new om(this),this._subscribingAgent=new cm(this),this._signaling=i.signaling,this._analytics=i.analytics,this._listenChannelEvent(),this._listenBeforeUnload()}static Create(...i){return M(this,null,function*(){const r=new qc(...i);return yield r._setupTtlTimer(),r})}_listenChannelEvent(){this.channel.onPublicationSubscribed.add(i=>M(this,[i],function*({subscription:r}){yield this._handleOnPublicationSubscribe(r).catch(s=>Ne.error("_handleOnStreamSubscribe",s))})).disposer(this._disposer),this.channel.onPublicationUnsubscribed.add(i=>M(this,[i],function*({subscription:r}){yield this._handleOnPublicationUnsubscribe(r).catch(s=>Ne.error("_handleOnStreamUnsubscribe",s))})).disposer(this._disposer),this.channel._onDisposed.once(()=>{this.dispose()}),this.onLeft.once(()=>{this.dispose()})}_setupTtlTimer(){return M(this,null,function*(){const{keepaliveIntervalSec:i,keepaliveIntervalGapSec:r}=this;if(i==null||(Ne.debug("_setupTtlTimer",this.toJSON(),{keepaliveIntervalSec:i,keepaliveIntervalGapSec:r}),i===-1))return;const s=()=>M(this,null,function*(){if(this._disposed)return;const o=yield this.context._api.getServerUnixtimeInSec();this.ttlSec=Math.floor(o+i+(r??0));try{yield this.channel._updateMemberTtl(this.id,this.ttlSec),Ne.debug("updateTtl",this.toJSON(),{now:o,ttlSec:this.ttlSec,keepaliveIntervalSec:i??0,keepaliveIntervalGapSec:r??0,diff:this.ttlSec-o})}catch(l){if(this._disposed)return;throw l}});yield s(),this.ttlInterval=setInterval(()=>M(this,null,function*(){yield s().catch(o=>{this._disposed||(this.onFatalError.emit(Se({operationName:"localPerson._setupTtlTimer",path:Ne.prefix,info:ge(ue({},Pe.internal),{detail:"updateMemberTtl failed"}),channel:this.channel,context:this.context,error:o})),this.dispose())})}),i*1e3)})}_listenBeforeUnload(){if(window){const i=()=>M(this,null,function*(){window.removeEventListener("beforeunload",i),this.state==="joined"&&(Ne.debug("leave by beforeunload",this.toJSON()),yield this.leave())});window.addEventListener("beforeunload",i)}}_handleOnPublicationSubscribe(i){return M(this,null,function*(){var r;if(i.subscriber.id===this.id)try{const s=Ne.info("[start] startSubscribing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i}),o=(r=this._subscribing[i.publication.id])==null?void 0:r.options;o&&(i.preferredEncoding=o.preferredEncodingId),yield this._subscribingAgent.startSubscribing(i),this.onPublicationSubscribed.emit({subscription:i,stream:i.stream}),this.onSubscriptionListChanged.emit(),Ne.elapsed(s,"[end] startSubscribing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i})}catch(s){throw this._onStreamSubscribeFailed.emit({error:s,subscription:i}),s}if(i.publication.publisher.id===this.id){if(i.subscriber.id===this.id)throw Se({operationName:"localPerson._handleOnStreamSubscribe",path:Ne.prefix,info:ge(ue({},Pe.internal),{detail:"can not subscribe own Publication"}),channel:this.channel,context:this.context});const s=Ne.info("[start] startPublishing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i});yield this._publishingAgent.startPublishing(i).catch(o=>{throw Ne.error("[failed] startPublishing",o,{subscription:i}),o}),Ne.elapsed(s,"[end] startPublishing",yield je({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:i})}})}_handleOnPublicationUnsubscribe(i){return M(this,null,function*(){if(i.publication.publisher.id===this.id){const r=Ne.info("[start] stopPublishing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i});yield this._publishingAgent.stopPublishing(i.publication,i.subscriber).catch(s=>{throw Ne.error("[failed] stopPublishing",s,{subscription:i}),s}),Ne.elapsed(r,"[end] stopPublishing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i})}if(i.subscriber.id===this.id){const r=Ne.info("[start] stopSubscribing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i});yield this._subscribingAgent.stopSubscribing(i).catch(s=>{throw Ne.error("[failed] stopSubscribing",{subscription:i},s),s}),this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit(),Ne.elapsed(r,"[end] stopSubscribing",yield je({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:i})}})}publish(i){return M(this,arguments,function*(r,s={}){var o,l,d,m;const C=Ne.info("[start] publish",yield je({operationName:"localPerson.publish",channel:this.channel}),{options:s});if(this.state!=="joined")throw Se({operationName:"localPerson.publish",info:Pe.localPersonNotJoinedChannel,path:Ne.prefix,channel:this.channel,context:this.context});if(r.published)throw Se({operationName:"localPerson.publish",channel:this.channel,context:this.context,info:Pe.alreadyPublishedStream,path:Ne.prefix});r.published=!0,s.codecCapabilities&&(s.codecCapabilities=s.codecCapabilities.filter(E=>E!=null));const h={metadata:s.metadata,publisher:this.id,channel:this.channel.id,contentType:r.contentType,codecCapabilities:(o=s.codecCapabilities)!=null?o:[],isEnabled:s.isEnabled};r.contentType==="video"&&h.codecCapabilities.length===0&&(h.codecCapabilities=[{mimeType:"video/vp8"}]),s.encodings&&s.encodings.length>0&&(h.encodings=Fs(Ac(s.encodings)));const v=yield this._requestQueue.push(()=>this.channel._publish(h).catch(E=>{throw Se({operationName:"localPerson.publish",context:this.context,channel:this.channel,info:E.info,path:Ne.prefix,error:E})}));r.contentType==="data"?r.setIsEnabled(v.isEnabled):yield r.setEnabled(v.isEnabled);const D=this.channel._addPublication(v);if(D._setStream(r),(l=h.codecCapabilities)!=null&&l.length&&D.setCodecCapabilities(h.codecCapabilities),(d=h.encodings)!=null&&d.length&&D.setEncodings(h.encodings),yield this._handleOnStreamPublish(D),Ne.elapsed(C,"[end] publish",yield je({operationName:"localPerson.publish",channel:this.channel}),{publication:D}),["video","audio"].includes(D.contentType)&&this._analytics&&!this._analytics.isClosed()){this._analytics.client.sendMediaDeviceReport({publicationId:D.id,mediaDeviceName:D.deviceName,mediaDeviceTrigger:"publish",updatedAt:Date.now()});const E=(m=h.encodings)!=null?m:[];this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:D.id,encodings:E,updatedAt:Date.now()})}return D})}_handleOnStreamPublish(i){return M(this,null,function*(){Ne.info("onStreamPublished",yield je({operationName:"onStreamPublished",channel:this.channel})),this.onStreamPublished.emit({publication:i}),this.onPublicationListChanged.emit()})}unpublish(i){return M(this,null,function*(){const r=Ne.info("[start] unpublish",yield je({operationName:"localPerson.unpublish",channel:this.channel})),s=typeof i=="string"?i:i.id;if(this.state!=="joined")throw Se({operationName:"localPerson.unpublish",info:Pe.localPersonNotJoinedChannel,path:Ne.prefix,context:this.context,channel:this.channel});const o=this.channel._getPublication(s);if(!o)throw Se({operationName:"localPerson.unpublish",info:Pe.publicationNotExist,path:Ne.prefix,context:this.context,channel:this.channel,payload:{publicationId:s}});o.stream&&o.stream._unpublished(),yield this._requestQueue.push(()=>this.channel._unpublish(s)),o.subscriptions.map(l=>l.subscriber).forEach(l=>{am(l)&&this._publishingAgent.stopPublishing(o,l).catch(d=>{Ne.error("[failed] stopPublishing",d,{publication:o})})}),yield this._handleOnStreamUnpublished(o),Ne.elapsed(r,"[end] unpublish",yield je({operationName:"localPerson.unpublish",channel:this.channel}),{publication:o})})}_handleOnStreamUnpublished(i){return M(this,null,function*(){Ne.info("onStreamUnpublished",yield je({operationName:"onStreamUnpublished",channel:this.channel})),this.onStreamUnpublished.emit({publication:i}),this.onPublicationListChanged.emit()})}subscribe(i){return M(this,arguments,function*(r,s={}){const o=Ne.info("[start] subscribe",yield je({operationName:"localPerson.subscribe",channel:this.channel}),{target:r}),l=typeof r=="string"?r:r.id;if(this.state!=="joined")throw Se({operationName:"localPerson.subscribe",info:Pe.localPersonNotJoinedChannel,path:Ne.prefix,context:this.context,channel:this.channel,payload:{target:r}});const d=this.channel._getPublication(l);if(d==null)throw Se({operationName:"localPerson.subscribe",info:Pe.publicationNotExist,path:Ne.prefix,context:this.context,channel:this.channel,payload:d});this._validatePublicationForSubscribe(d),this._subscribing[d.id]={options:s,processing:!0};const m=this._subscribing[d.id];try{const C=yield this._requestQueue.push(()=>this.channel._subscribe(this.id,l));Ne.elapsed(o,"[elapsed] subscribe / subscriptionDto received",{subscriptionDto:C});const h=this.channel._addSubscription(C);return h.stream||(yield Promise.race([new Promise((v,D)=>{this.onPublicationSubscribed.watch(({subscription:E})=>E.publication.id===l,this.context.config.rtcApi.timeout).then(v).catch(E=>M(this,null,function*(){m.processing&&D(Se({operationName:"localPerson.subscribe",info:ge(ue({},Pe.timeout),{detail:"failed to subscribe publication. maybe publisher already left room"}),path:Ne.prefix,context:this.context,channel:this.channel,payload:{subscription:h,publication:d},error:E}))}))}),new Promise((v,D)=>{this.channel.onMemberLeft.watch(E=>E.member.id===d.publisher.id,this.context.config.rtcApi.timeout+1e3).then(()=>{m.processing&&D(Se({operationName:"localPerson.subscribe",info:ge(ue({},Pe.internal),{detail:"failed to subscribe publication. publisher already left room"}),path:Ne.prefix,context:this.context,channel:this.channel,payload:{subscription:h,publication:d}}))}).catch(v)}),new Promise((v,D)=>{this._onStreamSubscribeFailed.watch(E=>E.subscription.publication.id===d.id,this.context.config.rtcApi.timeout+1e3).then(E=>{var R,b;if(m.processing){const H=(b=(R=E==null?void 0:E.error)==null?void 0:R.info)!=null?b:ge(ue({},Pe.internal),{detail:"subscribe _onStreamSubscribeFailed"});D(Se({operationName:"localPerson.subscribe",info:H,path:Ne.prefix,context:this.context,channel:this.channel,error:E.error,payload:{subscription:h,publication:d}}))}}).catch(v)})])),m.processing=!1,Ne.elapsed(o,"[end] subscribe",yield je({operationName:"localPerson.subscribe",channel:this.channel}),{subscription:h,publication:d}),{subscription:h,stream:h.stream}}catch(C){throw m.processing=!1,Ne.warn("[failed] subscribe",C,{publication:d}),C}})}_validatePublicationForSubscribe(i){if(i.publisher.id===this.id)throw Se({operationName:"localPerson._validatePublicationForSubscribe",info:Pe.publicationNotExist,path:Ne.prefix,context:this.context,channel:this.channel,payload:{publication:i}});if(i.publisher instanceof Sc)throw Se({operationName:"localPerson._validatePublicationForSubscribe",info:Pe.unknownMemberType,path:Ne.prefix,context:this.context,channel:this.channel,payload:{publication:i}});if(this.subscriptions.find(r=>r.publication.id===i.id))throw Se({operationName:"localPerson._validatePublicationForSubscribe",info:Pe.alreadySubscribedPublication,path:Ne.prefix,context:this.context,channel:this.channel,payload:{publication:i}})}unsubscribe(i){return M(this,null,function*(){const r=Ne.info("[start] unsubscribe",yield je({operationName:"localPerson.unsubscribe",channel:this.channel})),s=typeof i=="string"?i:i.id;if(this.state!=="joined")throw Se({operationName:"localPerson.unsubscribe",info:Pe.localPersonNotJoinedChannel,path:Ne.prefix,context:this.context,channel:this.channel});const o=this.subscriptions.find(l=>l.id===s);if(!o)throw Se({operationName:"localPerson.unsubscribe",info:Pe.subscriptionNotExist,path:Ne.prefix,context:this.context,channel:this.channel,payload:{subscriptionId:s}});delete this._subscribing[o.publication.id],yield this._requestQueue.push(()=>this.channel._unsubscribe(s)),Ne.elapsed(r,"[end] unsubscribe",yield je({operationName:"localPerson.unsubscribe",channel:this.channel}),{subscription:o})})}_getConnections(){return this.channel.members.map(s=>s._getConnection(this.id)).filter(s=>(s==null?void 0:s.closed)===!1)}dispose(){this._disposed||(this._disposed=!0,Ne.debug("disposed",this.toJSON()),clearInterval(this.ttlInterval),this._signaling&&this._signaling.close(),this._analytics&&this._analytics.close(),this._getConnections().forEach(i=>i.close({reason:"localPerson disposed"})),this._onDisposed.emit(),this._events.dispose(),this._disposer.dispose())}};Z();Z();var xi=new Ie("packages/core/src/subscription/index.ts"),Sg=class{constructor(e){this._disposer=new ei,this._state="enabled",this.onCanceled=new De,this.onStreamAttached=new De,this.onConnectionStateChanged=new De,this._onChangeEncoding=new De,this.cancel=()=>new Promise((i,r)=>{let s=!1;this._channel._unsubscribe(this.id).catch(o=>{s=!0,r(o)}),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>i()).catch(o=>{s||r(o)})}),this._channel=e.channel,this._context=this._channel._context,this.id=e.id,this.contentType=e.contentType,this.subscriber=e.subscriber,this.publication=e.publication,xi.debug("subscription spawned",this.toJSON()),this._handlePublicationEnabled()}get state(){return this._state}_handlePublicationEnabled(){this.publication.onDisabled.add(()=>{this.stream&&(xi.debug("disabled",this),this.stream.setIsEnabled(!1))}).disposer(this._disposer),this.publication.onEnabled.add(()=>{this.stream&&(xi.debug("enabled",this),this.stream.setIsEnabled(!0))}).disposer(this._disposer),this.stream&&this.stream.setIsEnabled(this.publication.state==="enabled")}_setStream(e){this._stream=e,this.onStreamAttached.emit(),e._onConnectionStateChanged.add(i=>{xi.debug("onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit(i)})}get stream(){return this._stream}toJSON(){return{id:this.id,contentType:this.contentType,subscriber:this.subscriber,publication:this.publication,channelId:this._channel.id,state:this.state,stream:this.stream}}_canceled(){this._state="canceled",this.onCanceled.emit(),this._disposer.dispose()}changePreferredEncoding(e){if(!this.stream)throw Se({operationName:"SubscriptionImpl.changePreferredEncoding",info:Pe.streamNotExistInSubscription,path:xi.prefix,context:this._context,channel:this._channel});if(this.stream.contentType==="data")throw Se({operationName:"SubscriptionImpl.changePreferredEncoding",info:Pe.dataStreamNotSupportEncoding,path:xi.prefix,context:this._context,channel:this._channel});if(!this.publication.encodings.map(i=>i.id).includes(e))throw Se({operationName:"SubscriptionImpl.changePreferredEncoding",info:Pe.correspondingEncodeNotExistForId,path:xi.prefix,context:this._context,channel:this._channel});this.preferredEncoding=e,this._onChangeEncoding.emit()}getStats(){if(!this.stream)throw Se({operationName:"SubscriptionImpl.getStats",info:Pe.streamNotExistInSubscription,path:xi.prefix,context:this._context,channel:this._channel});return this.stream._getStats()}getRTCPeerConnection(){if(!this.stream)throw Se({operationName:"SubscriptionImpl.getRTCPeerConnection",info:Pe.streamNotExistInSubscription,path:xi.prefix,context:this._context,channel:this._channel});return this.stream._getRTCPeerConnection()}getConnectionState(){if(!this.stream)throw Se({operationName:"SubscriptionImpl.getConnectionState",info:Pe.streamNotExistInSubscription,path:xi.prefix,context:this._context,channel:this._channel});return this.stream._getConnectionState()}};function wg(e,{subscriberId:i,publicationId:r,id:s}){const o=e._getSubscription(s);if(o)return o;const d=e._getPublication(r).contentType;return new Sg({channel:e,id:s,subscriber:e._getMember(i),publication:e._getPublication(r),contentType:d})}var Ze=new Ie("packages/core/src/channel/index.ts"),ys=class{constructor(e,i){this._context=e,this._channelImpl=i,this.id=this._channelImpl.id,this.name=this._channelImpl.name,this.appId=this._context.appId,this.disposed=!1,this.config=this._context.config,this._state="opened",this._api=this._context._api,this._members={},this._getMember=r=>this._members[r],this._publications={},this._getPublication=r=>this._publications[r],this._subscriptions={},this._getSubscription=r=>this._subscriptions[r],this._events=new Ti,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this._onDisposed=this._events.make(),this.leave=r=>M(this,null,function*(){return this._channelImpl.leave(this.id,r.id)}),this.updateMetadata=r=>this._channelImpl.updateChannelMetadata(r),this.close=()=>new Promise((r,s)=>M(this,null,function*(){if(this.state==="closed"){s(Se({operationName:"SkyWayChannelImpl.close",path:Ze.prefix,info:Pe.alreadyChannelClosed,channel:this,context:this._context,payload:this.toJSON()}));return}const o=Ze.info("[start] close channel",yield je({operationName:"SkyWayChannelImpl.close",channel:this}));try{yield this._channelImpl.close().catch(l=>{throw Se({operationName:"SkyWayChannelImpl.close",context:this._context,info:ge(ue({},Pe.internal),{detail:"_api.deleteChannel failed"}),error:l,path:Ze.prefix,channel:this})}),this._state!=="closed"&&(yield this.onClosed.asPromise(this._context.config.rtcApi.timeout).catch(l=>{throw Se({operationName:"SkyWayChannelImpl.close",context:this._context,info:ge(ue({},Pe.timeout),{detail:"channel.onClosed"}),error:l,path:Ze.prefix,channel:this})}))}catch(l){Ze.error(l.message,l),s(l)}Ze.elapsed(o,"[end] close channel",yield je({operationName:"SkyWayChannelImpl.close",channel:this})),r()})),this._updateMemberTtl=(r,s)=>this._channelImpl.updateMemberTtl(r,s),this._updateMemberMetadata=(r,s)=>this._channelImpl.updateMemberMetadata(r,s),this._publish=r=>this._channelImpl.publish(r),this._unpublish=r=>M(this,null,function*(){return this._channelImpl.unpublish(r)}),this._subscribe=(r,s)=>{const o=this._getPublication(s),l=this._getMember(r);if(l==null)throw Se({operationName:"SkyWayChannelImpl._subscribe",path:Ze.prefix,info:ge(ue({},Pe.internal),{detail:"subscriber not found"}),channel:this,context:this._context,payload:{subscriberId:r,publicationId:s}});return this._channelImpl.subscribe({publication:o.toJSON(),subscriber:l.toJSON()})},this._unsubscribe=r=>M(this,null,function*(){if(!this._getSubscription(r))throw Se({operationName:"SkyWayChannelImpl._unsubscribe",path:Ze.prefix,info:ge(ue({},Pe.internal),{detail:"can't unsubscribe not exist subscription"}),channel:this,context:this._context,payload:{subscriptionId:r}});yield this._channelImpl.unsubscribe(r)}),this._updatePublicationMetadata=(r,s)=>this._channelImpl.updatePublicationMetadata(r,s),this._disablePublication=r=>this._channelImpl.disablePublication(r),this._enablePublication=r=>this._channelImpl.enablePublication(r),this._setupPropertiesFromChannel(),this._setupListenChannelEvent(),e._onDisposed.once(()=>{this.dispose()}),Ze.debug("channel spawned",this.toJSON())}_addMember(e){const i=this._getMember(e.id);if(i)return i;const r=this._context._createRemoteMember(this,e);return this._members[r.id]=r,r}_removeMember(e){delete this._members[e]}_addPublication(e){const i=this._getPublication(e.id);if(i)return i;const r=sm(this,e);return this._publications[e.id]=r,r}_removePublication(e){delete this._publications[e]}_addSubscription(e){const i=this._getSubscription(e.id);if(i)return i;const r=wg(this,e);return this._subscriptions[e.id]=r,r}_removeSubscription(e){delete this._subscriptions[e]}get localPerson(){return this._localPerson}get members(){return Object.values(this._members)}get bots(){return this.members.filter(e=>e.type==="bot")}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}get metadata(){return this._channelImpl.metadata}get state(){return this._state}toJSON(){return{id:this.id,name:this.name,appId:this.appId,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}_setupPropertiesFromChannel(){this._channelImpl.members.forEach(e=>{this._addMember(e)}),this._channelImpl.publications.forEach(e=>{this._addPublication(e)}),this._channelImpl.subscriptions.forEach(e=>{this._addSubscription(e)})}_setupListenChannelEvent(){this._channelImpl.onClosed.add(()=>this._handleOnChannelClose()),this._channelImpl.onMetadataUpdated.add(({channel:e})=>this._handleOnChannelMetadataUpdate(e.metadata)),this._channelImpl.onMemberJoined.add(({member:e})=>{this._handleOnMemberJoin(e)}),this._channelImpl.onMemberLeft.add(({member:e})=>{this._handleOnMemberLeft(e)}),this._channelImpl.onMemberListChanged.pipe(this.onMemberListChanged),this._channelImpl.onMemberMetadataUpdated.add(({member:e})=>{this._handleOnMemberMetadataUpdate(e,e.metadata)}),this._channelImpl.onStreamPublished.add(({publication:e})=>{this._handleOnStreamPublish(e)}),this._channelImpl.onStreamUnpublished.add(({publication:e})=>{this._handleOnStreamUnpublish(e)}),this._channelImpl.onPublicationListChanged.pipe(this.onPublicationListChanged),this._channelImpl.onPublicationMetadataUpdated.add(({publication:e})=>{this._handleOnPublicationMetadataUpdate(e,e.metadata)}),this._channelImpl.onPublicationEnabled.add(e=>M(this,[e],function*({publication:i}){return yield this._handleOnPublicationEnabled(i)})),this._channelImpl.onPublicationDisabled.add(e=>M(this,[e],function*({publication:i}){return yield this._handleOnPublicationDisabled(i)})),this._channelImpl.onPublicationSubscribed.add(({subscription:e})=>{this._handleOnStreamSubscribe(e)}),this._channelImpl.onPublicationUnsubscribed.add(({subscription:e})=>{this._handleOnStreamUnsubscribe(e)}),this._channelImpl.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged)}_handleOnChannelClose(){this._state="closed",this.onClosed.emit({}),this.dispose()}_handleOnChannelMetadataUpdate(e){this.onMetadataUpdated.emit({metadata:e})}_handleOnMemberJoin(e){const i=this._addMember(e);this.onMemberJoined.emit({member:i})}_handleOnMemberLeft(e){var i;const r=this._getMember(e.id);this._removeMember(r.id),r._left(),((i=this.localPerson)==null?void 0:i.id)===e.id&&(this.localPerson._left(),this._localPerson=void 0),this.onMemberLeft.emit({member:r})}_handleOnMemberMetadataUpdate(e,i){var r;const s=this._getMember(e.id);s._metadataUpdated(i),((r=this.localPerson)==null?void 0:r.id)===e.id&&this.localPerson._metadataUpdated(i),this.onMemberMetadataUpdated.emit({member:s,metadata:i})}_handleOnStreamPublish(e){const i=this._addPublication(e);this.onStreamPublished.emit({publication:i})}_handleOnStreamUnpublish(e){const i=this._getPublication(e.id);this._removePublication(i.id),i._unpublished(),this.onStreamUnpublished.emit({publication:i})}_handleOnPublicationMetadataUpdate(e,i){const r=this._getPublication(e.id);r._updateMetadata(i),this.onPublicationMetadataUpdated.emit({publication:r,metadata:i})}_handleOnPublicationEnabled(e){return M(this,null,function*(){const i=this._getPublication(e.id);i._enable(),this.onPublicationEnabled.emit({publication:i})})}_handleOnPublicationDisabled(e){return M(this,null,function*(){const i=this._getPublication(e.id);yield i._disable(),this.onPublicationDisabled.emit({publication:i})})}_handleOnStreamSubscribe(e){const i=this._addSubscription(e);this._getPublication(i.publication.id)._subscribed(i),this.onPublicationSubscribed.emit({subscription:i})}_handleOnStreamUnsubscribe(e){const i=this._getSubscription(e.id);this._removeSubscription(i.id),i._canceled(),this._getPublication(i.publication.id)._unsubscribed(i),this.onPublicationUnsubscribed.emit({subscription:i})}join(){return M(this,arguments,function*(e={}){var i,r;const s=Ze.info("[start] join",yield je({operationName:"SkyWayChannelImpl.join",channel:this}));if(this._localPerson)throw Se({operationName:"SkyWayChannelImpl.join",path:Ze.prefix,info:Pe.alreadyLocalPersonExist,channel:this,context:this._context});if(e.name!=null&&this.members.find(h=>h.name===e.name))throw Se({operationName:"SkyWayChannelImpl.join",path:Ze.prefix,info:Pe.alreadySameNameMemberExist,channel:this,context:this._context,payload:e});(i=e.keepaliveIntervalSec)!=null||(e.keepaliveIntervalSec=this.config.member.keepaliveIntervalSec),(r=e.keepaliveIntervalGapSec)!=null||(e.keepaliveIntervalGapSec=this.config.member.keepaliveIntervalGapSec);const o=ge(ue({},e),{type:"person",subtype:"person"});e.keepaliveIntervalSec!==null&&(o.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+e.keepaliveIntervalSec);const l=yield this._channelImpl.joinChannel(o).catch(C=>{throw Ze.error("[failed] join",C),C});Ze.elapsed(s,"[elapsed] join / channelImpl.joinChannel",{member:l});const d=yield this._createLocalPerson(l,e),m=new Ba(d);return Ze.elapsed(s,"[end] join",{person:d}),m})}moveChannel(e){return M(this,null,function*(){if(this._localPerson)throw Se({operationName:"SkyWayChannelImpl.moveChannel",path:Ze.prefix,info:Pe.alreadyLocalPersonExist,channel:this,context:this._context});if(!(e instanceof Ba))throw Se({operationName:"SkyWayChannelImpl.moveChannel",path:Ze.prefix,info:Pe.invalidArgumentValue,channel:this,context:this._context});const i=e.channel;if(this.id===i.id)throw Se({operationName:"SkyWayChannelImpl.moveChannel",path:Ze.prefix,info:Pe.cantMoveSameIdChannel,channel:this,context:this._context});yield i.leave(e);const r={name:e.name,type:e.type,subtype:e.subtype,metadata:e.metadata};e.keepaliveIntervalSec!=null&&(r.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+e.keepaliveIntervalSec);const s=yield this._channelImpl.joinChannel(r),o=yield this._createLocalPerson(s,{keepaliveIntervalSec:e.keepaliveIntervalSec,keepaliveIntervalGapSec:e.keepaliveIntervalGapSec,disableSignaling:e.disableSignaling,disableAnalytics:e.disableAnalytics});e.apply(o)})}_createLocalPerson(e,i){return M(this,null,function*(){const r=yield yg(this._context,this,e,i);return this._localPerson=r,r})}dispose(){this.disposed||(this.disposed=!0,Ze.debug("disposed",this.toJSON()),this._channelImpl.dispose(),this._onDisposed.emit(),this._events.dispose())}},Xs=class{static Create(e){return M(this,arguments,function*(i,r={}){const s=Ze.info("[start] createChannel",{operationName:"SkyWayChannel.Create"}),o=yield i._api.createChannel(r).catch(d=>{throw Ze.error("[failed] createChannel",d),d}),l=new ys(i,o);return Ze.elapsed(s,"[end] createChannel"),l})}static Find(e,i){return M(this,null,function*(){const r=Ze.info("[start] findChannel",{operationName:"SkyWayChannel.Find"}),s=yield e._api.findChannel(i).catch(l=>{throw Ze.error("[failed] findChannel",l),l}),o=new ys(e,s);return Ze.elapsed(r,"[end] findChannel"),o})}static FindOrCreate(e,i){return M(this,null,function*(){const r=Ze.info("[start] findOrCreateChannel",{operationName:"SkyWayChannel.FindOrCreate"}),s=yield e._api.findOrCreateChannel(i).catch(l=>{throw Ze.error("[failed] findOrCreateChannel",l),l}),o=new ys(e,s);return Ze.elapsed(r,"[end] findOrCreateChannel"),o})}constructor(){}};Z();Z();Z();var _s=new Ie("packages/core/src/media/factory.ts"),Cg=class{constructor(){if(this.onDeviceChange=new De,this._devices=[],!(navigator!=null&&navigator.mediaDevices))throw Se({operationName:"StreamFactory.constructor",info:Pe.mediaDevicesNotFound,path:_s.prefix});navigator.mediaDevices.addEventListener("devicechange",()=>M(this,null,function*(){const e=yield this._enumerateDevicesArray(),i=[];this._devices.forEach(s=>{e.map(o=>o.id).includes(s.id)||i.push(s)});const r=[];e.map(s=>s.id).forEach(s=>{this._devices.map(o=>o.id).includes(s)||r.push(e.find(o=>o.id===s))}),_s.debug("device changed",{added:r,removed:i}),i.forEach(s=>{this.onDeviceChange.emit({state:"removed",device:s})}),r.forEach(s=>{this.onDeviceChange.emit({state:"added",device:s})}),this._devices=e}))}_enumerateDevicesArray(){return M(this,null,function*(){return(yield navigator.mediaDevices.enumerateDevices()).map(i=>new xg(i)).filter(i=>i.id.length>0)})}_enumerateDevicesWithAuth(){return M(this,arguments,function*({video:e,audio:i}={audio:!0,video:!0}){let r=[];return(e||i)&&(r=(yield navigator.mediaDevices.getUserMedia({video:e,audio:i})).getTracks()),this._devices=yield this._enumerateDevicesArray(),r.forEach(s=>s.stop()),this._devices})}enumerateDevices(){return M(this,null,function*(){return yield this._enumerateDevicesWithAuth()})}enumerateInputVideoDevices(){return M(this,null,function*(){return(yield this._enumerateDevicesWithAuth({video:!0})).filter(i=>i.kind==="videoinput")})}enumerateInputAudioDevices(){return M(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(i=>i.kind==="audioinput")})}enumerateOutputAudioDevices(){return M(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(i=>i.kind==="audiooutput")})}createCameraVideoStream(){return M(this,arguments,function*(e={}){var i;e.stopTrackWhenDisabled=(i=e.stopTrackWhenDisabled)!=null?i:!0;const[r]=(yield navigator.mediaDevices.getUserMedia({video:e})).getTracks(),s=new fs(r,e);return s._setLabel("camera"),s})}createMicrophoneAudioStream(){return M(this,arguments,function*(e={}){var i;e.stopTrackWhenDisabled=(i=e.stopTrackWhenDisabled)!=null?i:!0;const[r]=(yield navigator.mediaDevices.getUserMedia({audio:e})).getTracks(),s=new ps(r,e);return s._setLabel("microphone"),s})}createDisplayStreams(){return M(this,arguments,function*(e={}){var i,r,s;const o=(i=e.video)!=null?i:{};(r=o.stopTrackWhenDisabled)!=null||(o.stopTrackWhenDisabled=!0);let l=e.audio;l&&(l=typeof l=="boolean"?{}:l,(s=l.stopTrackWhenDisabled)!=null||(l.stopTrackWhenDisabled=!0)),e={audio:l,video:o};const d=yield navigator.mediaDevices.getDisplayMedia(e),[m]=d.getVideoTracks(),[C]=d.getAudioTracks();e.audio&&!C&&_s.warn(vt({operationName:"StreamFactory.createDisplayStreams",detail:"This client does not support device audio capture"}));const h=new fs(m,ge(ue({},o),{isDisplayMedia:!0}));h._setLabel("displayVideo");const v=C?new ps(C,ge(ue({},l),{isDisplayMedia:!0})):void 0;return v&&v._setLabel("displayAudio"),{video:h,audio:v}})}createDataStream(){return M(this,arguments,function*(e={}){return new Gs(e)})}createMicrophoneAudioAndCameraStream(){return M(this,arguments,function*({audio:e,video:i}={}){var r,s;const o=yield navigator.mediaDevices.getUserMedia({audio:e??!0,video:i??!0}),[l]=o.getAudioTracks(),[d]=o.getVideoTracks();e=e??{},e.stopTrackWhenDisabled=(r=e.stopTrackWhenDisabled)!=null?r:!0;const m=new ps(l,e);m._setLabel("microphone"),i=i??{},i.stopTrackWhenDisabled=(s=i.stopTrackWhenDisabled)!=null?s:!0;const C=new fs(d,i);return C._setLabel("camera"),{audio:m,video:C}})}createCustomVideoStream(e){return M(this,arguments,function*(i,r={}){var s,o;r.stopTrackWhenDisabled=(s=r.stopTrackWhenDisabled)!=null?s:!0;const l=new rm(r),d=yield i.createProcessedStream({constraints:(o=r.constraints)!=null?o:{},stopTrackWhenDisabled:r.stopTrackWhenDisabled,onUpdateTrack:m=>l.updateTrack(m)});return yield l.setStream(d),l})}},$g=new Cg,xg=class{constructor(e){this.id=e.deviceId,this.label=e.label,this.kind=e.kind}};Z();Z();Z();Z();Z();Z();Z();Z();Z();Z();var Vc={domain:"sfu.skyway.ntt.com",secure:!0,version:4};Z();var Bi={invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストの値が不正です",solution:"正しい値を入力してください"},notFound:{name:"notFound",detail:"対象のリソースが見つかりません",solution:"対象のリソースが存在するか確かめてください"},maxSubscriberExceededError:{name:"maxSubscribersExceededError",detail:"forwardingのmaxSubscribersの制限を超えています。maxSubscribersの値を超えてSubscribeすることはできません",solution:"maxSubscribersの範囲内でご利用ください"},quotaExceededError:{name:"quotaExceededError",detail:"リソースの制限量を超えてリソースを利用することはできません",solution:"リソース制限量の範囲内でご利用ください"},timeout:{name:"timeout",detail:"",solution:""},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています",solution:"tokenに必要な権限を付与してください"},backendError:{name:"backendError:",detail:"",solution:""},notAllowedConsumeError:{name:"notAllowedConsumeError",detail:"ForwardingからのConsume許可がありません",solution:"Forwardingしているmemberによる許可操作が必要です"}};Z();function $i({operationName:e,info:i,error:r,path:s,payload:o}){return new Ai({error:r,info:i,payload:{payload:o,operationName:e},path:s})}function Ar({appId:e,detail:i,channelId:r,operationName:s,payload:o,memberId:l,botId:d}){return{operationName:s,payload:o,detail:i,appId:e,channelId:r,memberId:l,botId:d}}var Lt=new Ie("packages/sfu-api-client/src/api.ts"),Eg=class{constructor(e,i){this._token=e,this._headers={authorization:`Bearer ${this._token}`},this.options=ue(ue({},Vc),i),this.endpoint=`http${this.options.secure?"s":""}://${this.options.domain}/v${this.options.version}`,this.http=new Ws(this.endpoint),Ie.level=this.options.log.level,Ie.format=this.options.log.format,Lt.debug("SfuRestApiClient spawned",{endpoint:this.endpoint})}updateToken(e){this._token=e}_commonErrorHandler(e,i){switch(e==null?void 0:e.status){case 401:return $i({operationName:i,info:Bi.invalidRequestParameter,path:Lt.prefix,payload:e});case 403:return $i({operationName:i,info:Bi.insufficientPermissions,path:Lt.prefix,payload:e});case 404:return $i({operationName:i,info:Bi.notFound,path:Lt.prefix,payload:e});case 429:return $i({operationName:i,info:Bi.quotaExceededError,path:Lt.prefix,payload:e});default:return $i({operationName:i,info:Bi.backendError,path:Lt.prefix,payload:e})}}createBot(e){return M(this,arguments,function*({appId:i,channelId:r}){return(yield this.http.post("/bots",{appId:i,channelId:r},{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.createBot")})).id})}deleteBot(e){return M(this,arguments,function*({botId:i}){yield this.http.delete(`/bots/${i}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(r=>{throw this._commonErrorHandler(r,"SfuRestApiClient.deleteBot")})})}startForwarding(e){return M(this,arguments,function*({botId:i,publicationId:r,maxSubscribers:s,contentType:o,publisherId:l}){const d=new vi,m={publicationId:r,maxSubscribers:s,contentType:o[0].toUpperCase()+o.slice(1),publisherId:l},C=yield this.http.post(`/bots/${i}/forwardings`,m,{headers:{authorization:`Bearer ${this._token}`},retry:h=>M(this,null,function*(){return[400,403,429].includes(h.status)?!1:yield d.wait()})}).catch(h=>{throw this._commonErrorHandler(h,"SfuRestApiClient.startForwarding")});return d.count>0&&Lt.warn("success to retry startForwarding",Ar({operationName:"SfuRestApiClient.startForwarding",detail:"success to retry startForwarding",botId:i,memberId:l,payload:{publicationId:r,count:d.count}})),C})}createProducer(e){return M(this,arguments,function*({botId:i,forwardingId:r,transportId:s,producerOptions:o}){const l=new vi,d=yield this.http.put(`/bots/${i}/forwardings/${r}/transports/producers`,{transportId:s,producerOptions:o},{headers:{authorization:`Bearer ${this._token}`},retry:()=>M(this,null,function*(){return yield l.wait()})}).catch(m=>{throw this._commonErrorHandler(m,"SfuRestApiClient.createProducer")});return l.count>0&&Lt.warn("success to retry createProducer",Ar({operationName:"SfuRestApiClient.createProducer",detail:"success to retry createProducer",botId:i,payload:{forwardingId:r,transportId:s,count:l.count}})),d})}createConsumer(e){return M(this,arguments,function*({botId:i,forwardingId:r,rtpCapabilities:s,subscriptionId:o,subscriberId:l,spatialLayer:d,originPublicationId:m}){const C=new vi({times:5,interval:100}),h={rtpCapabilities:s,subscriptionId:o,subscriberId:l,spatialLayer:d,originPublicationId:m},v=yield this.http.post(`/bots/${i}/forwardings/${r}/transports/consumers`,h,{retry:D=>M(this,null,function*(){return[400,403,429].includes(D.status)?!1:yield C.wait()}),headers:{authorization:`Bearer ${this._token}`}}).catch(D=>{throw D.status===429?$i({operationName:"SfuRestApiClient.createConsumer",info:Bi.maxSubscriberExceededError,path:Lt.prefix,payload:D}):D.status===403?$i({operationName:"SfuRestApiClient.createConsumer",info:Bi.notAllowedConsumeError,path:Lt.prefix,payload:D}):this._commonErrorHandler(D,"SfuRestApiClient.createConsumer")});return C.count>0&&Lt.warn("success to retry createConsumer",Ar({operationName:"SfuRestApiClient.createConsumer",detail:"success to retry createConsumer",botId:i,payload:{forwardingId:r,count:C.count}})),Lt.debug("response of createConsumer",v),v})}connect(e){return M(this,arguments,function*({transportId:i,dtlsParameters:r}){const s=new vi,o={transportId:i,dtlsParameters:r},l=yield this.http.put("/transports/connections",o,{headers:{authorization:`Bearer ${this._token}`},retry:()=>M(this,null,function*(){return yield s.wait()})}).catch(d=>{throw this._commonErrorHandler(d,"SfuRestApiClient.connect")});return s.count>0&&Lt.warn("success to retry connect",Ar({operationName:"SfuRestApiClient.connect",detail:"success to retry connect",payload:{transportId:i,count:s.count}})),l})}changeConsumerLayer(e){return M(this,arguments,function*({transportId:i,consumerId:r,spatialLayer:s,publicationId:o}){return yield this.http.put(`transports/consumers/${r}/layers`,{transportId:i,spatialLayer:s,publicationId:o},{headers:{authorization:`Bearer ${this._token}`}}).catch(d=>{throw this._commonErrorHandler(d,"SfuRestApiClient.changeConsumerLayer")})})}stopForwarding({botId:e,forwardingId:i}){let r=!1;return{promise:this.http.delete(`/bots/${e}/forwardings/${i}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.stopForwarding")}).then(o=>{r=o}),fulfilled:r}}iceRestart(e){return M(this,arguments,function*({transportId:i}){return(yield this.http.put("/transports/connections/ice",{transportId:i},{headers:this._headers}).catch(s=>{throw this._commonErrorHandler(s,"SfuRestApiClient.iceRestart")})).iceParameters})}getRtpCapabilities(e){return M(this,arguments,function*({botId:i,forwardingId:r,originPublicationId:s}){const o=new vi,l=yield this.http.get(`/bots/${i}/forwardings/${r}/transports/rtp-capabilities?originPublicationId=${s}`,{headers:{authorization:`Bearer ${this._token}`},retry:()=>M(this,null,function*(){return yield o.wait()})}).catch(d=>{throw this._commonErrorHandler(d,"SfuRestApiClient.getRtpCapabilities")});return o.count>0&&Lt.warn("getCapabilities to retry connect",Ar({operationName:"SfuRestApiClient.getRtpCapabilities",detail:"getCapabilities to retry connect",botId:i,payload:{forwardingId:r,count:o.count}})),l.rtpCapabilities})}confirmSubscription(e){return M(this,arguments,function*({forwardingId:i,subscriptionId:r,identifierKey:s}){const o={forwardingId:i,subscriptionId:r,identifierKey:s},l=yield this.http.post("/confirm-subscription",o,{headers:{authorization:`Bearer ${this._token}`}}).catch(d=>{throw this._commonErrorHandler(d,"SfuRestApiClient.confirmSubscription")});return Lt.debug("response of confirmSubscription",l),l})}},Xe=ge(ue({},Bi),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},sfuBotNotInChannel:{name:"sfuBotNotInChannel",detail:"SfuBotがChannelに存在しません",solution:"操作しようとしているSfuBotが正しいか確かめてください"},maxSubscribersMustNotBeZero:{name:"maxSubscribersMustNotBeZero",detail:"maxSubscribersは１以上である必要があります",solution:"正しい値を入力してください"},remotePublisherId:{name:"remotePublisherId",detail:"publisherがremoteのPublicationをForwardingすることはできません",solution:"PublicationがLocalでPublishされたものか確かめてください"},dataStreamNotSupported:{name:"dataStreamNotSupported",detail:"dataStreamはSFUに対応していません",solution:"ありません"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},invalidPreferredEncoding:{name:"invalidPreferredEncoding",detail:"preferredEncodingの値が不正です。エンコード設定切り替え機能が使えません",solution:"正しい文字列を入力してください"},invalidEncodings:{name:"invalidEncodings",detail:"エンコード設定が設定されていません。エンコード設定切り替え機能が使えません",solution:"エンコード設定切り替え機能を利用する場合はエンコード設定をしたPublicationをForwardingしてください"},receiverNotFound:{name:"receiverNotFound",detail:"SFUはRemoteMemberのSubscriptionを操作できません",solution:"SFUでsubscriptionの操作をする際にはLocalPersonがSubscribeしているSubscriptionインスタンスを利用してください"},consumerNotFound:{name:"consumerNotFound",detail:"SFUはLocalPersonがUnsubscribeしたSubscriptionを操出来ません",solution:"操作対象のSubscriptionが正しいか確かめてください"},forwardingNotFound:{name:"forwardingNotFound",detail:"存在しないForwardingを操作しようとしています",solution:"対象のForwardingが正しいか確かめてください"},netWorkError:{name:"netWorkError",detail:"通信環境に問題があります",solution:"ネットワーク接続状況を確認してください"},confirmSubscriptionFailed:{name:"confirmSubscriptionFailed",detail:"Forwardingのconsume許可を出すのに失敗しました",solution:"ありません"}});Z();function Os(e,i){let r=0;for(;r<i.length&&i[r].id!==e;r++);return r}function Qi({channel:e,detail:i,operationName:r,payload:s,bot:o}){var l;const d={operationName:r,payload:s,detail:i};return e&&(d.appId=e.appId,d.channelId=e.id,e.localPerson&&(d.memberId=e.localPerson.id)),o&&(d.botId=o.id,d.appId=o.channel.appId,d.channelId=o.channel.id,d.memberId=(l=o.channel.localPerson)==null?void 0:l.id),d}Z();var ni=new Ie("packages/sfu-bot/src/connection/receiver.ts"),Pg=class{constructor(e,i,r,s,o,l,d){this.subscription=e,this._api=i,this._transportRepository=r,this._localPerson=s,this._bot=o,this._iceManager=l,this._context=d,this._disposer=new ei,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const m=this._localPerson._analytics;m&&m.onConnectionStateChanged.add(C=>{if(C==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const h of this._waitingSendSubscriptionStatsReports)this.consumer&&this.consumer.id===h&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}toJSON(){return{transport:this.transport,subscription:this.subscription}}consume(){return M(this,null,function*(){var e,i;let r=this._transportRepository.rtpCapabilities;r||(ni.debug("[start] getCapabilities"),r=yield this._api.getRtpCapabilities({botId:this._bot.id,forwardingId:this.subscription.publication.id,originPublicationId:this.subscription.publication.origin.id}),ni.debug("[end] getCapabilities"),yield this._transportRepository.loadDevice(r).catch(R=>{throw Se({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:ge(ue({},Xe.internal),{detail:"sfu loadDevice failed"}),path:ni.prefix,error:R})}));const s=this.subscription.preferredEncoding?Os(this.subscription.preferredEncoding,(i=(e=this.subscription.publication.origin)==null?void 0:e.encodings)!=null?i:[]):void 0;ni.debug("[start] createConsumer",{subscription:this.subscription});const{consumerOptions:o,transportOptions:l,transportId:d,producerId:m}=yield this._api.createConsumer({botId:this._bot.id,forwardingId:this.subscription.publication.id,rtpCapabilities:r,subscriptionId:this.subscription.id,subscriberId:this.subscription.subscriber.id,spatialLayer:s,originPublicationId:this.subscription.publication.origin.id});l&&this._transportRepository.createTransport(this._localPerson.id,this._bot,l,"recv",this._iceManager,this._localPerson._analytics),this.transport=this._transportRepository.getTransport(this._localPerson.id,d),this.transport||(ni.warn("transport is under race condition",{transportId:d}),yield this._transportRepository.onTransportCreated.watch(R=>R===d,this._bot.options.endpointTimeout).catch(R=>{throw Se({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:ge(ue({},Xe.timeout),{detail:"receiver sfuTransport not found"}),path:ni.prefix,error:R,payload:{transportOptions:l,transportId:d,producerId:m,consumerOptions:o,subscription:this.subscription}})}),this.transport=this._transportRepository.getTransport(this._localPerson.id,d)),this._localPerson._analytics&&!this._localPerson._analytics.isClosed()&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:this.subscription.id,role:"receiver",rtcPeerConnectionId:this.transport.id}),ni.debug("[end] createConsumer"),ni.debug("[start] consume",{consumerOptions:o,subscription:this.subscription});const C=yield this.transport.msTransport.consume(ge(ue({},o),{producerId:m})).catch(R=>{throw Se({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:ge(ue({},Xe.internal),{detail:"consume failed, maybe subscribing unsupported codec"}),path:ni.prefix,error:R})});this.consumer=C,ni.debug("[end] consume",{subscription:this.subscription});const[h]=C.rtpParameters.codecs,v=ks(Ur(),C.track,h),D={mimeType:h.mimeType,parameters:h.parameters};this._setupTransportAccessForStream(v,C);const E=this._localPerson._analytics;return E&&!E.isClosed()&&(E.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(C.id)),{stream:v,codec:D}})}_setupTransportAccessForStream(e,i){const r=this.transport,s=this.pc;e._getTransport=()=>({rtcPeerConnection:s,connectionState:r.connectionState,info:this}),e._getStats=()=>M(this,null,function*(){const o=yield i.getStats();let l=mr(o);return l=l.map(d=>(d.sfuTransportId=r.id,d)),l}),this._disposer.push(()=>{e._getTransport=()=>{}}),r.onConnectionStateChanged.add(o=>{ni.debug("transport connection state changed",r.id,o),e._setConnectionState(o)})}unconsume(){if(!this.consumer){ni.debug("unconsume failed, consumer not exist",{subscription:this.subscription});return}this.consumer.close(),this.consumer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer)}close(){this._disposer.dispose()}get pc(){var e;return(e=this.transport)==null?void 0:e.pc}startSendSubscriptionStatsReportTimer(){const e=this._localPerson._analytics;if(e){const i=e.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>M(this,null,function*(){if(!e||e.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this.consumer){const r=yield this.consumer.getStats();r&&e.client.sendSubscriptionStatsReport(r,{subscriptionId:this.subscription.id,role:"receiver",contentType:this.subscription.contentType,createdAt:Date.now()})}}),i*1e3)}}};Z();var eo=$t(wo());Z();var un=new Ie("packages/sfu-bot/src/connection/sender.ts"),Rg=class{constructor(e){this.props=e,this.state="started",this.configure=this.props.configure,this.originPublication=this.props.originPublication,this.relayingPublication=this.props.relayingPublication,this._identifierKey=this.props.identifierKey,this._api=this.props.api,this._context=this.props.context,this.onStopped=new De,this.relayingPublication.onSubscribed.add(i=>M(this,null,function*(){yield this.confirmSubscription(i.subscription).catch(r=>r)})),this.relayingPublication.subscriptions.forEach(i=>M(this,null,function*(){yield this.confirmSubscription(i).catch(r=>r)}))}get id(){return this.relayingPublication.id}_stop(){this.state="stopped",this.onStopped.emit()}toJSON(){return{id:this.id,configure:this.configure,originPublication:this.originPublication,relayingPublication:this.relayingPublication}}confirmSubscription(e){return M(this,null,function*(){un.debug("[start] Forwarding confirmSubscription");const{message:i}=yield this._api.confirmSubscription({forwardingId:this.id,subscriptionId:e.id,identifierKey:this._identifierKey}).catch(r=>{throw un.error("Forwarding confirmSubscription failed:",r),Se({operationName:"Forwarding.confirmSubscription",context:this._context,info:Xe.confirmSubscriptionFailed,path:un.prefix,payload:r})});un.debug("[end] Forwarding confirmSubscription",{message:i})})}},nt=new Ie("packages/sfu-bot/src/connection/sender.ts"),Tg=class{constructor(e,i,r,s,o,l,d,m){this.publication=e,this.channel=i,this._api=r,this._transportRepository=s,this._localPerson=o,this._bot=l,this._iceManager=d,this._context=m,this._disposer=new ei,this._connectionState="new",this.onConnectionStateChanged=new De,this.closed=!1,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const C=this._localPerson._analytics;C&&C.onConnectionStateChanged.add(h=>{if(h==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const v of this._waitingSendSubscriptionStatsReports)this._producer&&this._producer.id===v&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}_setConnectionState(e){this._connectionState!==e&&(nt.debug("_setConnectionState",{state:e,forwardingId:this.forwardingId}),this._connectionState=e,this.onConnectionStateChanged.emit(e))}toJSON(){return{forwarding:this.forwarding,broadcasterTransport:this._broadcasterTransport,_connectionState:this._connectionState}}startForwarding(e){return M(this,null,function*(){if(this.publication.contentType==="data")throw Se({operationName:"Sender.startForwarding",context:this._context,info:Xe.dataStreamNotSupported,path:nt.prefix,channel:this.channel});const i=this.publication.stream;if(!i)throw Se({operationName:"Sender.startForwarding",context:this._context,info:Xe.streamNotExistInPublication,path:nt.prefix,channel:this.channel});this.onConnectionStateChanged.add(R=>{var b;nt.debug("transport connection state changed",(b=this._broadcasterTransport)==null?void 0:b.id,R),i._setConnectionState(this._bot,R)}).disposer(this._disposer),nt.debug("[start] Sender startForwarding",{botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:e.maxSubscribers});const{forwardingId:r,broadcasterTransportId:s,broadcasterTransportOptions:o,rtpCapabilities:l,identifierKey:d}=yield this._api.startForwarding({botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:e.maxSubscribers,publisherId:this.publication.publisher.id});if(this.forwardingId=r,o&&(nt.debug("sender create new transport",{broadcasterTransportOptions:o}),yield this._transportRepository.loadDevice(l),this._broadcasterTransport=this._transportRepository.createTransport(this._localPerson.id,this._bot,o,"send",this._iceManager,this._localPerson._analytics)),this._broadcasterTransport=this._transportRepository.getTransport(this._localPerson.id,s),!this._broadcasterTransport)throw Se({operationName:"Sender.startForwarding",context:this._context,info:ge(ue({},Xe.internal),{detail:"_broadcasterTransport not found"}),path:nt.prefix,channel:this.channel,payload:{broadcasterTransportOptions:o}});this._broadcasterTransport.onConnectionStateChanged.add(R=>{this._setConnectionState(R)}).disposer(this._disposer),this._setConnectionState(this._broadcasterTransport.connectionState);const m=yield this._produce(i,this._broadcasterTransport);this._cleanupStreamCallbacks=this._setupTransportAccessForStream(i,this._broadcasterTransport,m);const C=this._localPerson._analytics;C&&!C.isClosed()&&(C.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(m.id)),nt.debug("[end] Sender startForwarding",{forwardingId:r});let h=this.channel._getPublication(r);h||(h=(yield this.channel.onStreamPublished.watch(R=>R.publication.id===r,this._context.config.rtcApi.timeout).catch(()=>{throw Se({operationName:"Sender.startForwarding",context:this._context,info:ge(ue({},Xe.timeout),{detail:"SfuBotMember onStreamPublished"}),path:nt.prefix,channel:this.channel,payload:{forwardingId:r}})})).publication);const v=new Rg({configure:e,originPublication:this.publication,relayingPublication:h,api:this._api,context:this._context,identifierKey:d});this.forwarding=v;const D=this.channel.subscriptions.find(R=>R.publication.id===this.publication.id),[E]=m.rtpParameters.codecs;return D.codec=E,this._localPerson._analytics&&this._localPerson._analytics.client.connectionState!=="closed"&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:D.id,role:"sender",rtcPeerConnectionId:this._broadcasterTransport.id}),Mc()&&Ma({stream:i,remoteMember:this._bot.id,end:R=>{const b=R.find(H=>H.id.includes("RTCOutboundRTP")||H.type.includes("outbound-rtp"));return(b==null?void 0:b.keyFramesEncoded)>0},interval:10}).then(()=>M(this,null,function*(){const R=this.publication.encodings;(R==null?void 0:R.length)>0&&(yield Mr(m.rtpSender,R).catch(b=>{nt.error("_onEncodingsChanged failed",b,this)}))})).catch(R=>{nt.error("setEncodingParams waitForLocalStats failed",R,this)}),Ma({stream:i,remoteMember:this._bot.id,end:R=>!!R.find(b=>b.type.includes("local-candidate"))}).then(()=>M(this,null,function*(){const R=yield je({operationName:"startForwarding/waitForLocalStats",channel:this.channel});nt.debug(R,"forwarding connection connected",{broadcasterTransportId:s})})).catch(()=>{}),v})}_listenStreamEnableChange(e){this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange();const{removeListener:i}=e._onEnableChanged.add(r=>M(this,null,function*(){yield this._replaceTrack(r).catch(s=>{nt.warn(Qi({detail:"replaceTrack failed",operationName:"Sender._listenStreamEnableChange",bot:this._bot,payload:s}))})}));this._unsubscribeStreamEnableChange=i}_produce(e,i){return M(this,null,function*(){var r,s,o,l,d,m,C,h;this.publication._onReplaceStream.add(k=>M(this,[k],function*({newStream:y}){if(!this._broadcasterTransport)throw Se({operationName:"Sender._produce",context:this._context,info:ge(ue({},Xe.internal),{detail:"_broadcasterTransport not found"}),path:nt.prefix,channel:this.channel});this._listenStreamEnableChange(y),this._cleanupStreamCallbacks&&this._cleanupStreamCallbacks(),this._cleanupStreamCallbacks=this._setupTransportAccessForStream(y,this._broadcasterTransport,j),yield this._replaceTrack(y.track)})).disposer(this._disposer),this._listenStreamEnableChange(e);const v=Ur(),D={track:e.track,stopTracks:!1,appData:{transactionId:v},disableTrackOnPause:!1},E=this.publication.encodings;E&&(D.encodings=E),this.publication._onEncodingsChanged.add(k=>M(this,null,function*(){yield Mr(j.rtpSender,k).catch(y=>{nt.error("_onEncodingsChanged failed",y,this)})})).disposer(this._disposer);const R=this.publication.codecCapabilities,b=(s=(r=this._transportRepository.rtpCapabilities)==null?void 0:r.codecs)!=null?s:[];nt.debug("select codec",{codecCapabilities:R,deviceCodecs:b});const[H]=R.map(k=>k.mimeType.toLowerCase().includes("video")?b.find(w=>{var F;return!(w.mimeType.toLowerCase()!==k.mimeType.toLowerCase()||Object.keys((F=k.parameters)!=null?F:{}).length>0&&!(0,eo.default)(k.parameters,w.parameters))}):b.find(f=>f.mimeType.toLowerCase()===k.mimeType.toLowerCase()));if(nt.debug("selected codec",{codec:H}),H){const[k,y]=H.mimeType.split("/");D.codec=ge(ue({},H),{mimeType:`${k}/${y.toUpperCase()}`}),e.contentType==="video"&&this._fixVideoCodecWithParametersOrder(H)}else R.length>0&&nt.warn("preferred codec not supported",Qi({channel:this.channel,detail:"preferred codec not supported",operationName:"Sender._produce",bot:this._bot,payload:{codecCapabilities:R,deviceCodecs:b}}));e.contentType==="audio"&&(((l=(o=R.find(w=>w.mimeType.toLowerCase()==="audio/opus"))==null?void 0:o.parameters)==null?void 0:l.usedtx)!==!1&&(D.codecOptions=ge(ue({},D.codecOptions),{opusDtx:!0})),(m=(d=R.find(w=>w.mimeType.toLowerCase()==="audio/opus"))==null?void 0:d.parameters)!=null&&m.stereo&&(D.codecOptions=ge(ue({},D.codecOptions),{opusStereo:!0})),(h=(C=R.find(w=>w.mimeType.toLowerCase()==="audio/opus"))==null?void 0:C.parameters)!=null&&h.useinbandfec&&(D.codecOptions=ge(ue({},D.codecOptions),{opusFec:!0}))),i.onProduce.watch(k=>{var y;return((y=k.producerOptions.appData)==null?void 0:y.transactionId)===v},this._context.config.rtcConfig.timeout).then(k=>M(this,null,function*(){try{const{producerId:y}=yield this._api.createProducer({botId:this._bot.id,transportId:i.id,forwardingId:this.forwardingId,producerOptions:k.producerOptions});k.callback({id:y})}catch(y){k.errback(y)}})).catch(k=>{nt.error("onProduce failed",k,this)}),nt.debug("[start] msTransport.produce",this);const j=yield i.msTransport.produce(D).catch(k=>{throw Se({operationName:"Sender._produce",context:this._context,info:ge(ue({},Xe.internal),{detail:"msTransport.produce failed"}),path:nt.prefix,channel:this.channel,error:k})});return nt.debug("[end] msTransport.produce",this),this._producer=j,j})}_fixVideoCodecWithParametersOrder(e){const i=this._broadcasterTransport.msTransport._handler,r=o=>o.mimeType===e.mimeType?e.parameters&&Object.keys(e.parameters).length>0?!!(0,eo.default)(o.parameters,e.parameters):!0:!1,s=(o,l)=>{for(const d of Object.keys(o))d!=="payloadType"&&(o[d]=l[d])};if(i._sendingRtpParametersByKind){const o=i._sendingRtpParametersByKind.video,l=o.codecs.find(r);if(o&&l){const d=JSON.parse(JSON.stringify(o)),[m]=o.codecs,C=JSON.parse(JSON.stringify(m));s(m,l),s(l,C),nt.debug("sort _sendingRtpParametersByKind",{origin:d,new:o.codecs})}}if(i._sendingRemoteRtpParametersByKind){const o=i._sendingRemoteRtpParametersByKind.video,l=o.codecs.find(r);if(o&&l){const d=JSON.parse(JSON.stringify(o)),[m]=o.codecs,C=JSON.parse(JSON.stringify(m));s(m,l),s(l,C),nt.debug("sort _sendingRemoteRtpParametersByKind",{origin:d,new:o.codecs})}}}_setupTransportAccessForStream(e,i,r){e._getTransportCallbacks[this._bot.id]=()=>({rtcPeerConnection:i.pc,connectionState:i.connectionState,info:this}),e._getStatsCallbacks[this._bot.id]=()=>M(this,null,function*(){if(r.closed)return delete e._getStatsCallbacks[this._bot.id],[];const o=yield r.getStats();let l=mr(o);return l=l.map(d=>(d.sfuTransportId=i.id,d)),l});const s=()=>{delete e._getTransportCallbacks[this._bot.id],delete e._getStatsCallbacks[this._bot.id]};return this._disposer.push(()=>{s()}),s}unproduce(){this._producer&&(this._producer.close(),this._producer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer))}_replaceTrack(e){return M(this,null,function*(){var i,r;yield(r=(i=this._producer)==null?void 0:i.replaceTrack)==null?void 0:r.call(i,{track:e}).catch(s=>{throw Se({operationName:"Sender._replaceTrack",context:this._context,info:Xe.internal,error:s,path:nt.prefix,channel:this.channel})})})}close(){this.closed=!0,this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange(),this._setConnectionState("disconnected"),this._disposer.dispose()}get pc(){var e;return(e=this._broadcasterTransport)==null?void 0:e.pc}startSendSubscriptionStatsReportTimer(){const e=this._localPerson._analytics,i=this._bot.subscriptions.find(r=>r.publication.id===this.publication.id);if(i&&e){const r=e.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>M(this,null,function*(){if(!e||e.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this._producer){const s=yield this._producer.getStats();s&&e.client.sendSubscriptionStatsReport(s,{subscriptionId:i.id,role:"sender",contentType:this.publication.contentType,createdAt:Date.now()})}}),r*1e3)}}},si=new Ie("packages/sfu-bot/src/connection/index.ts"),Ig=class{constructor(e,i,r,s,o,l){this._api=e,this.channel=i,this.localPerson=r,this.remoteMember=s,this._transportRepository=o,this._context=l,this.type="sfu",this.onDisconnect=new De,this.onClose=new De,this.closed=!1,this._receivers={},this._senders={}}addSender(e){const i=new Tg(e,this.channel,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);return this._senders[e.id]=i,i}removeSender(e){si.debug("removeSender",e);const i=this._senders[e];i&&i.unproduce()}startSubscribing(e){return M(this,null,function*(){var i;const r=new Pg(e,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);this._receivers[e.id]=r;const s=si.debug("[start] _startSubscribing consume"),{stream:o,codec:l}=yield r.consume().catch(d=>{throw si.error("[failed] _startSubscribing consume",Se({operationName:"SFUConnection.startSubscribing",context:this._context,channel:this.channel,info:ge(ue({},Xe.internal),{detail:"failed to receiver.consume"}),error:d,path:si.prefix,payload:{subscription:e.toJSON()}})),d});if(si.elapsed(s,"[end] _startSubscribing consume"),o.setIsEnabled(e.publication.state==="enabled"),e.codec=l,e._setStream(o),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const d=e.preferredEncoding,m=(i=e.publication.origin)==null?void 0:i.encodings;if(!d||!m||m.length===0)return;const C=Os(d,m);this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:e.id,preferredEncodingIndex:C,updatedAt:Date.now()})}})}stopSubscribing(e){return M(this,null,function*(){const i=this._receivers[e.id];i&&i.unconsume()})}stopPublishing(e){return M(this,null,function*(){this.removeSender(e.id)})}close({reason:e}={}){this.closed||(si.debug("close sfu connection",{remote:this.remoteMember,local:this.localPerson,reason:e}),this.closed=!0,Object.values(this._senders).forEach(i=>{i.close()}),Object.values(this._receivers).forEach(i=>{i.close()}),this._senders={},this._receivers={},this.onClose.emit())}_getReceiver(e){return this._receivers[e]}changePreferredEncoding(e){return M(this,null,function*(){var i;const r=e.preferredEncoding,s=(i=e.publication.origin)==null?void 0:i.encodings;if(si.debug("changePreferredEncoding",{preferredEncoding:r,encodings:s,subscription:e}),!r)throw Se({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:Xe.invalidPreferredEncoding,path:si.prefix,payload:{subscription:e}});if(!s||s.length===0)throw Se({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:Xe.invalidEncodings,path:si.prefix,payload:{subscription:e}});const o=Os(r,s),l=this._getReceiver(e.id);if(!l)throw Se({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:Xe.receiverNotFound,path:si.prefix,payload:{subscription:e}});const d=l.transport;if(!d)throw Se({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:ge(ue({},Xe.internal),{detail:"transport not found"}),path:si.prefix,payload:{subscription:e}});const m=l.consumer;if(!m)throw Se({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:Xe.consumerNotFound,path:si.prefix,payload:{subscription:e}});yield this._api.changeConsumerLayer({transportId:d.id,consumerId:m.id,publicationId:e.publication.id,spatialLayer:o}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:e.id,preferredEncodingIndex:o,updatedAt:Date.now()})})}};Z();Z();var Dg=10,Dt=new Ie("packages/sfu-bot/src/member.ts"),Kc=class zc extends Bn{constructor(i){super(i),this.side="remote",this.subtype=zc.subtype,this.type="bot",this._connections={},this.onForwardingStarted=new De,this.onForwardingStopped=new De,this.onForwardingListChanged=new De,this._startForwardQueue=new Ui,this._forwardings={},this.stopForwarding=r=>new Promise((s,o)=>M(this,null,function*(){const l=Dt.info("[start] stopForwarding",yield je({operationName:"SfuBotMember.stopForwarding",channel:this.channel}));if(this.state!=="joined"){o(Se({operationName:"SfuBotMember.stopForwarding",context:this._context,info:Xe.sfuBotNotInChannel,path:Dt.prefix,channel:this.channel,payload:{status:this.state}}));return}const d=typeof r=="string"?r:r.id,m=this._forwardings[d];if(!m){o(Se({operationName:"SfuBotMember.stopForwarding",context:this._context,info:Xe.forwardingNotFound,path:Dt.prefix,channel:this.channel,payload:{forwardingId:d,_forwardings:Object.keys(this._forwardings)}}));return}delete this._forwardings[m.id];const{promise:C,fulfilled:h}=this._api.stopForwarding({botId:this.id,forwardingId:d});let v=!1;C.catch(D=>{v=!0,o(D)}),this.onForwardingStopped.watch(D=>D.forwarding.id===d,this._context.config.rtcApi.timeout).then(()=>M(this,null,function*(){Dt.elapsed(l,"[end] stopForwarding",yield je({operationName:"SfuBotMember.stopForwarding",channel:this.channel})),s()})).catch(D=>{v||o(Se({operationName:"SfuBotMember.stopForwarding",context:this._context,info:ge(ue({},Xe.timeout),{detail:"onForwardingStopped"}),path:Dt.prefix,channel:this.channel,payload:{fulfilled:h},error:D}))})})),this._api=i.api,this._context=i.context,this._transportRepository=i.transportRepository,this.options=i.options,this.onLeft.once(()=>{Dt.debug("SfuBotMember left: ",{id:this.id}),Object.values(this._connections).forEach(r=>{r.close({reason:"sfu bot left"})}),this._connections={}})}get forwardings(){return Object.values(this._forwardings)}_getConnection(i){return this._connections[i]}_getOrCreateConnection(i){var r;return(r=this._getConnection(i.id))!=null?r:this._createConnection(this.channel,i,this)}_createConnection(i,r,s){const o=new Ig(s._api,i,r,s,this._transportRepository,this._context);return o.onClose.once(()=>{delete this._connections[r.id]}),this._connections[r.id]=o,o}startForwarding(i){return M(this,arguments,function*(r,s={}){const o=Dt.info("[start] startForwarding",yield je({operationName:"SfuBotMember.startForwarding",channel:this.channel})),l=yield this._startForwardQueue.push(()=>this._startForwarding(r,s));return Dt.elapsed(o,"[end] startForwarding",yield je({operationName:"SfuBotMember.startForwarding",channel:this.channel})),l})}_startForwarding(i,r){return M(this,null,function*(){if(r.maxSubscribers==null&&(r.maxSubscribers=Dg),r.maxSubscribers===0)throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Xe.maxSubscribersMustNotBeZero,path:Dt.prefix,payload:{configure:r}});if(this.state!=="joined")throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Xe.sfuBotNotInChannel,path:Dt.prefix,payload:{status:this.state}});if(!this.channel._getPublication(i.id))throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Pe.publicationNotExist,path:Dt.prefix});const s=this.channel.localPerson;if(!s)throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Pe.localPersonNotJoinedChannel,path:Dt.prefix});if(s.id!==i.publisher.id)throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,info:Xe.remotePublisherId,path:Dt.prefix,channel:this.channel});const o=Dt.debug("[start] SfuBotMember startForwarding",{publication:i.toJSON(),configure:r}),m=yield this._getOrCreateConnection(s).addSender(i).startForwarding(r).catch(C=>{throw Se({operationName:"SfuBotMember._startForwarding",context:this._context,info:ge(ue({},Xe.internal),{detail:"[failed] SfuBotMember startForwarding"}),path:Dt.prefix,channel:this.channel,error:C,payload:{publication:i.toJSON()}})});return this._forwardings[m.id]=m,this.listenStopForwardEvent(m),this.onForwardingStarted.emit({forwarding:m}),this.onForwardingListChanged.emit(),Dt.elapsed(o,"[end] SfuBotMember startForwarding",{forwarding:m.toJSON()}),m})}listenStopForwardEvent(i){const{removeListener:r}=this.channel.onStreamUnpublished.add(s=>{if(s.publication.id===i.id){r(),i._stop();const o=i.originPublication,l=this._getConnection(o.publisher.id);l&&l.removeSender(o.id),this.onForwardingStopped.emit({forwarding:i}),this.onForwardingListChanged.emit()}})}_dispose(){}};Kc.subtype="sfu";var er=Kc;Z();var Ag=ge(ue({},Vc),{endpointTimeout:3e4,ackTimeout:1e4,disableRestartIce:!1});Z();Z();var to=$t($h());Z();var Pt=new Ie("packages/sfu-bot/src/connection/transport/transport.ts"),Fg=class{constructor(e,i,r,s,o,l){this.msTransport=e,this._bot=i,this._iceManager=r,this._sfuApi=s,this._context=o,this._analyticsSession=l,this._backoffIceRestart=new vi({times:8,interval:100,jitter:100}),this._connectionState="new",this.onProduce=new De,this.onProduceData=new De,this.onMediasoupConnectionStateChanged=new De,this.onConnectionStateChanged=new De,this.restartIce=()=>M(this,null,function*(){if(this._backoffIceRestart.exceeded){Pt.error("_iceRestartedCount exceeded",Se({operationName:"SfuTransport.restartIce",context:this._context,info:Xe.netWorkError,path:Pt.prefix})),this._setConnectionState("disconnected");return}Pt.warn("[start] restartIce",Qi({bot:this._bot,detail:"start restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}}));const v=()=>{if(this._bot.state==="left")return Pt.debug("bot already left",this),this._setConnectionState("disconnected"),Pt.warn("[end] restartIce",Qi({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),!0;if(this.msTransport.connectionState==="connected")return this._backoffIceRestart.reset(),this._setConnectionState("connected"),Pt.warn("[end] restartIce",Qi({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestart.wait(),v())return;let D=yield this._iceManager.updateIceParams().catch(R=>R);if(D){Pt.warn("updateIceParams failed",Qi({operationName:"SfuTransport.restartIce",detail:"updateIceParams failed",bot:this._bot,payload:{transport:this}}),D),yield this.restartIce();return}if(yield this.msTransport.updateIceServers({iceServers:this._iceManager.iceServers}),v())return;const E=yield this._mediasoupRestartIce();if(D=yield this._waitForMsConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(R=>R),!D&&v())return E;yield this.restartIce()}),this._waitForMsConnectionState=(v,D=1e4)=>M(this,null,function*(){v!==this.msTransport.connectionState&&(yield this.onMediasoupConnectionStateChanged.watch(()=>v===this.msTransport.connectionState,D).catch(E=>{throw Se({operationName:"SfuTransport._waitForMsConnectionState",context:this._context,info:ge(ue({},Xe.timeout),{detail:"waitForConnectionState timeout"}),error:E,path:Pt.prefix})}))}),this._onConnect=v=>(D,E,R)=>M(this,[D,E,R],function*({dtlsParameters:b},H,j){try{Pt.debug("[start] transport connect",{transportId:v}),yield this._sfuApi.connect({transportId:v,dtlsParameters:b}),Pt.debug("[end] transport connect",{transportId:v}),H()}catch(k){Pt.error("[failed] transport connect",{error:k,transportId:v}),j(k)}});var d,m,C;const h=o.plugins.find(v=>v.subtype===Hn.subtype);this._options=h.options,Pt.debug("peerConfig",(C=(m=(d=this.pc)==null?void 0:d.getConfiguration)==null?void 0:m.call(d))!=null?C:{}),e.on("connect",(v,D,E)=>this._onConnect(e.id)(v,D,E)),e.on("connectionstatechange",v=>{this.onMediasoupConnectionStateChanged.emit(v),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"connectionStateChange",data:{connectionState:v},createdAt:Date.now()})}),e.on("produce",(v,D,E)=>{this.onProduce.emit({producerOptions:v,callback:D,errback:E})}),e.on("producedata",(v,D,E)=>{this.onProduceData.emit({producerOptions:v,callback:D,errback:E})}),this.onMediasoupConnectionStateChanged.add(v=>M(this,null,function*(){switch(je({operationName:"onMediasoupConnectionStateChanged",channel:this._bot.channel}).then(D=>{Pt.debug(D,{state:v,transportId:this.id,bot:i})}).catch(()=>{}),v){case"disconnected":case"failed":{if(this._connectionState==="reconnecting")return;(yield this._waitForMsConnectionState("connected",o.config.rtcConfig.iceDisconnectBufferTimeout).catch(E=>E))&&this._connectionState!=="reconnecting"&&i.options.disableRestartIce!==!0&&(yield this.restartIce())}break;case"connecting":case"connected":this._setConnectionState(v);break;case"closed":this._setConnectionState("disconnected");break}Pt.debug("onMediasoupConnectionStateChanged",this)}))}get pc(){var e,i,r;return(r=(i=(e=this.msTransport)==null?void 0:e._handler)==null?void 0:i._pc)!=null?r:{}}get id(){return this.msTransport.id}get connectionState(){return this._connectionState}toJSON(){return{id:this.id,direction:this.msTransport.direction,connectionState:this._connectionState}}close(){var e;Pt.debug("close",this.id),(e=this.pc)!=null&&e.peerIdentity&&this.pc.peerIdentity.catch(()=>{}),this.msTransport.close(),this._setConnectionState("disconnected")}_setConnectionState(e){this._connectionState!==e&&(Pt.debug("onConnectionStateChanged",this._connectionState,e,this),this._connectionState=e,this.onConnectionStateChanged.emit(e),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"skywayConnectionStateChange",data:{skywayConnectionState:e},createdAt:Date.now()}))}_mediasoupRestartIce(){return M(this,null,function*(){const e=yield this._sfuApi.iceRestart({transportId:this.id}).catch(i=>i);if(e instanceof Error){Pt.warn("iceRestart failed",Qi({operationName:"SfuTransport._mediasoupRestartIce",detail:"iceRestart failed",bot:this._bot,payload:{transport:this}}),e),yield this.restartIce();return}return yield this.msTransport.restartIce({iceParameters:e}),e})}},Ss=new Ie("packages/sfu-bot/src/connection/transport/transportRepository.ts"),kg=class{constructor(e,i){this._context=e,this._api=i,this.onTransportCreated=new De,this._transports={},this.getTransport=(o,l)=>this._transports[o+l];const{browserName:r,browserVersion:s}=_c();Ss.debug("runtime info",{browserName:r,browserVersion:s}),r==="Safari"&&s==null?this._device=new to.Device({handlerName:"Safari12"}):this._device=new to.Device}get rtpCapabilities(){if(this._device.loaded)return this._device.rtpCapabilities}loadDevice(e){return M(this,null,function*(){this._device.loaded||(yield this._device.load({routerRtpCapabilities:e}).catch(i=>{throw Se({operationName:"TransportRepository.loadDevice",context:this._context,info:ge(ue({},Xe.internal),{detail:"loadDevice failed"}),path:Ss.prefix,payload:{rtpCapabilities:e},error:i})}),Ss.debug("device loaded",{routerRtpCapabilities:e,rtpCapabilities:this._device.rtpCapabilities}))})}createTransport(e,i,r,s,o,l){const m=(s==="send"?h=>this._device.createSendTransport(h):h=>this._device.createRecvTransport(h))(ge(ue({},r),{iceServers:o.iceServers,iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,additionalSettings:this._context.config.rtcConfig})),C=new Fg(m,i,o,this._api,this._context,l);return this._transports[e+m.id]=C,this.onTransportCreated.emit(m.id),C}deleteTransports(e){Object.entries(ue({},this._transports)).forEach(([i,r])=>{i.includes(e)&&(r.close(),delete this._transports[i])})}};Z();var Og="1.9.2",Gi=new Ie("packages/sfu-bot/src/plugin.ts"),Wc=class $c extends Js{constructor(i={}){super(),this.subtype=$c.subtype,this._createRemoteMember=(r,s)=>new er(ge(ue({},this._context),{channel:r,id:s.id,name:s.name,metadata:s.metadata,plugin:this,api:this._api,context:this._context,transportRepository:this._transportRepository,options:this.options})),this.createBot=r=>M(this,null,function*(){var s;const o=Gi.info("[start] createBot",yield je({operationName:"SfuBotPlugin.createBot",channel:r})),l=yield this._api.createBot({appId:this._context.authToken.scope.app.id,channelId:r.id}),d=(s=r._getMember(l))!=null?s:(yield r.onMemberJoined.watch(m=>m.member.id===l,this._context.config.rtcApi.timeout).catch(m=>{throw Se({operationName:"SfuBotPlugin.createBot",info:ge(ue({},Xe.timeout),{detail:"onMemberJoined"}),path:Gi.prefix,error:m,context:this._context})})).member;return Gi.elapsed(o,"[end] createBot",yield je({operationName:"SfuBotPlugin.createBot",channel:r})),d}),this.deleteBot=(r,s)=>M(this,null,function*(){return new Promise((o,l)=>M(this,null,function*(){const d=Gi.info("[start] deleteBot",yield je({operationName:"SfuBotPlugin.deleteBot",channel:r}));let m=!1;this._api.deleteBot({botId:s}).catch(C=>{m=!0,l(C)}),r.onMemberLeft.watch(C=>C.member.id===s,this._context.config.rtcApi.timeout).then(()=>M(this,null,function*(){Gi.elapsed(d,"[end] deleteBot",yield je({operationName:"SfuBotPlugin.deleteBot",channel:r})),o()})).catch(C=>{m||l(Se({operationName:"SfuBotPlugin.deleteBot",info:ge(ue({},Xe.timeout),{detail:"onMemberLeft"}),path:Gi.prefix,channel:r,error:C,context:this._context}))})}))}),this.options=ue(ue({},Ag),i),this._onContextAttached.once(r=>{Ie.level=r.config.log.level,Ie.format=r.config.log.format,Gi.info("SfuBotPlugin spawned",{operationName:"SfuBotPlugin.constructor",endpoint:{sfu:this.options.domain},options:this.options,sdkName:"sfu-bot",sdkVersion:Og}),this._api=new Eg(r.authTokenString,ge(ue({},this.options),{log:r.config.log})),this._transportRepository=new kg(r,this._api),r._onTokenUpdated.add(s=>{this._api.updateToken(s)})}),this._whenDisposeLocalPerson=r=>M(this,null,function*(){this._transportRepository.deleteTransports(r.id)})}};Wc.subtype=er.subtype;var Hn=Wc,Mg={invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},notImplemented:{name:"notImplemented",detail:"対応していないRoomTypeです",solution:"正しいRoomTypeを指定してください"},roomNotOpened:{name:"roomNotOpened",detail:"RoomがOpenされていません",solution:"Roomの状態を確かめてください"},subscribeOtherMemberType:{name:"subscribeOtherMemberType",detail:"RemoteMemberにSubscribe/Unsubscribeさせる場合、対象のMemberのTypeはPersonである必要があります",solution:"対象のRemoteMemberが正しいか確認してください"},sfuRoomNotSupportDataStream:{name:"sfuRoomNotSupportDataStream",detail:"SFURoomでDataStreamを使うことは出来ません",solution:"ありません"},publicationNotHasOrigin:{name:"publicationNotHasOrigin",detail:"SfuRoomで操作するPublicationはOriginをもつ必要があります",solution:"SfuRoomとP2PRoomを同一のIDで混在させていないか確かめてください"},notFound:{name:"notFound",detail:"参照しようとしていたものが見つかりません",solution:"参照しようとしたものが存在するか確かめてください"}},Ht=ue(ue(ue({},Pe),Xe),Mg);Z();var Gc=class{constructor(e,i){this.member=e,this.room=i,this.onLeft=new De;const{removeListener:r}=i.onMemberLeft.add(s=>{s.member.id===this.member.id&&(r(),this.onLeft.emit())});this.onMetadataUpdated=e.onMetadataUpdated}get id(){return this.member.id}get name(){return this.member.name}get roomId(){return this.room.id}get roomName(){return this.room.name}get roomType(){return this.room.type}get state(){return this.member.state}get metadata(){return this.member.metadata}get _member(){return this.member}get publications(){return this.room.publications.filter(e=>e.publisher.id===this.id)}get subscriptions(){return this.member.subscriptions.map(e=>this.room._getSubscription(e.id))}updateMetadata(e){return this.member.updateMetadata(e)}leave(){return this.member.leave()}toJSON(){return{id:this.id,name:this.name,metadata:this.metadata}}};Z();var Jc=class extends Gc{constructor(e,i){super(e,i),this.side="local",this._local=this._member,this.onStreamPublished=new De,this.onStreamUnpublished=new De,this.onPublicationListChanged=new De,this.onPublicationSubscribed=new De,this.onPublicationUnsubscribed=new De,this.onSubscriptionListChanged=new De,this.onFatalError=new De,this._context=this.room._context,this._local.onPublicationSubscribed.add(r=>M(this,null,function*(){const s=i._addSubscription(r.subscription);this.onPublicationSubscribed.emit({subscription:s,stream:r.stream})})),this._local.onFatalError.pipe(this.onFatalError),this._listenRoomEvent(),this.onStreamPublished.add(()=>this.onPublicationListChanged.emit()),this.onStreamUnpublished.add(()=>this.onPublicationListChanged.emit()),this.onPublicationSubscribed.add(()=>this.onSubscriptionListChanged.emit()),this.onPublicationUnsubscribed.add(()=>this.onSubscriptionListChanged.emit())}get subscriptions(){return this.member.subscriptions.map(e=>this.room._getSubscription(e.id)).filter(e=>e.stream)}_listenRoomEvent(){this.room.onPublicationUnsubscribed.add(e=>{e.subscription.subscriber._member.id===this._local.id&&this.onPublicationUnsubscribed.emit(e)})}};Z();Z();function Bt({operationName:e,context:i,info:r,error:s,path:o,payload:l,room:d}){const m={operationName:e,payload:l};return d&&(m.appId=d._channel.appId,m.roomId=d.id,d.localRoomMember&&(m.memberId=d.localRoomMember.id)),i&&(m.info=i.info,m.plugins=i.plugins.map(C=>C.subtype)),new Ai({error:s,info:r,payload:m,path:o})}var Fr=new Ie("packages/room/src/member/local/p2p.ts"),Ng=class extends Jc{constructor(e,i){super(e,i)}publish(e){return M(this,arguments,function*(i,r={}){const s=yield this._local.publish(i,r),o=this.room._addPublication(s);return this.onStreamPublished.emit({publication:o}),o})}unpublish(e){return M(this,null,function*(){const i=typeof e=="string"?e:e.id;this._local.unpublish(i).catch(s=>{Fr.error("unpublish",s,{target:e},this.toJSON())});const{publication:r}=yield this.room.onStreamUnpublished.watch(s=>s.publication.id===i,this._context.config.rtcApi.timeout).catch(s=>{throw Bt({operationName:"LocalP2PRoomMemberImpl.unpublish",context:this._context,room:this.room,info:ge(ue({},Ht.timeout),{detail:"onStreamUnpublished"}),path:Fr.prefix,error:s})});this.onStreamUnpublished.emit({publication:r})})}subscribe(e){return M(this,null,function*(){const i=typeof e=="string"?e:e.id,{subscription:r,stream:s}=yield this._local.subscribe(i);return{subscription:this.room._addSubscription(r),stream:s}})}unsubscribe(e){return M(this,null,function*(){const i=typeof e=="string"?e:e.id;this._local.unsubscribe(i).catch(r=>{Fr.error("unsubscribe",r,{target:e},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(r=>r.subscription.id===i,this._context.config.rtcApi.timeout).catch(r=>{throw Bt({operationName:"LocalP2PRoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:ge(ue({},Ht.timeout),{detail:"onPublicationUnsubscribed"}),path:Fr.prefix,error:r})})})}_updateRoom(e){Fr.debug("_updateRoom",{memberId:this.id}),this.room=e,this._listenRoomEvent()}};Z();Z();var Lg=10,ji=new Ie("packages/room/src/member/local/sfu.ts"),jg=class extends Jc{constructor(e,i){super(e,i)}publish(e){return M(this,arguments,function*(i,r={}){var s;if(i instanceof Gs)throw Bt({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:Ht.sfuRoomNotSupportDataStream,path:ji.prefix});r.maxSubscribers=(s=r.maxSubscribers)!=null?s:Lg;const o=yield this._local.publish(i,r),l=this.room._channel.members.find(h=>h.subtype===er.subtype);if(!l)throw Bt({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:Xe.sfuBotNotInChannel,path:ji.prefix});const m=(yield l.startForwarding(o,{maxSubscribers:r.maxSubscribers})).relayingPublication,C=this.room._addPublication(m);return this.onStreamPublished.emit({publication:C}),C})}unpublish(e){return M(this,null,function*(){const i=typeof e=="string"?e:e.id,r=this.room._getPublication(i),s=r._publication.origin;if(!s)throw Bt({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:Ht.publicationNotHasOrigin,path:ji.prefix});this._local.unpublish(s.id).catch(o=>{ji.error("unpublish error",o,{target:e},this.toJSON())}),yield this.room.onStreamUnpublished.watch(o=>o.publication.id===i,this._context.config.rtcApi.timeout).catch(o=>{throw Bt({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:ge(ue({},Ht.timeout),{detail:"onStreamUnpublished"}),path:ji.prefix,error:o})}),this.onStreamUnpublished.emit({publication:r})})}subscribe(e,i){return M(this,null,function*(){const r=typeof e=="string"?e:e.id,{subscription:s,stream:o}=yield this._local.subscribe(r,i);return{subscription:this.room._addSubscription(s),stream:o}})}unsubscribe(e){return M(this,null,function*(){const i=typeof e=="string"?e:e.id;this._local.unsubscribe(i).catch(r=>{ji.error("unsubscribe error",r,{target:e},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(r=>r.subscription.id===i,this._context.config.rtcApi.timeout).catch(r=>{throw Bt({operationName:"LocalSFURoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:ge(ue({},Ht.timeout),{detail:"onPublicationUnsubscribed"}),path:ji.prefix,error:r})})})}_updateRoom(e){ji.debug("_updateRoom",{memberId:this.id}),this.room=e,this._listenRoomEvent()}};Z();var io=new Ie("packages/room/src/member/remote/base.ts"),wn=class extends Gc{constructor(e,i){super(e,i),this.side="remote",this.onPublicationSubscribed=new De,this.onPublicationUnsubscribed=new De,this.onSubscriptionListChanged=new De,this.onPublicationListChanged=new De,this._disposer=new ei,this.subscribe=r=>new Promise((s,o)=>{if(!(this.member instanceof mn)){o(Bt({operationName:"RemoteRoomMemberImpl.subscribe",context:this.room._context,room:this.room,info:Ht.subscribeOtherMemberType,path:io.prefix}));return}let l=!1;this.member.subscribe(r).catch(d=>{l=!0,o(d)}),this.onPublicationSubscribed.watch(d=>d.subscription.publication.id===r).then(d=>s(d)).catch(d=>{l||o(d)})}),this.unsubscribe=r=>new Promise((s,o)=>{if(!(this.member instanceof mn)){o(Bt({operationName:"RemoteRoomMemberImpl.unsubscribe",context:this.room._context,room:this.room,info:Ht.subscribeOtherMemberType,path:io.prefix}));return}let l=!1;this.member.unsubscribe(r).catch(d=>{l=!0,o(d)}),this.onPublicationUnsubscribed.watch(d=>d.subscription.id===r).then(()=>s()).catch(d=>{l||o(d)})}),i.onPublicationSubscribed.add(r=>{r.subscription.subscriber._member.id===e.id&&(this.onPublicationSubscribed.emit(r),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),i.onPublicationUnsubscribed.add(r=>{r.subscription.subscriber._member.id===e.id&&(this.onPublicationUnsubscribed.emit(r),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),e instanceof mn&&e.onPublicationListChanged.pipe(this.onPublicationListChanged).disposer(this._disposer)}_dispose(){this._disposer.dispose()}};Z();var gn="packages/room/src/publication/index.ts",ro=new Ie(gn),Bg=class{constructor(e,i){this._publication=e,this._room=i,this._disposer=new ei,this._events=new Ti,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new De,this.enable=()=>new Promise((s,o)=>{this._origin?Promise.all([this._origin.enable(),this._publication.onEnabled.asPromise()]).then(()=>s()).catch(o):this._publication.enable().then(s).catch(o)}),this.disable=()=>new Promise((s,o)=>{this._origin?Promise.all([this._origin.disable(),this._publication.onDisabled.asPromise()]).then(()=>s()).catch(o):this._publication.disable().then(s).catch(o)}),this.replaceStream=(s,o={})=>{this._preferredPublication.replaceStream(s,o)};var r;this.id=e.id,this.contentType=e.contentType,this._origin=e.origin;{const s=(r=this._origin)!=null?r:this._publication;this.publisher=this._room._getMember(s.publisher.id)}this._setEvents()}_setEvents(){var e;this._room.onStreamUnpublished.add(i=>{i.publication.id===this.id&&this._dispose()}),this._room.onPublicationSubscribed.add(i=>{i.subscription.publication.id===this.id&&(this.onSubscribed.emit({subscription:i.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._room.onPublicationUnsubscribed.add(i=>{i.subscription.publication.id===this.id&&(this.onUnsubscribed.emit({subscription:i.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._publication.onEnabled.pipe(this.onEnabled),this._publication.onDisabled.pipe(this.onDisabled),this._publication.onStateChanged.pipe(this.onStateChanged),((e=this._origin)!=null?e:this._publication).onMetadataUpdated.pipe(this.onMetadataUpdated),this._origin?this._origin.onConnectionStateChanged.add(i=>{ro.debug("this._origin.onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit({state:i.state})}):this._publication.onConnectionStateChanged.add(i=>{ro.debug("this._publication.onConnectionStateChanged",this.id,i),this.onConnectionStateChanged.emit({state:i.state,remoteMember:this._room._getMember(i.remoteMember.id)})})}get subscriptions(){return this._publication.subscriptions.map(e=>this._room._getSubscription(e.id))}get _preferredPublication(){var e;return(e=this._origin)!=null?e:this._publication}get codecCapabilities(){return this._preferredPublication.codecCapabilities}get encodings(){return this._preferredPublication.encodings}get stream(){return this._preferredPublication.stream}get state(){return this._preferredPublication.state}get metadata(){return this._preferredPublication.metadata}cancel(){return M(this,null,function*(){yield Promise.all([this._preferredPublication.cancel(),this.onCanceled.asPromise()])})}updateMetadata(e){return M(this,null,function*(){yield this._preferredPublication.updateMetadata(e)})}updateEncodings(e){this._preferredPublication.updateEncodings(e)}_dispose(){this.onCanceled.emit(),this._events.dispose(),this._disposer.dispose()}getStats(e){var i;if(this._origin){const r=(i=this._origin.subscriptions.find(s=>s.subscriber.subtype===er.subtype))==null?void 0:i.subscriber;if(!r)throw Bt({operationName:"RoomPublicationImpl.getStats",room:this._room,path:gn,info:ge(ue({},Ht.notFound),{detail:"bot not found"})});return this._origin.getStats(r)}else{const r=typeof e=="string"?e:e.id;return this._publication.getStats(r)}}getRTCPeerConnection(e){var i;if(this._origin){const r=(i=this._origin.subscriptions.find(s=>s.subscriber.subtype===er.subtype))==null?void 0:i.subscriber;if(!r)throw Bt({operationName:"RoomPublicationImpl.getRTCPeerConnection",room:this._room,path:gn,info:ge(ue({},Ht.notFound),{detail:"bot not found"})});return this._origin.getRTCPeerConnection(r)}else{const r=typeof e=="string"?e:e.id;return this._publication.getRTCPeerConnection(r)}}getConnectionState(e){var i;if(this._origin){const r=(i=this._origin.subscriptions.find(s=>s.subscriber.subtype===er.subtype))==null?void 0:i.subscriber;if(!r)throw Bt({operationName:"RoomPublicationImpl.getConnectionState",room:this._room,path:gn,info:ge(ue({},Ht.notFound),{detail:"bot not found"})});return this._origin.getConnectionState(r)}else{const r=typeof e=="string"?e:e.id;return this._publication.getConnectionState(r)}}toJSON(){return{id:this.id,contentType:this.contentType,metadata:this.metadata,publisher:this.publisher,subscriptions:this.subscriptions,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state}}};Z();Z();var Hg="1.9.2";Z();Z();Z();var ws=new Ie("packages/room/src/subscription/index.ts"),Ug=class{constructor(e,i){this._subscription=e,this._room=i,this._context=this._room._context,this.onStreamAttached=new De,this.onCanceled=new De,this.onConnectionStateChanged=new De,this.id=e.id,this.contentType=e.contentType,this.publication=this._room._getPublication(e.publication.id),this.subscriber=this._room._getMember(e.subscriber.id),e.onStreamAttached.pipe(this.onStreamAttached),e.onCanceled.pipe(this.onCanceled),e.onConnectionStateChanged.add(r=>{ws.debug("_subscription.onConnectionStateChanged",this.id,r),this.onConnectionStateChanged.emit(r)})}get stream(){return this._subscription.stream}get state(){return this._subscription.state}get codec(){return this._subscription.codec}get preferredEncoding(){return this._subscription.preferredEncoding}changePreferredEncoding(e){this._subscription.changePreferredEncoding(e)}cancel(){return M(this,null,function*(){this._subscription.cancel().catch(e=>{ws.error("subscription.cancel",e,this.toJSON())}),yield this._room.onPublicationUnsubscribed.watch(e=>e.subscription.id===this.id,this._context.config.rtcApi.timeout).catch(e=>{throw Bt({operationName:"RoomSubscriptionImpl.cancel",context:this._context,room:this._room,info:ge(ue({},Ht.timeout),{detail:"onPublicationUnsubscribed"}),error:e,path:ws.prefix})})})}toJSON(){return{id:this.id,contentType:this.contentType,publication:this.publication,codec:this.codec}}getStats(){return this._subscription.getStats()}getRTCPeerConnection(){return this._subscription.getRTCPeerConnection()}getConnectionState(){return this._subscription.getConnectionState()}},no=new Ie("packages/room/src/room/base.ts"),Xc=class{constructor(e,i){this._channel=i,this._members={},this._publications={},this._subscriptions={},this._context=this._channel._context,this._events=new Ti,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.type=e,this._channel.onClosed.pipe(this.onClosed),this._channel.onMetadataUpdated.pipe(this.onMetadataUpdated),this._channel.onMemberMetadataUpdated.add(r=>{this._handleOnMemberMetadataUpdate(r)})}_getMember(e){return this._members[e]}_getPublication(e){return this._publications[e]}_addPublication(e){const i=this._publications[e.id];if(i)return i;const r=new Bg(e,this);return this._publications[e.id]=r,r}_getSubscription(e){return this._subscriptions[e]}_addSubscription(e){const i=this._subscriptions[e.id];if(i)return i;const r=new Ug(e,this);return this._subscriptions[e.id]=r,r}get id(){return this._channel.id}get name(){return this._channel.name}get metadata(){return this._channel.metadata}get state(){return this._channel.state}get disposed(){return this._channel.disposed}_handleOnMemberMetadataUpdate(e){const i=this._getMember(e.member.id);this.onMemberMetadataUpdated.emit({member:i,metadata:e.metadata})}get members(){return Object.values(this._members)}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}joinChannel(){return M(this,arguments,function*(e={}){var i;if(this.state!=="opened")throw Bt({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:Ht.roomNotOpened,path:no.prefix});e.name=(i=e.name)!=null?i:Ii();const r=yield this._channel.join(e);return this._getMember(r.id)||(yield this.onMemberJoined.watch(s=>s.member._member.id===r.id,this._context.config.rtcApi.timeout).catch(s=>{throw Bt({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:ge(ue({},Ht.timeout),{detail:"RoomImpl onMemberJoined"}),path:no.prefix,error:s})})),r})}leave(e){return M(this,null,function*(){yield this._channel.leave(e._member)})}moveRoom(e){return M(this,null,function*(){return yield this._channel.moveChannel(e._local),e._updateRoom(this),e})}updateMetadata(e){return this._channel.updateMetadata(e)}close(){return M(this,null,function*(){yield this._channel.close()})}dispose(){return M(this,null,function*(){return this._channel.dispose()})}toJSON(){return{type:this.type,id:this.id,name:this.name,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}},qg=new Ie("packages/room/src/room/p2p.ts"),Vg=class extends Xc{constructor(e){super("p2p",e),this.setChannelState(),this.setChannelListener()}setChannelState(){this._channel.members.forEach(e=>{const i=new wn(e,this);this._members[e.id]=i}),this._channel.publications.forEach(e=>{this._addPublication(e)}),this._channel.subscriptions.forEach(e=>{this._addSubscription(e)})}setChannelListener(){this._channel.onMemberJoined.add(e=>this._handleOnMemberJoin(e.member)),this._channel.onMemberLeft.add(e=>this._handleOnMemberLeft(e.member)),this._channel.onStreamPublished.add(e=>this._handleOnStreamPublish(e.publication)),this._channel.onStreamUnpublished.add(e=>this._handleOnStreamUnpublish(e.publication)),this._channel.onPublicationMetadataUpdated.add(e=>{this._handleOnPublicationMetadataUpdate(e.publication)}),this._channel.onPublicationEnabled.add(e=>{this._handleOnPublicationEnabled(e.publication)}),this._channel.onPublicationDisabled.add(e=>{this._handleOnPublicationDisabled(e.publication)}),this._channel.onPublicationSubscribed.add(e=>this._handleOnStreamSubscribe(e.subscription)),this._channel.onPublicationUnsubscribed.add(e=>this._handleOnStreamUnsubscribe(e.subscription))}_handleOnMemberJoin(e){if(this._getMember(e.id))return;const i=new wn(e,this);this._members[e.id]=i,this.onMemberJoined.emit({member:i}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(e){const i=this._getMember(e.id);delete this._members[e.id],i._dispose(),this.onMemberLeft.emit({member:i}),this.onMemberListChanged.emit({})}_handleOnStreamPublish(e){if(this._getPublication(e.id))return;const i=this._addPublication(e);this.onStreamPublished.emit({publication:i}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(e){const i=this._getPublication(e.id);delete this._publications[e.id],this.onStreamUnpublished.emit({publication:i}),this.onPublicationListChanged.emit({})}_handleOnPublicationMetadataUpdate(e){const i=this._getPublication(e.id);this.onPublicationMetadataUpdated.emit({publication:i,metadata:i.metadata})}_handleOnPublicationEnabled(e){const i=this._getPublication(e.id);this.onPublicationEnabled.emit({publication:i})}_handleOnPublicationDisabled(e){const i=this._getPublication(e.id);this.onPublicationDisabled.emit({publication:i})}_handleOnStreamSubscribe(e){if(this._getSubscription(e.id))return;const i=this._addSubscription(e);this.onPublicationSubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(e){const i=this._getSubscription(e.id);delete this._subscriptions[e.id],this.onPublicationUnsubscribed.emit({subscription:i}),this.onSubscriptionListChanged.emit({})}join(){return M(this,arguments,function*(e={}){const i=yield this.joinChannel(e),r=new Ng(i,this);return qg.debug("member joined",e),this.localRoomMember=r,r.onLeft.once(()=>{this.localRoomMember=void 0}),r})}};Z();var Kg=new Ie("packages/room/src/room/sfu.ts"),zg=class Qc extends Xc{constructor(i,r){super("sfu",i),this._plugin=r,this.setChannelState(),this.setChannelListener()}static Create(i,r){return M(this,null,function*(){const s=i.plugins.find(d=>d.subtype==="sfu");return r.members.find(d=>d.subtype===er.subtype)||(yield s.createBot(r)),new Qc(r,s)})}setChannelState(){this._channel.members.forEach(i=>{if(i.type==="bot")return;const r=new wn(i,this);this._members[i.id]=r}),this._channel.publications.forEach(i=>{i.origin&&this._addPublication(i)}),this._channel.subscriptions.forEach(i=>{i.subscriber.type!=="bot"&&this._addSubscription(i)})}setChannelListener(){this._channel.onMemberJoined.add(i=>this._handleOnMemberJoin(i.member)),this._channel.onMemberLeft.add(i=>this._handleOnMemberLeft(i.member)),this._channel.onStreamPublished.add(i=>{this._handleOnStreamPublish(i.publication)}),this._channel.onStreamUnpublished.add(i=>this._handleOnStreamUnpublish(i.publication)),this._channel.onPublicationMetadataUpdated.add(i=>{this._handleOnPublicationMetadataUpdate(i.publication)}),this._channel.onPublicationEnabled.add(i=>{this._handleOnPublicationEnabled(i.publication)}),this._channel.onPublicationDisabled.add(i=>{this._handleOnPublicationDisabled(i.publication)}),this._channel.onPublicationSubscribed.add(i=>{this._handleOnStreamSubscribe(i.subscription)}),this._channel.onPublicationUnsubscribed.add(i=>this._handleOnStreamUnsubscribe(i.subscription))}_handleOnMemberJoin(i){if(i.type==="bot")return;const r=new wn(i,this);this._members[i.id]=r,this.onMemberJoined.emit({member:r}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(i){const r=this._getMember(i.id);r&&(delete this._members[i.id],r._dispose(),this.onMemberLeft.emit({member:r}),this.onMemberListChanged.emit({}))}_handleOnStreamPublish(i){var r;if(!((r=i.origin)!=null&&r.id))return;const s=this._addPublication(i);this.onStreamPublished.emit({publication:s}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(i){var r;if(!((r=i.origin)!=null&&r.id))return;const s=this._getPublication(i.id);delete this._publications[i.id],this.onStreamUnpublished.emit({publication:s}),this.onPublicationListChanged.emit({})}_getRelayedPublication(i){return this.publications.find(s=>{var o;return((o=s._publication.origin)==null?void 0:o.id)===i})}_handleOnPublicationMetadataUpdate(i){const r=this._getRelayedPublication(i.id);r&&this.onPublicationMetadataUpdated.emit({publication:r,metadata:r.metadata})}_handleOnPublicationEnabled(i){const r=this._getRelayedPublication(i.id);r&&this.onPublicationEnabled.emit({publication:r})}_handleOnPublicationDisabled(i){const r=this._getRelayedPublication(i.id);r&&this.onPublicationDisabled.emit({publication:r})}_handleOnStreamSubscribe(i){if(i.subscriber.type==="bot")return;const r=this._addSubscription(i);this.onPublicationSubscribed.emit({subscription:r}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(i){if(i.subscriber.type==="bot")return;const r=this._getSubscription(i.id);delete this._subscriptions[i.id],this.onPublicationUnsubscribed.emit({subscription:r}),this.onSubscriptionListChanged.emit({})}join(){return M(this,arguments,function*(i={}){const r=yield this.joinChannel(ge(ue({},i),{disableSignaling:!0})),s=new jg(r,this);return this.localRoomMember=s,s.onLeft.once(()=>{this.localRoomMember=void 0}),Kg.debug("member joined",i),s})}},Yc=new Ie("packages/room/src/room/index.ts"),ci=class{constructor(){}};ci.Create=(e,i)=>M(ci,null,function*(){var r,s;Yc.info("room created",{operationName:"SkyWayRoom._Factory",sdkName:"room",sdkVersion:Hg,init:i});const o=new Hn((r=i==null?void 0:i.options)==null?void 0:r.sfu);e.registerPlugin(o);const l=yield Xs.Create(e,{name:(s=i.name)!=null?s:Ii(),metadata:i.metadata});return yield ci._Factory(e,i.type,l)});ci.Find=(e,i,r,s)=>M(ci,null,function*(){const o=new Hn(s==null?void 0:s.sfu);e.registerPlugin(o);const l=yield Xs.Find(e,i);return yield ci._Factory(e,r,l)});ci.FindOrCreate=(e,i)=>M(ci,null,function*(){var r;const s=new Hn((r=i==null?void 0:i.options)==null?void 0:r.sfu);e.registerPlugin(s);const o=yield Xs.FindOrCreate(e,ue({},i));return yield ci._Factory(e,i.type,o)});ci._Factory=(e,i,r)=>M(ci,null,function*(){switch(i){case"p2p":return new Vg(r);case"sfu":return yield zg.Create(e,r);default:throw Se({operationName:"SkyWayRoom._Factory",context:e,channel:r,info:Ht.notImplemented,path:Yc.prefix})}});var Jg=ci;Z();/*! Bundled license information:

jsrsasign/lib/jsrsasign.js:
  (*! CryptoJS v3.1.2 core-fix.js
   * code.google.com/p/crypto-js
   * (c) 2009-2013 by Jeff Mott. All rights reserved.
   * code.google.com/p/crypto-js/wiki/License
   * THIS IS FIX of 'core.js' to fix Hmac issue.
   * https://code.google.com/p/crypto-js/issues/detail?id=84
   * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
   *)
  (*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
   *)
  (*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/export{Lr as S,ig as a,Jg as b,$g as c,Wg as n,Ur as u};
