import{s as q,n as P,r as z,o as F,b as M}from"../chunks/scheduler.Ce_0Mfso.js";import{S as U,i as G,e as _,t as V,s as A,c as v,a as g,b as N,d as w,f as B,k as R,l as E,g as H,h as i,m as W,j as J}from"../chunks/index.CT52lF6p.js";import{a as K,b as L,c as Q}from"../chunks/index.CU4dFde9.js";const X=!1,Y=!0,ne=Object.freeze(Object.defineProperty({__proto__:null,prerender:Y,ssr:X},Symbol.toStringTag,{value:"Module"}));function Z(r){let t,n,h,s,f,b,u,o,I="join",d,c,T="leave",S,m,j,a,k,y,l,C;return{c(){t=_("main"),n=_("p"),h=V("ID: "),s=_("span"),f=V(r[2]),b=A(),u=_("div"),o=_("button"),o.textContent=I,d=A(),c=_("button"),c.textContent=T,S=A(),m=_("video"),j=A(),a=_("div"),k=A(),y=_("div"),this.h()},l(p){t=v(p,"MAIN",{});var e=g(t);n=v(e,"P",{});var D=g(n);h=N(D,"ID: "),s=v(D,"SPAN",{id:!0});var O=g(s);f=N(O,r[2]),O.forEach(w),D.forEach(w),b=B(e),u=v(e,"DIV",{});var x=g(u);o=v(x,"BUTTON",{id:!0,"data-svelte-h":!0}),R(o)!=="svelte-uqik4z"&&(o.textContent=I),d=B(x),c=v(x,"BUTTON",{id:!0,"data-svelte-h":!0}),R(c)!=="svelte-vgx7o6"&&(c.textContent=T),x.forEach(w),S=B(e),m=v(e,"VIDEO",{width:!0,class:!0}),g(m).forEach(w),j=B(e),a=v(e,"DIV",{id:!0}),g(a).forEach(w),k=B(e),y=v(e,"DIV",{id:!0}),g(y).forEach(w),e.forEach(w),this.h()},h(){E(s,"id","my-id"),E(o,"id","join"),E(c,"id","leave"),E(m,"width","400px"),m.playsInline=!0,E(m,"class","svelte-17cowuk"),E(a,"id","remote-media-area"),E(y,"id","button-area")},m(p,e){H(p,t,e),i(t,n),i(n,h),i(n,s),i(s,f),i(t,b),i(t,u),i(u,o),i(u,d),i(u,c),i(t,S),i(t,m),r[6](m),i(t,j),i(t,a),r[7](a),i(t,k),i(t,y),r[8](y),l||(C=[W(o,"click",r[4]),W(c,"click",r[5])],l=!0)},p(p,[e]){e&4&&J(f,p[2])},i:P,o:P,d(p){p&&w(t),r[6](null),r[7](null),r[8](null),l=!1,z(C)}}}function $(r,t,n){let h,s,f="",b,u,o,I,d;F(async()=>{n(3,o=document.getElementById("button-area")),n(1,s=document.getElementById("remote-media-area")),n(2,f=document.getElementById("my-id")),document.getElementById("join"),document.getElementById("leave"),typeof window<"u"&&window.RTCPeerConnection&&(I="")});async function c(){u=await K.Create(I),b=await L.FindOrCreate(u,{type:"p2p",name:"love_is_war"}),d=await b.join(),n(2,f=d.id);const{audio:a,video:k}=await Q.createMicrophoneAudioAndCameraStream();k.attach(h),await h.play(),await d.publish(a),await d.publish(k);const y=l=>{if(l.publisher.id===d.id)return;const C=document.createElement("button");C.id=`subscribe-button-${l.id}`,C.textContent=`${l.publisher.id}: ${l.contentType}`,o.appendChild(C),C.onclick=async()=>{const{stream:p}=await d.subscribe(l.id);let e;switch(p.track.kind){case"video":e=document.createElement("video"),e.playsInline=!0,e.autoplay=!0;break;case"audio":e=document.createElement("audio"),e.controls=!0,e.autoplay=!0;break;default:return}e.id=`media-${l.id}`,p.attach(e),s.appendChild(e)}};b.publications.forEach(y),b.onStreamPublished.add(l=>y(l.publication))}async function T(){d&&(await d.leave(),await b.dispose(),n(2,f=""),o.replaceChildren(),s.replaceChildren())}function S(a){M[a?"unshift":"push"](()=>{h=a,n(0,h)})}function m(a){M[a?"unshift":"push"](()=>{s=a,n(1,s)})}function j(a){M[a?"unshift":"push"](()=>{o=a,n(3,o)})}return[h,s,f,o,c,T,S,m,j]}class oe extends U{constructor(t){super(),G(this,t,$,Z,q,{})}}export{oe as component,ne as universal};
